###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    18/Mar/2013  18:21:53 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \hal\target\CC2430EB\hal_led.c                     #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wEndev.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\Tools #
#                          \CC2430DB\f8wConfig.cfg" (-DSECURE=0               #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\hal\targ #
#                          et\CC2430EB\hal_led.c" -D CC2430EB -D AXD_END3 -D  #
#                          NWK_AUTO_POLL -D REFLECTOR -D xZTOOL_P1 -D         #
#                          xMT_TASK -D xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG   #
#                          -D xPOWER_SAVING -lC "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\EndDeviceEB3\L #
#                          ist\" -lA "C:\Texas Instruments\ZStack-1.4.3-1.2.1 #
#                          \Projects\zstack\Samples\cc2430-zstack-adxl345\CC2 #
#                          430DB\EndDeviceEB3\List\" --diag_suppress          #
#                          Pe001,Pa010 --diag_remark pe550 -o "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\EndDeviceEB3\O #
#                          bj\" -e --require_prototypes -z2 --no_cse          #
#                          --no_unroll --no_inline --no_code_motion           #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\SOURCE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\cc2430-zstack-adxl345 #
#                          \CC2430DB\..\Drivers\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\ZMAIN #
#                          \TI2430DB\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\EndDe #
#                          viceEB3\List\hal_led.lst                           #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\EndDe #
#                          viceEB3\Obj\hal_led.r51                            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\hal\target\CC2430EB\hal_led.c
      1          /**************************************************************************************************
      2            Filename:       hal_led.c
      3            Revised:        $Date: 2007-11-01 08:44:53 -0700 (Thu, 01 Nov 2007) $
      4            Revision:       $Revision: 15821 $
      5          
      6            Description:    This file contains the interface to the HAL LED Service.
      7          
      8          
      9            Copyright 2006-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /***************************************************************************************************
     41           *                                             INCLUDES
     42           ***************************************************************************************************/
     43          #include "hal_mcu.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa0
   \   union <unnamed> volatile __sfr _A_P2
   \                     _A_P2:
   \   000000                DS 1
     44          #include "hal_defs.h"
     45          #include "hal_types.h"
     46          #include "hal_drivers.h"
     47          #include "hal_led.h"
     48          #include "osal.h"
     49          #include "hal_board.h"
     50          
     51          /***************************************************************************************************
     52           *                                             CONSTANTS
     53           ***************************************************************************************************/
     54          
     55          /***************************************************************************************************
     56           *                                              MACROS
     57           ***************************************************************************************************/
     58          
     59          /***************************************************************************************************
     60           *                                              TYPEDEFS
     61           ***************************************************************************************************/
     62          /* LED control structure */
     63          typedef struct {
     64            uint8 mode;       /* Operation mode */
     65            uint8 todo;       /* Blink cycles left */
     66            uint8 onPct;      /* On cycle percentage */
     67            uint16 time;      /* On/off cycle time (msec) */
     68            uint32 next;      /* Time for next change */
     69          } HalLedControl_t;
     70          
     71          typedef struct
     72          {
     73            HalLedControl_t HalLedControlTable[HAL_LED_DEFAULT_MAX_LEDS];
     74            uint8           sleepActive;
     75          } HalLedStatus_t;
     76          
     77          
     78          /***************************************************************************************************
     79           *                                           GLOBAL VARIABLES
     80           ***************************************************************************************************/
     81          
     82          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     83          static uint8 HalLedState;              // LED state at last set/clr/blink update
   \                     HalLedState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     84          static uint8 HalSleepLedState;         // LED state at last set/clr/blink update
   \                     HalSleepLedState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     85          static uint8 preBlinkState;            // Original State before going to blink mode
   \                     preBlinkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     86                                                 // bit 0, 1, 2, 3 represent led 0, 1, 2, 3
     87          
     88          #ifdef BLINK_LEDS

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     89            static HalLedStatus_t HalLedStatusControl;
   \                     HalLedStatusControl:
   \   000000                DS 37
   \   000025                REQUIRE __INIT_XDATA_Z
     90          #endif
     91          
     92          /***************************************************************************************************
     93           *                                            LOCAL FUNCTION
     94           ***************************************************************************************************/
     95          #if (HAL_LED == TRUE)
     96          void HalLedUpdate (void);
     97          void HalLedOnOff (uint8 leds, uint8 mode);
     98          #endif /* HAL_LED */
     99          
    100          /***************************************************************************************************
    101           *                                            FUNCTIONS - API
    102           ***************************************************************************************************/
    103          
    104          /***************************************************************************************************
    105           * @fn      HalLedInit
    106           *
    107           * @brief   Initialize LED Service
    108           *
    109           * @param   init - pointer to void that contains the initialized value
    110           *
    111           * @return  None
    112           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    113          void HalLedInit (void)
   \                     HalLedInit:
    114          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    115          #if (HAL_LED == TRUE)
    116            /* Initialize all LEDs to OFF */
    117            HalLedSet (HAL_LED_ALL, HAL_LED_MODE_OFF);
   \   000004                ; Setup parameters for call to function HalLedSet
   \   000004   7A00         MOV     R2,#0x0
   \   000006   790F         MOV     R1,#0xf
   \   000008   12....       LCALL   ??HalLedSet?relay
    118            /* Initialize sleepActive to FALSE */
    119            HalLedStatusControl.sleepActive = FALSE;
   \   00000B   7400         MOV     A,#0x0
   \   00000D   90....       MOV     DPTR,#(HalLedStatusControl + 36)
   \   000010   F0           MOVX    @DPTR,A
    120          #endif /* HAL_LED */
    121          }
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
    122          
    123          /***************************************************************************************************
    124           * @fn      HalLedSet
    125           *
    126           * @brief   Tun ON/OFF/TOGGLE given LEDs
    127           *
    128           * @param   led - bit mask value of leds to be turned ON/OFF/TOGGLE
    129           *          mode - BLINK, FLASH, TOGGLE, ON, OFF
    130           * @return  None
    131           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    132          uint8 HalLedSet (uint8 leds, uint8 mode)
   \                     HalLedSet:
    133          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
    134          
    135          #if (defined (BLINK_LEDS)) && (HAL_LED == TRUE)
    136            uint8 led;
    137            HalLedControl_t *sts;
    138          
    139            switch (mode)
   \   000009   EE           MOV     A,R6
   \   00000A   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for HalLedSet>_0`:
   \   00000D   01           DB        1
   \   00000E   00           DB        0
   \   00000F   01           DB        1
   \   000010   ....         DW        ??HalLedSet_0
   \   000012   03           DB        3
   \   000013   02           DB        2
   \   000014   ....         DW        ??HalLedSet_1
   \   000016   04           DB        4
   \   000017   ....         DW        ??HalLedSet_2
   \   000019   08           DB        8
   \   00001A   ....         DW        ??HalLedSet_0
   \   00001C   ....         DW        ??HalLedSet_3
    140            {
    141              case HAL_LED_MODE_BLINK:
    142                /* Default blink, 1 time, D% duty cycle */
    143                HalLedBlink (leds, 1, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME);
   \                     ??HalLedSet_1:
   \   00001E                ; Setup parameters for call to function HalLedBlink
   \   00001E   7CE8         MOV     R4,#-0x18
   \   000020   7D03         MOV     R5,#0x3
   \   000022   7B05         MOV     R3,#0x5
   \   000024   7A01         MOV     R2,#0x1
   \   000026   A9..         MOV     R1,?V0 + 0
   \   000028   12....       LCALL   ??HalLedBlink?relay
   \   00002B   805E         SJMP    ??HalLedSet_3
    144                break;
    145          
    146              case HAL_LED_MODE_FLASH:
    147                /* Default flash, N times, D% duty cycle */
    148                HalLedBlink (leds, HAL_LED_DEFAULT_FLASH_COUNT, HAL_LED_DEFAULT_DUTY_CYCLE, HAL_LED_DEFAULT_FLASH_TIME);
   \                     ??HalLedSet_2:
   \   00002D                ; Setup parameters for call to function HalLedBlink
   \   00002D   7CE8         MOV     R4,#-0x18
   \   00002F   7D03         MOV     R5,#0x3
   \   000031   7B05         MOV     R3,#0x5
   \   000033   7A32         MOV     R2,#0x32
   \   000035   A9..         MOV     R1,?V0 + 0
   \   000037   12....       LCALL   ??HalLedBlink?relay
   \   00003A   804F         SJMP    ??HalLedSet_3
    149                break;
    150          
    151              case HAL_LED_MODE_ON:
    152              case HAL_LED_MODE_OFF:
    153              case HAL_LED_MODE_TOGGLE:
    154          
    155                led = HAL_LED_1;
   \                     ??HalLedSet_0:
   \   00003C   7F01         MOV     R7,#0x1
    156                leds &= HAL_LED_ALL;
   \   00003E   53..0F       ANL     ?V0 + 0,#0xf
    157                sts = HalLedStatusControl.HalLedControlTable;
   \   000041   75....       MOV     ?V0 + 2,#(HalLedStatusControl & 0xff)
   \   000044   75....       MOV     ?V0 + 3,#((HalLedStatusControl >> 8) & 0xff)
    158          
    159                while (leds)
   \                     ??HalLedSet_4:
   \   000047   E5..         MOV     A,?V0 + 0
   \   000049   6040         JZ      ??HalLedSet_3
    160                {
    161                  if (leds & led)
   \   00004B   EF           MOV     A,R7
   \   00004C   55..         ANL     A,?V0 + 0
   \   00004E   6029         JZ      ??HalLedSet_5
    162                  {
    163                    if (mode != HAL_LED_MODE_TOGGLE)
   \   000050   7408         MOV     A,#0x8
   \   000052   6E           XRL     A,R6
   \   000053   600A         JZ      ??HalLedSet_6
    164                    {
    165                      sts->mode = mode;  /* ON or OFF */
   \   000055   EE           MOV     A,R6
   \   000056   85..82       MOV     DPL,?V0 + 2
   \   000059   85..83       MOV     DPH,?V0 + 3
   \   00005C   F0           MOVX    @DPTR,A
   \   00005D   800A         SJMP    ??HalLedSet_7
    166                    }
    167                    else
    168                    {
    169                      sts->mode ^= HAL_LED_MODE_ON;  /* Toggle */
   \                     ??HalLedSet_6:
   \   00005F   85..82       MOV     DPL,?V0 + 2
   \   000062   85..83       MOV     DPH,?V0 + 3
   \   000065   E0           MOVX    A,@DPTR
   \   000066   6401         XRL     A,#0x1
   \   000068   F0           MOVX    @DPTR,A
    170                    }
    171                    HalLedOnOff (led, sts->mode);
   \                     ??HalLedSet_7:
   \   000069                ; Setup parameters for call to function HalLedOnOff
   \   000069   85..82       MOV     DPL,?V0 + 2
   \   00006C   85..83       MOV     DPH,?V0 + 3
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   FA           MOV     R2,A
   \   000071   EF           MOV     A,R7
   \   000072   F9           MOV     R1,A
   \   000073   12....       LCALL   ??HalLedOnOff?relay
    172                    leds ^= led;
   \   000076   EF           MOV     A,R7
   \   000077   62..         XRL     ?V0 + 0,A
    173                  }
    174                  led <<= 1;
   \                     ??HalLedSet_5:
   \   000079   EF           MOV     A,R7
   \   00007A   C3           CLR     C
   \   00007B   33           RLC     A
   \   00007C   FF           MOV     R7,A
    175                  sts++;
   \   00007D   E5..         MOV     A,?V0 + 2
   \   00007F   2409         ADD     A,#0x9
   \   000081   F5..         MOV     ?V0 + 2,A
   \   000083   E5..         MOV     A,?V0 + 3
   \   000085   3400         ADDC    A,#0x0
   \   000087   F5..         MOV     ?V0 + 3,A
   \   000089   80BC         SJMP    ??HalLedSet_4
    176                }
    177                break;
    178          
    179              default:
    180                break;
    181            }
    182          
    183          #elif (HAL_LED == TRUE)
    184            LedOnOff(leds, mode);
    185          #endif /* BLINK_LEDS && HAL_LED   */
    186          
    187            return ( HalLedState );
   \                     ??HalLedSet_3:
   \   00008B   90....       MOV     DPTR,#HalLedState
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   F9           MOV     R1,A
   \   000090   7F04         MOV     R7,#0x4
   \   000092   02....       LJMP    ?BANKED_LEAVE_XDATA
    188          
    189          }
    190          
    191          /***************************************************************************************************
    192           * @fn      HalLedBlink
    193           *
    194           * @brief   Blink the leds
    195           *
    196           * @param   leds       - bit mask value of leds to be blinked
    197           *          numBlinks  - number of blinks
    198           *          percent    - the percentage in each period where the led
    199           *                       will be on
    200           *          period     - length of each cycle in milliseconds
    201           *
    202           * @return  None
    203           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    204          void HalLedBlink (uint8 leds, uint8 numBlinks, uint8 percent, uint16 period)
   \                     HalLedBlink:
    205          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   C0E0         PUSH    A
   \   00000D   7401         MOV     A,#0x1
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   D0E0         POP     A
   \   000014   F0           MOVX    @DPTR,A
   \   000015   EB           MOV     A,R3
   \   000016   85..82       MOV     DPL,?XSP + 0
   \   000019   85..83       MOV     DPH,?XSP + 1
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?XSTACK_DISP0_8
   \   000022   EC           MOV     A,R4
   \   000023   F0           MOVX    @DPTR,A
   \   000024   A3           INC     DPTR
   \   000025   ED           MOV     A,R5
   \   000026   F0           MOVX    @DPTR,A
   \   000027   89..         MOV     ?V0 + 0,R1
    206          #if (defined (BLINK_LEDS)) && (HAL_LED == TRUE)
    207            uint8 led;
    208            HalLedControl_t *sts;
    209          
    210            if (leds && percent && period)
   \   000029   E5..         MOV     A,?V0 + 0
   \   00002B   7003         JNZ     $+5
   \   00002D   02....       LJMP    ??HalLedBlink_0 & 0xFFFF
   \   000030   85..82       MOV     DPL,?XSP + 0
   \   000033   85..83       MOV     DPH,?XSP + 1
   \   000036   E0           MOVX    A,@DPTR
   \   000037   7003         JNZ     $+5
   \   000039   02....       LJMP    ??HalLedBlink_0 & 0xFFFF
   \   00003C   7402         MOV     A,#0x2
   \   00003E   12....       LCALL   ?XSTACK_DISP0_8
   \   000041   E0           MOVX    A,@DPTR
   \   000042   6400         XRL     A,#0x0
   \   000044   7004         JNZ     ??HalLedBlink_1
   \   000046   A3           INC     DPTR
   \   000047   E0           MOVX    A,@DPTR
   \   000048   6400         XRL     A,#0x0
   \                     ??HalLedBlink_1:
   \   00004A   7003         JNZ     $+5
   \   00004C   02....       LJMP    ??HalLedBlink_0 & 0xFFFF
    211            {
    212              if (percent < 100)
   \   00004F   85..82       MOV     DPL,?XSP + 0
   \   000052   85..83       MOV     DPH,?XSP + 1
   \   000055   E0           MOVX    A,@DPTR
   \   000056   C3           CLR     C
   \   000057   9464         SUBB    A,#0x64
   \   000059   4003         JC      $+5
   \   00005B   02....       LJMP    ??HalLedBlink_2 & 0xFFFF
    213              {
    214                led = HAL_LED_1;
   \   00005E   75..01       MOV     ?V0 + 1,#0x1
    215                leds &= HAL_LED_ALL;
   \   000061   53..0F       ANL     ?V0 + 0,#0xf
    216                sts = HalLedStatusControl.HalLedControlTable;
   \   000064   75....       MOV     ?V0 + 2,#(HalLedStatusControl & 0xff)
   \   000067   75....       MOV     ?V0 + 3,#((HalLedStatusControl >> 8) & 0xff)
    217          
    218                while (leds)
   \                     ??HalLedBlink_3:
   \   00006A   E5..         MOV     A,?V0 + 0
   \   00006C   7003         JNZ     $+5
   \   00006E   02....       LJMP    ??HalLedBlink_4 & 0xFFFF
    219                {
    220                  if (leds & led)
   \   000071   E5..         MOV     A,?V0 + 1
   \   000073   55..         ANL     A,?V0 + 0
   \   000075   7003         JNZ     $+5
   \   000077   02....       LJMP    ??HalLedBlink_5 & 0xFFFF
    221                  {
    222                    /* Store the current state of the led before going to blinking */
    223                    preBlinkState |= (led & HalLedState);
   \   00007A   90....       MOV     DPTR,#HalLedState
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   55..         ANL     A,?V0 + 1
   \   000080   FA           MOV     R2,A
   \   000081   90....       MOV     DPTR,#preBlinkState
   \   000084   E0           MOVX    A,@DPTR
   \   000085   4A           ORL     A,R2
   \   000086   F0           MOVX    @DPTR,A
    224                    
    225                    sts->mode  = HAL_LED_MODE_OFF;                    /* Stop previous blink */
   \   000087   7400         MOV     A,#0x0
   \   000089   85..82       MOV     DPL,?V0 + 2
   \   00008C   85..83       MOV     DPH,?V0 + 3
   \   00008F   F0           MOVX    @DPTR,A
    226                    sts->time  = period;                              /* Time for one on/off cycle */
   \   000090   7402         MOV     A,#0x2
   \   000092   12....       LCALL   ?XSTACK_DISP0_8
   \   000095   E0           MOVX    A,@DPTR
   \   000096   F8           MOV     R0,A
   \   000097   A3           INC     DPTR
   \   000098   E0           MOVX    A,@DPTR
   \   000099   F9           MOV     R1,A
   \   00009A   85..82       MOV     DPL,?V0 + 2
   \   00009D   85..83       MOV     DPH,?V0 + 3
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   E8           MOV     A,R0
   \   0000A4   F0           MOVX    @DPTR,A
   \   0000A5   A3           INC     DPTR
   \   0000A6   E9           MOV     A,R1
   \   0000A7   F0           MOVX    @DPTR,A
    227                    sts->onPct = percent;                             /* % of cycle LED is on */
   \   0000A8   85..82       MOV     DPL,?XSP + 0
   \   0000AB   85..83       MOV     DPH,?XSP + 1
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   85..82       MOV     DPL,?V0 + 2
   \   0000B2   85..83       MOV     DPH,?V0 + 3
   \   0000B5   A3           INC     DPTR
   \   0000B6   A3           INC     DPTR
   \   0000B7   F0           MOVX    @DPTR,A
    228                    sts->todo  = numBlinks;                           /* Number of blink cycles */
   \   0000B8   7401         MOV     A,#0x1
   \   0000BA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   85..82       MOV     DPL,?V0 + 2
   \   0000C1   85..83       MOV     DPH,?V0 + 3
   \   0000C4   A3           INC     DPTR
   \   0000C5   F0           MOVX    @DPTR,A
    229                    if (!numBlinks) sts->mode |= HAL_LED_MODE_FLASH;  /* Continuous */
   \   0000C6   7401         MOV     A,#0x1
   \   0000C8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000CB   E0           MOVX    A,@DPTR
   \   0000CC   700A         JNZ     ??HalLedBlink_6
   \   0000CE   85..82       MOV     DPL,?V0 + 2
   \   0000D1   85..83       MOV     DPH,?V0 + 3
   \   0000D4   E0           MOVX    A,@DPTR
   \   0000D5   D2E2         SETB    0xE0 /* A   */.2
   \   0000D7   F0           MOVX    @DPTR,A
    230                    sts->next = osal_GetSystemClock();                /* Start now */
   \                     ??HalLedBlink_6:
   \   0000D8                ; Setup parameters for call to function osal_GetSystemClock
   \   0000D8   12....       LCALL   ??osal_GetSystemClock?relay
   \   0000DB   8A..         MOV     ?V0 + 4,R2
   \   0000DD   8B..         MOV     ?V0 + 5,R3
   \   0000DF   8C..         MOV     ?V0 + 6,R4
   \   0000E1   8D..         MOV     ?V0 + 7,R5
   \   0000E3   85..82       MOV     DPL,?V0 + 2
   \   0000E6   85..83       MOV     DPH,?V0 + 3
   \   0000E9   A3           INC     DPTR
   \   0000EA   A3           INC     DPTR
   \   0000EB   A3           INC     DPTR
   \   0000EC   A3           INC     DPTR
   \   0000ED   A3           INC     DPTR
   \   0000EE   E5..         MOV     A,?V0 + 4
   \   0000F0   F0           MOVX    @DPTR,A
   \   0000F1   A3           INC     DPTR
   \   0000F2   E5..         MOV     A,?V0 + 5
   \   0000F4   F0           MOVX    @DPTR,A
   \   0000F5   A3           INC     DPTR
   \   0000F6   E5..         MOV     A,?V0 + 6
   \   0000F8   F0           MOVX    @DPTR,A
   \   0000F9   A3           INC     DPTR
   \   0000FA   E5..         MOV     A,?V0 + 7
   \   0000FC   F0           MOVX    @DPTR,A
    231                    sts->mode |= HAL_LED_MODE_BLINK;                  /* Enable blinking */
   \   0000FD   85..82       MOV     DPL,?V0 + 2
   \   000100   85..83       MOV     DPH,?V0 + 3
   \   000103   E0           MOVX    A,@DPTR
   \   000104   D2E1         SETB    0xE0 /* A   */.1
   \   000106   F0           MOVX    @DPTR,A
    232                    leds ^= led;
   \   000107   E5..         MOV     A,?V0 + 1
   \   000109   62..         XRL     ?V0 + 0,A
    233                  }
    234                  led <<= 1;
   \                     ??HalLedBlink_5:
   \   00010B   E5..         MOV     A,?V0 + 1
   \   00010D   C3           CLR     C
   \   00010E   33           RLC     A
   \   00010F   F5..         MOV     ?V0 + 1,A
    235                  sts++;
   \   000111   E5..         MOV     A,?V0 + 2
   \   000113   2409         ADD     A,#0x9
   \   000115   F5..         MOV     ?V0 + 2,A
   \   000117   E5..         MOV     A,?V0 + 3
   \   000119   3400         ADDC    A,#0x0
   \   00011B   F5..         MOV     ?V0 + 3,A
   \   00011D   02....       LJMP    ??HalLedBlink_3 & 0xFFFF
    236                }
    237                osal_set_event (Hal_TaskID, HAL_LED_BLINK_EVENT);
   \                     ??HalLedBlink_4:
   \   000120                ; Setup parameters for call to function osal_set_event
   \   000120   7A02         MOV     R2,#0x2
   \   000122   7B00         MOV     R3,#0x0
   \   000124   90....       MOV     DPTR,#Hal_TaskID
   \   000127   E0           MOVX    A,@DPTR
   \   000128   F9           MOV     R1,A
   \   000129   12....       LCALL   ??osal_set_event?relay
   \   00012C   8010         SJMP    ??HalLedBlink_7
    238              }
    239              else
    240              {
    241                HalLedSet (leds, HAL_LED_MODE_ON);                    /* >= 100%, turn on */
   \                     ??HalLedBlink_2:
   \   00012E                ; Setup parameters for call to function HalLedSet
   \   00012E   7A01         MOV     R2,#0x1
   \   000130   A9..         MOV     R1,?V0 + 0
   \   000132   12....       LCALL   ??HalLedSet?relay
   \   000135   8007         SJMP    ??HalLedBlink_7
    242              }
    243            }
    244            else
    245            {
    246              HalLedSet (leds, HAL_LED_MODE_OFF);                     /* No on time, turn off */
   \                     ??HalLedBlink_0:
   \   000137                ; Setup parameters for call to function HalLedSet
   \   000137   7A00         MOV     R2,#0x0
   \   000139   A9..         MOV     R1,?V0 + 0
   \   00013B   12....       LCALL   ??HalLedSet?relay
    247            }
    248          #elif (HAL_LED == TRUE)
    249            percent = (leds & HalLedState) ? HAL_LED_MODE_OFF : HAL_LED_MODE_ON;
    250            HalLedOnOff (leds, percent);                              /* Toggle */
    251          #endif /* BLINK_LEDS && HAL_LED */
    252          }
   \                     ??HalLedBlink_7:
   \   00013E   7404         MOV     A,#0x4
   \   000140   12....       LCALL   ?DEALLOC_XSTACK8
   \   000143   7F08         MOV     R7,#0x8
   \   000145   02....       LJMP    ?BANKED_LEAVE_XDATA
    253          
    254          #if (HAL_LED == TRUE)
    255          /***************************************************************************************************
    256           * @fn      HalLedUpdate
    257           *
    258           * @brief   Update leds to work with blink
    259           *
    260           * @param   none
    261           *
    262           * @return  none
    263           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    264          void HalLedUpdate (void)
   \                     HalLedUpdate:
    265          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 11
   \   000005   74F5         MOV     A,#-0xb
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    266            uint8 led;
    267            uint8 pct;
    268            uint8 leds;
    269            HalLedControl_t *sts;
    270            uint32 time;
    271            uint16 next;
    272            uint16 wait;
    273          
    274            next = 0;
   \   00000A   7405         MOV     A,#0x5
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   7400         MOV     A,#0x0
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   7400         MOV     A,#0x0
   \   000015   F0           MOVX    @DPTR,A
    275            led  = HAL_LED_1;
   \   000016   7E01         MOV     R6,#0x1
    276            leds = HAL_LED_ALL;
   \   000018   740F         MOV     A,#0xf
   \   00001A   C0E0         PUSH    A
   \   00001C   7402         MOV     A,#0x2
   \   00001E   12....       LCALL   ?XSTACK_DISP0_8
   \   000021   D0E0         POP     A
   \   000023   F0           MOVX    @DPTR,A
    277            sts = HalLedStatusControl.HalLedControlTable;
   \   000024   85..82       MOV     DPL,?XSP + 0
   \   000027   85..83       MOV     DPH,?XSP + 1
   \   00002A   74..         MOV     A,#(HalLedStatusControl & 0xff)
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   A3           INC     DPTR
   \   00002E   74..         MOV     A,#((HalLedStatusControl >> 8) & 0xff)
   \   000030   F0           MOVX    @DPTR,A
    278          
    279            /* Check if sleep is active or not */
    280            if (!HalLedStatusControl.sleepActive)
   \   000031   90....       MOV     DPTR,#(HalLedStatusControl + 36)
   \   000034   E0           MOVX    A,@DPTR
   \   000035   6003         JZ      $+5
   \   000037   02....       LJMP    ??HalLedUpdate_0 & 0xFFFF
    281            {
    282              while (leds)
   \                     ??HalLedUpdate_1:
   \   00003A   7402         MOV     A,#0x2
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   7003         JNZ     $+5
   \   000042   02....       LJMP    ??HalLedUpdate_2 & 0xFFFF
    283              {
    284                if (leds & led)
   \   000045   7402         MOV     A,#0x2
   \   000047   12....       LCALL   ?XSTACK_DISP0_8
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   5E           ANL     A,R6
   \   00004C   7003         JNZ     $+5
   \   00004E   02....       LJMP    ??HalLedUpdate_3 & 0xFFFF
    285                {
    286                  if (sts->mode & HAL_LED_MODE_BLINK)
   \   000051   85..82       MOV     DPL,?XSP + 0
   \   000054   85..83       MOV     DPH,?XSP + 1
   \   000057   E0           MOVX    A,@DPTR
   \   000058   F8           MOV     R0,A
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   F583         MOV     DPH,A
   \   00005D   8882         MOV     DPL,R0
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   A2E1         MOV     C,0xE0 /* A   */.1
   \   000062   4003         JC      $+5
   \   000064   02....       LJMP    ??HalLedUpdate_4 & 0xFFFF
    287                  {
    288                    time = osal_GetSystemClock();
   \   000067                ; Setup parameters for call to function osal_GetSystemClock
   \   000067   12....       LCALL   ??osal_GetSystemClock?relay
   \   00006A   8A..         MOV     ?V0 + 0,R2
   \   00006C   8B..         MOV     ?V0 + 1,R3
   \   00006E   8C..         MOV     ?V0 + 2,R4
   \   000070   8D..         MOV     ?V0 + 3,R5
   \   000072   7407         MOV     A,#0x7
   \   000074   12....       LCALL   ?XSTACK_DISP0_8
   \   000077   E5..         MOV     A,?V0 + 0
   \   000079   F0           MOVX    @DPTR,A
   \   00007A   A3           INC     DPTR
   \   00007B   E5..         MOV     A,?V0 + 1
   \   00007D   F0           MOVX    @DPTR,A
   \   00007E   A3           INC     DPTR
   \   00007F   E5..         MOV     A,?V0 + 2
   \   000081   F0           MOVX    @DPTR,A
   \   000082   A3           INC     DPTR
   \   000083   E5..         MOV     A,?V0 + 3
   \   000085   F0           MOVX    @DPTR,A
    289                    if (time >= sts->next)
   \   000086   7407         MOV     A,#0x7
   \   000088   12....       LCALL   ?XSTACK_DISP0_8
   \   00008B   C082         PUSH    DPL
   \   00008D   C083         PUSH    DPH
   \   00008F   85..82       MOV     DPL,?XSP + 0
   \   000092   85..83       MOV     DPH,?XSP + 1
   \   000095   E0           MOVX    A,@DPTR
   \   000096   F8           MOV     R0,A
   \   000097   A3           INC     DPTR
   \   000098   E0           MOVX    A,@DPTR
   \   000099   F583         MOV     DPH,A
   \   00009B   8882         MOV     DPL,R0
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   78..         MOV     R0,#?V0 + 0
   \   0000A4   12....       LCALL   ?L_MOV_X
   \   0000A7   D083         POP     DPH
   \   0000A9   D082         POP     DPL
   \   0000AB   78..         MOV     R0,#?V0 + 0
   \   0000AD   12....       LCALL   ?UL_GT_X
   \   0000B0   5003         JNC     $+5
   \   0000B2   02....       LJMP    ??HalLedUpdate_5 & 0xFFFF
    290                    {
    291                      if (sts->mode & HAL_LED_MODE_ON)
   \   0000B5   85..82       MOV     DPL,?XSP + 0
   \   0000B8   85..83       MOV     DPH,?XSP + 1
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   F8           MOV     R0,A
   \   0000BD   A3           INC     DPTR
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   F583         MOV     DPH,A
   \   0000C1   8882         MOV     DPL,R0
   \   0000C3   E0           MOVX    A,@DPTR
   \   0000C4   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000C6   507C         JNC     ??HalLedUpdate_6
    292                      {
    293                        pct = 100 - sts->onPct;               /* Percentage of cycle for off */
   \   0000C8   85..82       MOV     DPL,?XSP + 0
   \   0000CB   85..83       MOV     DPH,?XSP + 1
   \   0000CE   E0           MOVX    A,@DPTR
   \   0000CF   F8           MOV     R0,A
   \   0000D0   A3           INC     DPTR
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   F583         MOV     DPH,A
   \   0000D4   8882         MOV     DPL,R0
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   E0           MOVX    A,@DPTR
   \   0000D9   FA           MOV     R2,A
   \   0000DA   7464         MOV     A,#0x64
   \   0000DC   C3           CLR     C
   \   0000DD   9A           SUBB    A,R2
   \   0000DE   FF           MOV     R7,A
    294                        sts->mode &= ~HAL_LED_MODE_ON;        /* Say it's not on */
   \   0000DF   85..82       MOV     DPL,?XSP + 0
   \   0000E2   85..83       MOV     DPH,?XSP + 1
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   F8           MOV     R0,A
   \   0000E7   A3           INC     DPTR
   \   0000E8   E0           MOVX    A,@DPTR
   \   0000E9   F583         MOV     DPH,A
   \   0000EB   8882         MOV     DPL,R0
   \   0000ED   E0           MOVX    A,@DPTR
   \   0000EE   C2E0         CLR     0xE0 /* A   */.0
   \   0000F0   F0           MOVX    @DPTR,A
    295                        HalLedOnOff (led, HAL_LED_MODE_OFF);  /* Turn it off */
   \   0000F1                ; Setup parameters for call to function HalLedOnOff
   \   0000F1   7A00         MOV     R2,#0x0
   \   0000F3   EE           MOV     A,R6
   \   0000F4   F9           MOV     R1,A
   \   0000F5   12....       LCALL   ??HalLedOnOff?relay
    296          
    297                        if (!(sts->mode & HAL_LED_MODE_FLASH))
   \   0000F8   85..82       MOV     DPL,?XSP + 0
   \   0000FB   85..83       MOV     DPH,?XSP + 1
   \   0000FE   E0           MOVX    A,@DPTR
   \   0000FF   F8           MOV     R0,A
   \   000100   A3           INC     DPTR
   \   000101   E0           MOVX    A,@DPTR
   \   000102   F583         MOV     DPH,A
   \   000104   8882         MOV     DPL,R0
   \   000106   E0           MOVX    A,@DPTR
   \   000107   A2E2         MOV     C,0xE0 /* A   */.2
   \   000109   4064         JC      ??HalLedUpdate_7
    298                        {
    299                          sts->todo--;                        /* Not continuous, reduce count */
   \   00010B   85..82       MOV     DPL,?XSP + 0
   \   00010E   85..83       MOV     DPH,?XSP + 1
   \   000111   E0           MOVX    A,@DPTR
   \   000112   F8           MOV     R0,A
   \   000113   A3           INC     DPTR
   \   000114   E0           MOVX    A,@DPTR
   \   000115   F583         MOV     DPH,A
   \   000117   8882         MOV     DPL,R0
   \   000119   A3           INC     DPTR
   \   00011A   E0           MOVX    A,@DPTR
   \   00011B   24FF         ADD     A,#-0x1
   \   00011D   F0           MOVX    @DPTR,A
    300                          if (!sts->todo)
   \   00011E   85..82       MOV     DPL,?XSP + 0
   \   000121   85..83       MOV     DPH,?XSP + 1
   \   000124   E0           MOVX    A,@DPTR
   \   000125   F8           MOV     R0,A
   \   000126   A3           INC     DPTR
   \   000127   E0           MOVX    A,@DPTR
   \   000128   F583         MOV     DPH,A
   \   00012A   8882         MOV     DPL,R0
   \   00012C   A3           INC     DPTR
   \   00012D   E0           MOVX    A,@DPTR
   \   00012E   703F         JNZ     ??HalLedUpdate_7
    301                          {
    302                            sts->mode ^= HAL_LED_MODE_BLINK;  /* No more blinks */
   \   000130   85..82       MOV     DPL,?XSP + 0
   \   000133   85..83       MOV     DPH,?XSP + 1
   \   000136   E0           MOVX    A,@DPTR
   \   000137   F8           MOV     R0,A
   \   000138   A3           INC     DPTR
   \   000139   E0           MOVX    A,@DPTR
   \   00013A   F583         MOV     DPH,A
   \   00013C   8882         MOV     DPL,R0
   \   00013E   E0           MOVX    A,@DPTR
   \   00013F   6402         XRL     A,#0x2
   \   000141   F0           MOVX    @DPTR,A
   \   000142   802B         SJMP    ??HalLedUpdate_7
    303                          }
    304                        }
    305                      }
    306                      else
    307                      {
    308                        pct = sts->onPct;                     /* Percentage of cycle for on */
   \                     ??HalLedUpdate_6:
   \   000144   85..82       MOV     DPL,?XSP + 0
   \   000147   85..83       MOV     DPH,?XSP + 1
   \   00014A   E0           MOVX    A,@DPTR
   \   00014B   F8           MOV     R0,A
   \   00014C   A3           INC     DPTR
   \   00014D   E0           MOVX    A,@DPTR
   \   00014E   F583         MOV     DPH,A
   \   000150   8882         MOV     DPL,R0
   \   000152   A3           INC     DPTR
   \   000153   A3           INC     DPTR
   \   000154   E0           MOVX    A,@DPTR
   \   000155   FF           MOV     R7,A
    309                        sts->mode |= HAL_LED_MODE_ON;         /* Say it's on */
   \   000156   85..82       MOV     DPL,?XSP + 0
   \   000159   85..83       MOV     DPH,?XSP + 1
   \   00015C   E0           MOVX    A,@DPTR
   \   00015D   F8           MOV     R0,A
   \   00015E   A3           INC     DPTR
   \   00015F   E0           MOVX    A,@DPTR
   \   000160   F583         MOV     DPH,A
   \   000162   8882         MOV     DPL,R0
   \   000164   E0           MOVX    A,@DPTR
   \   000165   D2E0         SETB    0xE0 /* A   */.0
   \   000167   F0           MOVX    @DPTR,A
    310                        HalLedOnOff (led, HAL_LED_MODE_ON);   /* Turn it on */
   \   000168                ; Setup parameters for call to function HalLedOnOff
   \   000168   7A01         MOV     R2,#0x1
   \   00016A   EE           MOV     A,R6
   \   00016B   F9           MOV     R1,A
   \   00016C   12....       LCALL   ??HalLedOnOff?relay
    311                      }
    312          
    313                      if (sts->mode & HAL_LED_MODE_BLINK)
   \                     ??HalLedUpdate_7:
   \   00016F   85..82       MOV     DPL,?XSP + 0
   \   000172   85..83       MOV     DPH,?XSP + 1
   \   000175   E0           MOVX    A,@DPTR
   \   000176   F8           MOV     R0,A
   \   000177   A3           INC     DPTR
   \   000178   E0           MOVX    A,@DPTR
   \   000179   F583         MOV     DPH,A
   \   00017B   8882         MOV     DPL,R0
   \   00017D   E0           MOVX    A,@DPTR
   \   00017E   A2E1         MOV     C,0xE0 /* A   */.1
   \   000180   4003         JC      $+5
   \   000182   02....       LJMP    ??HalLedUpdate_8 & 0xFFFF
    314                      {
    315                        wait = (((uint32)pct * (uint32)sts->time) / 100);
   \   000185   8F..         MOV     ?V0 + 0,R7
   \   000187   E4           CLR     A
   \   000188   F5..         MOV     ?V0 + 1,A
   \   00018A   F5..         MOV     ?V0 + 2,A
   \   00018C   F5..         MOV     ?V0 + 3,A
   \   00018E   85..82       MOV     DPL,?XSP + 0
   \   000191   85..83       MOV     DPH,?XSP + 1
   \   000194   E0           MOVX    A,@DPTR
   \   000195   F8           MOV     R0,A
   \   000196   A3           INC     DPTR
   \   000197   E0           MOVX    A,@DPTR
   \   000198   F583         MOV     DPH,A
   \   00019A   8882         MOV     DPL,R0
   \   00019C   A3           INC     DPTR
   \   00019D   A3           INC     DPTR
   \   00019E   A3           INC     DPTR
   \   00019F   E0           MOVX    A,@DPTR
   \   0001A0   F5..         MOV     ?V0 + 4,A
   \   0001A2   A3           INC     DPTR
   \   0001A3   E0           MOVX    A,@DPTR
   \   0001A4   F5..         MOV     ?V0 + 5,A
   \   0001A6   E4           CLR     A
   \   0001A7   F5..         MOV     ?V0 + 6,A
   \   0001A9   F5..         MOV     ?V0 + 7,A
   \   0001AB   78..         MOV     R0,#?V0 + 0
   \   0001AD   79..         MOV     R1,#?V0 + 4
   \   0001AF   12....       LCALL   ?L_MUL
   \   0001B2   90....       MOV     DPTR,#__Constant_64
   \   0001B5   78..         MOV     R0,#?V0 + 4
   \   0001B7   12....       LCALL   ?L_MOV_X
   \   0001BA   78..         MOV     R0,#?V0 + 0
   \   0001BC   79..         MOV     R1,#?V0 + 4
   \   0001BE   12....       LCALL   ?UL_DIV_MOD
   \   0001C1   7403         MOV     A,#0x3
   \   0001C3   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C6   E5..         MOV     A,?V0 + 0
   \   0001C8   F0           MOVX    @DPTR,A
   \   0001C9   A3           INC     DPTR
   \   0001CA   E5..         MOV     A,?V0 + 1
   \   0001CC   F0           MOVX    @DPTR,A
    316                        sts->next = time + wait;
   \   0001CD   7407         MOV     A,#0x7
   \   0001CF   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D2   C082         PUSH    DPL
   \   0001D4   C083         PUSH    DPH
   \   0001D6   7403         MOV     A,#0x3
   \   0001D8   12....       LCALL   ?XSTACK_DISP0_8
   \   0001DB   E0           MOVX    A,@DPTR
   \   0001DC   F5..         MOV     ?V0 + 0,A
   \   0001DE   A3           INC     DPTR
   \   0001DF   E0           MOVX    A,@DPTR
   \   0001E0   F5..         MOV     ?V0 + 1,A
   \   0001E2   E4           CLR     A
   \   0001E3   F5..         MOV     ?V0 + 2,A
   \   0001E5   F5..         MOV     ?V0 + 3,A
   \   0001E7   D083         POP     DPH
   \   0001E9   D082         POP     DPL
   \   0001EB   78..         MOV     R0,#?V0 + 0
   \   0001ED   12....       LCALL   ?L_ADD_X
   \   0001F0   85..82       MOV     DPL,?XSP + 0
   \   0001F3   85..83       MOV     DPH,?XSP + 1
   \   0001F6   E0           MOVX    A,@DPTR
   \   0001F7   F8           MOV     R0,A
   \   0001F8   A3           INC     DPTR
   \   0001F9   E0           MOVX    A,@DPTR
   \   0001FA   F583         MOV     DPH,A
   \   0001FC   8882         MOV     DPL,R0
   \   0001FE   A3           INC     DPTR
   \   0001FF   A3           INC     DPTR
   \   000200   A3           INC     DPTR
   \   000201   A3           INC     DPTR
   \   000202   A3           INC     DPTR
   \   000203   E5..         MOV     A,?V0 + 0
   \   000205   F0           MOVX    @DPTR,A
   \   000206   A3           INC     DPTR
   \   000207   E5..         MOV     A,?V0 + 1
   \   000209   F0           MOVX    @DPTR,A
   \   00020A   A3           INC     DPTR
   \   00020B   E5..         MOV     A,?V0 + 2
   \   00020D   F0           MOVX    @DPTR,A
   \   00020E   A3           INC     DPTR
   \   00020F   E5..         MOV     A,?V0 + 3
   \   000211   F0           MOVX    @DPTR,A
   \   000212   8066         SJMP    ??HalLedUpdate_9
    317                      }
    318                      else
    319                      {
    320                        /* no more blink, no more wait */
    321                        wait = 0;
   \                     ??HalLedUpdate_8:
   \   000214   7403         MOV     A,#0x3
   \   000216   12....       LCALL   ?XSTACK_DISP0_8
   \   000219   7400         MOV     A,#0x0
   \   00021B   F0           MOVX    @DPTR,A
   \   00021C   A3           INC     DPTR
   \   00021D   7400         MOV     A,#0x0
   \   00021F   F0           MOVX    @DPTR,A
    322                        /* After blinking, set the LED back to the state before it blinks */
    323                        HalLedSet (led, ((preBlinkState & led)!=0)?HAL_LED_MODE_ON:HAL_LED_MODE_OFF);
   \   000220   90....       MOV     DPTR,#preBlinkState
   \   000223   E0           MOVX    A,@DPTR
   \   000224   5E           ANL     A,R6
   \   000225   6004         JZ      ??HalLedUpdate_10
   \   000227   7A01         MOV     R2,#0x1
   \   000229   8002         SJMP    ??HalLedUpdate_11
   \                     ??HalLedUpdate_10:
   \   00022B   7A00         MOV     R2,#0x0
   \                     ??HalLedUpdate_11:
   \   00022D                ; Setup parameters for call to function HalLedSet
   \   00022D   EE           MOV     A,R6
   \   00022E   F9           MOV     R1,A
   \   00022F   12....       LCALL   ??HalLedSet?relay
    324                        /* Clear the saved bit */
    325                        preBlinkState &= ~led;
   \   000232   EE           MOV     A,R6
   \   000233   F4           CPL     A
   \   000234   FA           MOV     R2,A
   \   000235   90....       MOV     DPTR,#preBlinkState
   \   000238   E0           MOVX    A,@DPTR
   \   000239   5A           ANL     A,R2
   \   00023A   F0           MOVX    @DPTR,A
   \   00023B   803D         SJMP    ??HalLedUpdate_9
    326                      }
    327                    }
    328                    else
    329                    {
    330                      wait = sts->next - time;  /* Time left */
   \                     ??HalLedUpdate_5:
   \   00023D   85..82       MOV     DPL,?XSP + 0
   \   000240   85..83       MOV     DPH,?XSP + 1
   \   000243   E0           MOVX    A,@DPTR
   \   000244   F8           MOV     R0,A
   \   000245   A3           INC     DPTR
   \   000246   E0           MOVX    A,@DPTR
   \   000247   F583         MOV     DPH,A
   \   000249   8882         MOV     DPL,R0
   \   00024B   A3           INC     DPTR
   \   00024C   A3           INC     DPTR
   \   00024D   A3           INC     DPTR
   \   00024E   A3           INC     DPTR
   \   00024F   A3           INC     DPTR
   \   000250   78..         MOV     R0,#?V0 + 0
   \   000252   12....       LCALL   ?L_MOV_X
   \   000255   85....       MOV     ?V0 + 4,?V0 + 0
   \   000258   85....       MOV     ?V0 + 5,?V0 + 1
   \   00025B   7407         MOV     A,#0x7
   \   00025D   12....       LCALL   ?XSTACK_DISP0_8
   \   000260   78..         MOV     R0,#?V0 + 0
   \   000262   12....       LCALL   ?L_MOV_X
   \   000265   E5..         MOV     A,?V0 + 4
   \   000267   C3           CLR     C
   \   000268   95..         SUBB    A,?V0 + 0
   \   00026A   F8           MOV     R0,A
   \   00026B   E5..         MOV     A,?V0 + 5
   \   00026D   95..         SUBB    A,?V0 + 1
   \   00026F   F9           MOV     R1,A
   \   000270   7403         MOV     A,#0x3
   \   000272   12....       LCALL   ?XSTACK_DISP0_8
   \   000275   E8           MOV     A,R0
   \   000276   F0           MOVX    @DPTR,A
   \   000277   A3           INC     DPTR
   \   000278   E9           MOV     A,R1
   \   000279   F0           MOVX    @DPTR,A
    331                    }
    332          
    333                    if (!next || ( wait && (wait < next) ))
   \                     ??HalLedUpdate_9:
   \   00027A   7405         MOV     A,#0x5
   \   00027C   12....       LCALL   ?XSTACK_DISP0_8
   \   00027F   E0           MOVX    A,@DPTR
   \   000280   6400         XRL     A,#0x0
   \   000282   7004         JNZ     ??HalLedUpdate_12
   \   000284   A3           INC     DPTR
   \   000285   E0           MOVX    A,@DPTR
   \   000286   6400         XRL     A,#0x0
   \                     ??HalLedUpdate_12:
   \   000288   602F         JZ      ??HalLedUpdate_13
   \   00028A   7403         MOV     A,#0x3
   \   00028C   12....       LCALL   ?XSTACK_DISP0_8
   \   00028F   E0           MOVX    A,@DPTR
   \   000290   6400         XRL     A,#0x0
   \   000292   7004         JNZ     ??HalLedUpdate_14
   \   000294   A3           INC     DPTR
   \   000295   E0           MOVX    A,@DPTR
   \   000296   6400         XRL     A,#0x0
   \                     ??HalLedUpdate_14:
   \   000298   6033         JZ      ??HalLedUpdate_4
   \   00029A   7403         MOV     A,#0x3
   \   00029C   12....       LCALL   ?XSTACK_DISP0_8
   \   00029F   C082         PUSH    DPL
   \   0002A1   C083         PUSH    DPH
   \   0002A3   7405         MOV     A,#0x5
   \   0002A5   12....       LCALL   ?XSTACK_DISP0_8
   \   0002A8   E0           MOVX    A,@DPTR
   \   0002A9   F8           MOV     R0,A
   \   0002AA   A3           INC     DPTR
   \   0002AB   E0           MOVX    A,@DPTR
   \   0002AC   F9           MOV     R1,A
   \   0002AD   D083         POP     DPH
   \   0002AF   D082         POP     DPL
   \   0002B1   C3           CLR     C
   \   0002B2   E0           MOVX    A,@DPTR
   \   0002B3   98           SUBB    A,R0
   \   0002B4   A3           INC     DPTR
   \   0002B5   E0           MOVX    A,@DPTR
   \   0002B6   99           SUBB    A,R1
   \   0002B7   5014         JNC     ??HalLedUpdate_4
    334                    {
    335                      next = wait;
   \                     ??HalLedUpdate_13:
   \   0002B9   7403         MOV     A,#0x3
   \   0002BB   12....       LCALL   ?XSTACK_DISP0_8
   \   0002BE   E0           MOVX    A,@DPTR
   \   0002BF   F8           MOV     R0,A
   \   0002C0   A3           INC     DPTR
   \   0002C1   E0           MOVX    A,@DPTR
   \   0002C2   F9           MOV     R1,A
   \   0002C3   7405         MOV     A,#0x5
   \   0002C5   12....       LCALL   ?XSTACK_DISP0_8
   \   0002C8   E8           MOV     A,R0
   \   0002C9   F0           MOVX    @DPTR,A
   \   0002CA   A3           INC     DPTR
   \   0002CB   E9           MOV     A,R1
   \   0002CC   F0           MOVX    @DPTR,A
    336                    }
    337                  }
    338                  leds ^= led;
   \                     ??HalLedUpdate_4:
   \   0002CD   7402         MOV     A,#0x2
   \   0002CF   12....       LCALL   ?XSTACK_DISP0_8
   \   0002D2   E0           MOVX    A,@DPTR
   \   0002D3   6E           XRL     A,R6
   \   0002D4   F0           MOVX    @DPTR,A
    339                }
    340                led <<= 1;
   \                     ??HalLedUpdate_3:
   \   0002D5   EE           MOV     A,R6
   \   0002D6   C3           CLR     C
   \   0002D7   33           RLC     A
   \   0002D8   FE           MOV     R6,A
    341                sts++;
   \   0002D9   85..82       MOV     DPL,?XSP + 0
   \   0002DC   85..83       MOV     DPH,?XSP + 1
   \   0002DF   E0           MOVX    A,@DPTR
   \   0002E0   2409         ADD     A,#0x9
   \   0002E2   F8           MOV     R0,A
   \   0002E3   A3           INC     DPTR
   \   0002E4   E0           MOVX    A,@DPTR
   \   0002E5   3400         ADDC    A,#0x0
   \   0002E7   F9           MOV     R1,A
   \   0002E8   85..82       MOV     DPL,?XSP + 0
   \   0002EB   85..83       MOV     DPH,?XSP + 1
   \   0002EE   E8           MOV     A,R0
   \   0002EF   F0           MOVX    @DPTR,A
   \   0002F0   A3           INC     DPTR
   \   0002F1   E9           MOV     A,R1
   \   0002F2   F0           MOVX    @DPTR,A
   \   0002F3   02....       LJMP    ??HalLedUpdate_1 & 0xFFFF
    342              }
    343          
    344              if (next)
   \                     ??HalLedUpdate_2:
   \   0002F6   7405         MOV     A,#0x5
   \   0002F8   12....       LCALL   ?XSTACK_DISP0_8
   \   0002FB   E0           MOVX    A,@DPTR
   \   0002FC   6400         XRL     A,#0x0
   \   0002FE   7004         JNZ     ??HalLedUpdate_15
   \   000300   A3           INC     DPTR
   \   000301   E0           MOVX    A,@DPTR
   \   000302   6400         XRL     A,#0x0
   \                     ??HalLedUpdate_15:
   \   000304   6016         JZ      ??HalLedUpdate_0
    345              {
    346                osal_start_timerEx(Hal_TaskID, HAL_LED_BLINK_EVENT, next);   /* Schedule event */
   \   000306                ; Setup parameters for call to function osal_start_timerEx
   \   000306   7405         MOV     A,#0x5
   \   000308   12....       LCALL   ?XSTACK_DISP0_8
   \   00030B   E0           MOVX    A,@DPTR
   \   00030C   FC           MOV     R4,A
   \   00030D   A3           INC     DPTR
   \   00030E   E0           MOVX    A,@DPTR
   \   00030F   FD           MOV     R5,A
   \   000310   7A02         MOV     R2,#0x2
   \   000312   7B00         MOV     R3,#0x0
   \   000314   90....       MOV     DPTR,#Hal_TaskID
   \   000317   E0           MOVX    A,@DPTR
   \   000318   F9           MOV     R1,A
   \   000319   12....       LCALL   ??osal_start_timerEx?relay
    347              }
    348            }
    349          }
   \                     ??HalLedUpdate_0:
   \   00031C   740B         MOV     A,#0xb
   \   00031E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000321   7F08         MOV     R7,#0x8
   \   000323   02....       LJMP    ?BANKED_LEAVE_XDATA
    350          
    351          /***************************************************************************************************
    352           * @fn      HalLedOnOff
    353           *
    354           * @brief   Turns specified LED ON or OFF
    355           *
    356           * @param   leds - LED bit mask
    357           *          mode - LED_ON,LED_OFF,
    358           *
    359           * @return  none
    360           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    361          void HalLedOnOff (uint8 leds, uint8 mode)
   \                     HalLedOnOff:
    362          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    363            if (leds & HAL_LED_1)
   \   000004   E9           MOV     A,R1
   \   000005   A2E0         MOV     C,0xE0 /* A   */.0
   \   000007   500B         JNC     ??HalLedOnOff_0
    364            {
    365              if (mode == HAL_LED_MODE_ON)
   \   000009   7401         MOV     A,#0x1
   \   00000B   6A           XRL     A,R2
   \   00000C   7004         JNZ     ??HalLedOnOff_1
    366              {
    367                HAL_TURN_ON_LED1();
   \   00000E   C290         CLR     0x90.0
   \   000010   8002         SJMP    ??HalLedOnOff_0
    368              }
    369              else
    370              {
    371                HAL_TURN_OFF_LED1();
   \                     ??HalLedOnOff_1:
   \   000012   D290         SETB    0x90.0
    372              }
    373            }
    374          
    375            if (leds & HAL_LED_2)
   \                     ??HalLedOnOff_0:
   \   000014   E9           MOV     A,R1
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500B         JNC     ??HalLedOnOff_2
    376            {
    377              if (mode == HAL_LED_MODE_ON)
   \   000019   7401         MOV     A,#0x1
   \   00001B   6A           XRL     A,R2
   \   00001C   7004         JNZ     ??HalLedOnOff_3
    378              {
    379                HAL_TURN_ON_LED2();
   \   00001E   C292         CLR     0x90.2
   \   000020   8002         SJMP    ??HalLedOnOff_2
    380              }
    381              else
    382              {
    383                HAL_TURN_OFF_LED2();
   \                     ??HalLedOnOff_3:
   \   000022   D292         SETB    0x90.2
    384              }
    385            }
    386          
    387            if (leds & HAL_LED_3)
   \                     ??HalLedOnOff_2:
   \   000024   E9           MOV     A,R1
   \   000025   A2E2         MOV     C,0xE0 /* A   */.2
   \   000027   500B         JNC     ??HalLedOnOff_4
    388            {
    389              if (mode == HAL_LED_MODE_ON)
   \   000029   7401         MOV     A,#0x1
   \   00002B   6A           XRL     A,R2
   \   00002C   7004         JNZ     ??HalLedOnOff_5
    390              {
    391                HAL_TURN_ON_LED3();
   \   00002E   C293         CLR     0x90.3
   \   000030   8002         SJMP    ??HalLedOnOff_4
    392              }
    393              else
    394              {
    395                HAL_TURN_OFF_LED3();
   \                     ??HalLedOnOff_5:
   \   000032   D293         SETB    0x90.3
    396              }
    397            }
    398          
    399            if (leds & HAL_LED_4)
   \                     ??HalLedOnOff_4:
   \   000034   E9           MOV     A,R1
   \   000035   A2E3         MOV     C,0xE0 /* A   */.3
   \   000037   500B         JNC     ??HalLedOnOff_6
    400            {
    401              if (mode == HAL_LED_MODE_ON)
   \   000039   7401         MOV     A,#0x1
   \   00003B   6A           XRL     A,R2
   \   00003C   7004         JNZ     ??HalLedOnOff_7
    402              {
    403                HAL_TURN_ON_LED4();
   \   00003E   C2A0         CLR     0xa0.0
   \   000040   8002         SJMP    ??HalLedOnOff_6
    404              }
    405              else
    406              {
    407                HAL_TURN_OFF_LED4();
   \                     ??HalLedOnOff_7:
   \   000042   D2A0         SETB    0xa0.0
    408              }
    409            }
    410          
    411            /* Remember current state */
    412            if (mode)
   \                     ??HalLedOnOff_6:
   \   000044   EA           MOV     A,R2
   \   000045   6008         JZ      ??HalLedOnOff_8
    413            {
    414              HalLedState |= leds;
   \   000047   90....       MOV     DPTR,#HalLedState
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   49           ORL     A,R1
   \   00004C   F0           MOVX    @DPTR,A
   \   00004D   8009         SJMP    ??HalLedOnOff_9
    415            }
    416            else
    417            {
    418              HalLedState &= ~leds;
   \                     ??HalLedOnOff_8:
   \   00004F   E9           MOV     A,R1
   \   000050   F4           CPL     A
   \   000051   FB           MOV     R3,A
   \   000052   90....       MOV     DPTR,#HalLedState
   \   000055   E0           MOVX    A,@DPTR
   \   000056   5B           ANL     A,R3
   \   000057   F0           MOVX    @DPTR,A
    419            }
    420          }
   \                     ??HalLedOnOff_9:
   \   000058   D083         POP     DPH
   \   00005A   D082         POP     DPL
   \   00005C   02....       LJMP    ?BRET
   \   00005F                REQUIRE _A_P1
   \   00005F                REQUIRE _A_P2
    421          #endif /* HAL_LED */
    422          
    423          /***************************************************************************************************
    424           * @fn      HalLedEnterSleep
    425           *
    426           * @brief   Store current LEDs state before sleep
    427           *
    428           * @param   none
    429           *
    430           * @return  none
    431           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    432          void HalLedEnterSleep( void )
   \                     HalLedEnterSleep:
    433          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    434            /* Sleep ON */
    435            HalLedStatusControl.sleepActive = TRUE;
   \   000004   7401         MOV     A,#0x1
   \   000006   90....       MOV     DPTR,#(HalLedStatusControl + 36)
   \   000009   F0           MOVX    @DPTR,A
    436          
    437          #if (HAL_LED == TRUE)
    438            /* Save the state of each led */
    439            HalSleepLedState = 0;
   \   00000A   7400         MOV     A,#0x0
   \   00000C   90....       MOV     DPTR,#HalSleepLedState
   \   00000F   F0           MOVX    @DPTR,A
    440            HalSleepLedState |= HAL_STATE_LED1();
   \   000010   A290         MOV     C,0x90.0
   \   000012   E4           CLR     A
   \   000013   92E0         MOV     0xE0 /* A   */.0,C
   \   000015   F4           CPL     A
   \   000016   5401         ANL     A,#0x1
   \   000018   FA           MOV     R2,A
   \   000019   90....       MOV     DPTR,#HalSleepLedState
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   4A           ORL     A,R2
   \   00001E   F0           MOVX    @DPTR,A
    441            HalSleepLedState |= HAL_STATE_LED2() << 1;
   \   00001F   A292         MOV     C,0x90.2
   \   000021   E4           CLR     A
   \   000022   92E0         MOV     0xE0 /* A   */.0,C
   \   000024   F4           CPL     A
   \   000025   5401         ANL     A,#0x1
   \   000027   C3           CLR     C
   \   000028   33           RLC     A
   \   000029   FA           MOV     R2,A
   \   00002A   90....       MOV     DPTR,#HalSleepLedState
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   4A           ORL     A,R2
   \   00002F   F0           MOVX    @DPTR,A
    442            HalSleepLedState |= HAL_STATE_LED3() << 2;
   \   000030   A293         MOV     C,0x90.3
   \   000032   E4           CLR     A
   \   000033   92E0         MOV     0xE0 /* A   */.0,C
   \   000035   F4           CPL     A
   \   000036   5401         ANL     A,#0x1
   \   000038   33           RLC     A
   \   000039   33           RLC     A
   \   00003A   54FC         ANL     A,#0xfc
   \   00003C   FA           MOV     R2,A
   \   00003D   90....       MOV     DPTR,#HalSleepLedState
   \   000040   E0           MOVX    A,@DPTR
   \   000041   4A           ORL     A,R2
   \   000042   F0           MOVX    @DPTR,A
    443            HalSleepLedState |= HAL_STATE_LED4() << 3;
   \   000043   A2A0         MOV     C,0xa0.0
   \   000045   E4           CLR     A
   \   000046   92E0         MOV     0xE0 /* A   */.0,C
   \   000048   F4           CPL     A
   \   000049   5401         ANL     A,#0x1
   \   00004B   33           RLC     A
   \   00004C   33           RLC     A
   \   00004D   33           RLC     A
   \   00004E   54F8         ANL     A,#0xf8
   \   000050   FA           MOV     R2,A
   \   000051   90....       MOV     DPTR,#HalSleepLedState
   \   000054   E0           MOVX    A,@DPTR
   \   000055   4A           ORL     A,R2
   \   000056   F0           MOVX    @DPTR,A
    444          
    445            /* TURN OFF all LEDs to save power */
    446            HalLedOnOff (HAL_LED_ALL, HAL_LED_MODE_OFF);
   \   000057                ; Setup parameters for call to function HalLedOnOff
   \   000057   7A00         MOV     R2,#0x0
   \   000059   790F         MOV     R1,#0xf
   \   00005B   12....       LCALL   ??HalLedOnOff?relay
    447          #endif /* HAL_LED */
    448          
    449          }
   \   00005E   D083         POP     DPH
   \   000060   D082         POP     DPL
   \   000062   02....       LJMP    ?BRET
   \   000065                REQUIRE _A_P1
   \   000065                REQUIRE _A_P2
    450          
    451          /***************************************************************************************************
    452           * @fn      HalLedExitSleep
    453           *
    454           * @brief   Restore current LEDs state after sleep
    455           *
    456           * @param   none
    457           *
    458           * @return  none
    459           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    460          void HalLedExitSleep( void )
   \                     HalLedExitSleep:
    461          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    462          #if (HAL_LED == TRUE)
    463            /* Load back the saved state */
    464            HalLedOnOff(HalSleepLedState, HAL_LED_MODE_ON);
   \   000004                ; Setup parameters for call to function HalLedOnOff
   \   000004   7A01         MOV     R2,#0x1
   \   000006   90....       MOV     DPTR,#HalSleepLedState
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   F9           MOV     R1,A
   \   00000B   12....       LCALL   ??HalLedOnOff?relay
    465          
    466            /* Restart - This takes care BLINKING LEDS */
    467            HalLedUpdate();
   \   00000E                ; Setup parameters for call to function HalLedUpdate
   \   00000E   12....       LCALL   ??HalLedUpdate?relay
    468          #endif /* HAL_LED */
    469          
    470            /* Sleep OFF */
    471            HalLedStatusControl.sleepActive = FALSE;
   \   000011   7400         MOV     A,#0x0
   \   000013   90....       MOV     DPTR,#(HalLedStatusControl + 36)
   \   000016   F0           MOVX    @DPTR,A
    472          }
   \   000017   D083         POP     DPH
   \   000019   D082         POP     DPL
   \   00001B   02....       LJMP    ?BRET

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_64:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_64>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_64>`:
   \   000000   64000000     DD 100

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLedInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLedInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLedSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLedSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLedBlink?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLedBlink

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLedUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLedUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLedOnOff?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLedOnOff

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLedEnterSleep?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLedEnterSleep

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLedExitSleep?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLedExitSleep
    473          
    474          /***************************************************************************************************
    475          ***************************************************************************************************/
    476          
    477          
    478          
    479          

   Maximum stack usage in bytes:

     Function                 ISTACK PSTACK XSTACK
     --------                 ------ ------ ------
     HalLedBlink                  1      0     32
       -> osal_GetSystemClock     0      0     40
       -> osal_set_event          0      0     40
       -> HalLedSet               0      0     40
       -> HalLedSet               0      0     40
     HalLedEnterSleep             2      0      0
       -> HalLedOnOff             4      0      0
     HalLedExitSleep              2      0      0
       -> HalLedOnOff             4      0      0
       -> HalLedUpdate            4      0      0
     HalLedInit                   2      0      0
       -> HalLedSet               4      0      0
     HalLedOnOff                  2      0     27
     HalLedSet                    1      0     39
       -> HalLedBlink             0      0     24
       -> HalLedBlink             0      0     24
       -> HalLedOnOff             0      0     24
     HalLedUpdate                 2      0     27
       -> osal_GetSystemClock     0      0     54
       -> HalLedOnOff             0      0     54
       -> HalLedOnOff             0      0     54
       -> HalLedSet               0      0     54
       -> osal_start_timerEx      0      0     54


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     _A_P1                             1
     _A_P2                             1
     HalLedState                       1
     HalSleepLedState                  1
     preBlinkState                     1
     HalLedStatusControl              37
     HalLedInit                       24
     HalLedSet                       149
     HalLedBlink                     328
     HalLedUpdate                    806
     HalLedOnOff                      95
     HalLedEnterSleep                101
     HalLedExitSleep                  30
     __Constant_64                     4
     ?<Initializer for __Constant_64>
                                       4
     ??HalLedInit?relay                6
     ??HalLedSet?relay                 6
     ??HalLedBlink?relay               6
     ??HalLedUpdate?relay              6
     ??HalLedOnOff?relay               6
     ??HalLedEnterSleep?relay          6
     ??HalLedExitSleep?relay           6

 
 1 533 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
     4 bytes in segment XDATA_I
     4 bytes in segment XDATA_ID
    40 bytes in segment XDATA_Z
 
 1 575 bytes of CODE  memory (+ 4 bytes shared)
     0 bytes of DATA  memory (+ 2 bytes shared)
    40 bytes of XDATA memory (+ 4 bytes shared)

Errors: none
Warnings: none
