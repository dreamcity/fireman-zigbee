###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    18/Mar/2013  18:21:48 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \stack\zdo\ZDApp.c                                 #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wEndev.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\Tools #
#                          \CC2430DB\f8wConfig.cfg" (-DSECURE=0               #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\stack\zd #
#                          o\ZDApp.c" -D CC2430EB -D AXD_END3 -D              #
#                          NWK_AUTO_POLL -D REFLECTOR -D xZTOOL_P1 -D         #
#                          xMT_TASK -D xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG   #
#                          -D xPOWER_SAVING -lC "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\EndDeviceEB3\L #
#                          ist\" -lA "C:\Texas Instruments\ZStack-1.4.3-1.2.1 #
#                          \Projects\zstack\Samples\cc2430-zstack-adxl345\CC2 #
#                          430DB\EndDeviceEB3\List\" --diag_suppress          #
#                          Pe001,Pa010 --diag_remark pe550 -o "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\EndDeviceEB3\O #
#                          bj\" -e --require_prototypes -z2 --no_cse          #
#                          --no_unroll --no_inline --no_code_motion           #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\SOURCE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\cc2430-zstack-adxl345 #
#                          \CC2430DB\..\Drivers\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\ZMAIN #
#                          \TI2430DB\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\EndDe #
#                          viceEB3\List\ZDApp.lst                             #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\EndDe #
#                          viceEB3\Obj\ZDApp.r51                              #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2007-11-28 15:44:45 -0800 (Wed, 28 Nov 2007) $
      4            Revision:       $Revision: 15983 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          
     64          #if   ( SECURE != 0  )
     65            #include "ssp.h"
     66          #endif
     67          
     68          #if defined( MT_ZDO_FUNC )
     69            #include "MT_ZDO.h"
     70          #endif
     71          
     72          /* HAL */
     73          #include "hal_led.h"
     74          #include "hal_lcd.h"
     75          #include "hal_key.h"
     76          
     77          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     78            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     79          #endif
     80          /*********************************************************************
     81           * MACROS
     82           */
     83          
     84          /*********************************************************************
     85           * CONSTANTS
     86           */
     87          #if !defined( NWK_START_DELAY )
     88            #define NWK_START_DELAY             100   // in milliseconds
     89          #endif
     90          
     91          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     92            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     93          #endif
     94          
     95          #if !defined( BEACON_REQUEST_DELAY )
     96            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     97          #endif
     98          
     99          #if !defined( BEACON_REQ_DELAY_MASK )
    100            #define BEACON_REQ_DELAY_MASK       0x007F
    101          #endif
    102          
    103          #if defined (AUTO_SOFT_START)
    104            #define MAX_RESUME_RETRY            3
    105            #define NUM_DISC_ATTEMPTS           3
    106          #else
    107            #define MAX_RESUME_RETRY            1
    108          #endif
    109          
    110          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    111          
    112          // Beacon Order Settings (see NLMEDE.h)
    113          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    114          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    115          
    116          #if ( SECURE != 0 )
    117            #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    118              // The number of times the frame counter can change before
    119              // saving to NV
    120              #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    121            #endif
    122          #endif
    123          
    124          // Leave control bits
    125          #define ZDAPP_LEAVE_CTRL_INIT 0
    126          #define ZDAPP_LEAVE_CTRL_SET  1
    127          #define ZDAPP_LEAVE_CTRL_RA   2
    128          
    129          // Standard time to update NWK NV data
    130          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    131          
    132          // Address Manager Stub Implementation
    133          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    134          
    135          /*********************************************************************
    136           * TYPEDEFS
    137           */
    138          
    139          /*********************************************************************
    140           * GLOBAL VARIABLES
    141           */
    142          
    143          #if defined( LCD_SUPPORTED )
    144            byte MatchRsps = 0;
    145          #endif
    146          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    147          byte zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    148          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    150          
    151          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
    152            byte zdappMgmtNwkDiscRspTransSeq;
    153            byte zdappMgmtNwkDiscReqInProgress = FALSE;
    154            zAddrType_t zdappMgmtNwkDiscRspAddr;
    155            byte zdappMgmtNwkDiscStartIndex;
    156            byte zdappMgmtSavedNwkState;
    157          #endif
    158          
    159          #if ( SECURE != 0 )
    160            uint16 nwkFrameCounterChanges = 0;
    161          #endif
    162          
    163          #if defined ( SOFT_START )
    164            static uint8 softStartAllowCoord = TRUE;
    165          #endif
    166          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    167          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    168          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    169          byte  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    170          
    171          /*********************************************************************
    172           * EXTERNAL VARIABLES
    173           */
    174          
    175          /*********************************************************************
    176           * EXTERNAL FUNCTIONS
    177           */
    178          
    179          /*********************************************************************
    180           * LOCAL FUNCTIONS
    181           */
    182          
    183          void ZDApp_NetworkStartEvt( void );
    184          void ZDApp_DeviceAuthEvt( void );
    185          void ZDApp_SaveNetworkStateEvt( void );
    186          
    187          uint8 ZDApp_ReadNetworkRestoreState( void );
    188          uint8 ZDApp_RestoreNetworkState( void );
    189          void ZDAppDetermineDeviceType( void );
    190          void ZDApp_InitUserDesc( void );
    191          void ZDAppCheckForHoldKey( void );
    192          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    193          void ZDApp_ProcessNetworkJoin( void );
    194          void ZDApp_SetCoordAddress( byte endPoint, byte dstEP );
    195          
    196          #if ( SECURE != 0 )
    197            void ZDApp_SaveNwkKey( void );
    198            byte ZDApp_RestoreNwkKey( void );
    199          #endif
    200          
    201          void ZDApp_SendMsg( byte taskID, byte cmd, byte len, byte *buf );
    202          
    203          void ZDApp_ResetTimerStart( uint16 delay );
    204          void ZDApp_ResetTimerCancel( void );
    205          void ZDApp_LeaveCtrlInit( void );
    206          void ZDApp_LeaveCtrlSet( uint8 ra );
    207          uint8 ZDApp_LeaveCtrlBypass( void );
    208          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    209          void ZDApp_LeaveReset( uint8 ra );
    210          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    211                                  uint8 removeChildren );
    212          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    213          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    214          void ZDApp_RegisterCBs( void );
    215          void ZDApp_SecInit( uint8 state );
    216          
    217          /*********************************************************************
    218           * LOCAL VARIABLES
    219           */
    220          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    221          byte ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    222          byte nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    223          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    224          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    225          
    226          #if defined( HOLD_AUTO_START )
    227            devStates_t devState = DEV_HOLD;
    228          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    229            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    230          #endif
    231          
    232          #if defined( ZDO_COORDINATOR ) && !defined( SOFT_START )
    233            // Set the default to coodinator
    234            devStartModes_t devStartMode = MODE_HARD;
    235          #else

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    236            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    237            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    238                                  // to parent. Set to make the device do an Orphan scan.
    239          #endif
    240          
    241          #if !defined( ZDO_COORDINATOR ) || defined( SOFT_START )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    242            static uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    243          #endif
    244          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    245          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    246          {
    247            ZDO_EP,
    248            &ZDAppTaskID,
    249            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    250            (afNetworkLatencyReq_t)0            // No Network Latency req
    251          };
    252          
    253          /*********************************************************************
    254           * @fn      ZDApp_Init
    255           *
    256           * @brief   ZDApp Initialization function.
    257           *
    258           * @param   task_id - ZDApp Task ID
    259           *
    260           * @return  None
    261           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    262          void ZDApp_Init( byte task_id )
   \                     ZDApp_Init:
    263          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    264            uint8 capabilities;
    265          
    266            // Save the task ID
    267            ZDAppTaskID = task_id;
   \   00000B   90....       MOV     DPTR,#ZDAppTaskID
   \   00000E   F0           MOVX    @DPTR,A
    268          
    269            // Initialize the ZDO global device short address storage
    270            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   00000F   7402         MOV     A,#0x2
   \   000011   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   000014   F0           MOVX    @DPTR,A
    271            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   000015   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000018   74FE         MOV     A,#-0x2
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   74FF         MOV     A,#-0x1
   \   00001E   F0           MOVX    @DPTR,A
    272            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   00001F                ; Setup parameters for call to function NLME_GetExtAddr
   \   00001F   12....       LCALL   ??NLME_GetExtAddr?relay
    273          
    274            // Check for manual "Hold Auto Start"
    275            ZDAppCheckForHoldKey();
   \   000022                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   000022   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    276          
    277            // Initialize ZDO items and setup the device - type of device to create.
    278            ZDO_Init();
   \   000025                ; Setup parameters for call to function ZDO_Init
   \   000025   12....       LCALL   ??ZDO_Init?relay
    279          
    280            // Register the endpoint description with the AF
    281            // This task doesn't have a Simple description, but we still need
    282            // to register the endpoint.
    283            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000028                ; Setup parameters for call to function afRegister
   \   000028   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   00002A   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   00002C   12....       LCALL   ??afRegister?relay
    284          
    285          #if defined( ZDO_USERDESC_RESPONSE )
    286            ZDApp_InitUserDesc();
    287          #endif // ZDO_USERDESC_RESPONSE
    288          
    289            // set broadcast address mask to support broadcast filtering
    290            NLME_GetRequest(nwkCapabilityInfo, 0, &capabilities);
   \   00002F                ; Setup parameters for call to function NLME_GetRequest
   \   00002F   85..82       MOV     DPL,?XSP + 0
   \   000032   85..83       MOV     DPH,?XSP + 1
   \   000035   AC82         MOV     R4,DPL
   \   000037   AD83         MOV     R5,DPH
   \   000039   7A00         MOV     R2,#0x0
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   798F         MOV     R1,#-0x71
   \   00003F   12....       LCALL   ??NLME_GetRequest?relay
    291            NLME_SetBroadcastFilter( capabilities );
   \   000042                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000042   85..82       MOV     DPL,?XSP + 0
   \   000045   85..83       MOV     DPH,?XSP + 1
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F9           MOV     R1,A
   \   00004A   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    292          
    293            // Start the device?
    294            if ( devState != DEV_HOLD )
   \   00004D   90....       MOV     DPTR,#devState
   \   000050   E0           MOVX    A,@DPTR
   \   000051   6009         JZ      ??ZDApp_Init_0
    295            {
    296              ZDOInitDevice( 0 );
   \   000053                ; Setup parameters for call to function ZDOInitDevice
   \   000053   7A00         MOV     R2,#0x0
   \   000055   7B00         MOV     R3,#0x0
   \   000057   12....       LCALL   ??ZDOInitDevice?relay
   \   00005A   800D         SJMP    ??ZDApp_Init_1
    297            }
    298            else
    299            {
    300              // Blink LED to indicate HOLD_START
    301              HalLedBlink ( HAL_LED_4, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   00005C                ; Setup parameters for call to function HalLedBlink
   \   00005C   7CF4         MOV     R4,#-0xc
   \   00005E   7D01         MOV     R5,#0x1
   \   000060   7B32         MOV     R3,#0x32
   \   000062   7A00         MOV     R2,#0x0
   \   000064   7908         MOV     R1,#0x8
   \   000066   12....       LCALL   ??HalLedBlink?relay
    302            }
    303            
    304            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000069                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000069   12....       LCALL   ??ZDApp_RegisterCBs?relay
    305          } /* ZDO_Init() */
   \   00006C   7401         MOV     A,#0x1
   \   00006E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000071   7F01         MOV     R7,#0x1
   \   000073   02....       LJMP    ?BANKED_LEAVE_XDATA
    306          
    307          /*********************************************************************
    308           * @fn          ZDApp_SecInit
    309           *
    310           * @brief       ZDApp initialize security.
    311           *
    312           * @param       state - device initialization state
    313           *
    314           * @return      none
    315           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    316          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    317          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    318            // Initialize ZigBee Device Security Manager
    319            ZDSecMgrInit();
   \   000005                ; Setup parameters for call to function ZDSecMgrInit
   \   000005   12....       LCALL   ??ZDSecMgrInit?relay
    320          
    321            // -----------------------------------------------------------------
    322            #if ( SECURE != 0 )
    323            // -----------------------------------------------------------------
    324            nwkFrameCounter = 0;
    325          
    326            if( _NIB.nwkKeyLoaded == FALSE )
    327            {
    328              // ---------------------------------------------------------------
    329              #if ( SECURITY_MODE == SECURITY_RESIDENTIAL )
    330              // ---------------------------------------------------------------
    331              #if !defined (ZDO_COORDINATOR)
    332              if ( zgPreConfigKeys )
    333              #endif
    334              {
    335                SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    336                SSP_SwitchNwkKey( 0 );
    337              }
    338              // ---------------------------------------------------------------
    339              #endif // ( SECURITY_MODE == SECURITY_RESIDENTIAL )
    340              // ---------------------------------------------------------------
    341            }
    342          
    343            if ( state == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    344            {
    345              //Restore NWK frame counter
    346            }
    347            // -----------------------------------------------------------------
    348            #endif
    349            // -----------------------------------------------------------------
    350          }
   \   000008   7F01         MOV     R7,#0x1
   \   00000A   02....       LJMP    ?BANKED_LEAVE_XDATA
    351          
    352          /*********************************************************************
    353           * @fn      ZDApp_event_loop()
    354           *
    355           * @brief   Main event loop for Zigbee device objects task. This function
    356           *          should be called at periodic intervals.
    357           *
    358           * @param   task_id - Task ID
    359           * @param   events  - Bitmap of events
    360           *
    361           * @return  none
    362           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    363          UINT16 ZDApp_event_loop( byte task_id, UINT16 events )
   \                     ZDApp_event_loop:
    364          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    365            uint8 *msg_ptr;
    366          
    367            if ( events & SYS_EVENT_MSG )
   \   000009   7400         MOV     A,#0x0
   \   00000B   5E           ANL     A,R6
   \   00000C   F8           MOV     R0,A
   \   00000D   7480         MOV     A,#-0x80
   \   00000F   5F           ANL     A,R7
   \   000010   F9           MOV     R1,A
   \   000011   7400         MOV     A,#0x0
   \   000013   68           XRL     A,R0
   \   000014   7003         JNZ     ??ZDApp_event_loop_0
   \   000016   7400         MOV     A,#0x0
   \   000018   69           XRL     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000019   6039         JZ      ??ZDApp_event_loop_1
    368            {
    369              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
   \                     ??ZDApp_event_loop_2:
   \   00001B                ; Setup parameters for call to function osal_msg_receive
   \   00001B   90....       MOV     DPTR,#ZDAppTaskID
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F9           MOV     R1,A
   \   000020   12....       LCALL   ??osal_msg_receive?relay
   \   000023   8A..         MOV     ?V0 + 4,R2
   \   000025   8B..         MOV     ?V0 + 5,R3
   \   000027   A8..         MOV     R0,?V0 + 4
   \   000029   A9..         MOV     R1,?V0 + 5
   \   00002B   88..         MOV     ?V0 + 2,R0
   \   00002D   89..         MOV     ?V0 + 3,R1
   \   00002F   E8           MOV     A,R0
   \   000030   6400         XRL     A,#0x0
   \   000032   7003         JNZ     ??ZDApp_event_loop_3
   \   000034   E9           MOV     A,R1
   \   000035   6400         XRL     A,#0x0
   \                     ??ZDApp_event_loop_3:
   \   000037   6010         JZ      ??ZDApp_event_loop_4
    370              {
    371                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
   \   000039                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   000039   AA..         MOV     R2,?V0 + 2
   \   00003B   AB..         MOV     R3,?V0 + 3
   \   00003D   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
    372          
    373                // Release the memory
    374                osal_msg_deallocate( msg_ptr );
   \   000040                ; Setup parameters for call to function osal_msg_deallocate
   \   000040   AA..         MOV     R2,?V0 + 2
   \   000042   AB..         MOV     R3,?V0 + 3
   \   000044   12....       LCALL   ??osal_msg_deallocate?relay
   \   000047   80D2         SJMP    ??ZDApp_event_loop_2
    375              }
    376          
    377              // Return unprocessed events
    378              return (events ^ SYS_EVENT_MSG);
   \                     ??ZDApp_event_loop_4:
   \   000049   7400         MOV     A,#0x0
   \   00004B   6E           XRL     A,R6
   \   00004C   FA           MOV     R2,A
   \   00004D   7480         MOV     A,#-0x80
   \   00004F   6F           XRL     A,R7
   \   000050   FB           MOV     R3,A
   \   000051   02....       LJMP    ??ZDApp_event_loop_5 & 0xFFFF
    379            }
    380          
    381            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_1:
   \   000054   EE           MOV     A,R6
   \   000055   5410         ANL     A,#0x10
   \   000057   6012         JZ      ??ZDApp_event_loop_6
    382            {
    383              ZDO_UpdateNwkStatus( devState );
   \   000059                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   000059   90....       MOV     DPTR,#devState
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F9           MOV     R1,A
   \   00005E   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    384          
    385              // Return unprocessed events
    386              return (events ^ ZDO_STATE_CHANGE_EVT);
   \   000061   7410         MOV     A,#0x10
   \   000063   6E           XRL     A,R6
   \   000064   FA           MOV     R2,A
   \   000065   7400         MOV     A,#0x0
   \   000067   6F           XRL     A,R7
   \   000068   FB           MOV     R3,A
   \   000069   806A         SJMP    ??ZDApp_event_loop_5
    387            }
    388          
    389          
    390            if ( events & ZDO_NETWORK_INIT )
   \                     ??ZDApp_event_loop_6:
   \   00006B   EE           MOV     A,R6
   \   00006C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00006E   5023         JNC     ??ZDApp_event_loop_7
    391            {
    392              // Initialize apps and start the network
    393              devState = DEV_INIT;
   \   000070   7401         MOV     A,#0x1
   \   000072   90....       MOV     DPTR,#devState
   \   000075   F0           MOVX    @DPTR,A
    394              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    395                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   000076                ; Setup parameters for call to function ZDO_StartDevice
   \   000076   7C0F         MOV     R4,#0xf
   \   000078   7B0F         MOV     R3,#0xf
   \   00007A   90....       MOV     DPTR,#devStartMode
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   FA           MOV     R2,A
   \   00007F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000082   E0           MOVX    A,@DPTR
   \   000083   5407         ANL     A,#0x7
   \   000085   F9           MOV     R1,A
   \   000086   12....       LCALL   ??ZDO_StartDevice?relay
    396          
    397              // Return unprocessed events
    398              return (events ^ ZDO_NETWORK_INIT);
   \   000089   7401         MOV     A,#0x1
   \   00008B   6E           XRL     A,R6
   \   00008C   FA           MOV     R2,A
   \   00008D   7400         MOV     A,#0x0
   \   00008F   6F           XRL     A,R7
   \   000090   FB           MOV     R3,A
   \   000091   8042         SJMP    ??ZDApp_event_loop_5
    399            }
    400          
    401          #if defined (RTR_NWK)
    402            if ( events & ZDO_NETWORK_START )
    403            {
    404              ZDApp_NetworkStartEvt();
    405          
    406              // Return unprocessed events
    407              return (events ^ ZDO_NETWORK_START);
    408            }
    409          #endif  //RTR_NWK
    410          
    411          #if defined ( RTR_NWK )
    412            if ( events & ZDO_ROUTER_START )
    413            {
    414              if ( nwkStatus == ZSuccess )
    415              {
    416                if ( devState == DEV_END_DEVICE )
    417                  devState = DEV_ROUTER;
    418          
    419                osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
    420              }
    421              else
    422              {
    423                // remain as end device!!
    424              }
    425              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    426          
    427              // Return unprocessed events
    428              return (events ^ ZDO_ROUTER_START);
    429            }
    430          #endif  // RTR
    431          
    432          
    433            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_7:
   \   000093   EE           MOV     A,R6
   \   000094   5408         ANL     A,#0x8
   \   000096   600A         JZ      ??ZDApp_event_loop_8
    434            {
    435              // User defined logic
    436          
    437              // Return unprocessed events
    438              return (events ^ ZDO_COMMAND_CNF);
   \   000098   7408         MOV     A,#0x8
   \   00009A   6E           XRL     A,R6
   \   00009B   FA           MOV     R2,A
   \   00009C   7400         MOV     A,#0x0
   \   00009E   6F           XRL     A,R7
   \   00009F   FB           MOV     R3,A
   \   0000A0   8033         SJMP    ??ZDApp_event_loop_5
    439            }
    440          
    441          #if defined( ZDSECMGR_SECURE ) && defined( RTR_NWK )
    442            if ( events & ZDO_NEW_DEVICE )
    443            {
    444              // process the new device event
    445              if ( ZDSecMgrNewDeviceEvent() == TRUE )
    446              {
    447                osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
    448              }
    449          
    450              // Return unprocessed events
    451              return (events ^ ZDO_NEW_DEVICE);
    452            }
    453          #endif  // ZDSECMGR_SECURE && RTR
    454          
    455          #if defined ( ZDSECMGR_COMMERCIAL )
    456            if ( events & ZDO_SECMGR_EVENT )
    457            {
    458              ZDSecMgrEvent();
    459          
    460              // Return unprocessed events
    461              return (events ^ ZDO_SECMGR_EVENT);
    462            }
    463          #endif // defined( ZDSECMGR_COMMERCIAL )
    464          
    465          #if   ( SECURE != 0  )
    466            if ( events & ZDO_DEVICE_AUTH )
    467            {
    468              ZDApp_DeviceAuthEvt();
    469          
    470              // Return unprocessed events
    471              return (events ^ ZDO_DEVICE_AUTH);
    472            }
    473          #endif  // SECURE
    474          
    475            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_8:
   \   0000A2   7400         MOV     A,#0x0
   \   0000A4   5E           ANL     A,R6
   \   0000A5   F8           MOV     R0,A
   \   0000A6   7402         MOV     A,#0x2
   \   0000A8   5F           ANL     A,R7
   \   0000A9   F9           MOV     R1,A
   \   0000AA   7400         MOV     A,#0x0
   \   0000AC   68           XRL     A,R0
   \   0000AD   7003         JNZ     ??ZDApp_event_loop_9
   \   0000AF   7400         MOV     A,#0x0
   \   0000B1   69           XRL     A,R1
   \                     ??ZDApp_event_loop_9:
   \   0000B2   600D         JZ      ??ZDApp_event_loop_10
    476            {
    477              ZDApp_SaveNetworkStateEvt();
   \   0000B4                ; Setup parameters for call to function ZDApp_SaveNetworkStateEvt
   \   0000B4   12....       LCALL   ??ZDApp_SaveNetworkStateEvt?relay
    478          
    479              // Return unprocessed events
    480              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000B7   7400         MOV     A,#0x0
   \   0000B9   6E           XRL     A,R6
   \   0000BA   FA           MOV     R2,A
   \   0000BB   7402         MOV     A,#0x2
   \   0000BD   6F           XRL     A,R7
   \   0000BE   FB           MOV     R3,A
   \   0000BF   8014         SJMP    ??ZDApp_event_loop_5
    481            }
    482          
    483          #if ( SECURE != 0  )
    484            if ( events & ZDO_FRAMECOUNTER_CHANGE )
    485            {
    486              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
    487                ZDApp_SaveNwkKey();
    488          
    489              // Return unprocessed events
    490              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
    491            }
    492          #endif
    493          
    494            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_10:
   \   0000C1   EE           MOV     A,R6
   \   0000C2   5404         ANL     A,#0x4
   \   0000C4   600B         JZ      ??ZDApp_event_loop_11
    495            {
    496              // The device has been in the UNAUTH state, so reset
    497              // Note: there will be no return from this call
    498              SystemReset();
   \   0000C6   C2AF         CLR     0xa8.7
   \   0000C8   75C9AB       MOV     0xc9,#-0x55
   \   0000CB   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_12:
   \   0000CE   00           NOP
   \   0000CF   80FD         SJMP    ??ZDApp_event_loop_12
    499            }
    500          
    501            // Discard or make more handlers
    502            return 0;
   \                     ??ZDApp_event_loop_11:
   \   0000D1   7A00         MOV     R2,#0x0
   \   0000D3   7B00         MOV     R3,#0x0
   \                     ??ZDApp_event_loop_5:
   \   0000D5   7F06         MOV     R7,#0x6
   \   0000D7   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   0000DA                REQUIRE _A_IEN0
   \   0000DA                REQUIRE WDCTL
    503          }
    504          
    505          /*********************************************************************
    506           * Application Functions
    507           */
    508          
    509          /*********************************************************************
    510           * @fn      ZDOInitDevice
    511           *
    512           * @brief   Start the device in the network.  This function will read
    513           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    514           *   restore the network state of the device.
    515           *
    516           * @param   startDelay - timeDelay to start device (in milliseconds).
    517           *      There is a jitter added to this delay:
    518           *              ((NWK_START_DELAY + startDelay)
    519           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    520           *
    521           * NOTE:    If the application would like to force a "new" join, the
    522           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    523           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    524           *          this function. "new" join means to not restore the network
    525           *          state of the device. Use zgWriteStartupOptions() to set these
    526           *          options.
    527           *
    528           * @return
    529           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    530           *          restored.
    531           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    532           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    533           *          it could mean that there was no network state to restore.
    534           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    535           *          with the rejoin option set to TRUE.  So, the device was not
    536           *          started in the network (one time only).  The next time this
    537           *          function is called it will start.
    538           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    539          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    540          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
    541            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   000015   75..01       MOV     ?V0 + 0,#0x1
    542            uint16 extendedDelay = 0;
   \   000018   7E00         MOV     R6,#0x0
   \   00001A   7F00         MOV     R7,#0x0
    543          
    544            devState = DEV_INIT;    // Remove the Hold state
   \   00001C   7401         MOV     A,#0x1
   \   00001E   90....       MOV     DPTR,#devState
   \   000021   F0           MOVX    @DPTR,A
    545          
    546            // Initialize leave control logic
    547            ZDApp_LeaveCtrlInit();
   \   000022                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000022   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    548          
    549            // Check leave control reset settings
    550            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   000025                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   000025   85..82       MOV     DPL,?XSP + 0
   \   000028   85..83       MOV     DPH,?XSP + 1
   \   00002B   AC82         MOV     R4,DPL
   \   00002D   AD83         MOV     R5,DPH
   \   00002F   7A..         MOV     R2,#(devState & 0xff)
   \   000031   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   000033   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    551          
    552            // Leave may make the hold state come back
    553            if ( devState == DEV_HOLD )
   \   000036   90....       MOV     DPTR,#devState
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   7004         JNZ     ??ZDOInitDevice_0
    554              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \   00003C   7902         MOV     R1,#0x2
   \   00003E   8043         SJMP    ??ZDOInitDevice_1
    555          
    556          #if defined ( NV_RESTORE )
    557            // Get Keypad directly to see if a reset nv is needed.
    558            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    559            // while booting to skip past NV Restore.
    560            if ( HalKeyRead() == SW_BYPASS_NV )
    561              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    562            else
    563            {
    564              // Determine if NV should be restored
    565              networkStateNV = ZDApp_ReadNetworkRestoreState();
    566            }
    567          
    568            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    569            {
    570              networkStateNV = ZDApp_RestoreNetworkState();
    571            }
    572            else
    573            {
    574              // Wipe out the network state in NV
    575              NLME_InitNV();
    576              NLME_SetDefaultNV();
    577            }
    578          #endif
    579          
    580            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
   \                     ??ZDOInitDevice_0:
   \   000040   7401         MOV     A,#0x1
   \   000042   65..         XRL     A,?V0 + 0
   \   000044   702F         JNZ     ??ZDOInitDevice_2
    581            {
    582              ZDAppDetermineDeviceType();
   \   000046                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000046   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    583          
    584              // Only delay if joining network - not restoring network state
    585              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    586                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000049                ; Setup parameters for call to function osal_rand
   \   000049   12....       LCALL   ??osal_rand?relay
   \   00004C   8A..         MOV     ?V0 + 2,R2
   \   00004E   8B..         MOV     ?V0 + 3,R3
   \   000050   A8..         MOV     R0,?V0 + 2
   \   000052   A9..         MOV     R1,?V0 + 3
   \   000054   85..82       MOV     DPL,?XSP + 0
   \   000057   85..83       MOV     DPH,?XSP + 1
   \   00005A   747F         MOV     A,#0x7f
   \   00005C   58           ANL     A,R0
   \   00005D   F8           MOV     R0,A
   \   00005E   7400         MOV     A,#0x0
   \   000060   59           ANL     A,R1
   \   000061   F9           MOV     R1,A
   \   000062   E0           MOVX    A,@DPTR
   \   000063   28           ADD     A,R0
   \   000064   F8           MOV     R0,A
   \   000065   A3           INC     DPTR
   \   000066   E0           MOVX    A,@DPTR
   \   000067   39           ADDC    A,R1
   \   000068   F9           MOV     R1,A
   \   000069   7464         MOV     A,#0x64
   \   00006B   28           ADD     A,R0
   \   00006C   F8           MOV     R0,A
   \   00006D   7400         MOV     A,#0x0
   \   00006F   39           ADDC    A,R1
   \   000070   F9           MOV     R1,A
   \   000071   E8           MOV     A,R0
   \   000072   FE           MOV     R6,A
   \   000073   E9           MOV     A,R1
   \   000074   FF           MOV     R7,A
    587            }
    588          
    589            // Initialize device security
    590            ZDApp_SecInit( networkStateNV );
   \                     ??ZDOInitDevice_2:
   \   000075                ; Setup parameters for call to function ZDApp_SecInit
   \   000075   A9..         MOV     R1,?V0 + 0
   \   000077   12....       LCALL   ??ZDApp_SecInit?relay
    591          
    592            // Trigger the network start
    593            ZDApp_NetworkInit( extendedDelay );
   \   00007A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00007A   EE           MOV     A,R6
   \   00007B   FA           MOV     R2,A
   \   00007C   EF           MOV     A,R7
   \   00007D   FB           MOV     R3,A
   \   00007E   12....       LCALL   ??ZDApp_NetworkInit?relay
    594          
    595            return ( networkStateNV );
   \   000081   A9..         MOV     R1,?V0 + 0
   \                     ??ZDOInitDevice_1:
   \   000083   7402         MOV     A,#0x2
   \   000085   12....       LCALL   ?DEALLOC_XSTACK8
   \   000088   7F04         MOV     R7,#0x4
   \   00008A   02....       LJMP    ?BANKED_LEAVE_XDATA
    596          }
    597          
    598          /*********************************************************************
    599           * @fn      ZDApp_ReadNetworkRestoreState
    600           *
    601           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    602           *          or not to restore the network state.
    603           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    604           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    605           *
    606           * @param   none
    607           *
    608           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    609           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    610           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    611           *          ZCD_NV_STARTUP_OPTION
    612           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    613          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    614          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    615            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    616          
    617            // Look for the New Network State option.
    618            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5002         JNC     ??ZDApp_ReadNetworkRestoreState_0
    619            {
    620              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   7E01         MOV     R6,#0x1
    621            }
    622          
    623            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000011   EE           MOV     A,R6
   \   000012   F9           MOV     R1,A
   \   000013   7F01         MOV     R7,#0x1
   \   000015   02....       LJMP    ?BANKED_LEAVE_XDATA
    624          }
    625          
    626          /*********************************************************************
    627           * @fn      ZDAppDetermineDeviceType()
    628           *
    629           * @brief   Determines the type of device to start.  Right now
    630           *          this only works with the SOFT_START feature.  So it doesn't
    631           *          support the end device type.
    632           *
    633           *          Looks at zgDeviceLogicalType and determines what type of
    634           *          device to start.  The types are:
    635           *            ZG_DEVICETYPE_COORDINATOR
    636           *            ZG_DEVICETYPE_ROUTER
    637           *            ZG_DEVICETYPE_ENDDEVICE - not supported yet.
    638           *            ZG_DEVICETYPE_SOFT - looks for coordinator, if one doesn't
    639           *               exist, becomes one.  This option is should only be used
    640           *               if the system is manually configured and you are insured
    641           *               that the first device is started before all the other
    642           *               devices are started.
    643           *
    644           * @param   none
    645           *
    646           * @return  none
    647           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    648          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    649          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    650            if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \   000000   02....       LJMP    ?BRET
    651              return;
    652          
    653          #if defined ( SOFT_START )
    654            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
    655            {
    656              devStartMode = MODE_HARD;     // Start as a coordinator
    657              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
    658            }
    659            else
    660            {
    661              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER )
    662              {
    663                softStartAllowCoord = FALSE;  // Don't allow coord to start
    664                continueJoining = TRUE;
    665              }
    666              devStartMode = MODE_JOIN;     // Assume joining
    667            }
    668          #endif // SOFT_START
    669          }
    670          
    671          /*********************************************************************
    672           * @fn      ZDApp_NetworkStartEvt()
    673           *
    674           * @brief   Process the Network Start Event
    675           *
    676           * @param   none
    677           *
    678           * @return  none
    679           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    680          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    681          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    682            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7021         JNZ     ??ZDApp_NetworkStartEvt_0
    683            {
    684              // Successfully started a ZigBee network
    685              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7006         JNZ     ??ZDApp_NetworkStartEvt_1
    686              {
    687                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   90....       MOV     DPTR,#devState
   \   000017   F0           MOVX    @DPTR,A
    688              }
    689          
    690              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000018                ; Setup parameters for call to function osal_pwrmgr_device
   \   000018   7900         MOV     R1,#0x0
   \   00001A   12....       LCALL   ??osal_pwrmgr_device?relay
    691              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A10         MOV     R2,#0x10
   \   00001F   7B00         MOV     R3,#0x0
   \   000021   90....       MOV     DPTR,#ZDAppTaskID
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??osal_set_event?relay
   \   000029   8047         SJMP    ??ZDApp_NetworkStartEvt_2
    692            }
    693            else
    694            {
    695              // Try again with a higher energy threshold !!
    696              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00002B                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00002B   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00002E   E9           MOV     A,R1
   \   00002F   F8           MOV     R0,A
   \   000030   7900         MOV     R1,#0x0
   \   000032   7410         MOV     A,#0x10
   \   000034   28           ADD     A,R0
   \   000035   F8           MOV     R0,A
   \   000036   7400         MOV     A,#0x0
   \   000038   39           ADDC    A,R1
   \   000039   F9           MOV     R1,A
   \   00003A   C3           CLR     C
   \   00003B   E8           MOV     A,R0
   \   00003C   94FF         SUBB    A,#-0x1
   \   00003E   E9           MOV     A,R1
   \   00003F   9400         SUBB    A,#0x0
   \   000041   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000043   65D0         XRL     A,PSW
   \   000045   33           RLC     A
   \   000046   5018         JNC     ??ZDApp_NetworkStartEvt_3
    697              {
    698                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000048                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000048                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000048   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00004B   E9           MOV     A,R1
   \   00004C   2410         ADD     A,#0x10
   \   00004E   F9           MOV     R1,A
   \   00004F   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    699                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   000052                ; Setup parameters for call to function osal_set_event
   \   000052   7A01         MOV     R2,#0x1
   \   000054   7B00         MOV     R3,#0x0
   \   000056   90....       MOV     DPTR,#ZDAppTaskID
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   12....       LCALL   ??osal_set_event?relay
   \   00005E   8012         SJMP    ??ZDApp_NetworkStartEvt_2
    700              }
    701              else
    702              {
    703                // Failed to start network. Enter a dormant state (until user intervenes)
    704                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000060   7401         MOV     A,#0x1
   \   000062   90....       MOV     DPTR,#devState
   \   000065   F0           MOVX    @DPTR,A
    705                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000066                ; Setup parameters for call to function osal_set_event
   \   000066   7A10         MOV     R2,#0x10
   \   000068   7B00         MOV     R3,#0x0
   \   00006A   90....       MOV     DPTR,#ZDAppTaskID
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   F9           MOV     R1,A
   \   00006F   12....       LCALL   ??osal_set_event?relay
    706              }
    707            }
    708          }
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000072   D083         POP     DPH
   \   000074   D082         POP     DPL
   \   000076   02....       LJMP    ?BRET
    709          
    710          #if ( SECURE != 0 )
    711          /*********************************************************************
    712           * @fn      ZDApp_DeviceAuthEvt()
    713           *
    714           * @brief   Process the Device Authentic Event
    715           *
    716           * @param   none
    717           *
    718           * @return  none
    719           */
    720          void ZDApp_DeviceAuthEvt( void )
    721          {
    722            // received authentication from trust center
    723            if ( devState == DEV_END_DEVICE_UNAUTH )
    724            {
    725              // Stop the reset timer so it doesn't reset
    726              ZDApp_ResetTimerCancel();
    727          
    728              devState = DEV_END_DEVICE;
    729              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    730          
    731              // Set the Power Manager Device
    732          #if defined ( POWER_SAVING )
    733              osal_pwrmgr_device( PWRMGR_BATTERY );
    734          #endif
    735          
    736          #if defined ( RTR_NWK )
    737              if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
    738              {
    739                // NOTE: first two parameters are not used, see NLMEDE.h for details
    740                NLME_StartRouterRequest( 0, 0, false );
    741              }
    742          #endif  // RTR
    743          
    744              // Notify to save info into NV
    745              ZDApp_NVUpdate();
    746          
    747              // Save off the security
    748              ZDApp_SaveNwkKey();
    749          
    750          #if defined ( ZDO_ENDDEVICE_ANNCE_GENERATE )
    751              ZDP_EndDeviceAnnce( ZDAppNwkAddr.addr.shortAddr, saveExtAddr,
    752                                 ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
    753          #endif
    754            }
    755            else
    756            {
    757              ZDApp_NVUpdate();
    758            }
    759          }
    760          #endif
    761          
    762          /*********************************************************************
    763           * @fn      ZDApp_SaveNetworkStateEvt()
    764           *
    765           * @brief   Process the Save the Network State Event
    766           *
    767           * @param   none
    768           *
    769           * @return  none
    770           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    771          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    772          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    773          #if defined ( NV_RESTORE )
    774           #if defined ( NV_TURN_OFF_RADIO )
    775            // Turn off the radio's receiver during an NV update
    776            byte RxOnIdle;
    777            byte x = false;
    778            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    779            ZMacSetReq( ZMacRxOnIdle, &x );
    780           #endif
    781          
    782            // Update the Network State in NV
    783            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    784                           NWK_NV_DEVICELIST_ENABLE |
    785                           NWK_NV_BINDING_ENABLE    |
    786                           NWK_NV_ADDRMGR_ENABLE );
    787          
    788            // Reset the NV startup option to resume from NV by
    789            // clearing the "New" join option.
    790            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    791          
    792           #if defined ( NV_TURN_OFF_RADIO )
    793            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    794           #endif
    795          #endif  // NV_RESTORE
    796          }
   \   000000   02....       LJMP    ?BRET
    797          
    798          /*********************************************************************
    799           * @fn      ZDApp_RestoreNetworkState()
    800           *
    801           * @brief   This function will restore the network state of the
    802           *          device if the network state is stored in NV.
    803           *
    804           * @param   none
    805           *
    806           * @return
    807           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    808           *          restored.
    809           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    810           *          This could mean that zgStartupOption said to not restore, or
    811           *          it could mean that there was no network state to restore.
    812           *
    813           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    814          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    815          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    816            byte nvStat;
    817          #if ( SECURE != 0 )
    818            nwkActiveKeyItems keyItems;
    819          #endif
    820          
    821            // Initialize NWK NV items
    822            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    823          
    824            if ( nvStat != NV_OPER_FAILED )
   \   00000A   7410         MOV     A,#0x10
   \   00000C   6E           XRL     A,R6
   \   00000D   6030         JZ      ??ZDApp_RestoreNetworkState_0
    825            {
    826              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6028         JZ      ??ZDApp_RestoreNetworkState_1
    827              {
    828                // Are we a coordinator
    829                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    830                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   6400         XRL     A,#0x0
   \   000026   7004         JNZ     ??ZDApp_RestoreNetworkState_2
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   6400         XRL     A,#0x0
   \                     ??ZDApp_RestoreNetworkState_2:
   \   00002C   7007         JNZ     ??ZDApp_RestoreNetworkState_3
    831                {
    832                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002E   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000031   E0           MOVX    A,@DPTR
   \   000032   54F8         ANL     A,#0xf8
   \   000034   F0           MOVX    @DPTR,A
    833                }
    834                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000035   7401         MOV     A,#0x1
   \   000037   90....       MOV     DPTR,#devStartMode
   \   00003A   F0           MOVX    @DPTR,A
   \   00003B   8002         SJMP    ??ZDApp_RestoreNetworkState_0
    835              }
    836              else
    837                nvStat = NV_ITEM_UNINIT;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   00003D   7E0F         MOV     R6,#0xf
    838          
    839          #if   ( SECURE != 0  )
    840              nwkFrameCounterChanges = 0;
    841              osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    842              osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    843          
    844            #if defined ( ZDO_COORDINATOR )
    845              ZDApp_RestoreNwkKey();
    846            #endif // ZDO_COORDINATOR
    847          #endif // SECURE
    848          
    849              // The default for RxOnWhenIdle is true for RTR_NWK and false for end devices
    850              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    851              // other than default.
    852            }
    853          
    854            if ( nvStat == ZSUCCESS )
   \                     ??ZDApp_RestoreNetworkState_0:
   \   00003F   EE           MOV     A,R6
   \   000040   7004         JNZ     ??ZDApp_RestoreNetworkState_4
    855              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000042   7900         MOV     R1,#0x0
   \   000044   8002         SJMP    ??ZDApp_RestoreNetworkState_5
    856            else
    857              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_4:
   \   000046   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_5:
   \   000048   7F01         MOV     R7,#0x1
   \   00004A   02....       LJMP    ?BANKED_LEAVE_XDATA
    858          }
    859          
    860          /*********************************************************************
    861           * @fn      ZDApp_InitUserDesc()
    862           *
    863           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    864           *          when needed.  If you want to initialize the User descriptor to
    865           *          something other than all zero, do it here.
    866           *
    867           * @param   none
    868           *
    869           * @return  none
    870           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    871          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    872          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    873            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    874          
    875            // Initialize the User Descriptor, the descriptor is read from NV
    876            // when needed.  If you want to initialize the User descriptor to something
    877            // other than all zero, do it here.
    878            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
    879            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    880                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   00001D                ; Setup parameters for call to function osal_nv_item_init
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C11         MOV     R4,#0x11
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A81         MOV     R2,#-0x7f
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_item_init?relay
   \   000039   7402         MOV     A,#0x2
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003E   E9           MOV     A,R1
   \   00003F   703F         JNZ     ??ZDApp_InitUserDesc_0
    881            {
    882              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    883                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000041                ; Setup parameters for call to function osal_nv_read
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   8582..       MOV     ?V0 + 0,DPL
   \   00004A   8583..       MOV     ?V0 + 1,DPH
   \   00004D   78..         MOV     R0,#?V0 + 0
   \   00004F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000052   75..11       MOV     ?V0 + 0,#0x11
   \   000055   75..00       MOV     ?V0 + 1,#0x0
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   7C00         MOV     R4,#0x0
   \   00005F   7D00         MOV     R5,#0x0
   \   000061   7A81         MOV     R2,#-0x7f
   \   000063   7B00         MOV     R3,#0x0
   \   000065   12....       LCALL   ??osal_nv_read?relay
   \   000068   7404         MOV     A,#0x4
   \   00006A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006D   E9           MOV     A,R1
   \   00006E   7010         JNZ     ??ZDApp_InitUserDesc_0
    884              {
    885                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000070   85..82       MOV     DPL,?XSP + 0
   \   000073   85..83       MOV     DPH,?XSP + 1
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6007         JZ      ??ZDApp_InitUserDesc_0
    886                {
    887                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000079   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   D2E4         SETB    0xE0 /* A   */.4
   \   00007F   F0           MOVX    @DPTR,A
    888                }
    889              }
    890            }
    891          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000080   7411         MOV     A,#0x11
   \   000082   12....       LCALL   ?DEALLOC_XSTACK8
   \   000085   7F02         MOV     R7,#0x2
   \   000087   02....       LJMP    ?BANKED_LEAVE_XDATA
    892          
    893          /*********************************************************************
    894           * @fn      ZDAppCheckForHoldKey()
    895           *
    896           * @brief   Check for key to set the device into Hold Auto Start
    897           *
    898           * @param   none
    899           *
    900           * @return  none
    901           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    902          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    903          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    904          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    905            // Get Keypad directly to see if a HOLD_START is needed.
    906            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    907            // while booting to avoid starting up the device.
    908            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7006         JNZ     ??ZDAppCheckForHoldKey_0
    909            {
    910              // Change the device state to HOLD on start up
    911              devState = DEV_HOLD;
   \   00000C   7400         MOV     A,#0x0
   \   00000E   90....       MOV     DPTR,#devState
   \   000011   F0           MOVX    @DPTR,A
    912            }
    913          #endif // HAL_KEY
    914          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
    915          
    916          /*********************************************************************
    917           * @fn      ZDApp_ProcessOSALMsg()
    918           *
    919           * @brief   Process the incoming task message.
    920           *
    921           * @param   msgPtr - message to process
    922           *
    923           * @return  none
    924           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    925          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    926          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    927            // Data Confirmation message fields
    928            byte sentEP;       // This should always be 0
    929            byte sentStatus;
    930            afDataConfirm_t *afDataConfirm;
    931          
    932            switch ( msgPtr->event )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   000011   00           DB        0
   \   000012   06           DB        6
   \   000013   01           DB        1
   \   000014   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   000016   02           DB        2
   \   000017   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   000019   03           DB        3
   \   00001A   ....         DW        ??ZDApp_ProcessOSALMsg_2
   \   00001C   1A           DB        26
   \   00001D   ....         DW        ??ZDApp_ProcessOSALMsg_3
   \   00001F   D3           DB        211
   \   000020   ....         DW        ??ZDApp_ProcessOSALMsg_4
   \   000022   FD           DB        253
   \   000023   ....         DW        ??ZDApp_ProcessOSALMsg_5
   \   000025   ....         DW        ??ZDApp_ProcessOSALMsg_5
    933            {
    934              // Incoming ZDO Message
    935              case AF_INCOMING_MSG_CMD:
    936                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000027                ; Setup parameters for call to function ZDP_IncomingData
   \   000027   EE           MOV     A,R6
   \   000028   FA           MOV     R2,A
   \   000029   EF           MOV     A,R7
   \   00002A   FB           MOV     R3,A
   \   00002B   12....       LCALL   ??ZDP_IncomingData?relay
   \   00002E   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    937                break;
    938                
    939              case ZDO_CB_MSG:
    940                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   000031                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   000031   EE           MOV     A,R6
   \   000032   FA           MOV     R2,A
   \   000033   EF           MOV     A,R7
   \   000034   FB           MOV     R3,A
   \   000035   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   \   000038   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    941                break;
    942          
    943              case AF_DATA_CONFIRM_CMD:
    944                // This message is received as a confirmation of a data packet sent.
    945                // The status is of ZStatus_t type [defined in NLMEDE.h]
    946                // The message fields are defined in AF.h
    947                afDataConfirm = (afDataConfirm_t *)msgPtr;
    948                sentEP = afDataConfirm->endpoint;
    949                sentStatus = afDataConfirm->hdr.status;
    950          
    951                // Action taken when confirmation is received.
    952                /* Put code here */
    953          #if !defined ( RTR_NWK )
    954                if ( sentStatus == ZMacNoACK )
    955                {
    956                  //ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
    957                }
    958          #else
    959               (void)sentStatus;
    960          #endif
    961                break;
    962          
    963              case ZDO_NWK_DISC_CNF:
    964                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   00003B   90....       MOV     DPTR,#devState
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   6402         XRL     A,#0x2
   \   000041   6003         JZ      $+5
   \   000043   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    965                {
    966                }
    967          #if !defined ( ZDO_COORDINATOR ) || defined ( SOFT_START )
    968            #if defined ( MANAGED_SCAN )
    969                else if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
    970            #else
    971                else if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter++ > NUM_DISC_ATTEMPTS) )
   \   000046   8E82         MOV     DPL,R6
   \   000048   8F83         MOV     DPH,R7
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   6003         JZ      $+5
   \   00004E   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   \   000051   90....       MOV     DPTR,#zdoDiscCounter
   \   000054   E0           MOVX    A,@DPTR
   \   000055   FA           MOV     R2,A
   \   000056   7401         MOV     A,#0x1
   \   000058   2A           ADD     A,R2
   \   000059   90....       MOV     DPTR,#zdoDiscCounter
   \   00005C   F0           MOVX    @DPTR,A
   \   00005D   EA           MOV     A,R2
   \   00005E   C3           CLR     C
   \   00005F   9403         SUBB    A,#0x3
   \   000061   5003         JNC     $+5
   \   000063   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    972            #endif
    973                {
    974                  if ( devStartMode == MODE_JOIN )
   \   000066   90....       MOV     DPTR,#devStartMode
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   706F         JNZ     ??ZDApp_ProcessOSALMsg_7
    975                  {
    976                    devState = DEV_NWK_JOINING;
   \   00006C   7403         MOV     A,#0x3
   \   00006E   90....       MOV     DPTR,#devState
   \   000071   F0           MOVX    @DPTR,A
    977          
    978                    ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   \   000072                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   000072   EE           MOV     A,R6
   \   000073   FA           MOV     R2,A
   \   000074   EF           MOV     A,R7
   \   000075   FB           MOV     R3,A
   \   000076   12....       LCALL   ??ZDApp_NodeProfileSync?relay
    979          
    980                    if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
    981                         BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
    982                         ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
    983                         ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   \   000079                ; Setup parameters for call to function NLME_JoinRequest
   \   000079   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   F5..         MOV     ?V0 + 4,A
   \   00007F   78..         MOV     R0,#?V0 + 4
   \   000081   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000084   8E82         MOV     DPL,R6
   \   000086   8F83         MOV     DPH,R7
   \   000088   A3           INC     DPTR
   \   000089   A3           INC     DPTR
   \   00008A   A3           INC     DPTR
   \   00008B   A3           INC     DPTR
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   F9           MOV     R1,A
   \   00008E   8E82         MOV     DPL,R6
   \   000090   8F83         MOV     DPH,R7
   \   000092   A3           INC     DPTR
   \   000093   A3           INC     DPTR
   \   000094   E0           MOVX    A,@DPTR
   \   000095   FC           MOV     R4,A
   \   000096   7D00         MOV     R5,#0x0
   \   000098   8E82         MOV     DPL,R6
   \   00009A   8F83         MOV     DPH,R7
   \   00009C   A3           INC     DPTR
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   FA           MOV     R2,A
   \   0000A1   E4           CLR     A
   \   0000A2   CA           XCH     A,R2
   \   0000A3   FB           MOV     R3,A
   \   0000A4   EA           MOV     A,R2
   \   0000A5   2C           ADD     A,R4
   \   0000A6   FC           MOV     R4,A
   \   0000A7   EB           MOV     A,R3
   \   0000A8   3D           ADDC    A,R5
   \   0000A9   FD           MOV     R5,A
   \   0000AA   EE           MOV     A,R6
   \   0000AB   2406         ADD     A,#0x6
   \   0000AD   FA           MOV     R2,A
   \   0000AE   EF           MOV     A,R7
   \   0000AF   3400         ADDC    A,#0x0
   \   0000B1   FB           MOV     R3,A
   \   0000B2   12....       LCALL   ??NLME_JoinRequest?relay
   \   0000B5   7401         MOV     A,#0x1
   \   0000B7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000BA   E9           MOV     A,R1
   \   0000BB   604E         JZ      ??ZDApp_ProcessOSALMsg_8
    984                    {
    985                      ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
    986                          + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000BD                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000BD                ; Setup parameters for call to function osal_rand
   \   0000BD   12....       LCALL   ??osal_rand?relay
   \   0000C0   8A..         MOV     ?V0 + 4,R2
   \   0000C2   8B..         MOV     ?V0 + 5,R3
   \   0000C4   747F         MOV     A,#0x7f
   \   0000C6   55..         ANL     A,?V0 + 4
   \   0000C8   F8           MOV     R0,A
   \   0000C9   7400         MOV     A,#0x0
   \   0000CB   55..         ANL     A,?V0 + 5
   \   0000CD   F9           MOV     R1,A
   \   0000CE   7464         MOV     A,#0x64
   \   0000D0   28           ADD     A,R0
   \   0000D1   FA           MOV     R2,A
   \   0000D2   7400         MOV     A,#0x0
   \   0000D4   39           ADDC    A,R1
   \   0000D5   FB           MOV     R3,A
   \   0000D6   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   0000D9   8030         SJMP    ??ZDApp_ProcessOSALMsg_8
    987                    }
    988                  }
    989                  else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   0000DB   90....       MOV     DPTR,#devStartMode
   \   0000DE   E0           MOVX    A,@DPTR
   \   0000DF   6403         XRL     A,#0x3
   \   0000E1   7028         JNZ     ??ZDApp_ProcessOSALMsg_8
    990                  {
    991                    devState = DEV_NWK_REJOIN;
   \   0000E3   7404         MOV     A,#0x4
   \   0000E5   90....       MOV     DPTR,#devState
   \   0000E8   F0           MOVX    @DPTR,A
    992                    if ( NLME_ReJoinRequest() != ZSuccess )
   \   0000E9                ; Setup parameters for call to function NLME_ReJoinRequest
   \   0000E9   12....       LCALL   ??NLME_ReJoinRequest?relay
   \   0000EC   E9           MOV     A,R1
   \   0000ED   601C         JZ      ??ZDApp_ProcessOSALMsg_8
    993                    {
    994                      ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
    995                          + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000EF                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000EF                ; Setup parameters for call to function osal_rand
   \   0000EF   12....       LCALL   ??osal_rand?relay
   \   0000F2   8A..         MOV     ?V0 + 4,R2
   \   0000F4   8B..         MOV     ?V0 + 5,R3
   \   0000F6   747F         MOV     A,#0x7f
   \   0000F8   55..         ANL     A,?V0 + 4
   \   0000FA   F8           MOV     R0,A
   \   0000FB   7400         MOV     A,#0x0
   \   0000FD   55..         ANL     A,?V0 + 5
   \   0000FF   F9           MOV     R1,A
   \   000100   7464         MOV     A,#0x64
   \   000102   28           ADD     A,R0
   \   000103   FA           MOV     R2,A
   \   000104   7400         MOV     A,#0x0
   \   000106   39           ADDC    A,R1
   \   000107   FB           MOV     R3,A
   \   000108   12....       LCALL   ??ZDApp_NetworkInit?relay
    996                    }
    997                  }
    998          
    999                  if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   00010B   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00010E   E0           MOVX    A,@DPTR
   \   00010F   A2E3         MOV     C,0xE0 /* A   */.3
   \   000111   5071         JNC     ??ZDApp_ProcessOSALMsg_5
   1000                  {
   1001                    // The receiver is on, turn network layer polling off.
   1002                    NLME_SetPollRate( 0 );
   \   000113                ; Setup parameters for call to function NLME_SetPollRate
   \   000113   7A00         MOV     R2,#0x0
   \   000115   7B00         MOV     R3,#0x0
   \   000117   12....       LCALL   ??NLME_SetPollRate?relay
   1003                    NLME_SetQueuedPollRate( 0 );
   \   00011A                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   00011A   7A00         MOV     R2,#0x0
   \   00011C   7B00         MOV     R3,#0x0
   \   00011E   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1004                    NLME_SetResponseRate( 0 );
   \   000121                ; Setup parameters for call to function NLME_SetResponseRate
   \   000121   7A00         MOV     R2,#0x0
   \   000123   7B00         MOV     R3,#0x0
   \   000125   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000128   805A         SJMP    ??ZDApp_ProcessOSALMsg_5
   1005                  }
   1006                }
   1007                else
   1008                {
   1009          #if defined ( SOFT_START ) && !defined ( VIRTKEY_SOFT_START )
   1010            #if defined ( MANAGED_SCAN )
   1011                  if ( (softStartAllowCoord)
   1012                      && (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status != ZDO_SUCCESS )
   1013                        && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   1014            #else
   1015                  if ( (softStartAllowCoord)
   1016                      && (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status != ZDO_SUCCESS )
   1017                        && (zdoDiscCounter++ > NUM_DISC_ATTEMPTS) )
   1018            #endif
   1019                  {
   1020                    ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   1021                    devStartMode = MODE_HARD;
   1022                  }
   1023                  else if ( continueJoining == FALSE )
   1024                  {
   1025                    devState = DEV_HOLD;
   1026                    osal_stop_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT );
   1027                    break;    // Don't init
   1028                  }
   1029          #endif
   1030            #if defined ( MANAGED_SCAN )
   1031                  ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1032            #else
   1033                  if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   00012A   90....       MOV     DPTR,#continueJoining
   \   00012D   E0           MOVX    A,@DPTR
   \   00012E   6054         JZ      ??ZDApp_ProcessOSALMsg_5
   1034                  {
   1035                    ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1036                        + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   000130                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000130                ; Setup parameters for call to function osal_rand
   \   000130   12....       LCALL   ??osal_rand?relay
   \   000133   8A..         MOV     ?V0 + 4,R2
   \   000135   8B..         MOV     ?V0 + 5,R3
   \   000137   74FF         MOV     A,#-0x1
   \   000139   55..         ANL     A,?V0 + 4
   \   00013B   F8           MOV     R0,A
   \   00013C   7400         MOV     A,#0x0
   \   00013E   55..         ANL     A,?V0 + 5
   \   000140   F9           MOV     R1,A
   \   000141   7464         MOV     A,#0x64
   \   000143   28           ADD     A,R0
   \   000144   FA           MOV     R2,A
   \   000145   7400         MOV     A,#0x0
   \   000147   39           ADDC    A,R1
   \   000148   FB           MOV     R3,A
   \   000149   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   00014C   8036         SJMP    ??ZDApp_ProcessOSALMsg_5
   1037                  }
   1038            #endif
   1039                }
   1040          #endif  // !ZDO_COORDINATOR
   1041                break;
   1042          
   1043          #if !defined( ZDO_COORDINATOR ) || defined( SOFT_START )
   1044              case ZDO_NWK_JOIN_IND:
   1045                ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   00014E                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   00014E   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   \   000151   8031         SJMP    ??ZDApp_ProcessOSALMsg_5
   1046                break;
   1047          
   1048              case ZDO_NWK_JOIN_REQ:
   1049                retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   000153   7400         MOV     A,#0x0
   \   000155   90....       MOV     DPTR,#retryCnt
   \   000158   F0           MOVX    @DPTR,A
   1050                devStartMode = MODE_RESUME;
   \   000159   7401         MOV     A,#0x1
   \   00015B   90....       MOV     DPTR,#devStartMode
   \   00015E   F0           MOVX    @DPTR,A
   1051                _tmpRejoinState = true;
   \   00015F   7401         MOV     A,#0x1
   \   000161   90....       MOV     DPTR,#_tmpRejoinState
   \   000164   F0           MOVX    @DPTR,A
   1052                zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \   000165   7402         MOV     A,#0x2
   \   000167   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   00016A   F0           MOVX    @DPTR,A
   1053                ZDApp_NetworkInit( 0 );
   \   00016B                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00016B   7A00         MOV     R2,#0x0
   \   00016D   7B00         MOV     R3,#0x0
   \   00016F   12....       LCALL   ??ZDApp_NetworkInit?relay
   1054          
   1055                // indicate state change to apps
   1056                devState = DEV_INIT;
   \   000172   7401         MOV     A,#0x1
   \   000174   90....       MOV     DPTR,#devState
   \   000177   F0           MOVX    @DPTR,A
   1057                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000178                ; Setup parameters for call to function osal_set_event
   \   000178   7A10         MOV     R2,#0x10
   \   00017A   7B00         MOV     R3,#0x0
   \   00017C   90....       MOV     DPTR,#ZDAppTaskID
   \   00017F   E0           MOVX    A,@DPTR
   \   000180   F9           MOV     R1,A
   \   000181   12....       LCALL   ??osal_set_event?relay
   1058                break;
   1059          #endif  // !ZDO_COORDINATOR
   1060          
   1061          #if defined ( ZDSECMGR_SECURE )
   1062            #if defined ( ZDSECMGR_COMMERCIAL )
   1063                  case ZDO_ESTABLISH_KEY_CFM:
   1064                    ZDSecMgrEstablishKeyCfm
   1065                      ( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1066                    break;
   1067            #endif
   1068          
   1069            #if defined ( ZDSECMGR_COMMERCIAL )
   1070              #if !defined ( ZDO_COORDINATOR ) || defined ( SOFT_START )
   1071                  case ZDO_ESTABLISH_KEY_IND:
   1072                    ZDSecMgrEstablishKeyInd
   1073                      ( (ZDO_EstablishKeyInd_t*)msgPtr );
   1074                    break;
   1075              #endif
   1076            #endif
   1077          
   1078            #if !defined ( ZDO_COORDINATOR ) || defined( SOFT_START )
   1079                  case ZDO_TRANSPORT_KEY_IND:
   1080                    ZDSecMgrTransportKeyInd
   1081                      ( (ZDO_TransportKeyInd_t*)msgPtr );
   1082                    break;
   1083            #endif
   1084          
   1085            #if defined ( ZDO_COORDINATOR )
   1086                  case ZDO_UPDATE_DEVICE_IND:
   1087                    ZDSecMgrUpdateDeviceInd
   1088                      ( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1089                    break;
   1090            #endif
   1091          
   1092            #if defined ( RTR_NWK )
   1093              #if !defined ( ZDO_COORDINATOR ) || defined( SOFT_START )
   1094                  case ZDO_REMOVE_DEVICE_IND:
   1095                    ZDSecMgrRemoveDeviceInd
   1096                      ( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1097                    break;
   1098              #endif
   1099            #endif
   1100          
   1101            #if defined ( ZDSECMGR_COMMERCIAL )
   1102              #if defined ( ZDO_COORDINATOR )
   1103                  case ZDO_REQUEST_KEY_IND:
   1104                    ZDSecMgrRequestKeyInd
   1105                      ( (ZDO_RequestKeyInd_t*)msgPtr );
   1106                    break;
   1107              #endif
   1108            #endif
   1109          
   1110            #if !defined ( ZDO_COORDINATOR ) || defined( SOFT_START )
   1111                  case ZDO_SWITCH_KEY_IND:
   1112                    ZDSecMgrSwitchKeyInd
   1113                      ( (ZDO_SwitchKeyInd_t*)msgPtr );
   1114                    break;
   1115            #endif
   1116          
   1117          #endif // defined ( ZDSECMGR_SECURE )
   1118          
   1119              default:
   1120                break;
   1121            }
   1122          
   1123            (void)sentEP;
   1124          }
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   000184   7F06         MOV     R7,#0x6
   \   000186   02....       LJMP    ?BANKED_LEAVE_XDATA
   1125          
   1126          /*********************************************************************
   1127           * @fn      ZDApp_ProcessMsgCBs()
   1128           *
   1129           * @brief   Process response messages
   1130           *
   1131           * @param   none
   1132           *
   1133           * @return  none
   1134           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1135          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1136          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   1137            switch ( inMsg->clusterID )
   \   00000E   E5..         MOV     A,?V0 + 0
   \   000010   240C         ADD     A,#0xc
   \   000012   F582         MOV     DPL,A
   \   000014   E5..         MOV     A,?V0 + 1
   \   000016   3400         ADDC    A,#0x0
   \   000018   F583         MOV     DPH,A
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F5..         MOV     ?V0 + 2,A
   \   00001D   A3           INC     DPTR
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F5..         MOV     ?V0 + 3,A
   \   000021   78..         MOV     R0,#?V0 + 2
   \   000023   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000026   0200         DW        2
   \   000028   2100         DW        33
   \   00002A   2200         DW        34
   \   00002C   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   00002E   0080         DW        32768
   \   000030   0180         DW        32769
   \   000032   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000034   0000         DW        0
   \   000036   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1138            {
   1139          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1140              case NWK_addr_rsp:
   1141              case IEEE_addr_rsp:
   1142                {
   1143                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1144                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000038                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000038   AA..         MOV     R2,?V0 + 0
   \   00003A   AB..         MOV     R3,?V0 + 1
   \   00003C   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00003F   8A..         MOV     ?V0 + 2,R2
   \   000041   8B..         MOV     ?V0 + 3,R3
   \   000043   AE..         MOV     R6,?V0 + 2
   \   000045   AF..         MOV     R7,?V0 + 3
   1145                  if ( pAddrRsp )
   \   000047   EE           MOV     A,R6
   \   000048   6400         XRL     A,#0x0
   \   00004A   7003         JNZ     ??ZDApp_ProcessMsgCBs_3
   \   00004C   EF           MOV     A,R7
   \   00004D   6400         XRL     A,#0x0
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   00004F   6047         JZ      ??ZDApp_ProcessMsgCBs_2
   1146                  {
   1147                    if ( pAddrRsp->status == ZSuccess )
   \   000051   8E82         MOV     DPL,R6
   \   000053   8F83         MOV     DPH,R7
   \   000055   E0           MOVX    A,@DPTR
   \   000056   7015         JNZ     ??ZDApp_ProcessMsgCBs_4
   1148                    {
   1149                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000058                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000058   EE           MOV     A,R6
   \   000059   2403         ADD     A,#0x3
   \   00005B   FC           MOV     R4,A
   \   00005C   EF           MOV     A,R7
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   FD           MOV     R5,A
   \   000060   8E82         MOV     DPL,R6
   \   000062   8F83         MOV     DPH,R7
   \   000064   A3           INC     DPTR
   \   000065   E0           MOVX    A,@DPTR
   \   000066   FA           MOV     R2,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   FB           MOV     R3,A
   \   00006A   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1150                    }
   1151                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   00006D                ; Setup parameters for call to function osal_mem_free
   \   00006D   EE           MOV     A,R6
   \   00006E   FA           MOV     R2,A
   \   00006F   EF           MOV     A,R7
   \   000070   FB           MOV     R3,A
   \   000071   12....       LCALL   ??osal_mem_free?relay
   \   000074   8022         SJMP    ??ZDApp_ProcessMsgCBs_2
   1152                  }
   1153                }
   1154                break;
   1155          #endif
   1156                
   1157          #if defined ( REFLECTOR )
   1158              case Bind_req:
   1159              case Unbind_req:
   1160                {
   1161                  ZDO_BindUnbindReq_t bindReq;
   1162                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000076                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000076   85..82       MOV     DPL,?XSP + 0
   \   000079   85..83       MOV     DPH,?XSP + 1
   \   00007C   AC82         MOV     R4,DPL
   \   00007E   AD83         MOV     R5,DPH
   \   000080   AA..         MOV     R2,?V0 + 0
   \   000082   AB..         MOV     R3,?V0 + 1
   \   000084   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1163                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000087                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000087   85..82       MOV     DPL,?XSP + 0
   \   00008A   85..83       MOV     DPH,?XSP + 1
   \   00008D   AC82         MOV     R4,DPL
   \   00008F   AD83         MOV     R5,DPH
   \   000091   AA..         MOV     R2,?V0 + 0
   \   000093   AB..         MOV     R3,?V0 + 1
   \   000095   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1164                }
   1165                break;
   1166          #endif      
   1167                
   1168          #if defined ( ZDO_COORDINATOR )
   1169              case Bind_rsp:
   1170              case Unbind_rsp:
   1171                if ( matchED )
   1172                {
   1173                  ZDMatchSendState(
   1174                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1175                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1176                }
   1177                break;
   1178                
   1179              case End_Device_Bind_req:
   1180                {
   1181                  ZDEndDeviceBind_t bindReq;
   1182                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1183                  ZDO_MatchEndDeviceBind( &bindReq );
   1184                  
   1185                  // Freeing the cluster lists - if allocated.
   1186                  if ( bindReq.numInClusters )
   1187                    osal_mem_free( bindReq.inClusters );
   1188                  if ( bindReq.numOutClusters )
   1189                    osal_mem_free( bindReq.outClusters );
   1190                }
   1191                break;
   1192          #endif      
   1193            }
   1194          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   000098   7415         MOV     A,#0x15
   \   00009A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009D   7F04         MOV     R7,#0x4
   \   00009F   02....       LJMP    ?BANKED_LEAVE_XDATA
   1195          
   1196          /*********************************************************************
   1197           * @fn      ZDApp_RegisterCBs()
   1198           *
   1199           * @brief   Process response messages
   1200           *
   1201           * @param   none
   1202           *
   1203           * @return  none
   1204           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1205          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1206          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1207          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1208            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   7B80         MOV     R3,#-0x80
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1209          #endif
   1210          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1211            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \   000010                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000010   7A00         MOV     R2,#0x0
   \   000012   7B80         MOV     R3,#-0x80
   \   000014   90....       MOV     DPTR,#ZDAppTaskID
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F9           MOV     R1,A
   \   000019   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1212          #endif  
   1213          #if defined ( ZDO_COORDINATOR )
   1214            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1215            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1216            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1217          #endif
   1218          #if defined ( REFLECTOR )
   1219            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \   00001C                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001C   7A21         MOV     R2,#0x21
   \   00001E   7B00         MOV     R3,#0x0
   \   000020   90....       MOV     DPTR,#ZDAppTaskID
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F9           MOV     R1,A
   \   000025   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1220            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \   000028                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000028   7A22         MOV     R2,#0x22
   \   00002A   7B00         MOV     R3,#0x0
   \   00002C   90....       MOV     DPTR,#ZDAppTaskID
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1221          #endif  
   1222          }
   \   000034   D083         POP     DPH
   \   000036   D082         POP     DPL
   \   000038   02....       LJMP    ?BRET
   1223          
   1224          #if !defined( ZDO_COORDINATOR ) || defined( SOFT_START )
   1225          /*********************************************************************
   1226           * @fn      ZDApp_ProcessNetworkJoin()
   1227           *
   1228           * @brief
   1229           *
   1230           *   Save off the Network key information.
   1231           *
   1232           * @param   none
   1233           *
   1234           * @return  none
   1235           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1236          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1237          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1238            if ( (devState == DEV_NWK_JOINING) ||
   1239                ((devState == DEV_NWK_ORPHAN)  &&
   1240                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6018         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   90....       MOV     DPTR,#devState
   \   000015   E0           MOVX    A,@DPTR
   \   000016   640A         XRL     A,#0xa
   \   000018   6003         JZ      $+5
   \   00001A   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000020   E0           MOVX    A,@DPTR
   \   000021   5407         ANL     A,#0x7
   \   000023   6401         XRL     A,#0x1
   \   000025   6003         JZ      $+5
   \   000027   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   1241            {
   1242              // Result of a Join attempt by this device.
   1243              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   00002A   90....       MOV     DPTR,#nwkStatus
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   7015         JNZ     ??ZDApp_ProcessNetworkJoin_2
   1244              {
   1245                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000030                ; Setup parameters for call to function osal_set_event
   \   000030   7A10         MOV     R2,#0x10
   \   000032   7B00         MOV     R3,#0x0
   \   000034   90....       MOV     DPTR,#ZDAppTaskID
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F9           MOV     R1,A
   \   000039   12....       LCALL   ??osal_set_event?relay
   1246          
   1247          #if defined ( POWER_SAVING )
   1248                osal_pwrmgr_device( PWRMGR_BATTERY );
   1249          #endif
   1250          
   1251          #if   ( SECURE != 0  )
   1252                if ( _NIB.SecurityLevel && (ZDApp_RestoreNwkKey() == false ) )
   1253                {
   1254                  // wait for auth from trust center!!
   1255                  devState = DEV_END_DEVICE_UNAUTH;
   1256          
   1257                  // Start the reset timer for MAX UNAUTH time
   1258                  ZDApp_ResetTimerStart( MAX_DEVICE_UNAUTH_TIMEOUT );
   1259                }
   1260                else
   1261          #endif  // SECURE
   1262                {
   1263          #if defined ( RTR_NWK )
   1264                  if ( devState == DEV_NWK_ORPHAN
   1265                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1266                  {
   1267                    // Change NIB state to router for restore
   1268                    _NIB.nwkState = NWK_ROUTER;
   1269                  }
   1270          #endif
   1271                  devState = DEV_END_DEVICE;
   \   00003C   7406         MOV     A,#0x6
   \   00003E   90....       MOV     DPTR,#devState
   \   000041   F0           MOVX    @DPTR,A
   \   000042   02....       LJMP    ??ZDApp_ProcessNetworkJoin_3 & 0xFFFF
   1272          #if defined ( RTR_NWK )
   1273                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1274            #if !defined (AUTO_SOFT_START)
   1275                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1276                  {
   1277                    NLME_StartRouterRequest( 0, 0, false );
   1278                  }
   1279            #endif // AUTO_SOFT_START
   1280          #endif  // RTR
   1281          
   1282          #if defined ( ZDO_ENDDEVICE_ANNCE_GENERATE )
   1283                  ZDP_EndDeviceAnnce( ZDAppNwkAddr.addr.shortAddr, saveExtAddr,
   1284                                     ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   1285          #endif
   1286                }
   1287              }
   1288              else
   1289              {
   1290                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   000045   90....       MOV     DPTR,#devStartMode
   \   000048   E0           MOVX    A,@DPTR
   \   000049   6401         XRL     A,#0x1
   \   00004B   7042         JNZ     ??ZDApp_ProcessNetworkJoin_4
   \   00004D   90....       MOV     DPTR,#retryCnt
   \   000050   E0           MOVX    A,@DPTR
   \   000051   2401         ADD     A,#0x1
   \   000053   FA           MOV     R2,A
   \   000054   EA           MOV     A,R2
   \   000055   90....       MOV     DPTR,#retryCnt
   \   000058   F0           MOVX    @DPTR,A
   \   000059   EA           MOV     A,R2
   \   00005A   C3           CLR     C
   \   00005B   9401         SUBB    A,#0x1
   \   00005D   4030         JC      ??ZDApp_ProcessNetworkJoin_4
   1291                {
   1292                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00005F   90....       MOV     DPTR,#(_NIB + 33)
   \   000062   E0           MOVX    A,@DPTR
   \   000063   64FF         XRL     A,#0xff
   \   000065   7004         JNZ     ??ZDApp_ProcessNetworkJoin_5
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   00006B   600E         JZ      ??ZDApp_ProcessNetworkJoin_6
   \   00006D   90....       MOV     DPTR,#(_NIB + 33)
   \   000070   E0           MOVX    A,@DPTR
   \   000071   64FE         XRL     A,#0xfe
   \   000073   7004         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   000075   A3           INC     DPTR
   \   000076   E0           MOVX    A,@DPTR
   \   000077   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   000079   7008         JNZ     ??ZDApp_ProcessNetworkJoin_8
   1293                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   00007B   7400         MOV     A,#0x0
   \   00007D   90....       MOV     DPTR,#devStartMode
   \   000080   F0           MOVX    @DPTR,A
   \   000081   800C         SJMP    ??ZDApp_ProcessNetworkJoin_4
   1294                  else
   1295                  {
   1296                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   000083   7403         MOV     A,#0x3
   \   000085   90....       MOV     DPTR,#devStartMode
   \   000088   F0           MOVX    @DPTR,A
   1297                    _tmpRejoinState = true;
   \   000089   7401         MOV     A,#0x1
   \   00008B   90....       MOV     DPTR,#_tmpRejoinState
   \   00008E   F0           MOVX    @DPTR,A
   1298                  }
   1299                }
   1300          
   1301                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1302                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   00008F                ; Setup parameters for call to function NLME_GetShortAddr
   \   00008F   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000092   8A..         MOV     ?V0 + 0,R2
   \   000094   8B..         MOV     ?V0 + 1,R3
   \   000096   74FE         MOV     A,#-0x2
   \   000098   65..         XRL     A,?V0 + 0
   \   00009A   7004         JNZ     ??ZDApp_ProcessNetworkJoin_9
   \   00009C   74FF         MOV     A,#-0x1
   \   00009E   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   0000A0   700E         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   0000A2   90....       MOV     DPTR,#(_NIB + 20)
   \   0000A5   E0           MOVX    A,@DPTR
   \   0000A6   64FE         XRL     A,#0xfe
   \   0000A8   7004         JNZ     ??ZDApp_ProcessNetworkJoin_11
   \   0000AA   A3           INC     DPTR
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   0000AE   6026         JZ      ??ZDApp_ProcessNetworkJoin_12
   1303                {
   1304                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   0000B0   85..82       MOV     DPL,?XSP + 0
   \   0000B3   85..83       MOV     DPH,?XSP + 1
   \   0000B6   74FE         MOV     A,#-0x2
   \   0000B8   F0           MOVX    @DPTR,A
   \   0000B9   A3           INC     DPTR
   \   0000BA   74FF         MOV     A,#-0x1
   \   0000BC   F0           MOVX    @DPTR,A
   1305                  // Invalidate nwk addr so end device does not use in its data reqs.
   1306                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000BD   90....       MOV     DPTR,#(_NIB + 20)
   \   0000C0   74FE         MOV     A,#-0x2
   \   0000C2   F0           MOVX    @DPTR,A
   \   0000C3   A3           INC     DPTR
   \   0000C4   74FF         MOV     A,#-0x1
   \   0000C6   F0           MOVX    @DPTR,A
   1307                  ZMacSetReq( ZMacShortAddress, (byte *)&addr );
   \   0000C7                ; Setup parameters for call to function ZMacSetReq
   \   0000C7   85..82       MOV     DPL,?XSP + 0
   \   0000CA   85..83       MOV     DPH,?XSP + 1
   \   0000CD   AA82         MOV     R2,DPL
   \   0000CF   AB83         MOV     R3,DPH
   \   0000D1   7953         MOV     R1,#0x53
   \   0000D3   12....       LCALL   ZMacSetReq & 0xFFFF
   1308                }
   1309          
   1310                zdoDiscCounter = 1;
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000D6   7401         MOV     A,#0x1
   \   0000D8   90....       MOV     DPTR,#zdoDiscCounter
   \   0000DB   F0           MOVX    @DPTR,A
   1311          
   1312          //      ZDApp_NetworkInit( (uint16)
   1313          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1314          //                          (NWK_START_DELAY * 5)) );
   1315                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1316                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000DC                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000DC                ; Setup parameters for call to function osal_rand
   \   0000DC   12....       LCALL   ??osal_rand?relay
   \   0000DF   8A..         MOV     ?V0 + 0,R2
   \   0000E1   8B..         MOV     ?V0 + 1,R3
   \   0000E3   747F         MOV     A,#0x7f
   \   0000E5   55..         ANL     A,?V0 + 0
   \   0000E7   F8           MOV     R0,A
   \   0000E8   7400         MOV     A,#0x0
   \   0000EA   55..         ANL     A,?V0 + 1
   \   0000EC   F9           MOV     R1,A
   \   0000ED   7464         MOV     A,#0x64
   \   0000EF   28           ADD     A,R0
   \   0000F0   FA           MOV     R2,A
   \   0000F1   7400         MOV     A,#0x0
   \   0000F3   39           ADDC    A,R1
   \   0000F4   FB           MOV     R3,A
   \   0000F5   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   0000F8   02....       LJMP    ??ZDApp_ProcessNetworkJoin_3 & 0xFFFF
   1317              }
   1318            }
   1319            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000FB   90....       MOV     DPTR,#devState
   \   0000FE   E0           MOVX    A,@DPTR
   \   0000FF   640A         XRL     A,#0xa
   \   000101   600B         JZ      ??ZDApp_ProcessNetworkJoin_13
   \   000103   90....       MOV     DPTR,#devState
   \   000106   E0           MOVX    A,@DPTR
   \   000107   6404         XRL     A,#0x4
   \   000109   6003         JZ      $+5
   \   00010B   02....       LJMP    ??ZDApp_ProcessNetworkJoin_3 & 0xFFFF
   1320            {
   1321              // results of an orphaning attempt by this device
   1322              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   00010E   90....       MOV     DPTR,#nwkStatus
   \   000111   E0           MOVX    A,@DPTR
   \   000112   7031         JNZ     ??ZDApp_ProcessNetworkJoin_14
   1323              {
   1324          #if ( SECURE != 0 )
   1325                ZDApp_RestoreNwkKey();
   1326          #endif
   1327                devState = DEV_END_DEVICE;
   \   000114   7406         MOV     A,#0x6
   \   000116   90....       MOV     DPTR,#devState
   \   000119   F0           MOVX    @DPTR,A
   1328                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00011A                ; Setup parameters for call to function osal_set_event
   \   00011A   7A10         MOV     R2,#0x10
   \   00011C   7B00         MOV     R3,#0x0
   \   00011E   90....       MOV     DPTR,#ZDAppTaskID
   \   000121   E0           MOVX    A,@DPTR
   \   000122   F9           MOV     R1,A
   \   000123   12....       LCALL   ??osal_set_event?relay
   1329                // setup Power Manager Device
   1330          #if defined ( POWER_SAVING )
   1331                osal_pwrmgr_device( PWRMGR_BATTERY );
   1332          #endif
   1333          
   1334                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \   000126   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000129   E0           MOVX    A,@DPTR
   \   00012A   A2E3         MOV     C,0xE0 /* A   */.3
   \   00012C   507D         JNC     ??ZDApp_ProcessNetworkJoin_3
   1335                {
   1336                  // The receiver is on, turn network layer polling off.
   1337                  NLME_SetPollRate( 0 );
   \   00012E                ; Setup parameters for call to function NLME_SetPollRate
   \   00012E   7A00         MOV     R2,#0x0
   \   000130   7B00         MOV     R3,#0x0
   \   000132   12....       LCALL   ??NLME_SetPollRate?relay
   1338                  NLME_SetQueuedPollRate( 0 );
   \   000135                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000135   7A00         MOV     R2,#0x0
   \   000137   7B00         MOV     R3,#0x0
   \   000139   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1339                  NLME_SetResponseRate( 0 );
   \   00013C                ; Setup parameters for call to function NLME_SetResponseRate
   \   00013C   7A00         MOV     R2,#0x0
   \   00013E   7B00         MOV     R3,#0x0
   \   000140   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000143   8066         SJMP    ??ZDApp_ProcessNetworkJoin_3
   1340                }
   1341          
   1342          #if defined ( ZDO_ENDDEVICE_ANNCE_GENERATE )
   1343                ZDP_EndDeviceAnnce( ZDAppNwkAddr.addr.shortAddr, saveExtAddr,
   1344                                   ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   1345          #endif
   1346          
   1347              }
   1348              else
   1349              {
   1350                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   000145   90....       MOV     DPTR,#devStartMode
   \   000148   E0           MOVX    A,@DPTR
   \   000149   6401         XRL     A,#0x1
   \   00014B   7042         JNZ     ??ZDApp_ProcessNetworkJoin_15
   \   00014D   90....       MOV     DPTR,#retryCnt
   \   000150   E0           MOVX    A,@DPTR
   \   000151   2401         ADD     A,#0x1
   \   000153   FA           MOV     R2,A
   \   000154   EA           MOV     A,R2
   \   000155   90....       MOV     DPTR,#retryCnt
   \   000158   F0           MOVX    @DPTR,A
   \   000159   EA           MOV     A,R2
   \   00015A   C3           CLR     C
   \   00015B   9401         SUBB    A,#0x1
   \   00015D   4030         JC      ??ZDApp_ProcessNetworkJoin_15
   1351                {
   1352                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00015F   90....       MOV     DPTR,#(_NIB + 33)
   \   000162   E0           MOVX    A,@DPTR
   \   000163   64FF         XRL     A,#0xff
   \   000165   7004         JNZ     ??ZDApp_ProcessNetworkJoin_16
   \   000167   A3           INC     DPTR
   \   000168   E0           MOVX    A,@DPTR
   \   000169   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   00016B   600E         JZ      ??ZDApp_ProcessNetworkJoin_17
   \   00016D   90....       MOV     DPTR,#(_NIB + 33)
   \   000170   E0           MOVX    A,@DPTR
   \   000171   64FE         XRL     A,#0xfe
   \   000173   7004         JNZ     ??ZDApp_ProcessNetworkJoin_18
   \   000175   A3           INC     DPTR
   \   000176   E0           MOVX    A,@DPTR
   \   000177   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   000179   7008         JNZ     ??ZDApp_ProcessNetworkJoin_19
   1353                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   00017B   7400         MOV     A,#0x0
   \   00017D   90....       MOV     DPTR,#devStartMode
   \   000180   F0           MOVX    @DPTR,A
   \   000181   800C         SJMP    ??ZDApp_ProcessNetworkJoin_15
   1354                  else
   1355                  {
   1356                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   000183   7403         MOV     A,#0x3
   \   000185   90....       MOV     DPTR,#devStartMode
   \   000188   F0           MOVX    @DPTR,A
   1357                    _tmpRejoinState = true;
   \   000189   7401         MOV     A,#0x1
   \   00018B   90....       MOV     DPTR,#_tmpRejoinState
   \   00018E   F0           MOVX    @DPTR,A
   1358                  }
   1359                }
   1360          
   1361                // setup a retry for later...
   1362                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1363                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   00018F                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00018F                ; Setup parameters for call to function osal_rand
   \   00018F   12....       LCALL   ??osal_rand?relay
   \   000192   8A..         MOV     ?V0 + 0,R2
   \   000194   8B..         MOV     ?V0 + 1,R3
   \   000196   747F         MOV     A,#0x7f
   \   000198   55..         ANL     A,?V0 + 0
   \   00019A   F8           MOV     R0,A
   \   00019B   7400         MOV     A,#0x0
   \   00019D   55..         ANL     A,?V0 + 1
   \   00019F   F9           MOV     R1,A
   \   0001A0   7464         MOV     A,#0x64
   \   0001A2   28           ADD     A,R0
   \   0001A3   FA           MOV     R2,A
   \   0001A4   7400         MOV     A,#0x0
   \   0001A6   39           ADDC    A,R1
   \   0001A7   FB           MOV     R3,A
   \   0001A8   12....       LCALL   ??ZDApp_NetworkInit?relay
   1364              }
   1365            }
   1366            else
   1367            {
   1368              // this is an error case!!
   1369            }
   1370          }
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   0001AB   7402         MOV     A,#0x2
   \   0001AD   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001B0   7F02         MOV     R7,#0x2
   \   0001B2   02....       LJMP    ?BANKED_LEAVE_XDATA
   1371          #endif // !ZDO_COORDINATOR
   1372          
   1373          #if ( SECURE != 0 )
   1374          /*********************************************************************
   1375           * @fn      ZDApp_SaveNwkKey()
   1376           *
   1377           * @brief   Save off the Network key information.
   1378           *
   1379           * @param   none
   1380           *
   1381           * @return  none
   1382           */
   1383          void ZDApp_SaveNwkKey( void )
   1384          {
   1385            nwkActiveKeyItems keyItems;
   1386          
   1387            SSP_ReadNwkActiveKey( &keyItems );
   1388            keyItems.frameCounter++;
   1389          
   1390            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1391                          (void *)&keyItems );
   1392          
   1393            nwkFrameCounterChanges = 0;
   1394          }
   1395          
   1396          /*********************************************************************
   1397           * @fn      ZDApp_ResetNwkKey()
   1398           *
   1399           * @brief   Reset the Network key information in NV.
   1400           *
   1401           * @param   none
   1402           *
   1403           * @return  none
   1404           */
   1405          void ZDApp_ResetNwkKey( void )
   1406          {
   1407            nwkActiveKeyItems keyItems;
   1408          
   1409            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   1410            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1411                          (void *)&keyItems );
   1412          }
   1413          #endif
   1414          
   1415          #if ( SECURE != 0 )
   1416          /*********************************************************************
   1417           * @fn      ZDApp_RestoreNwkKey()
   1418           *
   1419           * @brief
   1420           *
   1421           *   Save off the Network key information.
   1422           *
   1423           * @param   none
   1424           *
   1425           * @return  true if restored from NV, false if not
   1426           */
   1427          byte ZDApp_RestoreNwkKey( void )
   1428          {
   1429            nwkActiveKeyItems keyItems;
   1430            byte ret = false;
   1431          
   1432            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1433                == ZSUCCESS )
   1434            {
   1435              if ( keyItems.frameCounter > 0 )
   1436              {
   1437                // Restore the key information
   1438                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1439                nwkFrameCounter = keyItems.frameCounter;
   1440                ret = true;
   1441              }
   1442          
   1443              // Force a save for the first frame counter increment
   1444              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   1445            }
   1446            return ( ret );
   1447          }
   1448          #endif
   1449          
   1450          /*********************************************************************
   1451           * @fn      ZDApp_ResetTimerStart
   1452           *
   1453           * @brief   Start the reset timer.
   1454           *
   1455           * @param   delay - delay time(ms) before reset
   1456           *
   1457           * @return  none
   1458           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1459          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1460          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1461            // Start the rest timer
   1462            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000009                ; Setup parameters for call to function osal_start_timerEx
   \   000009   EE           MOV     A,R6
   \   00000A   FC           MOV     R4,A
   \   00000B   EF           MOV     A,R7
   \   00000C   FD           MOV     R5,A
   \   00000D   7A04         MOV     R2,#0x4
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   90....       MOV     DPTR,#ZDAppTaskID
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F9           MOV     R1,A
   \   000016   12....       LCALL   ??osal_start_timerEx?relay
   1463          }
   \   000019   7F01         MOV     R7,#0x1
   \   00001B   02....       LJMP    ?BANKED_LEAVE_XDATA
   1464          
   1465          /*********************************************************************
   1466           * @fn      ZDApp_ResetTimerCancel
   1467           *
   1468           * @brief   Cancel the reset timer.
   1469           *
   1470           * @param   none
   1471           *
   1472           * @return  none
   1473           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1474          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1475          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1476            // Cancel the reset timer
   1477            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1478          }
   \   000010   D083         POP     DPH
   \   000012   D082         POP     DPL
   \   000014   02....       LJMP    ?BRET
   1479          
   1480          /*********************************************************************
   1481           * @fn      ZDApp_LeaveCtrlInit
   1482           *
   1483           * @brief   Initialize the leave control logic.
   1484           *
   1485           * @param   none
   1486           *
   1487           * @return  none
   1488           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1489          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1490          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1491            uint8 status;
   1492          
   1493          
   1494            // Initialize control state
   1495            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   7400         MOV     A,#0x0
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   F0           MOVX    @DPTR,A
   1496          
   1497            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1498                                        sizeof(ZDApp_LeaveCtrl),
   1499                                        &ZDApp_LeaveCtrl );
   \   00000B                ; Setup parameters for call to function osal_nv_item_init
   \   00000B   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   00000E   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   7C01         MOV     R4,#0x1
   \   000018   7D00         MOV     R5,#0x0
   \   00001A   7A85         MOV     R2,#-0x7b
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??osal_nv_item_init?relay
   \   000021   7402         MOV     A,#0x2
   \   000023   12....       LCALL   ?DEALLOC_XSTACK8
   \   000026   E9           MOV     A,R1
   1500          
   1501            if ( status == ZSUCCESS )
   \   000027   7026         JNZ     ??ZDApp_LeaveCtrlInit_0
   1502            {
   1503              // Read saved control
   1504              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1505                            0,
   1506                            sizeof( uint8 ),
   1507                            &ZDApp_LeaveCtrl);
   \   000029                ; Setup parameters for call to function osal_nv_read
   \   000029   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   00002C   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000034   75..01       MOV     ?V0 + 0,#0x1
   \   000037   75..00       MOV     ?V0 + 1,#0x0
   \   00003A   78..         MOV     R0,#?V0 + 0
   \   00003C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003F   7C00         MOV     R4,#0x0
   \   000041   7D00         MOV     R5,#0x0
   \   000043   7A85         MOV     R2,#-0x7b
   \   000045   7B00         MOV     R3,#0x0
   \   000047   12....       LCALL   ??osal_nv_read?relay
   \   00004A   7404         MOV     A,#0x4
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   1508            }
   1509          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00004F   7F02         MOV     R7,#0x2
   \   000051   02....       LJMP    ?BANKED_LEAVE_XDATA
   1510          
   1511          /*********************************************************************
   1512           * @fn      ZDApp_LeaveCtrlSet
   1513           *
   1514           * @brief   Set the leave control logic.
   1515           *
   1516           * @param   ra - reassociate flag
   1517           *
   1518           * @return  none
   1519           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1520          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1521          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1522            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   7401         MOV     A,#0x1
   \   000009   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000C   F0           MOVX    @DPTR,A
   1523          
   1524            if ( ra == TRUE )
   \   00000D   7401         MOV     A,#0x1
   \   00000F   6E           XRL     A,R6
   \   000010   7007         JNZ     ??ZDApp_LeaveCtrlSet_0
   1525            {
   1526              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000012   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000015   E0           MOVX    A,@DPTR
   \   000016   D2E1         SETB    0xE0 /* A   */.1
   \   000018   F0           MOVX    @DPTR,A
   1527            }
   1528          
   1529            // Write the leave control
   1530            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1531                           0,
   1532                           sizeof( uint8 ),
   1533                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000019                ; Setup parameters for call to function osal_nv_write
   \   000019   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   00001C   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000024   75..01       MOV     ?V0 + 0,#0x1
   \   000027   75..00       MOV     ?V0 + 1,#0x0
   \   00002A   78..         MOV     R0,#?V0 + 0
   \   00002C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002F   7C00         MOV     R4,#0x0
   \   000031   7D00         MOV     R5,#0x0
   \   000033   7A85         MOV     R2,#-0x7b
   \   000035   7B00         MOV     R3,#0x0
   \   000037   12....       LCALL   ??osal_nv_write?relay
   \   00003A   7404         MOV     A,#0x4
   \   00003C   12....       LCALL   ?DEALLOC_XSTACK8
   1534          }
   \   00003F   7F02         MOV     R7,#0x2
   \   000041   02....       LJMP    ?BANKED_LEAVE_XDATA
   1535          
   1536          /*********************************************************************
   1537           * @fn      ZDApp_LeaveCtrlBypass
   1538           *
   1539           * @brief   Check if NV restore should be skipped during a leave reset.
   1540           *
   1541           * @param   none
   1542           *
   1543           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1544           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1545          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1546          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1547            uint8 bypass;
   1548          
   1549            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   5004         JNC     ??ZDApp_LeaveCtrlBypass_0
   1550            {
   1551              bypass = TRUE;
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   8002         SJMP    ??ZDApp_LeaveCtrlBypass_1
   1552            }
   1553            else
   1554            {
   1555              bypass = FALSE;
   \                     ??ZDApp_LeaveCtrlBypass_0:
   \   000010   7900         MOV     R1,#0x0
   1556            }
   1557          
   1558            return bypass;
   \                     ??ZDApp_LeaveCtrlBypass_1:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET
   1559          }
   1560          
   1561          /*********************************************************************
   1562           * @fn      ZDApp_LeaveCtrlStartup
   1563           *
   1564           * @brief   Check for startup conditions during a leave reset.
   1565           *
   1566           * @param   state      - devState_t determined by leave control logic
   1567           * @param   startDelay - startup delay
   1568           *
   1569           * @return  none
   1570           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1571          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1572          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
   1573            *startDelay = 0;
   \   00000D   8E82         MOV     DPL,R6
   \   00000F   8F83         MOV     DPH,R7
   \   000011   7400         MOV     A,#0x0
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   7400         MOV     A,#0x0
   \   000017   F0           MOVX    @DPTR,A
   1574          
   1575            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   000018   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001E   504A         JNC     ??ZDApp_LeaveCtrlStartup_0
   1576            {
   1577              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000020   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000023   E0           MOVX    A,@DPTR
   \   000024   A2E1         MOV     C,0xE0 /* A   */.1
   \   000026   500D         JNC     ??ZDApp_LeaveCtrlStartup_1
   1578              {
   1579                *startDelay = 5000;
   \   000028   8E82         MOV     DPL,R6
   \   00002A   8F83         MOV     DPH,R7
   \   00002C   7488         MOV     A,#-0x78
   \   00002E   F0           MOVX    @DPTR,A
   \   00002F   A3           INC     DPTR
   \   000030   7413         MOV     A,#0x13
   \   000032   F0           MOVX    @DPTR,A
   \   000033   8009         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1580              }
   1581              else
   1582              {
   1583                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000035   7400         MOV     A,#0x0
   \   000037   85..82       MOV     DPL,?V0 + 0
   \   00003A   85..83       MOV     DPH,?V0 + 1
   \   00003D   F0           MOVX    @DPTR,A
   1584              }
   1585          
   1586              // Set leave control to initialized state
   1587              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00003E   7400         MOV     A,#0x0
   \   000040   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000043   F0           MOVX    @DPTR,A
   1588          
   1589              // Write initialized control
   1590              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1591                            0,
   1592                            sizeof( uint8 ),
   1593                            &ZDApp_LeaveCtrl);
   \   000044                ; Setup parameters for call to function osal_nv_write
   \   000044   75....       MOV     ?V0 + 2,#(ZDApp_LeaveCtrl & 0xff)
   \   000047   75....       MOV     ?V0 + 3,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00004A   78..         MOV     R0,#?V0 + 2
   \   00004C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004F   75..01       MOV     ?V0 + 2,#0x1
   \   000052   75..00       MOV     ?V0 + 3,#0x0
   \   000055   78..         MOV     R0,#?V0 + 2
   \   000057   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005A   7C00         MOV     R4,#0x0
   \   00005C   7D00         MOV     R5,#0x0
   \   00005E   7A85         MOV     R2,#-0x7b
   \   000060   7B00         MOV     R3,#0x0
   \   000062   12....       LCALL   ??osal_nv_write?relay
   \   000065   7404         MOV     A,#0x4
   \   000067   12....       LCALL   ?DEALLOC_XSTACK8
   1594            }
   1595          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   00006A   7F04         MOV     R7,#0x4
   \   00006C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1596          
   1597          /*********************************************************************
   1598           * @fn      ZDApp_LeaveReset
   1599           *
   1600           * @brief   Setup a device reset due to a leave indication/confirm.
   1601           *
   1602           * @param   ra - reassociate flag
   1603           *
   1604           * @return  none
   1605           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1606          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1607          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   1608            ZDApp_LeaveCtrlSet( ra );
   \   000006                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1609          
   1610            ZDApp_ResetTimerStart( 5000 );
   \   00000A                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   00000A   7A88         MOV     R2,#-0x78
   \   00000C   7B13         MOV     R3,#0x13
   \   00000E   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1611          }
   \   000011   7F01         MOV     R7,#0x1
   \   000013   02....       LJMP    ?BANKED_LEAVE_XDATA
   1612          
   1613          /*********************************************************************
   1614           * @fn      ZDApp_LeaveUpdate
   1615           *
   1616           * @brief   Update local device data related to leaving device.
   1617           *
   1618           * @param   nwkAddr        - NWK address of leaving device
   1619           * @param   extAddr        - EXT address of leaving device
   1620           * @param   removeChildren - remove children of leaving device
   1621           *
   1622           * @return  none
   1623           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1624          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1625                                  uint8 removeChildren )
   1626          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   8C..         MOV     ?V0 + 0,R4
   \   000007   8D..         MOV     ?V0 + 1,R5
   \   000009   89..         MOV     ?V0 + 2,R1
   1627            /*
   1628            AddrMgrEntry_t entry;
   1629            */
   1630          
   1631          
   1632            // Remove if child
   1633            NLME_RemoveChild( extAddr, removeChildren );
   \   00000B                ; Setup parameters for call to function NLME_RemoveChild
   \   00000B   A9..         MOV     R1,?V0 + 2
   \   00000D   AA..         MOV     R2,?V0 + 0
   \   00000F   AB..         MOV     R3,?V0 + 1
   \   000011   12....       LCALL   ??NLME_RemoveChild?relay
   1634          
   1635            /*
   1636            // Set NWK address to invalid
   1637            entry.user    = ADDRMGR_USER_DEFAULT;
   1638            entry.nwkAddr = INVALID_NODE_ADDR;
   1639            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1640            AddrMgrEntryUpdate( &entry );
   1641          
   1642            // Check
   1643            if ( removeChildren == TRUE )
   1644            {
   1645              // Set index to INVALID_NODE_ADDR to start search
   1646              entry.index = INVALID_NODE_ADDR;
   1647          
   1648              // Get first entry
   1649              AddrMgrEntryGetNext( &entry );
   1650          
   1651              // Remove all descendents
   1652              while ( entry.index != INVALID_NODE_ADDR )
   1653              {
   1654                // Check NWK address allocation algorithm
   1655                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1656                {
   1657                  // Set NWK address to invalid
   1658                  entry.nwkAddr = INVALID_NODE_ADDR;
   1659                  AddrMgrEntryUpdate( &entry );
   1660                }
   1661          
   1662                // Get next entry
   1663                AddrMgrEntryGetNext( &entry );
   1664              }
   1665            }
   1666            */
   1667          }
   \   000014   7F03         MOV     R7,#0x3
   \   000016   02....       LJMP    ?BANKED_LEAVE_XDATA
   1668          
   1669          /*********************************************************************
   1670           * CALLBACK FUNCTIONS
   1671           */
   1672          
   1673          /*********************************************************************
   1674           * @fn      ZDApp_SendEventMsg()
   1675           *
   1676           * @brief
   1677           *
   1678           *   Sends a Network Join message
   1679           *
   1680           * @param  cmd - command ID
   1681           * @param  len - length (in bytes) of the buf field
   1682           * @param  buf - buffer for the rest of the message.
   1683           *
   1684           * @return  none
   1685           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1686          void ZDApp_SendEventMsg( byte cmd, byte len, byte *buf )
   \                     ZDApp_SendEventMsg:
   1687          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   8A..         MOV     ?V0 + 1,R2
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
   1688            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   00000D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00000D   EE           MOV     A,R6
   \   00000E   FC           MOV     R4,A
   \   00000F   EF           MOV     A,R7
   \   000010   FD           MOV     R5,A
   \   000011   AB..         MOV     R3,?V0 + 1
   \   000013   AA..         MOV     R2,?V0 + 0
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDApp_SendMsg?relay
   1689          }
   \   00001D   7F02         MOV     R7,#0x2
   \   00001F   02....       LJMP    ?BANKED_LEAVE_XDATA
   1690          
   1691          /*********************************************************************
   1692           * @fn      ZDApp_SendMsg()
   1693           *
   1694           * @brief   Sends a OSAL message
   1695           *
   1696           * @param  taskID - Where to send the message
   1697           * @param  cmd - command ID
   1698           * @param  len - length (in bytes) of the buf field
   1699           * @param  buf - buffer for the rest of the message.
   1700           *
   1701           * @return  none
   1702           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1703          void ZDApp_SendMsg( byte taskID, byte cmd, byte len, byte *buf )
   \                     ZDApp_SendMsg:
   1704          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   8A..         MOV     ?V0 + 3,R2
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   \   00000B   8C..         MOV     ?V0 + 6,R4
   \   00000D   8D..         MOV     ?V0 + 7,R5
   1705            osal_event_hdr_t *msgPtr;
   1706          
   1707            // Send the address to the task
   1708            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F                ; Setup parameters for call to function osal_msg_allocate
   \   00000F   EF           MOV     A,R7
   \   000010   F5..         MOV     ?V0 + 0,A
   \   000012   AA..         MOV     R2,?V0 + 0
   \   000014   7B00         MOV     R3,#0x0
   \   000016   12....       LCALL   ??osal_msg_allocate?relay
   \   000019   8A..         MOV     ?V0 + 0,R2
   \   00001B   8B..         MOV     ?V0 + 1,R3
   \   00001D   85....       MOV     ?V0 + 4,?V0 + 0
   \   000020   85....       MOV     ?V0 + 5,?V0 + 1
   1709            if ( msgPtr )
   \   000023   E5..         MOV     A,?V0 + 4
   \   000025   6400         XRL     A,#0x0
   \   000027   7004         JNZ     ??ZDApp_SendMsg_0
   \   000029   E5..         MOV     A,?V0 + 5
   \   00002B   6400         XRL     A,#0x0
   \                     ??ZDApp_SendMsg_0:
   \   00002D   6045         JZ      ??ZDApp_SendMsg_1
   1710            {
   1711              if ( (len > 0) && (buf != NULL) )
   \   00002F   EF           MOV     A,R7
   \   000030   C3           CLR     C
   \   000031   9401         SUBB    A,#0x1
   \   000033   402D         JC      ??ZDApp_SendMsg_2
   \   000035   E5..         MOV     A,?V0 + 6
   \   000037   6400         XRL     A,#0x0
   \   000039   7004         JNZ     ??ZDApp_SendMsg_3
   \   00003B   E5..         MOV     A,?V0 + 7
   \   00003D   6400         XRL     A,#0x0
   \                     ??ZDApp_SendMsg_3:
   \   00003F   6021         JZ      ??ZDApp_SendMsg_2
   1712                osal_memcpy( msgPtr, buf, len );
   \   000041                ; Setup parameters for call to function osal_memcpy
   \   000041   85....       MOV     ?V0 + 0,?V0 + 6
   \   000044   85....       MOV     ?V0 + 1,?V0 + 7
   \   000047   75..00       MOV     ?V0 + 2,#0x0
   \   00004A   78..         MOV     R0,#?V0 + 0
   \   00004C   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00004F   EF           MOV     A,R7
   \   000050   F5..         MOV     ?V0 + 0,A
   \   000052   AC..         MOV     R4,?V0 + 0
   \   000054   7D00         MOV     R5,#0x0
   \   000056   AA..         MOV     R2,?V0 + 4
   \   000058   AB..         MOV     R3,?V0 + 5
   \   00005A   12....       LCALL   ??osal_memcpy?relay
   \   00005D   7403         MOV     A,#0x3
   \   00005F   12....       LCALL   ?DEALLOC_XSTACK8
   1713          
   1714              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   000062   85..82       MOV     DPL,?V0 + 4
   \   000065   85..83       MOV     DPH,?V0 + 5
   \   000068   E5..         MOV     A,?V0 + 3
   \   00006A   F0           MOVX    @DPTR,A
   1715              osal_msg_send( taskID, (byte *)msgPtr );
   \   00006B                ; Setup parameters for call to function osal_msg_send
   \   00006B   AA..         MOV     R2,?V0 + 4
   \   00006D   AB..         MOV     R3,?V0 + 5
   \   00006F   EE           MOV     A,R6
   \   000070   F9           MOV     R1,A
   \   000071   12....       LCALL   ??osal_msg_send?relay
   1716            }
   1717          }
   \                     ??ZDApp_SendMsg_1:
   \   000074   7F08         MOV     R7,#0x8
   \   000076   02....       LJMP    ?BANKED_LEAVE_XDATA
   1718          
   1719          /*********************************************************************
   1720           * Call Back Functions from NWK  - API
   1721           */
   1722          
   1723          /*********************************************************************
   1724           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1725           *
   1726           * @brief       This function returns a choice of PAN to join.
   1727           *
   1728           * @param       ResultCount - Number of routers discovered
   1729           * @param               NetworkList - Pointer to list of network descriptors
   1730           *
   1731           * @return      ZStatus_t
   1732           */
   1733          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1734          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( byte ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1735                                                   networkDesc_t *NetworkList )
   1736          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 4,R1
   \   00000C   8A..         MOV     ?V0 + 6,R2
   \   00000E   8B..         MOV     ?V0 + 7,R3
   1737            networkDesc_t *pNwkDesc;
   1738            ZDO_NetworkDiscoveryCfm_t msg;
   1739            byte  i;
   1740            uint8 stackProfile;
   1741            uint8 stackProfilePro;
   1742            uint8 selected;
   1743          
   1744          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1745            if ( zdappMgmtNwkDiscReqInProgress )
   1746            {
   1747              zdappMgmtNwkDiscReqInProgress = false;
   1748              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1749              return ( ZSuccess );
   1750            }
   1751          #endif
   1752          
   1753            // process discovery results
   1754            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 2,#0x0
   1755            selected = FALSE;
   \   000013   75..00       MOV     ?V0 + 1,#0x0
   1756          
   1757            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000016   75..00       MOV     ?V0 + 3,#0x0
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000019   E5..         MOV     A,?V0 + 3
   \   00001B   C3           CLR     C
   \   00001C   9402         SUBB    A,#0x2
   \   00001E   4003         JC      $+5
   \   000020   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_1 & 0xFFFF
   1758            {
   1759              pNwkDesc = NetworkList;
   \   000023   AE..         MOV     R6,?V0 + 6
   \   000025   AF..         MOV     R7,?V0 + 7
   1760              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   000027   75..00       MOV     ?V0 + 0,#0x0
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00002A   E5..         MOV     A,?V0 + 0
   \   00002C   C3           CLR     C
   \   00002D   95..         SUBB    A,?V0 + 4
   \   00002F   4003         JC      $+5
   \   000031   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   1761              {
   1762                if ( zgConfigPANID != 0xFFFF )
   \   000034   90....       MOV     DPTR,#zgConfigPANID
   \   000037   E0           MOVX    A,@DPTR
   \   000038   64FF         XRL     A,#0xff
   \   00003A   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_4
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000040   6021         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   1763                {
   1764                  // PAN Id is preconfigured. check if it matches
   1765                  // only 14 bits of pan id is used
   1766                  if ( pNwkDesc->panId != ( zgConfigPANID & 0x3FFF ) )
   \   000042   8E82         MOV     DPL,R6
   \   000044   8F83         MOV     DPH,R7
   \   000046   C082         PUSH    DPL
   \   000048   C083         PUSH    DPH
   \   00004A   90....       MOV     DPTR,#zgConfigPANID
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   54FF         ANL     A,#0xff
   \   000050   F8           MOV     R0,A
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   543F         ANL     A,#0x3f
   \   000055   F9           MOV     R1,A
   \   000056   D083         POP     DPH
   \   000058   D082         POP     DPL
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   68           XRL     A,R0
   \   00005C   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000061   704E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_7
   1767                    continue;
   1768                }
   1769          
   1770                // check that network is allowing joining
   1771                //------------------------------------------------------------
   1772                #if defined( RTR_NWK )
   1773                //------------------------------------------------------------
   1774                if ( stackProfilePro == FALSE )
   1775                {
   1776                  if ( !pNwkDesc->routerCapacity )
   1777                  {
   1778                    continue;
   1779                  }
   1780                }
   1781                else
   1782                {
   1783                  if ( !pNwkDesc->deviceCapacity )
   1784                  {
   1785                    continue;
   1786                  }
   1787                }
   1788                //------------------------------------------------------------
   1789                #else
   1790                //------------------------------------------------------------
   1791                if ( !pNwkDesc->deviceCapacity )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   000063   8E82         MOV     DPL,R6
   \   000065   8F83         MOV     DPH,R7
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   A3           INC     DPTR
   \   00006A   A3           INC     DPTR
   \   00006B   A3           INC     DPTR
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   6041         JZ      ??ZDO_NetworkDiscoveryConfirmCB_7
   1792                {
   1793                  continue;
   1794                }
   1795                //------------------------------------------------------------
   1796                #endif
   1797                //------------------------------------------------------------
   1798                // check version of zigbee protocol
   1799                if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   \   000070   8E82         MOV     DPL,R6
   \   000072   8F83         MOV     DPH,R7
   \   000074   A3           INC     DPTR
   \   000075   A3           INC     DPTR
   \   000076   A3           INC     DPTR
   \   000077   A3           INC     DPTR
   \   000078   A3           INC     DPTR
   \   000079   A3           INC     DPTR
   \   00007A   A3           INC     DPTR
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   FA           MOV     R2,A
   \   00007D   90....       MOV     DPTR,#(_NIB + 17)
   \   000080   E0           MOVX    A,@DPTR
   \   000081   6A           XRL     A,R2
   \   000082   702D         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_7
   1800                  continue;
   1801          
   1802                // check version of stack profile
   1803                if ( pNwkDesc->stackProfile != zgStackProfile  )
   \   000084   8E82         MOV     DPL,R6
   \   000086   8F83         MOV     DPH,R7
   \   000088   A3           INC     DPTR
   \   000089   A3           INC     DPTR
   \   00008A   A3           INC     DPTR
   \   00008B   A3           INC     DPTR
   \   00008C   A3           INC     DPTR
   \   00008D   A3           INC     DPTR
   \   00008E   A3           INC     DPTR
   \   00008F   A3           INC     DPTR
   \   000090   E0           MOVX    A,@DPTR
   \   000091   FA           MOV     R2,A
   \   000092   90....       MOV     DPTR,#zgStackProfile
   \   000095   E0           MOVX    A,@DPTR
   \   000096   6A           XRL     A,R2
   \   000097   602C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_3
   1804                {
   1805                  if ( pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE )
   \   000099   8E82         MOV     DPL,R6
   \   00009B   8F83         MOV     DPH,R7
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   E0           MOVX    A,@DPTR
   \   0000A6   6402         XRL     A,#0x2
   \   0000A8   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   1806                    stackProfilePro = TRUE;
   \   0000AA   75..01       MOV     ?V0 + 2,#0x1
   1807                  
   1808                  if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   0000AD   E5..         MOV     A,?V0 + 3
   \   0000AF   7014         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   1809                  {
   1810                    continue;
   1811                  }
   1812                }
   1813          
   1814                // check if beacon order is the right value..
   1815                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1816                //    continue;
   1817          
   1818                // choose this pan for joining
   1819                break;
   1820              } 
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000B1   05..         INC     ?V0 + 0
   \   0000B3   EE           MOV     A,R6
   \   0000B4   2415         ADD     A,#0x15
   \   0000B6   F582         MOV     DPL,A
   \   0000B8   EF           MOV     A,R7
   \   0000B9   3400         ADDC    A,#0x0
   \   0000BB   F583         MOV     DPH,A
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   FE           MOV     R6,A
   \   0000BF   A3           INC     DPTR
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   FF           MOV     R7,A
   \   0000C2   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   1821              
   1822              if (i < ResultCount)
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   0000C5   E5..         MOV     A,?V0 + 0
   \   0000C7   C3           CLR     C
   \   0000C8   95..         SUBB    A,?V0 + 4
   \   0000CA   400F         JC      ??ZDO_NetworkDiscoveryConfirmCB_1
   1823              {
   1824               selected = TRUE;
   1825                break;
   1826              }
   1827             
   1828              // break if selected or stack profile pro wasn't found
   1829              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \   0000CC   7401         MOV     A,#0x1
   \   0000CE   65..         XRL     A,?V0 + 1
   \   0000D0   6009         JZ      ??ZDO_NetworkDiscoveryConfirmCB_1
   \   0000D2   E5..         MOV     A,?V0 + 2
   \   0000D4   6005         JZ      ??ZDO_NetworkDiscoveryConfirmCB_1
   1830              {
   1831                break;
   1832              }
   1833            }
   \   0000D6   05..         INC     ?V0 + 3
   \   0000D8   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1834          
   1835            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   0000DB   E5..         MOV     A,?V0 + 4
   \   0000DD   65..         XRL     A,?V0 + 0
   \   0000DF   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_9
   1836            {
   1837              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   0000E1   7401         MOV     A,#0x1
   \   0000E3   C0E0         PUSH    A
   \   0000E5   7401         MOV     A,#0x1
   \   0000E7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EA   D0E0         POP     A
   \   0000EC   F0           MOVX    @DPTR,A
   \   0000ED   8068         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_10
   1838            }
   1839            else
   1840            {
   1841              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   0000EF   7400         MOV     A,#0x0
   \   0000F1   C0E0         PUSH    A
   \   0000F3   7401         MOV     A,#0x1
   \   0000F5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F8   D0E0         POP     A
   \   0000FA   F0           MOVX    @DPTR,A
   1842              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   0000FB   8E82         MOV     DPL,R6
   \   0000FD   8F83         MOV     DPH,R7
   \   0000FF   E0           MOVX    A,@DPTR
   \   000100   C0E0         PUSH    A
   \   000102   7402         MOV     A,#0x2
   \   000104   12....       LCALL   ?XSTACK_DISP0_8
   \   000107   D0E0         POP     A
   \   000109   F0           MOVX    @DPTR,A
   1843              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   00010A   8E82         MOV     DPL,R6
   \   00010C   8F83         MOV     DPH,R7
   \   00010E   A3           INC     DPTR
   \   00010F   E0           MOVX    A,@DPTR
   \   000110   F9           MOV     R1,A
   \   000111   E9           MOV     A,R1
   \   000112   C0E0         PUSH    A
   \   000114   7403         MOV     A,#0x3
   \   000116   12....       LCALL   ?XSTACK_DISP0_8
   \   000119   D0E0         POP     A
   \   00011B   F0           MOVX    @DPTR,A
   1844              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   00011C   8E82         MOV     DPL,R6
   \   00011E   8F83         MOV     DPH,R7
   \   000120   A3           INC     DPTR
   \   000121   A3           INC     DPTR
   \   000122   E0           MOVX    A,@DPTR
   \   000123   C0E0         PUSH    A
   \   000125   7404         MOV     A,#0x4
   \   000127   12....       LCALL   ?XSTACK_DISP0_8
   \   00012A   D0E0         POP     A
   \   00012C   F0           MOVX    @DPTR,A
   1845              msg.version = pNwkDesc->version;
   \   00012D   8E82         MOV     DPL,R6
   \   00012F   8F83         MOV     DPH,R7
   \   000131   A3           INC     DPTR
   \   000132   A3           INC     DPTR
   \   000133   A3           INC     DPTR
   \   000134   A3           INC     DPTR
   \   000135   A3           INC     DPTR
   \   000136   A3           INC     DPTR
   \   000137   A3           INC     DPTR
   \   000138   E0           MOVX    A,@DPTR
   \   000139   C0E0         PUSH    A
   \   00013B   7405         MOV     A,#0x5
   \   00013D   12....       LCALL   ?XSTACK_DISP0_8
   \   000140   D0E0         POP     A
   \   000142   F0           MOVX    @DPTR,A
   1846              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000143                ; Setup parameters for call to function osal_cpyExtAddr
   \   000143   EE           MOV     A,R6
   \   000144   240D         ADD     A,#0xd
   \   000146   FC           MOV     R4,A
   \   000147   EF           MOV     A,R7
   \   000148   3400         ADDC    A,#0x0
   \   00014A   FD           MOV     R5,A
   \   00014B   7406         MOV     A,#0x6
   \   00014D   12....       LCALL   ?XSTACK_DISP0_8
   \   000150   AA82         MOV     R2,DPL
   \   000152   AB83         MOV     R3,DPH
   \   000154   12....       LCALL   ??osal_cpyExtAddr?relay
   1847            }
   1848          
   1849            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (byte *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   000157                ; Setup parameters for call to function ZDApp_SendMsg
   \   000157   85..82       MOV     DPL,?XSP + 0
   \   00015A   85..83       MOV     DPH,?XSP + 1
   \   00015D   AC82         MOV     R4,DPL
   \   00015F   AD83         MOV     R5,DPH
   \   000161   7B0E         MOV     R3,#0xe
   \   000163   7A01         MOV     R2,#0x1
   \   000165   90....       MOV     DPTR,#ZDAppTaskID
   \   000168   E0           MOVX    A,@DPTR
   \   000169   F9           MOV     R1,A
   \   00016A   12....       LCALL   ??ZDApp_SendMsg?relay
   1850          
   1851            return (ZSuccess);
   \   00016D   7900         MOV     R1,#0x0
   \   00016F   740E         MOV     A,#0xe
   \   000171   12....       LCALL   ?DEALLOC_XSTACK8
   \   000174   7F08         MOV     R7,#0x8
   \   000176   02....       LJMP    ?BANKED_LEAVE_XDATA
   1852          }  // ZDO_NetworkDiscoveryConfirmCB
   1853          
   1854          /*********************************************************************
   1855           * @fn          ZDO_NetworkFormationConfirmCB
   1856           *
   1857           * @brief       This function reports the results of the request to
   1858           *              initialize a coordinator in a network.
   1859           *
   1860           * @param       Status - Result of NLME_NetworkFormationRequest()
   1861           *
   1862           * @return      none
   1863           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1864          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   1865          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1866          #if defined(ZDO_COORDINATOR)
   1867            nwkStatus = (byte)Status;
   1868          
   1869            if ( Status == ZSUCCESS )
   1870            {
   1871              // LED on shows Coordinator started
   1872              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   1873          
   1874              // LED off forgets HOLD_AUTO_START
   1875              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   1876          
   1877          #if defined ( ZBIT )
   1878              SIM_SetColor(0xd0ffd0);
   1879          #endif
   1880          
   1881              if ( devState == DEV_HOLD )
   1882              {
   1883                // Began with HOLD_AUTO_START
   1884                devState = DEV_COORD_STARTING;
   1885              }
   1886            }
   1887          #if defined(BLINK_LEDS)
   1888            else
   1889              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   1890          #endif
   1891          
   1892            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   1893          #endif  //ZDO_COORDINATOR
   1894          }
   \   000000   02....       LJMP    ?BRET
   1895          
   1896          #if defined(RTR_NWK)
   1897          /*********************************************************************
   1898           * @fn          ZDO_StartRouterConfirmCB
   1899           *
   1900           * @brief       This function reports the results of the request to
   1901           *              start functioning as a router in a network.
   1902           *
   1903           * @param       Status - Result of NLME_StartRouterRequest()
   1904           *
   1905           * @return      none
   1906           */
   1907          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   1908          {
   1909            nwkStatus = (byte)Status;
   1910          
   1911            if ( Status == ZSUCCESS )
   1912            {
   1913              // LED on shows Router started
   1914              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   1915              // LED off forgets HOLD_AUTO_START
   1916              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   1917              if ( devState == DEV_HOLD )
   1918              {
   1919                // Began with HOLD_AUTO_START
   1920                devState = DEV_END_DEVICE;
   1921              }
   1922            }
   1923          #if defined(BLINK_LEDS)
   1924            else
   1925              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   1926          #endif
   1927          
   1928            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   1929          }
   1930          #endif  //RTR_NWK
   1931          
   1932          /*********************************************************************
   1933           * @fn          ZDO_JoinConfirmCB
   1934           *
   1935           * @brief       This function allows the next hight layer to be notified
   1936           *              of the results of its request to join itself or another
   1937           *              device to a network.
   1938           *
   1939           * @param       Status - Result of NLME_JoinRequest()
   1940           *
   1941           * @return      none
   1942           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1943          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   1944          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   1945            nwkStatus = (byte)Status;
   \   000007   E5..         MOV     A,?V0 + 0
   \   000009   90....       MOV     DPTR,#nwkStatus
   \   00000C   F0           MOVX    @DPTR,A
   1946          
   1947            if ( Status == ZSUCCESS )
   \   00000D   E5..         MOV     A,?V0 + 0
   \   00000F   701F         JNZ     ??ZDO_JoinConfirmCB_0
   1948            {
   1949              // LED on shows device joined
   1950              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   000011                ; Setup parameters for call to function HalLedSet
   \   000011   7A01         MOV     R2,#0x1
   \   000013   7904         MOV     R1,#0x4
   \   000015   12....       LCALL   ??HalLedSet?relay
   1951              // LED off forgets HOLD_AUTO_START
   1952              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   \   000018                ; Setup parameters for call to function HalLedSet
   \   000018   7A00         MOV     R2,#0x0
   \   00001A   7908         MOV     R1,#0x8
   \   00001C   12....       LCALL   ??HalLedSet?relay
   1953              if ( (devState == DEV_HOLD) )
   \   00001F   90....       MOV     DPTR,#devState
   \   000022   E0           MOVX    A,@DPTR
   \   000023   7006         JNZ     ??ZDO_JoinConfirmCB_1
   1954              {
   1955                // Began with HOLD_AUTO_START
   1956                devState = DEV_NWK_JOINING;
   \   000025   7403         MOV     A,#0x3
   \   000027   90....       MOV     DPTR,#devState
   \   00002A   F0           MOVX    @DPTR,A
   1957              }
   1958          #if !  ( SECURE != 0  )
   1959              // Notify to save info into NV
   1960              ZDApp_NVUpdate();
   \                     ??ZDO_JoinConfirmCB_1:
   \   00002B                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00002B   12....       LCALL   ??ZDApp_NVUpdate?relay
   \   00002E   8007         SJMP    ??ZDO_JoinConfirmCB_2
   1961          #endif
   1962            }
   1963          #if defined(BLINK_LEDS)
   1964            else
   1965              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000030                ; Setup parameters for call to function HalLedSet
   \   000030   7A04         MOV     R2,#0x4
   \   000032   7904         MOV     R1,#0x4
   \   000034   12....       LCALL   ??HalLedSet?relay
   1966          #endif
   1967          
   1968            // Notify ZDApp
   1969            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_2:
   \   000037                ; Setup parameters for call to function ZDApp_SendMsg
   \   000037   7C00         MOV     R4,#0x0
   \   000039   7D00         MOV     R5,#0x0
   \   00003B   7B02         MOV     R3,#0x2
   \   00003D   7A02         MOV     R2,#0x2
   \   00003F   90....       MOV     DPTR,#ZDAppTaskID
   \   000042   E0           MOVX    A,@DPTR
   \   000043   F9           MOV     R1,A
   \   000044   12....       LCALL   ??ZDApp_SendMsg?relay
   1970          }
   \   000047   7F01         MOV     R7,#0x1
   \   000049   02....       LJMP    ?BANKED_LEAVE_XDATA
   1971          
   1972          /*********************************************************************
   1973           * @fn          ZDO_JoinIndicationCB
   1974           *
   1975           * @brief       This function allows the next higher layer of a
   1976           *              coordinator to be notified of a remote join request.
   1977           *
   1978           * @param       ShortAddress - 16-bit address
   1979           * @param       ExtendedAddress - IEEE (64-bit) address
   1980           * @param       CapabilityInformation - Association Capability Information
   1981           *
   1982           * @return      ZStatus_t
   1983           */
   1984          #if defined(RTR_NWK)
   1985          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, byte *ExtendedAddress,
   1986                                                   byte CapabilityInformation )
   1987          {
   1988          #if defined (AUTO_SOFT_START)
   1989              ZDX_PostCoordinatorIEEE(ShortAddress);
   1990          #endif
   1991          
   1992            // Notify to save info into NV
   1993            ZDApp_NVUpdate();
   1994          
   1995          #if   ( SECURE != 0  )
   1996            // send notification to TC of new device..
   1997            if ( _NIB.SecurityLevel )
   1998              osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   1999          #endif  // SECURE
   2000          
   2001            return ( ZSuccess );
   2002          }
   2003          #endif  //RTR_NWK
   2004          
   2005          /*********************************************************************
   2006           * @fn          ZDO_LeaveCnf
   2007           *
   2008           * @brief       This function allows the next higher layer to be
   2009           *              notified of the results of its request for this or
   2010           *              a child device to leave the network.
   2011           *
   2012           * @param       cnf - NLME_LeaveCnf_t
   2013           *
   2014           * @return      none
   2015           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2016          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2017          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2018            // Check for this device
   2019            if ( osal_ExtAddrEqual( cnf->extAddr,
   2020                                    NLME_GetExtAddr() ) == TRUE )
   \   000009                ; Setup parameters for call to function osal_ExtAddrEqual
   \   000009                ; Setup parameters for call to function NLME_GetExtAddr
   \   000009   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
   \   000010   EE           MOV     A,R6
   \   000011   2402         ADD     A,#0x2
   \   000013   FA           MOV     R2,A
   \   000014   EF           MOV     A,R7
   \   000015   3400         ADDC    A,#0x0
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??osal_ExtAddrEqual?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   6401         XRL     A,#0x1
   \   00001E   700F         JNZ     ??ZDO_LeaveCnf_0
   2021            {
   2022              // Prepare to leave with reset
   2023              ZDApp_LeaveReset( cnf->rejoin );
   \   000020                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   F582         MOV     DPL,A
   \   000025   EF           MOV     A,R7
   \   000026   3400         ADDC    A,#0x0
   \   000028   F583         MOV     DPH,A
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F9           MOV     R1,A
   \   00002C   12....       LCALL   ??ZDApp_LeaveReset?relay
   2024            }
   2025            //------------------------------------------------------------------
   2026            #if defined( RTR_NWK )
   2027            //------------------------------------------------------------------
   2028            else
   2029            {
   2030              // Remove device address(optionally descendents) from data
   2031              ZDApp_LeaveUpdate( cnf->dstAddr,
   2032                                 cnf->extAddr,
   2033                                 cnf->removeChildren );
   2034            }
   2035            //------------------------------------------------------------------
   2036            #endif
   2037            //------------------------------------------------------------------
   2038          }
   \                     ??ZDO_LeaveCnf_0:
   \   00002F   7F01         MOV     R7,#0x1
   \   000031   02....       LJMP    ?BANKED_LEAVE_XDATA
   2039          
   2040          /*********************************************************************
   2041           * @fn          ZDO_LeaveInd
   2042           *
   2043           * @brief       This function allows the next higher layer of a
   2044           *              device to be notified of a remote leave request or
   2045           *              indication.
   2046           *
   2047           * @param       ind - NLME_LeaveInd_t
   2048           *
   2049           * @return      none
   2050           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2051          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2052          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2053            uint8 leave;
   2054          
   2055          
   2056            // Parent is requesting the leave - NWK layer filters out illegal
   2057            // requests
   2058            if ( ind->request == TRUE )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6401         XRL     A,#0x1
   \   00001A   7011         JNZ     ??ZDO_LeaveInd_0
   2059            {
   2060              // Notify network of leave
   2061              //----------------------------------------------------------------
   2062              #if defined( RTR_NWK )
   2063              //----------------------------------------------------------------
   2064              NLME_LeaveRsp_t rsp;
   2065              rsp.rejoin         = ind->rejoin;
   2066              rsp.removeChildren = ind->removeChildren;
   2067              NLME_LeaveRsp( &rsp );
   2068              //----------------------------------------------------------------
   2069              #endif
   2070              //----------------------------------------------------------------
   2071          
   2072              // Prepare to leave with reset
   2073              ZDApp_LeaveReset( ind->rejoin );
   \   00001C                ; Setup parameters for call to function ZDApp_LeaveReset
   \   00001C   EE           MOV     A,R6
   \   00001D   240C         ADD     A,#0xc
   \   00001F   F582         MOV     DPL,A
   \   000021   EF           MOV     A,R7
   \   000022   3400         ADDC    A,#0x0
   \   000024   F583         MOV     DPH,A
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00002B   8074         SJMP    ??ZDO_LeaveInd_1
   2074            }
   2075            else
   2076            {
   2077              leave = FALSE;
   \                     ??ZDO_LeaveInd_0:
   \   00002D   75..00       MOV     ?V0 + 0,#0x0
   2078          
   2079              // Check if this device needs to leave as a child or descendent
   2080              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \   000030   8E82         MOV     DPL,R6
   \   000032   8F83         MOV     DPH,R7
   \   000034   C082         PUSH    DPL
   \   000036   C083         PUSH    DPH
   \   000038                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000038   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   00003B   8A..         MOV     ?V0 + 2,R2
   \   00003D   8B..         MOV     ?V0 + 3,R3
   \   00003F   D083         POP     DPH
   \   000041   D082         POP     DPL
   \   000043   E0           MOVX    A,@DPTR
   \   000044   65..         XRL     A,?V0 + 2
   \   000046   7004         JNZ     ??ZDO_LeaveInd_2
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   65..         XRL     A,?V0 + 3
   \                     ??ZDO_LeaveInd_2:
   \   00004C   701C         JNZ     ??ZDO_LeaveInd_3
   2081              {
   2082                if ( ( ind->removeChildren == TRUE               ) ||
   2083                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2084                       NODETYPE_DEVICE                           )    )
   \   00004E   EE           MOV     A,R6
   \   00004F   240B         ADD     A,#0xb
   \   000051   F582         MOV     DPL,A
   \   000053   EF           MOV     A,R7
   \   000054   3400         ADDC    A,#0x0
   \   000056   F583         MOV     DPH,A
   \   000058   E0           MOVX    A,@DPTR
   \   000059   6401         XRL     A,#0x1
   \   00005B   600A         JZ      ??ZDO_LeaveInd_4
   \   00005D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000060   E0           MOVX    A,@DPTR
   \   000061   5407         ANL     A,#0x7
   \   000063   6402         XRL     A,#0x2
   \   000065   7003         JNZ     ??ZDO_LeaveInd_3
   2085                {
   2086                  leave = TRUE;
   \                     ??ZDO_LeaveInd_4:
   \   000067   75..01       MOV     ?V0 + 0,#0x1
   2087                }
   2088              }
   2089              else if ( ind->removeChildren == TRUE )
   2090              {
   2091                // Check NWK address allocation algorithm
   2092                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2093              }
   2094          
   2095              if ( leave == TRUE )
   \                     ??ZDO_LeaveInd_3:
   \   00006A   7401         MOV     A,#0x1
   \   00006C   65..         XRL     A,?V0 + 0
   \   00006E   7011         JNZ     ??ZDO_LeaveInd_5
   2096              {
   2097                // Prepare to leave with reset
   2098                ZDApp_LeaveReset( ind->rejoin );
   \   000070                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000070   EE           MOV     A,R6
   \   000071   240C         ADD     A,#0xc
   \   000073   F582         MOV     DPL,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   F583         MOV     DPH,A
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   F9           MOV     R1,A
   \   00007C   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00007F   8020         SJMP    ??ZDO_LeaveInd_1
   2099              }
   2100              else
   2101              {
   2102                // Remove device address(optionally descendents) from data
   2103                ZDApp_LeaveUpdate( ind->srcAddr,
   2104                                   ind->extAddr,
   2105                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_5:
   \   000081                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   000081   EE           MOV     A,R6
   \   000082   240B         ADD     A,#0xb
   \   000084   F582         MOV     DPL,A
   \   000086   EF           MOV     A,R7
   \   000087   3400         ADDC    A,#0x0
   \   000089   F583         MOV     DPH,A
   \   00008B   E0           MOVX    A,@DPTR
   \   00008C   F9           MOV     R1,A
   \   00008D   EE           MOV     A,R6
   \   00008E   2402         ADD     A,#0x2
   \   000090   FC           MOV     R4,A
   \   000091   EF           MOV     A,R7
   \   000092   3400         ADDC    A,#0x0
   \   000094   FD           MOV     R5,A
   \   000095   8E82         MOV     DPL,R6
   \   000097   8F83         MOV     DPH,R7
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   FA           MOV     R2,A
   \   00009B   A3           INC     DPTR
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   FB           MOV     R3,A
   \   00009E   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2106              }
   2107            }
   2108          }
   \                     ??ZDO_LeaveInd_1:
   \   0000A1   7F04         MOV     R7,#0x4
   \   0000A3   02....       LJMP    ?BANKED_LEAVE_XDATA
   2109          
   2110          /*********************************************************************
   2111           * @fn          ZDO_SyncIndicationCB
   2112           *
   2113           * @brief       This function allows the next higher layer of a
   2114           *              coordinator to be notified of a loss of synchronization
   2115           *                          with the parent/child device.
   2116           *
   2117           * @param       type: 0 - child; 1 - parent
   2118           *
   2119           *
   2120           * @return      none
   2121           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2122          void ZDO_SyncIndicationCB( byte type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2123          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   2124          
   2125          #if !defined ( RTR_NWK )
   2126              if ( type == 1 )
   \   000007   7401         MOV     A,#0x1
   \   000009   65..         XRL     A,?V0 + 0
   \   00000B   7010         JNZ     ??ZDO_SyncIndicationCB_0
   2127              {
   2128                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   00000D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00000D   7C00         MOV     R4,#0x0
   \   00000F   7D00         MOV     R5,#0x0
   \   000011   7B02         MOV     R3,#0x2
   \   000013   7A03         MOV     R2,#0x3
   \   000015   90....       MOV     DPTR,#ZDAppTaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??ZDApp_SendMsg?relay
   2129              }
   2130          #endif
   2131            return;
   \                     ??ZDO_SyncIndicationCB_0:
   \   00001D   7F01         MOV     R7,#0x1
   \   00001F   02....       LJMP    ?BANKED_LEAVE_XDATA
   2132          }
   2133          
   2134          /*********************************************************************
   2135           * @fn          ZDO_PollConfirmCB
   2136           *
   2137           * @brief       This function allows the next higher layer to be
   2138           *              notified of a Poll Confirm.
   2139           *
   2140           * @param       none
   2141           *
   2142           * @return      none
   2143           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2144          void ZDO_PollConfirmCB( byte status )
   \                     ZDO_PollConfirmCB:
   2145          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2146            return;
   \   000000   02....       LJMP    ?BRET
   2147          }
   2148          
   2149          /******************************************************************************
   2150           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2151           *
   2152           * @brief       Stub routine implemented by NHLE. NHLE should call
   2153           *              <AddrMgrWriteNV> when appropriate.
   2154           *
   2155           * @param       none
   2156           *
   2157           * @return      none
   2158           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2159          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2160          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2161            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   8A..         MOV     ?V0 + 0,R2
   \   000013   8B..         MOV     ?V0 + 1,R3
   \   000015   7400         MOV     A,#0x0
   \   000017   65..         XRL     A,?V0 + 0
   \   000019   7004         JNZ     ??AddrMgrWriteNVRequest_0
   \   00001B   7400         MOV     A,#0x0
   \   00001D   65..         XRL     A,?V0 + 1
   \                     ??AddrMgrWriteNVRequest_0:
   \   00001F   7003         JNZ     ??AddrMgrWriteNVRequest_1
   2162            {
   2163              // Trigger to save info into NV
   2164              ZDApp_NVUpdate();
   \   000021                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000021   12....       LCALL   ??ZDApp_NVUpdate?relay
   2165            }
   2166          }
   \                     ??AddrMgrWriteNVRequest_1:
   \   000024   7F02         MOV     R7,#0x2
   \   000026   02....       LJMP    ?BANKED_LEAVE_XDATA
   2167          
   2168          /*********************************************************************
   2169           * Call Back Functions from Security  - API
   2170           */
   2171          
   2172          #if defined( ZDO_COORDINATOR )
   2173           /*********************************************************************
   2174           * @fn          ZDO_UpdateDeviceIndication
   2175           *
   2176           * @brief       This function notifies the "Trust Center" of a
   2177           *              network when a device joins or leaves the network.
   2178           *
   2179           * @param       extAddr - pointer to 64 bit address of new device
   2180           * @param       status  - 0 if a new device joined securely
   2181           *                      - 1 if a new device joined un-securely
   2182           *                      - 2 if a device left the network
   2183           *
   2184           * @return      true if newly joined device should be allowed to
   2185           *                                              remain on network
   2186           */
   2187          ZStatus_t ZDO_UpdateDeviceIndication( byte *extAddr, byte status )
   2188          {
   2189          
   2190          #if   ( SECURE != 0  )
   2191            // can implement a network access policy based on the
   2192            // IEEE address of newly joining devices...
   2193          #endif  // Trust Center
   2194          
   2195            return ZSuccess;
   2196          }
   2197          #endif // ZDO
   2198          
   2199          /*********************************************************************
   2200           * @fn          ZDApp_InMsgCB
   2201           *
   2202           * @brief       This function is called to pass up any message that is
   2203           *              not yet supported.  This allows for the developer to
   2204           *              support features themselves..
   2205           *
   2206           * @return      none
   2207           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2208          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2209          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2210            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   F582         MOV     DPL,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   E0           MOVX    A,@DPTR
   \   000014   5400         ANL     A,#0x0
   \   000016   F8           MOV     R0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   5480         ANL     A,#0x80
   \   00001B   F9           MOV     R1,A
   \   00001C   7400         MOV     A,#0x0
   \   00001E   68           XRL     A,R0
   \   00001F   7003         JNZ     ??ZDApp_InMsgCB_0
   \   000021   7400         MOV     A,#0x0
   \   000023   69           XRL     A,R1
   \                     ??ZDApp_InMsgCB_0:
   \   000024   7071         JNZ     ??ZDApp_InMsgCB_1
   2211            {
   2212              // Handle the response message
   2213            }
   2214            else
   2215            {
   2216              // Handle the request message by sending a generic "not supported".
   2217              // End Device Announce doesn't have a response.
   2218              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != End_Device_annce )
   \   000026   EE           MOV     A,R6
   \   000027   240B         ADD     A,#0xb
   \   000029   F582         MOV     DPL,A
   \   00002B   EF           MOV     A,R7
   \   00002C   3400         ADDC    A,#0x0
   \   00002E   F583         MOV     DPH,A
   \   000030   E0           MOVX    A,@DPTR
   \   000031   7064         JNZ     ??ZDApp_InMsgCB_1
   \   000033   EE           MOV     A,R6
   \   000034   240C         ADD     A,#0xc
   \   000036   F582         MOV     DPL,A
   \   000038   EF           MOV     A,R7
   \   000039   3400         ADDC    A,#0x0
   \   00003B   F583         MOV     DPH,A
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   6413         XRL     A,#0x13
   \   000040   7004         JNZ     ??ZDApp_InMsgCB_2
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   6400         XRL     A,#0x0
   \                     ??ZDApp_InMsgCB_2:
   \   000046   604F         JZ      ??ZDApp_InMsgCB_1
   2219              {
   2220                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2221                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000048                ; Setup parameters for call to function ZDP_GenericRsp
   \   000048   EE           MOV     A,R6
   \   000049   240C         ADD     A,#0xc
   \   00004B   F582         MOV     DPL,A
   \   00004D   EF           MOV     A,R7
   \   00004E   3400         ADDC    A,#0x0
   \   000050   F583         MOV     DPH,A
   \   000052   E0           MOVX    A,@DPTR
   \   000053   4400         ORL     A,#0x0
   \   000055   F5..         MOV     ?V0 + 0,A
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   4480         ORL     A,#0x80
   \   00005B   F5..         MOV     ?V0 + 1,A
   \   00005D   78..         MOV     R0,#?V0 + 0
   \   00005F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000062   75..00       MOV     ?V0 + 0,#0x0
   \   000065   75..00       MOV     ?V0 + 1,#0x0
   \   000068   78..         MOV     R0,#?V0 + 0
   \   00006A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006D   EE           MOV     A,R6
   \   00006E   240E         ADD     A,#0xe
   \   000070   F582         MOV     DPL,A
   \   000072   EF           MOV     A,R7
   \   000073   3400         ADDC    A,#0x0
   \   000075   F583         MOV     DPH,A
   \   000077   E0           MOVX    A,@DPTR
   \   000078   FD           MOV     R5,A
   \   000079   7C84         MOV     R4,#-0x7c
   \   00007B   EE           MOV     A,R6
   \   00007C   2402         ADD     A,#0x2
   \   00007E   FA           MOV     R2,A
   \   00007F   EF           MOV     A,R7
   \   000080   3400         ADDC    A,#0x0
   \   000082   FB           MOV     R3,A
   \   000083   EE           MOV     A,R6
   \   000084   240F         ADD     A,#0xf
   \   000086   F582         MOV     DPL,A
   \   000088   EF           MOV     A,R7
   \   000089   3400         ADDC    A,#0x0
   \   00008B   F583         MOV     DPH,A
   \   00008D   E0           MOVX    A,@DPTR
   \   00008E   F9           MOV     R1,A
   \   00008F   12....       LCALL   ??ZDP_GenericRsp?relay
   \   000092   7404         MOV     A,#0x4
   \   000094   12....       LCALL   ?DEALLOC_XSTACK8
   2222              }
   2223            }
   2224          }
   \                     ??ZDApp_InMsgCB_1:
   \   000097   7F02         MOV     R7,#0x2
   \   000099   02....       LJMP    ?BANKED_LEAVE_XDATA
   2225          
   2226          /*********************************************************************
   2227           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2228           *
   2229           * @brief   Changes the Match Descriptor Response permission.
   2230           *
   2231           * @param   endpoint - endpoint to allow responses
   2232           * @param   action - true to allow responses, false to not
   2233           *
   2234           * @return  none
   2235           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2236          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2237          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   2238            // Store the action
   2239            afSetMatch( endpoint, action );
   \   000008                ; Setup parameters for call to function afSetMatch
   \   000008   FA           MOV     R2,A
   \   000009   EE           MOV     A,R6
   \   00000A   F9           MOV     R1,A
   \   00000B   12....       LCALL   ??afSetMatch?relay
   2240          }
   \   00000E   7F01         MOV     R7,#0x1
   \   000010   02....       LJMP    ?BANKED_LEAVE_XDATA
   2241          
   2242          /*********************************************************************
   2243           * @fn      ZDApp_NetworkInit()
   2244           *
   2245           * @brief   Used to start the network joining process
   2246           *
   2247           * @param   delay - mSec delay to wait before starting
   2248           *
   2249           * @return  none
   2250           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2251          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2252          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2253            if ( delay )
   \   000009   7400         MOV     A,#0x0
   \   00000B   6E           XRL     A,R6
   \   00000C   7003         JNZ     ??ZDApp_NetworkInit_0
   \   00000E   7400         MOV     A,#0x0
   \   000010   6F           XRL     A,R7
   \                     ??ZDApp_NetworkInit_0:
   \   000011   6012         JZ      ??ZDApp_NetworkInit_1
   2254            {
   2255              // Wait awhile before starting the device
   2256              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   000013                ; Setup parameters for call to function osal_start_timerEx
   \   000013   EE           MOV     A,R6
   \   000014   FC           MOV     R4,A
   \   000015   EF           MOV     A,R7
   \   000016   FD           MOV     R5,A
   \   000017   7A01         MOV     R2,#0x1
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   90....       MOV     DPTR,#ZDAppTaskID
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F9           MOV     R1,A
   \   000020   12....       LCALL   ??osal_start_timerEx?relay
   \   000023   800C         SJMP    ??ZDApp_NetworkInit_2
   2257            }
   2258            else
   2259            {
   2260              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   000025                ; Setup parameters for call to function osal_set_event
   \   000025   7A01         MOV     R2,#0x1
   \   000027   7B00         MOV     R3,#0x0
   \   000029   90....       MOV     DPTR,#ZDAppTaskID
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F9           MOV     R1,A
   \   00002E   12....       LCALL   ??osal_set_event?relay
   2261            }
   2262          }
   \                     ??ZDApp_NetworkInit_2:
   \   000031   7F01         MOV     R7,#0x1
   \   000033   02....       LJMP    ?BANKED_LEAVE_XDATA
   2263          
   2264          /*********************************************************************
   2265           * @fn      ZDApp_StartUpFromApp()
   2266           *
   2267           * @brief   Start the device.  This function will only start a device
   2268           *          that is in the Holding state.
   2269           *
   2270           * @param   mode - ZDAPP_STARTUP_COORD - Start up as coordinator only
   2271           *                 ZDAPP_STARTUP_ROUTER - Start up as router only
   2272           *                 ZDAPP_STARTUP_AUTO - Startup in auto, look for coord,
   2273           *                                       if not found, become coord.
   2274           *
   2275           * @return  TRUE if started, FALSE if in the wrong mode
   2276           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2277          ZStatus_t ZDApp_StartUpFromApp( uint8 mode )
   \                     ZDApp_StartUpFromApp:
   2278          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   2279            ZStatus_t ret = ZFailure;
   \   000005   7F01         MOV     R7,#0x1
   2280          
   2281            if ( devState == DEV_HOLD )
   \   000007   90....       MOV     DPTR,#devState
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   7009         JNZ     ??ZDApp_StartUpFromApp_0
   2282            {
   2283              // Start the device's joining process
   2284              if ( ZDOInitDevice( 0 ) == ZDO_INITDEV_NEW_NETWORK_STATE )
   \   00000D                ; Setup parameters for call to function ZDOInitDevice
   \   00000D   7A00         MOV     R2,#0x0
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   12....       LCALL   ??ZDOInitDevice?relay
   2285              {
   2286          #if defined( SOFT_START )
   2287                if ( mode == ZDAPP_STARTUP_COORD )
   2288                {
   2289                  devStartMode = MODE_HARD;     // Start as a coordinator
   2290                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   2291                }
   2292                else
   2293                {
   2294                  if ( mode == ZDAPP_STARTUP_ROUTER )
   2295                  {
   2296                    softStartAllowCoord = FALSE;  // Don't allow coord to start
   2297                    continueJoining = TRUE;
   2298                  }
   2299                  devStartMode = MODE_JOIN;     // Assume joining
   2300                }
   2301          #endif  // SOFT_START
   2302              }
   2303              ret = ZSuccess;
   \   000014   7F00         MOV     R7,#0x0
   2304            }
   2305          
   2306            return ( ret );
   \                     ??ZDApp_StartUpFromApp_0:
   \   000016   EF           MOV     A,R7
   \   000017   F9           MOV     R1,A
   \   000018   7F01         MOV     R7,#0x1
   \   00001A   02....       LJMP    ?BANKED_LEAVE_XDATA
   2307          }
   2308          
   2309          /*********************************************************************
   2310           * @fn      ZDApp_StopStartUp()
   2311           *
   2312           * @brief   Stops the joining process of a router.  This will only
   2313           *          work if the router is in the scanning process and
   2314           *          the SOFT_START feature is enabled.
   2315           *
   2316           * @param   none
   2317           *
   2318           * @return  TRUE if SOFT_START is enabled, FALSE if not possible
   2319           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2320          uint8 ZDApp_StopStartUp( void )
   \                     ZDApp_StopStartUp:
   2321          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2322            uint8 ret = FALSE;
   \   000000   7900         MOV     R1,#0x0
   2323          
   2324          #if defined( SOFT_START )
   2325            continueJoining = FALSE;
   2326            ret = TRUE;
   2327          #endif  // SOFT_START
   2328          
   2329            return ( ret );
   \   000002   02....       LJMP    ?BRET
   2330          }
   2331          
   2332          /*********************************************************************
   2333           * @fn      ZDApp_StartJoiningCycle()
   2334           *
   2335           * @brief   Starts the joining cycle of a device.  This will only
   2336           *          continue an already started (or stopped) joining cycle.
   2337           *
   2338           * @param   none
   2339           *
   2340           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2341           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2342          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2343          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2344            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2345            {
   2346              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000014   7401         MOV     A,#0x1
   \   000016   90....       MOV     DPTR,#continueJoining
   \   000019   F0           MOVX    @DPTR,A
   2347              ZDApp_NetworkInit( 0 );
   \   00001A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00001A   7A00         MOV     R2,#0x0
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??ZDApp_NetworkInit?relay
   2348          
   2349              return ( TRUE );
   \   000021   7901         MOV     R1,#0x1
   \   000023   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2350            }
   2351            else
   2352              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000025   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000027   D083         POP     DPH
   \   000029   D082         POP     DPL
   \   00002B   02....       LJMP    ?BRET
   2353          }
   2354          
   2355          /*********************************************************************
   2356           * @fn      ZDApp_StopJoiningCycle()
   2357           *
   2358           * @brief   Stops the joining or rejoining process of a device.
   2359           *
   2360           * @param   none
   2361           *
   2362           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2363           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2364          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2365          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2366            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6008         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6402         XRL     A,#0x2
   \   000012   700A         JNZ     ??ZDApp_StopJoiningCycle_1
   2367            {
   2368              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000014   7400         MOV     A,#0x0
   \   000016   90....       MOV     DPTR,#continueJoining
   \   000019   F0           MOVX    @DPTR,A
   2369              return ( TRUE );
   \   00001A   7901         MOV     R1,#0x1
   \   00001C   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2370            }
   2371            else
   2372              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001E   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   000020   D083         POP     DPH
   \   000022   D082         POP     DPL
   \   000024   02....       LJMP    ?BRET
   2373          }
   2374          
   2375          #if !defined ( ZDO_COORDINATOR ) || defined ( SOFT_START )
   2376          /*********************************************************************
   2377           * @fn      ZDApp_NodeProfileSync()
   2378           *
   2379           * @brief   Sync node with stack profile.
   2380           *
   2381           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2382           *
   2383           * @return  none
   2384           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2385          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2386          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   2387            networkDesc_t* desc;
   2388            uint16         panID;
   2389          
   2390            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000009   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000F   4003         JC      $+5
   \   000011   02....       LJMP    ??ZDApp_NodeProfileSync_0 & 0xFFFF
   2391            {
   2392              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   \   000014   85..82       MOV     DPL,?V0 + 0
   \   000017   85..83       MOV     DPH,?V0 + 1
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   FA           MOV     R2,A
   \   00001E   7B00         MOV     R3,#0x0
   \   000020   85..82       MOV     DPL,?V0 + 0
   \   000023   85..83       MOV     DPH,?V0 + 1
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F8           MOV     R0,A
   \   00002B   E4           CLR     A
   \   00002C   C8           XCH     A,R0
   \   00002D   F9           MOV     R1,A
   \   00002E   E8           MOV     A,R0
   \   00002F   2A           ADD     A,R2
   \   000030   F8           MOV     R0,A
   \   000031   E9           MOV     A,R1
   \   000032   3B           ADDC    A,R3
   \   000033   F9           MOV     R1,A
   \   000034   E8           MOV     A,R0
   \   000035   FE           MOV     R6,A
   \   000036   E9           MOV     A,R1
   \   000037   FF           MOV     R7,A
   2393          
   2394              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   000038                ; Setup parameters for call to function nwk_getNetworkDesc
   \   000038   85..82       MOV     DPL,?V0 + 0
   \   00003B   85..83       MOV     DPH,?V0 + 1
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   A3           INC     DPTR
   \   000042   E0           MOVX    A,@DPTR
   \   000043   F9           MOV     R1,A
   \   000044   EE           MOV     A,R6
   \   000045   FC           MOV     R4,A
   \   000046   EF           MOV     A,R7
   \   000047   FD           MOV     R5,A
   \   000048   E5..         MOV     A,?V0 + 0
   \   00004A   2406         ADD     A,#0x6
   \   00004C   FA           MOV     R2,A
   \   00004D   E5..         MOV     A,?V0 + 1
   \   00004F   3400         ADDC    A,#0x0
   \   000051   FB           MOV     R3,A
   \   000052   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000055   8A..         MOV     ?V0 + 4,R2
   \   000057   8B..         MOV     ?V0 + 5,R3
   \   000059   85....       MOV     ?V0 + 2,?V0 + 4
   \   00005C   85....       MOV     ?V0 + 3,?V0 + 5
   2395          
   2396              if (desc != NULL)
   \   00005F   E5..         MOV     A,?V0 + 2
   \   000061   6400         XRL     A,#0x0
   \   000063   7004         JNZ     ??ZDApp_NodeProfileSync_1
   \   000065   E5..         MOV     A,?V0 + 3
   \   000067   6400         XRL     A,#0x0
   \                     ??ZDApp_NodeProfileSync_1:
   \   000069   6029         JZ      ??ZDApp_NodeProfileSync_0
   2397              {
   2398                if ( desc->stackProfile != zgStackProfile )
   \   00006B   85..82       MOV     DPL,?V0 + 2
   \   00006E   85..83       MOV     DPH,?V0 + 3
   \   000071   A3           INC     DPTR
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   A3           INC     DPTR
   \   000076   A3           INC     DPTR
   \   000077   A3           INC     DPTR
   \   000078   A3           INC     DPTR
   \   000079   E0           MOVX    A,@DPTR
   \   00007A   FA           MOV     R2,A
   \   00007B   90....       MOV     DPTR,#zgStackProfile
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   6A           XRL     A,R2
   \   000080   6012         JZ      ??ZDApp_NodeProfileSync_0
   2399                {
   2400                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000082   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000085   E0           MOVX    A,@DPTR
   \   000086   54F8         ANL     A,#0xf8
   \   000088   4402         ORL     A,#0x2
   \   00008A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00008D   F0           MOVX    @DPTR,A
   2401                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00008E   740C         MOV     A,#0xc
   \   000090   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000093   F0           MOVX    @DPTR,A
   2402                }
   2403              }
   2404            }
   2405          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000094   7F06         MOV     R7,#0x6
   \   000096   02....       LJMP    ?BANKED_LEAVE_XDATA
   2406          #endif
   2407          
   2408          /*********************************************************************
   2409           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2410           *
   2411           * @brief   Returns a PAN ID for the network layer to use during
   2412           *          a coordinator start and there is another network with 
   2413           *          the intended PANID.
   2414           *
   2415           * @param   panid - the intended PAN ID
   2416           *
   2417           * @return  PANID to try
   2418           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2419          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2420          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2421            return ( (panid + 1) & 0x3FFF );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   F8           MOV     R0,A
   \   000004   7400         MOV     A,#0x0
   \   000006   3B           ADDC    A,R3
   \   000007   F9           MOV     R1,A
   \   000008   74FF         MOV     A,#-0x1
   \   00000A   58           ANL     A,R0
   \   00000B   FA           MOV     R2,A
   \   00000C   743F         MOV     A,#0x3f
   \   00000E   59           ANL     A,R1
   \   00000F   FB           MOV     R3,A
   \   000010   02....       LJMP    ?BRET
   2422          }
   2423          
   2424          
   2425          /*********************************************************************
   2426           * @fn          ZDApp_NVUpdate
   2427           *
   2428           * @brief       Set the NV Update Timer.
   2429           *
   2430           * @param       none
   2431           *
   2432           * @return      none
   2433           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2434          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2435          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2436            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   7CBC         MOV     R4,#-0x44
   \   000006   7D02         MOV     R5,#0x2
   \   000008   7A00         MOV     R2,#0x0
   \   00000A   7B02         MOV     R3,#0x2
   \   00000C   90....       MOV     DPTR,#ZDAppTaskID
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F9           MOV     R1,A
   \   000011   12....       LCALL   ??osal_start_timerEx?relay
   2437          }
   \   000014   D083         POP     DPH
   \   000016   D082         POP     DPL
   \   000018   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartUpFromApp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartUpFromApp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopStartUp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopStartUp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate
   2438          
   2439          
   2440          /*********************************************************************
   2441          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0     10
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDAppCheckForHoldKey               2      0     10
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           0      0     14
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> ZDAppCheckForHoldKey          0      0     20
       -> ZDO_Init                      0      0     20
       -> afRegister                    0      0     20
       -> NLME_GetRequest               0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
       -> ZDOInitDevice                 0      0     20
       -> HalLedBlink                   0      0     20
       -> ZDApp_RegisterCBs             0      0     20
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     28
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     30
       -> osal_nv_write                 0      0     32
     ZDApp_LeaveReset                   0      0     21
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> ZDApp_ResetTimerStart         0      0     18
     ZDApp_LeaveUpdate                  0      0     23
       -> NLME_RemoveChild              0      0     22
     ZDApp_NVUpdate                     2      0     10
       -> osal_start_timerEx            4      0      0
     ZDApp_NetworkInit                  0      0     23
       -> osal_start_timerEx            0      0     18
       -> osal_set_event                0      0     18
     ZDApp_NetworkStartEvt              2      0      0
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     28
       -> nwk_getNetworkDesc            0      0     28
     ZDApp_ProcessMsgCBs                0      0     47
       -> ZDO_ParseAddrRsp              0      0     66
       -> ZDO_UpdateAddrManager         0      0     66
       -> osal_mem_free                 0      0     66
       -> ZDO_ParseBindUnbindReq        0      0     66
       -> ZDO_ProcessBindUnbindReq      0      0     66
     ZDApp_ProcessNetworkJoin           0      0     26
       -> osal_set_event                0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               0      0     29
       -> ZDP_IncomingData              0      0     28
       -> ZDApp_ProcessMsgCBs           0      0     28
       -> ZDApp_NodeProfileSync         0      0     28
       -> NLME_JoinRequest              0      0     30
       -> osal_rand                     0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> NLME_ReJoinRequest            0      0     28
       -> osal_rand                     0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> NLME_SetPollRate              0      0     28
       -> NLME_SetQueuedPollRate        0      0     28
       -> NLME_SetResponseRate          0      0     28
       -> osal_rand                     0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> ZDApp_ProcessNetworkJoin      0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> osal_set_event                0      0     28
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0     10
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              0      0     18
       -> osal_start_timerEx            0      0     18
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
     ZDApp_SaveNetworkStateEvt          0      0     14
     ZDApp_SecInit                      0      0     23
       -> ZDSecMgrInit                  0      0     18
     ZDApp_SendEventMsg                 0      0     10
       -> ZDApp_SendMsg                 0      0     20
     ZDApp_SendMsg                      1      0     49
       -> osal_msg_allocate             0      0     32
       -> osal_memcpy                   0      0     38
       -> osal_msg_send                 0      0     32
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StartUpFromApp               0      0      9
       -> ZDOInitDevice                 0      0     18
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_StopStartUp                  0      0      0
     ZDApp_event_loop                   0      0     14
       -> osal_msg_receive              0      0     28
       -> ZDApp_ProcessOSALMsg          0      0     28
       -> osal_msg_deallocate           0      0     28
       -> ZDO_UpdateNwkStatus           0      0     28
       -> ZDO_StartDevice               0      0     28
       -> ZDApp_SaveNetworkStateEvt     0      0     28
     ZDOInitDevice                      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     28
       -> ZDApp_LeaveCtrlStartup        0      0     28
       -> ZDAppDetermineDeviceType      0      0     28
       -> osal_rand                     0      0     28
       -> ZDApp_SecInit                 0      0     28
       -> ZDApp_NetworkInit             0      0     28
     ZDO_JoinConfirmCB                  0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> ZDApp_NVUpdate                0      0     18
       -> HalLedSet                     0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_LeaveCnf                       0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> osal_ExtAddrEqual             0      0     18
       -> ZDApp_LeaveReset              0      0     18
     ZDO_LeaveInd                       2      0     12
       -> ZDApp_LeaveReset              0      0     24
       -> NLME_GetCoordShortAddr        4      0     24
       -> ZDApp_LeaveReset              0      0     24
       -> ZDApp_LeaveUpdate             0      0     24
     ZDO_NetworkDiscoveryConfirmCB      2      0     30
       -> osal_cpyExtAddr               0      0     60
       -> ZDApp_SendMsg                 0      0     60
     ZDO_NetworkFormationConfirmCB      0      0      0
     ZDO_PollConfirmCB                  0      0      0
     ZDO_SyncIndicationCB               0      0      9
       -> ZDApp_SendMsg                 0      0     18


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     _A_IEN0                           1
     WDCTL                             1
     zdoDiscCounter                    1
     ZDAppNwkAddr                      9
     continueJoining                   1
     _tmpRejoinState                   1
     ZDAppTaskID                       1
     nwkStatus                         1
     ZDApp_AutoFindMode_epDesc         2
     ZDApp_LeaveCtrl                   1
     devState                          1
     devStartMode                      1
     retryCnt                          1
     ZDApp_epDesc                      6
     ZDApp_Init                      118
     ZDApp_SecInit                    13
     ZDApp_event_loop                218
     ZDOInitDevice                   141
     ZDApp_ReadNetworkRestoreState    24
     ZDAppDetermineDeviceType          3
     ZDApp_NetworkStartEvt           121
     ZDApp_SaveNetworkStateEvt         3
     ZDApp_RestoreNetworkState        77
     ZDApp_InitUserDesc              138
     ZDAppCheckForHoldKey             25
     ZDApp_ProcessOSALMsg            393
     ZDApp_ProcessMsgCBs             162
     ZDApp_RegisterCBs                59
     ZDApp_ProcessNetworkJoin        437
     ZDApp_ResetTimerStart            30
     ZDApp_ResetTimerCancel           23
     ZDApp_LeaveCtrlInit              84
     ZDApp_LeaveCtrlSet               68
     ZDApp_LeaveCtrlBypass            25
     ZDApp_LeaveCtrlStartup          111
     ZDApp_LeaveReset                 22
     ZDApp_LeaveUpdate                25
     ZDApp_SendEventMsg               34
     ZDApp_SendMsg                   121
     ZDO_NetworkDiscoveryConfirmCB   377
     ZDO_NetworkFormationConfirmCB     3
     ZDO_JoinConfirmCB                76
     ZDO_LeaveCnf                     52
     ZDO_LeaveInd                    166
     ZDO_SyncIndicationCB             34
     ZDO_PollConfirmCB                 3
     AddrMgrWriteNVRequest            41
     ZDApp_InMsgCB                   156
     ZDApp_ChangeMatchDescRespPermission
                                      19
     ZDApp_NetworkInit                54
     ZDApp_StartUpFromApp             29
     ZDApp_StopStartUp                 5
     ZDApp_StartJoiningCycle          46
     ZDApp_StopJoiningCycle           39
     ZDApp_NodeProfileSync           153
     ZDApp_CoordStartPANIDConflictCB
                                      19
     ZDApp_NVUpdate                   27
     ?<Initializer for zdoDiscCounter>
                                       1
     ?<Initializer for continueJoining>
                                       1
     ?<Initializer for devState>       1
     ?<Initializer for ZDApp_epDesc>
                                       6
     ??ZDApp_Init?relay                6
     ??ZDApp_SecInit?relay             6
     ??ZDApp_event_loop?relay          6
     ??ZDOInitDevice?relay             6
     ??ZDApp_ReadNetworkRestoreState?relay
                                       6
     ??ZDAppDetermineDeviceType?relay
                                       6
     ??ZDApp_NetworkStartEvt?relay     6
     ??ZDApp_SaveNetworkStateEvt?relay
                                       6
     ??ZDApp_RestoreNetworkState?relay
                                       6
     ??ZDApp_InitUserDesc?relay        6
     ??ZDAppCheckForHoldKey?relay      6
     ??ZDApp_ProcessOSALMsg?relay      6
     ??ZDApp_ProcessMsgCBs?relay       6
     ??ZDApp_RegisterCBs?relay         6
     ??ZDApp_ProcessNetworkJoin?relay
                                       6
     ??ZDApp_ResetTimerStart?relay     6
     ??ZDApp_ResetTimerCancel?relay    6
     ??ZDApp_LeaveCtrlInit?relay       6
     ??ZDApp_LeaveCtrlSet?relay        6
     ??ZDApp_LeaveCtrlBypass?relay     6
     ??ZDApp_LeaveCtrlStartup?relay    6
     ??ZDApp_LeaveReset?relay          6
     ??ZDApp_LeaveUpdate?relay         6
     ??ZDApp_SendEventMsg?relay        6
     ??ZDApp_SendMsg?relay             6
     ??ZDO_NetworkDiscoveryConfirmCB?relay
                                       6
     ??ZDO_NetworkFormationConfirmCB?relay
                                       6
     ??ZDO_JoinConfirmCB?relay         6
     ??ZDO_LeaveCnf?relay              6
     ??ZDO_LeaveInd?relay              6
     ??ZDO_SyncIndicationCB?relay      6
     ??ZDO_PollConfirmCB?relay         6
     ??AddrMgrWriteNVRequest?relay     6
     ??ZDApp_InMsgCB?relay             6
     ??ZDApp_ChangeMatchDescRespPermission?relay
                                       6
     ??ZDApp_NetworkInit?relay         6
     ??ZDApp_StartUpFromApp?relay      6
     ??ZDApp_StopStartUp?relay         6
     ??ZDApp_StartJoiningCycle?relay
                                       6
     ??ZDApp_StopJoiningCycle?relay    6
     ??ZDApp_NodeProfileSync?relay     6
     ??ZDApp_CoordStartPANIDConflictCB?relay
                                       6
     ??ZDApp_NVUpdate?relay            6

 
 3 774 bytes in segment BANKED_CODE
   258 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
     9 bytes in segment XDATA_I
     9 bytes in segment XDATA_ID
    17 bytes in segment XDATA_Z
 
 4 041 bytes of CODE  memory
     0 bytes of DATA  memory (+ 2 bytes shared)
    26 bytes of XDATA memory

Errors: none
Warnings: none
