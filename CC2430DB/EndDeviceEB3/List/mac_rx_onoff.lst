###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    18/Mar/2013  18:21:57 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \mac\low_level\srf03\mac_rx_onoff.c                #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wEndev.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\Tools #
#                          \CC2430DB\f8wConfig.cfg" (-DSECURE=0               #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\mac\low_ #
#                          level\srf03\mac_rx_onoff.c" -D CC2430EB -D         #
#                          AXD_END3 -D NWK_AUTO_POLL -D REFLECTOR -D          #
#                          xZTOOL_P1 -D xMT_TASK -D xMT_ZDO_FUNC -D           #
#                          xLCD_SUPPORTED=DEBUG -D xPOWER_SAVING -lC          #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\EndD #
#                          eviceEB3\List\" -lA "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\EndDeviceEB3\L #
#                          ist\" --diag_suppress Pe001,Pa010 --diag_remark    #
#                          pe550 -o "C:\Texas Instruments\ZStack-1.4.3-1.2.1\ #
#                          Projects\zstack\Samples\cc2430-zstack-adxl345\CC24 #
#                          30DB\EndDeviceEB3\Obj\" -e --require_prototypes    #
#                          -z2 --no_cse --no_unroll --no_inline               #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data --nr_virtual_regs 8  #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\" #
#                           -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Proje #
#                          cts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\ #
#                          ..\SOURCE\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\Drivers\"   #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\ZMAIN\TI2430DB\" -I "C:\Texas              #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\EndDe #
#                          viceEB3\List\mac_rx_onoff.lst                      #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\EndDe #
#                          viceEB3\Obj\mac_rx_onoff.r51                       #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\mac\low_level\srf03\mac_rx_onoff.c
      1          /**************************************************************************************************
      2            Filename:       mac_rx_onoff.c
      3            Revised:        $Date: 2007-10-29 22:38:47 -0700 (Mon, 29 Oct 2007) $
      4            Revision:       $Revision: 15812 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2006-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /* ------------------------------------------------------------------------------------------------
     41           *                                          Includes
     42           * ------------------------------------------------------------------------------------------------
     43           */
     44          
     45          /* hal */
     46          #include "hal_defs.h"
     47          #include "hal_types.h"
     48          
     49          /* exported low-level */
     50          #include "mac_low_level.h"
     51          
     52          /* low-level specific */
     53          #include "mac_rx_onoff.h"
     54          #include "mac_rx.h"
     55          #include "mac_tx.h"
     56          
     57          /* target specific */
     58          #include "mac_radio_defs.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe1
   \   unsigned char volatile __sfr RFST
   \                     RFST:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe9
   \   unsigned char volatile __sfr RFIF
   \                     RFIF:
   \   000000                DS 1
     59          
     60          /* debug */
     61          #include "mac_assert.h"
     62          
     63          
     64          /* ------------------------------------------------------------------------------------------------
     65           *                                         Global Variables
     66           * ------------------------------------------------------------------------------------------------
     67           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     68          uint8 macRxOnFlag;
   \                     macRxOnFlag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     69          uint8 macRxEnableFlags;
   \                     macRxEnableFlags:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     70          
     71          
     72          /**************************************************************************************************
     73           * @fn          macRxOnOffInit
     74           *
     75           * @brief       Initialize variables for rx on/off module.
     76           *
     77           * @param       none
     78           *
     79           * @return      none
     80           **************************************************************************************************
     81           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     82          void macRxOnOffInit(void)
   \                     macRxOnOffInit:
     83          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     84            macRxEnableFlags = 0;
   \   000004   7400         MOV     A,#0x0
   \   000006   90....       MOV     DPTR,#macRxEnableFlags
   \   000009   F0           MOVX    @DPTR,A
     85            macRxOnFlag = 0;
   \   00000A   7400         MOV     A,#0x0
   \   00000C   90....       MOV     DPTR,#macRxOnFlag
   \   00000F   F0           MOVX    @DPTR,A
     86          }
   \   000010   D083         POP     DPH
   \   000012   D082         POP     DPL
   \   000014   02....       LJMP    ?BRET
     87          
     88          
     89          /**************************************************************************************************
     90           * @fn          macRxEnable
     91           *
     92           * @brief       Set enable flags and then turn on receiver.
     93           *
     94           * @param       flags - byte containing rx enable flags to set
     95           *
     96           * @return      none
     97           **************************************************************************************************
     98           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     99          void macRxEnable(uint8 flags)
   \                     macRxEnable:
    100          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    101            halIntState_t  s;
    102          
    103            MAC_ASSERT(flags != 0); /* rx flags not affected */
   \   000007   EE           MOV     A,R6
   \   000008   7003         JNZ     ??macRxEnable_0
   \   00000A                ; Setup parameters for call to function halAssertHandler
   \   00000A   12....       LCALL   ??halAssertHandler?relay
    104          
    105            /* set enable flags and then turn on receiver */
    106            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macRxEnable_0:
   \   00000D   A2AF         MOV     C,0xa8.7
   \   00000F   E4           CLR     A
   \   000010   92E0         MOV     0xE0 /* A   */.0,C
   \   000012   FF           MOV     R7,A
   \   000013   C2AF         CLR     0xa8.7
    107            macRxEnableFlags |= flags;
   \   000015   90....       MOV     DPTR,#macRxEnableFlags
   \   000018   E0           MOVX    A,@DPTR
   \   000019   4E           ORL     A,R6
   \   00001A   F0           MOVX    @DPTR,A
    108            macRxOn();
   \   00001B                ; Setup parameters for call to function macRxOn
   \   00001B   12....       LCALL   ??macRxOn?relay
    109            HAL_EXIT_CRITICAL_SECTION(s);
   \   00001E   EF           MOV     A,R7
   \   00001F   A2E0         MOV     C,0xE0 /* A   */.0
   \   000021   92AF         MOV     0xa8.7,C
    110          }
   \   000023   7F01         MOV     R7,#0x1
   \   000025   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000028                REQUIRE _A_IEN0
    111          
    112          
    113          /**************************************************************************************************
    114           * @fn          macRxSoftEnable
    115           *
    116           * @brief       Set enable flags but don't turn on the receiver.  Useful to leave the receiver
    117           *              on after a transmit, but without turning it on immediately.
    118           *
    119           * @param       flags - byte containing rx enable flags to set
    120           *
    121           * @return      none
    122           **************************************************************************************************
    123           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    124          void macRxSoftEnable(uint8 flags)
   \                     macRxSoftEnable:
    125          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    126            halIntState_t  s;
    127          
    128            MAC_ASSERT(flags != 0); /* rx flags not affected */
   \   000007   EE           MOV     A,R6
   \   000008   7003         JNZ     ??macRxSoftEnable_0
   \   00000A                ; Setup parameters for call to function halAssertHandler
   \   00000A   12....       LCALL   ??halAssertHandler?relay
    129          
    130            /* set the enable flags but do not turn on the receiver */
    131            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macRxSoftEnable_0:
   \   00000D   A2AF         MOV     C,0xa8.7
   \   00000F   E4           CLR     A
   \   000010   92E0         MOV     0xE0 /* A   */.0,C
   \   000012   FF           MOV     R7,A
   \   000013   C2AF         CLR     0xa8.7
    132            macRxEnableFlags |= flags;
   \   000015   90....       MOV     DPTR,#macRxEnableFlags
   \   000018   E0           MOVX    A,@DPTR
   \   000019   4E           ORL     A,R6
   \   00001A   F0           MOVX    @DPTR,A
    133            HAL_EXIT_CRITICAL_SECTION(s);
   \   00001B   EF           MOV     A,R7
   \   00001C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001E   92AF         MOV     0xa8.7,C
    134          }
   \   000020   7F01         MOV     R7,#0x1
   \   000022   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000025                REQUIRE _A_IEN0
    135          
    136          
    137          /**************************************************************************************************
    138           * @fn          macRxDisable
    139           *
    140           * @brief       Clear indicated rx enable flags.  If all flags are clear, turn off receiver
    141           *              unless there is an active receive or transmit.
    142           *
    143           * @param       flags - byte containg rx enable flags to clear
    144           *
    145           * @return      none
    146           **************************************************************************************************
    147           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    148          void macRxDisable(uint8 flags)
   \                     macRxDisable:
    149          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    150            halIntState_t  s;
    151          
    152            MAC_ASSERT(flags != 0); /* rx flags not affected */
   \   000007   EE           MOV     A,R6
   \   000008   7003         JNZ     ??macRxDisable_0
   \   00000A                ; Setup parameters for call to function halAssertHandler
   \   00000A   12....       LCALL   ??halAssertHandler?relay
    153          
    154            /* clear the indicated flags */
    155            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macRxDisable_0:
   \   00000D   A2AF         MOV     C,0xa8.7
   \   00000F   E4           CLR     A
   \   000010   92E0         MOV     0xE0 /* A   */.0,C
   \   000012   FF           MOV     R7,A
   \   000013   C2AF         CLR     0xa8.7
    156            macRxEnableFlags &= (0xff ^ flags);
   \   000015   74FF         MOV     A,#-0x1
   \   000017   6E           XRL     A,R6
   \   000018   FA           MOV     R2,A
   \   000019   90....       MOV     DPTR,#macRxEnableFlags
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   5A           ANL     A,R2
   \   00001E   F0           MOVX    @DPTR,A
    157            HAL_EXIT_CRITICAL_SECTION(s);
   \   00001F   EF           MOV     A,R7
   \   000020   A2E0         MOV     C,0xE0 /* A   */.0
   \   000022   92AF         MOV     0xa8.7,C
    158          
    159            /* turn off the radio if it is allowed */
    160            macRxOffRequest();
   \   000024                ; Setup parameters for call to function macRxOffRequest
   \   000024   12....       LCALL   ??macRxOffRequest?relay
    161          }
   \   000027   7F01         MOV     R7,#0x1
   \   000029   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00002C                REQUIRE _A_IEN0
    162          
    163          
    164          /**************************************************************************************************
    165           * @fn          macRxHardDisable
    166           *
    167           * @brief       Clear all enable flags and turn off receiver.
    168           *
    169           * @param       none
    170           *
    171           * @return      none
    172           **************************************************************************************************
    173           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    174          void macRxHardDisable(void)
   \                     macRxHardDisable:
    175          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    176            halIntState_t  s;
    177          
    178            HAL_ENTER_CRITICAL_SECTION(s);
   \   000005   A2AF         MOV     C,0xa8.7
   \   000007   E4           CLR     A
   \   000008   92E0         MOV     0xE0 /* A   */.0,C
   \   00000A   FE           MOV     R6,A
   \   00000B   C2AF         CLR     0xa8.7
    179          
    180            macRxEnableFlags = 0;
   \   00000D   7400         MOV     A,#0x0
   \   00000F   90....       MOV     DPTR,#macRxEnableFlags
   \   000012   F0           MOVX    @DPTR,A
    181            macRxOnFlag = 0;
   \   000013   7400         MOV     A,#0x0
   \   000015   90....       MOV     DPTR,#macRxOnFlag
   \   000018   F0           MOVX    @DPTR,A
    182          
    183            /* force receiver off */
    184            MAC_RADIO_RXTX_OFF();
   \   000019   75E1E5       MOV     0xe1,#-0x1b
    185            MAC_RADIO_FLUSH_RX_FIFO();
   \   00001C   75E1E6       MOV     0xe1,#-0x1a
   \   00001F   75E1E6       MOV     0xe1,#-0x1a
    186            MAC_DEBUG_TURN_OFF_RX_LED();
    187          
    188            HAL_EXIT_CRITICAL_SECTION(s);
   \   000022   EE           MOV     A,R6
   \   000023   A2E0         MOV     C,0xE0 /* A   */.0
   \   000025   92AF         MOV     0xa8.7,C
    189          
    190            /* clean up after being forced off */
    191            macRxHaltCleanup();
   \   000027                ; Setup parameters for call to function macRxHaltCleanup
   \   000027   12....       LCALL   ??macRxHaltCleanup?relay
    192          }
   \   00002A   7F01         MOV     R7,#0x1
   \   00002C   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00002F                REQUIRE _A_IEN0
   \   00002F                REQUIRE RFST
    193          
    194          
    195          /**************************************************************************************************
    196           * @fn          macRxOnRequest
    197           *
    198           * @brief       Turn on the receiver if any rx enable flag is set.
    199           *
    200           * @param       none
    201           *
    202           * @return      none
    203           **************************************************************************************************
    204           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    205          void macRxOnRequest(void)
   \                     macRxOnRequest:
    206          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    207            halIntState_t  s;
    208          
    209            HAL_ENTER_CRITICAL_SECTION(s);
   \   000005   A2AF         MOV     C,0xa8.7
   \   000007   E4           CLR     A
   \   000008   92E0         MOV     0xE0 /* A   */.0,C
   \   00000A   FE           MOV     R6,A
   \   00000B   C2AF         CLR     0xa8.7
    210            if (macRxEnableFlags)
   \   00000D   90....       MOV     DPTR,#macRxEnableFlags
   \   000010   E0           MOVX    A,@DPTR
   \   000011   6003         JZ      ??macRxOnRequest_0
    211            {
    212              macRxOn();
   \   000013                ; Setup parameters for call to function macRxOn
   \   000013   12....       LCALL   ??macRxOn?relay
    213            }
    214            HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macRxOnRequest_0:
   \   000016   EE           MOV     A,R6
   \   000017   A2E0         MOV     C,0xE0 /* A   */.0
   \   000019   92AF         MOV     0xa8.7,C
    215          }
   \   00001B   7F01         MOV     R7,#0x1
   \   00001D   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000020                REQUIRE _A_IEN0
    216          
    217          
    218          /**************************************************************************************************
    219           * @fn          macRxOffRequest
    220           *
    221           * @brief       Turn off receiver if permitted.
    222           *
    223           * @param       none
    224           *
    225           * @return      none
    226           **************************************************************************************************
    227           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    228          void macRxOffRequest(void)
   \                     macRxOffRequest:
    229          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    230            halIntState_t  s;
    231          
    232            HAL_ENTER_CRITICAL_SECTION(s);
   \   000005   A2AF         MOV     C,0xa8.7
   \   000007   E4           CLR     A
   \   000008   92E0         MOV     0xE0 /* A   */.0,C
   \   00000A   FE           MOV     R6,A
   \   00000B   C2AF         CLR     0xa8.7
    233            if (!macRxEnableFlags)
   \   00000D   90....       MOV     DPTR,#macRxEnableFlags
   \   000010   E0           MOVX    A,@DPTR
   \   000011   7019         JNZ     ??macRxOffRequest_0
    234            {
    235              if (!MAC_RX_IS_PHYSICALLY_ACTIVE() && !MAC_TX_IS_PHYSICALLY_ACTIVE())
   \   000013   90....       MOV     DPTR,#macRxActive
   \   000016   E0           MOVX    A,@DPTR
   \   000017   A2E7         MOV     C,0xE0 /* A   */.7
   \   000019   4011         JC      ??macRxOffRequest_0
   \   00001B   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   700B         JNZ     ??macRxOffRequest_0
   \   000021   90....       MOV     DPTR,#macTxActive
   \   000024   E0           MOVX    A,@DPTR
   \   000025   A2E7         MOV     C,0xE0 /* A   */.7
   \   000027   4003         JC      ??macRxOffRequest_0
    236              {
    237                macRxOff();
   \   000029                ; Setup parameters for call to function macRxOff
   \   000029   12....       LCALL   ??macRxOff?relay
    238              }
    239            }
    240            HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macRxOffRequest_0:
   \   00002C   EE           MOV     A,R6
   \   00002D   A2E0         MOV     C,0xE0 /* A   */.0
   \   00002F   92AF         MOV     0xa8.7,C
    241          }
   \   000031   7F01         MOV     R7,#0x1
   \   000033   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000036                REQUIRE _A_IEN0
    242          
    243          
    244          /**************************************************************************************************
    245           * @fn          macRxOn
    246           *
    247           * @brief       Turn on the receiver if it's not already on.
    248           *
    249           * @param       none
    250           *
    251           * @return      none
    252           **************************************************************************************************
    253           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    254          void macRxOn(void)
   \                     macRxOn:
    255          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    256            halIntState_t  s;
    257          
    258            HAL_ENTER_CRITICAL_SECTION(s);
   \   000004   A2AF         MOV     C,0xa8.7
   \   000006   E4           CLR     A
   \   000007   92E0         MOV     0xE0 /* A   */.0,C
   \   000009   FA           MOV     R2,A
   \   00000A   C2AF         CLR     0xa8.7
    259            if (!macRxOnFlag)
   \   00000C   90....       MOV     DPTR,#macRxOnFlag
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   7009         JNZ     ??macRxOn_0
    260            {
    261              macRxOnFlag = 1;
   \   000012   7401         MOV     A,#0x1
   \   000014   90....       MOV     DPTR,#macRxOnFlag
   \   000017   F0           MOVX    @DPTR,A
    262              MAC_RADIO_RX_ON();
   \   000018   75E1E2       MOV     0xe1,#-0x1e
    263              MAC_DEBUG_TURN_ON_RX_LED();
    264            }
    265            HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macRxOn_0:
   \   00001B   EA           MOV     A,R2
   \   00001C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001E   92AF         MOV     0xa8.7,C
    266          }
   \   000020   D083         POP     DPH
   \   000022   D082         POP     DPL
   \   000024   02....       LJMP    ?BRET
   \   000027                REQUIRE _A_IEN0
   \   000027                REQUIRE RFST
    267          
    268          
    269          /**************************************************************************************************
    270           * @fn          macRxOff
    271           *
    272           * @brief       Turn off the receiver if it's not already off.
    273           *
    274           * @param       none
    275           *
    276           * @return      none
    277           **************************************************************************************************
    278           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    279          void macRxOff(void)
   \                     macRxOff:
    280          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    281            halIntState_t  s;
    282          
    283            HAL_ENTER_CRITICAL_SECTION(s);
   \   000004   A2AF         MOV     C,0xa8.7
   \   000006   E4           CLR     A
   \   000007   92E0         MOV     0xE0 /* A   */.0,C
   \   000009   FA           MOV     R2,A
   \   00000A   C2AF         CLR     0xa8.7
    284            if (macRxOnFlag)
   \   00000C   90....       MOV     DPTR,#macRxOnFlag
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6012         JZ      ??macRxOff_0
    285            {
    286              macRxOnFlag = 0;
   \   000012   7400         MOV     A,#0x0
   \   000014   90....       MOV     DPTR,#macRxOnFlag
   \   000017   F0           MOVX    @DPTR,A
    287              MAC_RADIO_RXTX_OFF();
   \   000018   75E1E5       MOV     0xe1,#-0x1b
    288              MAC_DEBUG_TURN_OFF_RX_LED();
    289          
    290              /* just in case a receive was about to start, flush the receive FIFO */
    291              MAC_RADIO_FLUSH_RX_FIFO();
   \   00001B   75E1E6       MOV     0xe1,#-0x1a
   \   00001E   75E1E6       MOV     0xe1,#-0x1a
    292          
    293              /* clear any receive interrupt that happened to squeak through */
    294              MAC_RADIO_CLEAR_RX_THRESHOLD_INTERRUPT_FLAG();
   \   000021   75E9DF       MOV     0xe9,#-0x21
    295          
    296            }
    297            HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macRxOff_0:
   \   000024   EA           MOV     A,R2
   \   000025   A2E0         MOV     C,0xE0 /* A   */.0
   \   000027   92AF         MOV     0xa8.7,C
    298          }
   \   000029   D083         POP     DPH
   \   00002B   D082         POP     DPL
   \   00002D   02....       LJMP    ?BRET
   \   000030                REQUIRE _A_IEN0
   \   000030                REQUIRE RFST
   \   000030                REQUIRE RFIF

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxOnOffInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxOnOffInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxEnable?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxEnable

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxSoftEnable?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxSoftEnable

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxDisable?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxDisable

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxHardDisable?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxHardDisable

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxOnRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxOnRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxOffRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxOffRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxOn?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxOn

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRxOff?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRxOff
    299          
    300          
    301          /**************************************************************************************************
    302          */

   Maximum stack usage in bytes:

     Function              ISTACK PSTACK XSTACK
     --------              ------ ------ ------
     macRxDisable              0      0      9
       -> halAssertHandler     0      0     18
       -> macRxOffRequest      0      0     18
     macRxEnable               0      0      9
       -> halAssertHandler     0      0     18
       -> macRxOn              0      0     18
     macRxHardDisable          0      0      9
       -> macRxHaltCleanup     0      0     18
     macRxOff                  2      0      9
     macRxOffRequest           0      0     18
       -> macRxOff             0      0     18
     macRxOn                   2      0      9
     macRxOnOffInit            2      0      0
     macRxOnRequest            0      0      9
       -> macRxOn              0      0     18
     macRxSoftEnable           0      0      9
       -> halAssertHandler     0      0     18


   Segment part sizes:

     Function/Label           Bytes
     --------------           -----
     _A_IEN0                     1
     RFST                        1
     RFIF                        1
     macRxOnFlag                 1
     macRxEnableFlags            1
     macRxOnOffInit             23
     macRxEnable                40
     macRxSoftEnable            37
     macRxDisable               44
     macRxHardDisable           47
     macRxOnRequest             32
     macRxOffRequest            54
     macRxOn                    39
     macRxOff                   48
     ??macRxOnOffInit?relay      6
     ??macRxEnable?relay         6
     ??macRxSoftEnable?relay     6
     ??macRxDisable?relay        6
     ??macRxHardDisable?relay    6
     ??macRxOnRequest?relay      6
     ??macRxOffRequest?relay     6
     ??macRxOn?relay             6
     ??macRxOff?relay            6

 
 364 bytes in segment BANKED_CODE
  54 bytes in segment BANK_RELAYS
   3 bytes in segment SFR_AN
   2 bytes in segment XDATA_Z
 
 418 bytes of CODE  memory
   0 bytes of DATA  memory (+ 3 bytes shared)
   2 bytes of XDATA memory

Errors: none
Warnings: none
