###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    19/Mar/2013  19:57:54 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \stack\zdo\ZDProfile.c                             #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wEndev.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\Tools #
#                          \CC2430DB\f8wConfig.cfg" (-DSECURE=0               #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\stack\zd #
#                          o\ZDProfile.c" -D CC2430EB -D AXD_END -D           #
#                          AXD_END_B -D NWK_AUTO_POLL -D REFLECTOR -D         #
#                          xZTOOL_P1 -D xMT_TASK -D xMT_ZDO_FUNC -D           #
#                          xLCD_SUPPORTED=DEBUG -D xPOWER_SAVING -lC          #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\ENDD #
#                          evice2EB\List\" -lA "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\ENDDevice2EB\L #
#                          ist\" --diag_suppress Pe001,Pa010 --diag_remark    #
#                          pe550 -o "C:\Texas Instruments\ZStack-1.4.3-1.2.1\ #
#                          Projects\zstack\Samples\cc2430-zstack-adxl345\CC24 #
#                          30DB\ENDDevice2EB\Obj\" -e --require_prototypes    #
#                          -z2 --no_cse --no_unroll --no_inline               #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data --nr_virtual_regs 8  #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\" #
#                           -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Proje #
#                          cts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\ #
#                          ..\SOURCE\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\Drivers\"   #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\ZMAIN\TI2430DB\" -I "C:\Texas              #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\ENDDe #
#                          vice2EB\List\ZDProfile.lst                         #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\ENDDe #
#                          vice2EB\Obj\ZDProfile.r51                          #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\stack\zdo\ZDProfile.c
      1          /**************************************************************************************************
      2            Filename:       ZDProfile.c
      3            Revised:        $Date: 2007-10-28 18:43:04 -0700 (Sun, 28 Oct 2007) $
      4            Revision:       $Revision: 15800 $
      5          
      6            Description:    This is the Zigbee Device Profile.
      7          
      8          
      9            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          #include "ZComdef.h"
     44          #include "OSAL.h"
     45          #include "AF.h"
     46          #include "NLMEDE.h"
     47          #include "nwk_util.h"
     48          #include "APS.h"
     49          
     50          #include "AddrMgr.h"
     51          #include "ZDConfig.h"
     52          #include "ZDProfile.h"
     53          #include "ZDObject.h"
     54          
     55          #if defined( LCD_SUPPORTED )
     56            #include "OnBoard.h"
     57          #endif
     58          
     59          #include "nwk_util.h"
     60          
     61          #if defined( MT_ZDO_FUNC )
     62            #include "MT_ZDO.h"
     63          #endif
     64          
     65          /*********************************************************************
     66           * MACROS
     67           */
     68          
     69          #define ZADDR_TO_AFADDR( pZADDR, AFADDR ) {                            \
     70            (AFADDR).endPoint = ZDP_AF_ENDPOINT;                                 \
     71            (AFADDR).addrMode = (afAddrMode_t)(pZADDR)->addrMode;                \
     72            (AFADDR).addr.shortAddr = (pZADDR)->addr.shortAddr;                  \
     73          }
     74          
     75          #define FillAndSendBuffer( TRANSSEQ, ADDR, ID, LEN, BUF ) {     \
     76            afStatus_t stat;                                    \
     77            ZDP_TmpBuf = (BUF)+1;                               \
     78            stat = fillAndSend( (TRANSSEQ), (ADDR), (ID), (LEN) );          \
     79            osal_mem_free( (BUF) );                             \
     80            ZDP_TmpBuf = ZDP_Buf+1;                             \
     81            return stat;                                        \
     82          }
     83          
     84          #define FillAndSendTxOptions( TRANSSEQ, ADDR, ID, LEN, TxO ) {  \
     85            afStatus_t stat;                                    \
     86            ZDP_TxOptions = (TxO);                              \
     87            stat = fillAndSend( (TRANSSEQ), (ADDR), (ID), (LEN) );          \
     88            ZDP_TxOptions = AF_TX_OPTIONS_NONE;                 \
     89            return stat;                                        \
     90          }
     91          
     92          /*********************************************************************
     93           * CONSTANTS
     94           */
     95          
     96          #define ZDP_BUF_SZ          80
     97          

   \                                 In  segment CODE_C, align 1
     98          CONST byte ZDP_AF_ENDPOINT = 0;
   \                     ZDP_AF_ENDPOINT:
   \   000000   00           DB 0
     99          
    100          /*********************************************************************
    101           * TYPEDEFS
    102           */
    103          typedef struct
    104          {
    105            void *next;
    106            uint8 taskID;
    107            uint16 clusterID;
    108          } ZDO_MsgCB_t;
    109          
    110          
    111          /*********************************************************************
    112           * GLOBAL VARIABLES
    113           */
    114          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    115          byte ZDP_TransID = 0;
   \                     ZDP_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    116          
    117          /*********************************************************************
    118           * EXTERNAL VARIABLES
    119           */
    120          
    121          extern endPointDesc_t ZDApp_epDesc;
    122          
    123          /*********************************************************************
    124           * EXTERNAL FUNCTIONS
    125           */
    126          
    127          /*********************************************************************
    128           * LOCAL FUNCTIONS
    129           */
    130          
    131          static afStatus_t fillAndSend( uint8 *transSeq, zAddrType_t *addr, cId_t clusterID, byte len );
    132          uint8 ZDO_SendMsgCBs( zdoIncomingMsg_t *inMsg );
    133          void zdpProcessAddrReq( zdoIncomingMsg_t *inMsg );
    134          
    135          /*********************************************************************
    136           * LOCAL VARIABLES
    137           */
    138          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          static uint8  ZDP_Buf[ ZDP_BUF_SZ ];
   \                     ZDP_Buf:
   \   000000                DS 80
   \   000050                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    140          static uint8 *ZDP_TmpBuf = ZDP_Buf+1;
   \                     ZDP_TmpBuf:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDP_TmpBuf>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          static byte ZDP_TxOptions = AF_TX_OPTIONS_NONE;
   \                     ZDP_TxOptions:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    142          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          ZDO_MsgCB_t *zdoMsgCBs = (ZDO_MsgCB_t *)NULL;
   \                     zdoMsgCBs:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    144          
    145          /*********************************************************************
    146           * ZDO Message Processing table
    147           */
    148          
    149          typedef void (*pfnZDPMsgProcessor)( zdoIncomingMsg_t *inMsg );
    150          
    151          typedef struct
    152          {
    153            uint16                clusterID;
    154            pfnZDPMsgProcessor    pFn;
    155          } zdpMsgProcItem_t;
    156          

   \                                 In  segment CODE_C, align 1
    157          CONST zdpMsgProcItem_t zdpMsgProcs[] = 
   \                     zdpMsgProcs:
   \   000000   0000....     DW 0, ??zdpProcessAddrReq?relay, 1, ??zdpProcessAddrReq?relay, 2
   \            0100....
   \            0200    
   \   00000A   ....0300     DW ??ZDO_ProcessNodeDescReq?relay, 3, ??ZDO_ProcessPowerDescReq?relay
   \            ....    
   \   000010   0400....     DW 4, ??ZDO_ProcessSimpleDescReq?relay, 5
   \            0500    
   \   000016   ....0600     DW ??ZDO_ProcessActiveEPReq?relay, 6, ??ZDO_ProcessMatchDescReq?relay
   \            ....    
   \   00001C   FFFF0000     DW 65535, 0H
    158          {
    159            { NWK_addr_req,           zdpProcessAddrReq },
    160            { IEEE_addr_req,          zdpProcessAddrReq },
    161            { Node_Desc_req,          ZDO_ProcessNodeDescReq },
    162            { Power_Desc_req,         ZDO_ProcessPowerDescReq },
    163            { Simple_Desc_req,        ZDO_ProcessSimpleDescReq },
    164            { Active_EP_req,          ZDO_ProcessActiveEPReq },
    165            { Match_Desc_req,         ZDO_ProcessMatchDescReq },
    166          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
    167            { Mgmt_NWK_Disc_req,      ZDO_ProcessMgmtNwkDiscReq },
    168          #endif
    169          #if defined ( ZDO_MGMT_LQI_RESPONSE ) && defined ( RTR_NWK )
    170            { Mgmt_Lqi_req,           ZDO_ProcessMgmtLqiReq },
    171          #endif
    172          #if defined ( ZDO_MGMT_RTG_RESPONSE ) && defined ( RTR_NWK )
    173            { Mgmt_Rtg_req,           ZDO_ProcessMgmtRtgReq },
    174          #endif
    175          #if defined ( ZDO_MGMT_BIND_RESPONSE ) && defined ( REFLECTOR )
    176            { Mgmt_Bind_req,          ZDO_ProcessMgmtBindReq },
    177          #endif
    178          #if defined ( ZDO_MGMT_JOINDIRECT_RESPONSE ) && defined ( RTR_NWK )
    179            { Mgmt_Direct_Join_req,   ZDO_ProcessMgmtDirectJoinReq },
    180          #endif
    181          #if defined ( ZDO_MGMT_LEAVE_RESPONSE )
    182            { Mgmt_Leave_req,         ZDO_ProcessMgmtLeaveReq },
    183          #endif
    184          #if defined ( ZDO_MGMT_PERMIT_JOIN_RESPONSE )  && defined ( RTR_NWK )
    185            { Mgmt_Permit_Join_req,   ZDO_ProcessMgmtPermitJoinReq },
    186          #endif
    187          #if defined ( ZDO_USERDESC_RESPONSE )
    188            { User_Desc_req,          ZDO_ProcessUserDescReq },
    189          #endif
    190          #if defined ( ZDO_USERDESCSET_RESPONSE )
    191            { User_Desc_set,          ZDO_ProcessUserDescSet },
    192          #endif
    193          #if defined ( ZDO_SERVERDISC_RESPONSE )
    194            { Server_Discovery_req,   ZDO_ProcessServerDiscReq },
    195          #endif
    196          #if defined ( ZDO_ENDDEVICE_ANNCE ) && defined ( RTR_NWK )
    197            { End_Device_annce,       ZDO_ProcessEndDeviceAnnce },
    198          #endif
    199            {0xFFFF, NULL} // Last
    200          };
    201          
    202          /*********************************************************************
    203           * @fn          fillAndSend
    204           *
    205           * @brief       Combined to reduce space
    206           *
    207           * @param
    208           * @param
    209           *
    210           * @return      afStatus_t
    211           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    212          static afStatus_t fillAndSend( uint8 *transSeq, zAddrType_t *addr, cId_t clusterID, byte len )
   \                     fillAndSend:
    213          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 6,R2
   \   00000C   8B..         MOV     ?V0 + 7,R3
   \   00000E   8C..         MOV     ?V0 + 2,R4
   \   000010   8D..         MOV     ?V0 + 3,R5
   \   000012   89..         MOV     ?V0 + 0,R1
   \   000014   7414         MOV     A,#0x14
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   FE           MOV     R6,A
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   FF           MOV     R7,A
    214            afAddrType_t afAddr;
    215          
    216            ZADDR_TO_AFADDR( addr, afAddr );
   \   00001E   90....       MOV     DPTR,#ZDP_AF_ENDPOINT
   \   000021   E4           CLR     A
   \   000022   93           MOVC    A,@A+DPTR
   \   000023   C0E0         PUSH    A
   \   000025   7403         MOV     A,#0x3
   \   000027   12....       LCALL   ?XSTACK_DISP0_8
   \   00002A   D0E0         POP     A
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   85..82       MOV     DPL,?V0 + 2
   \   000030   85..83       MOV     DPH,?V0 + 3
   \   000033   A3           INC     DPTR
   \   000034   A3           INC     DPTR
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   C0E0         PUSH    A
   \   00003E   7402         MOV     A,#0x2
   \   000040   12....       LCALL   ?XSTACK_DISP0_8
   \   000043   D0E0         POP     A
   \   000045   F0           MOVX    @DPTR,A
   \   000046   85..82       MOV     DPL,?V0 + 2
   \   000049   85..83       MOV     DPH,?V0 + 3
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   F8           MOV     R0,A
   \   00004E   A3           INC     DPTR
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   F9           MOV     R1,A
   \   000051   85..82       MOV     DPL,?XSP + 0
   \   000054   85..83       MOV     DPH,?XSP + 1
   \   000057   E8           MOV     A,R0
   \   000058   F0           MOVX    @DPTR,A
   \   000059   A3           INC     DPTR
   \   00005A   E9           MOV     A,R1
   \   00005B   F0           MOVX    @DPTR,A
    217          
    218            *(ZDP_TmpBuf-1) = *transSeq;
   \   00005C   85..82       MOV     DPL,?V0 + 6
   \   00005F   85..83       MOV     DPH,?V0 + 7
   \   000062   E0           MOVX    A,@DPTR
   \   000063   C0E0         PUSH    A
   \   000065   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000068   E0           MOVX    A,@DPTR
   \   000069   24FF         ADD     A,#-0x1
   \   00006B   F8           MOV     R0,A
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   34FF         ADDC    A,#-0x1
   \   000070   F9           MOV     R1,A
   \   000071   8882         MOV     DPL,R0
   \   000073   8983         MOV     DPH,R1
   \   000075   D0E0         POP     A
   \   000077   F0           MOVX    @DPTR,A
    219          
    220            return AF_DataRequest( &afAddr, &ZDApp_epDesc, clusterID,
    221                                     (uint16)(len+1), (uint8*)(ZDP_TmpBuf-1),
    222                                     transSeq, ZDP_TxOptions,  AF_DEFAULT_RADIUS );
   \   000078                ; Setup parameters for call to function AF_DataRequest
   \   000078   75..0A       MOV     ?V0 + 1,#0xa
   \   00007B   78..         MOV     R0,#?V0 + 1
   \   00007D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000080   78..         MOV     R0,#?V0 + 6
   \   000082   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000085   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000088   E0           MOVX    A,@DPTR
   \   000089   24FF         ADD     A,#-0x1
   \   00008B   F5..         MOV     ?V0 + 4,A
   \   00008D   A3           INC     DPTR
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   34FF         ADDC    A,#-0x1
   \   000091   F5..         MOV     ?V0 + 5,A
   \   000093   78..         MOV     R0,#?V0 + 4
   \   000095   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000098   85....       MOV     ?V0 + 4,?V0 + 0
   \   00009B   75..00       MOV     ?V0 + 5,#0x0
   \   00009E   7401         MOV     A,#0x1
   \   0000A0   25..         ADD     A,?V0 + 4
   \   0000A2   F5..         MOV     ?V0 + 4,A
   \   0000A4   7400         MOV     A,#0x0
   \   0000A6   35..         ADDC    A,?V0 + 5
   \   0000A8   F5..         MOV     ?V0 + 5,A
   \   0000AA   78..         MOV     R0,#?V0 + 4
   \   0000AC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000AF   8E..         MOV     ?V0 + 4,R6
   \   0000B1   8F..         MOV     ?V0 + 5,R7
   \   0000B3   78..         MOV     R0,#?V0 + 4
   \   0000B5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B8   90....       MOV     DPTR,#ZDP_TxOptions
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   F9           MOV     R1,A
   \   0000BD   7C..         MOV     R4,#(ZDApp_epDesc & 0xff)
   \   0000BF   7D..         MOV     R5,#((ZDApp_epDesc >> 8) & 0xff)
   \   0000C1   7409         MOV     A,#0x9
   \   0000C3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C6   AA82         MOV     R2,DPL
   \   0000C8   AB83         MOV     R3,DPH
   \   0000CA   12....       LCALL   ??AF_DataRequest?relay
   \   0000CD   7409         MOV     A,#0x9
   \   0000CF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000D2   7404         MOV     A,#0x4
   \   0000D4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000D7   7F08         MOV     R7,#0x8
   \   0000D9   02....       LJMP    ?BANKED_LEAVE_XDATA
    223          
    224          }
    225          
    226          /*********************************************************************
    227           * @fn          ZDP_SendData
    228           *
    229           * @brief       This builds and send a request message that has
    230           *              NWKAddrOfInterest as its only parameter.
    231           *
    232           * @param       dstAddr - destination address
    233           * @param       cmd - clusterID
    234           * @param       dataLen - number of bytes of data
    235           * @param       data - pointer to the data
    236           * @param       SecurityEnable - Security Options
    237           *
    238           * @return      afStatus_t
    239           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    240          afStatus_t ZDP_SendData( byte *TransSeq, zAddrType_t *dstAddr, uint16 cmd,
   \                     ZDP_SendData:
    241                                  byte len, byte *buf, byte SecurityEnable )
    242          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   \   000015   7402         MOV     A,#0x2
   \   000017   12....       LCALL   ?XSTACK_DISP0_8
   \   00001A   EC           MOV     A,R4
   \   00001B   F0           MOVX    @DPTR,A
   \   00001C   A3           INC     DPTR
   \   00001D   ED           MOV     A,R5
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   E9           MOV     A,R1
   \   000020   FF           MOV     R7,A
   \   000021   7412         MOV     A,#0x12
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F5..         MOV     ?V0 + 2,A
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F5..         MOV     ?V0 + 3,A
   \   00002D   7416         MOV     A,#0x16
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F5..         MOV     ?V0 + 1,A
    243            byte *pBuf = ZDP_TmpBuf;
   \   000035   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F8           MOV     R0,A
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F9           MOV     R1,A
   \   00003D   88..         MOV     ?V0 + 4,R0
   \   00003F   89..         MOV     ?V0 + 5,R1
    244            byte cnt = len;
   \   000041   EF           MOV     A,R7
   \   000042   FE           MOV     R6,A
    245          
    246            while ( cnt-- )
   \                     ??ZDP_SendData_0:
   \   000043   EE           MOV     A,R6
   \   000044   FA           MOV     R2,A
   \   000045   74FF         MOV     A,#-0x1
   \   000047   2A           ADD     A,R2
   \   000048   FE           MOV     R6,A
   \   000049   EA           MOV     A,R2
   \   00004A   603C         JZ      ??ZDP_SendData_1
    247            {
    248              *pBuf++ = *buf++;
   \   00004C   7414         MOV     A,#0x14
   \   00004E   12....       LCALL   ?XSTACK_DISP0_8
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F8           MOV     R0,A
   \   000053   A3           INC     DPTR
   \   000054   E0           MOVX    A,@DPTR
   \   000055   F583         MOV     DPH,A
   \   000057   8882         MOV     DPL,R0
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   85..82       MOV     DPL,?V0 + 4
   \   00005D   85..83       MOV     DPH,?V0 + 5
   \   000060   F0           MOVX    @DPTR,A
   \   000061   7414         MOV     A,#0x14
   \   000063   12....       LCALL   ?XSTACK_DISP0_8
   \   000066   E0           MOVX    A,@DPTR
   \   000067   2401         ADD     A,#0x1
   \   000069   F8           MOV     R0,A
   \   00006A   A3           INC     DPTR
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   3400         ADDC    A,#0x0
   \   00006E   F9           MOV     R1,A
   \   00006F   7414         MOV     A,#0x14
   \   000071   12....       LCALL   ?XSTACK_DISP0_8
   \   000074   E8           MOV     A,R0
   \   000075   F0           MOVX    @DPTR,A
   \   000076   A3           INC     DPTR
   \   000077   E9           MOV     A,R1
   \   000078   F0           MOVX    @DPTR,A
   \   000079   85..82       MOV     DPL,?V0 + 4
   \   00007C   85..83       MOV     DPH,?V0 + 5
   \   00007F   A3           INC     DPTR
   \   000080   8582..       MOV     ?V0 + 4,DPL
   \   000083   8583..       MOV     ?V0 + 5,DPH
   \   000086   80BB         SJMP    ??ZDP_SendData_0
    249            }
    250          
    251            FillAndSendTxOptions( TransSeq, dstAddr, cmd, len,
    252                         (AF_DEFAULT_RADIUS | ((SecurityEnable) ? AF_EN_SECURITY : 0)) );
   \                     ??ZDP_SendData_1:
   \   000088   E5..         MOV     A,?V0 + 1
   \   00008A   6004         JZ      ??ZDP_SendData_2
   \   00008C   7840         MOV     R0,#0x40
   \   00008E   8002         SJMP    ??ZDP_SendData_3
   \                     ??ZDP_SendData_2:
   \   000090   7800         MOV     R0,#0x0
   \                     ??ZDP_SendData_3:
   \   000092   E8           MOV     A,R0
   \   000093   440A         ORL     A,#0xa
   \   000095   90....       MOV     DPTR,#ZDP_TxOptions
   \   000098   F0           MOVX    @DPTR,A
   \   000099                ; Setup parameters for call to function fillAndSend
   \   000099   78..         MOV     R0,#?V0 + 2
   \   00009B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009E   EF           MOV     A,R7
   \   00009F   F9           MOV     R1,A
   \   0000A0   7404         MOV     A,#0x4
   \   0000A2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A5   E0           MOVX    A,@DPTR
   \   0000A6   FC           MOV     R4,A
   \   0000A7   A3           INC     DPTR
   \   0000A8   E0           MOVX    A,@DPTR
   \   0000A9   FD           MOV     R5,A
   \   0000AA   7402         MOV     A,#0x2
   \   0000AC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   FA           MOV     R2,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   FB           MOV     R3,A
   \   0000B4   12....       LCALL   ??fillAndSend?relay
   \   0000B7   7402         MOV     A,#0x2
   \   0000B9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000BC   E9           MOV     A,R1
   \   0000BD   F5..         MOV     ?V0 + 0,A
   \   0000BF   7400         MOV     A,#0x0
   \   0000C1   90....       MOV     DPTR,#ZDP_TxOptions
   \   0000C4   F0           MOVX    @DPTR,A
   \   0000C5   A9..         MOV     R1,?V0 + 0
   \   0000C7   7404         MOV     A,#0x4
   \   0000C9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CC   7F06         MOV     R7,#0x6
   \   0000CE   02....       LJMP    ?BANKED_LEAVE_XDATA
    253          }
    254          
    255          #if defined ( ZDO_NODEDESC_REQUEST ) || defined ( ZDO_POWERDESC_REQUEST ) ||\
    256              defined ( ZDO_ACTIVEEP_REQUEST ) || defined ( ZDO_COMPLEXDESC_REQUEST ) ||\
    257              defined ( ZDO_USERDESC_REQUEST )
    258          /*********************************************************************
    259           * @fn          ZDP_NWKAddrOfInterestReq
    260           *
    261           * @brief       This builds and send a request message that has
    262           *              NWKAddrOfInterest as its only parameter.
    263           *
    264           * @param       dstAddr - destination address
    265           * @param       nwkAddr - 16 bit address
    266           * @param       SecurityEnable - Security Options
    267           *
    268           * @return      afStatus_t
    269           */
    270          afStatus_t ZDP_NWKAddrOfInterestReq( zAddrType_t *dstAddr, uint16 nwkAddr,
    271                                               byte cmd, byte SecurityEnable )
    272          {
    273            ZDP_TmpBuf[0] = LO_UINT16( nwkAddr );
    274            ZDP_TmpBuf[1] = HI_UINT16( nwkAddr );
    275          
    276            return fillAndSend( &ZDP_TransID, dstAddr, cmd, 2 );
    277          }
    278          #endif // ZDO_NODEDESC_REQUEST ZDO_POWERDESC_REQUEST ZDO_ACTIVEEP_REQUEST ZDO_COMPLEXDESC_REQUEST  ZDO_USERDESC_REQUEST
    279          
    280          /*********************************************************************
    281           * Address Requests
    282           */
    283          
    284          #if defined ( ZDO_NWKADDR_REQUEST )
    285          /*********************************************************************
    286           * @fn          ZDP_NwkAddrReq
    287           *
    288           * @brief       This builds and send a NWK_addr_req message.  This
    289           *              function sends a broadcast message looking for a 16
    290           *              bit address with a 64 bit address as bait.
    291           *
    292           * @param       IEEEAddress - looking for this device
    293           * @param       SecurityEnable - Security Options
    294           *
    295           * @return      afStatus_t
    296           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    297          afStatus_t ZDP_NwkAddrReq( byte *IEEEAddress, byte ReqType,
   \                     ZDP_NwkAddrReq:
    298                                     byte StartIndex, byte SecurityEnable )
    299          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 6,R2
   \   00000C   8B..         MOV     ?V0 + 7,R3
   \   00000E   89..         MOV     ?V0 + 4,R1
   \   000010   8C..         MOV     ?V0 + 1,R4
    300            byte *pBuf = ZDP_TmpBuf;
   \   000012   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F8           MOV     R0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   E8           MOV     A,R0
   \   00001B   FE           MOV     R6,A
   \   00001C   E9           MOV     A,R1
   \   00001D   FF           MOV     R7,A
    301            byte len = Z_EXTADDR_LEN + 1 + 1;  // IEEEAddress + ReqType + StartIndex.
   \   00001E   75..0A       MOV     ?V0 + 0,#0xa
    302            zAddrType_t dstAddr;
    303          
    304            if ( osal_ExtAddrEqual( saveExtAddr, IEEEAddress ) == FALSE )
   \   000021                ; Setup parameters for call to function osal_ExtAddrEqual
   \   000021   AC..         MOV     R4,?V0 + 6
   \   000023   AD..         MOV     R5,?V0 + 7
   \   000025   7A..         MOV     R2,#(saveExtAddr & 0xff)
   \   000027   7B..         MOV     R3,#((saveExtAddr >> 8) & 0xff)
   \   000029   12....       LCALL   ??osal_ExtAddrEqual?relay
   \   00002C   E9           MOV     A,R1
   \   00002D   701B         JNZ     ??ZDP_NwkAddrReq_0
    305            {
    306              dstAddr.addrMode = AddrBroadcast;
   \   00002F   740F         MOV     A,#0xf
   \   000031   C0E0         PUSH    A
   \   000033   7408         MOV     A,#0x8
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   D0E0         POP     A
   \   00003A   F0           MOVX    @DPTR,A
    307              dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   00003B   85..82       MOV     DPL,?XSP + 0
   \   00003E   85..83       MOV     DPH,?XSP + 1
   \   000041   74FF         MOV     A,#-0x1
   \   000043   F0           MOVX    @DPTR,A
   \   000044   A3           INC     DPTR
   \   000045   74FF         MOV     A,#-0x1
   \   000047   F0           MOVX    @DPTR,A
   \   000048   801F         SJMP    ??ZDP_NwkAddrReq_1
    308            }
    309            else
    310            {
    311              dstAddr.addrMode = Addr16Bit;
   \                     ??ZDP_NwkAddrReq_0:
   \   00004A   7402         MOV     A,#0x2
   \   00004C   C0E0         PUSH    A
   \   00004E   7408         MOV     A,#0x8
   \   000050   12....       LCALL   ?XSTACK_DISP0_8
   \   000053   D0E0         POP     A
   \   000055   F0           MOVX    @DPTR,A
    312              dstAddr.addr.shortAddr = ZDAppNwkAddr.addr.shortAddr;
   \   000056   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F8           MOV     R0,A
   \   00005B   A3           INC     DPTR
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F9           MOV     R1,A
   \   00005E   85..82       MOV     DPL,?XSP + 0
   \   000061   85..83       MOV     DPH,?XSP + 1
   \   000064   E8           MOV     A,R0
   \   000065   F0           MOVX    @DPTR,A
   \   000066   A3           INC     DPTR
   \   000067   E9           MOV     A,R1
   \   000068   F0           MOVX    @DPTR,A
    313            }
    314          
    315            pBuf = osal_cpyExtAddr( pBuf, IEEEAddress );
   \                     ??ZDP_NwkAddrReq_1:
   \   000069                ; Setup parameters for call to function osal_cpyExtAddr
   \   000069   AC..         MOV     R4,?V0 + 6
   \   00006B   AD..         MOV     R5,?V0 + 7
   \   00006D   EE           MOV     A,R6
   \   00006E   FA           MOV     R2,A
   \   00006F   EF           MOV     A,R7
   \   000070   FB           MOV     R3,A
   \   000071   12....       LCALL   ??osal_cpyExtAddr?relay
   \   000074   8A..         MOV     ?V0 + 2,R2
   \   000076   8B..         MOV     ?V0 + 3,R3
   \   000078   AE..         MOV     R6,?V0 + 2
   \   00007A   AF..         MOV     R7,?V0 + 3
    316          
    317            *pBuf++ = ReqType;
   \   00007C   8E82         MOV     DPL,R6
   \   00007E   8F83         MOV     DPH,R7
   \   000080   E5..         MOV     A,?V0 + 4
   \   000082   F0           MOVX    @DPTR,A
   \   000083   8E82         MOV     DPL,R6
   \   000085   8F83         MOV     DPH,R7
   \   000087   A3           INC     DPTR
   \   000088   AE82         MOV     R6,DPL
   \   00008A   AF83         MOV     R7,DPH
    318            *pBuf++ = StartIndex;
   \   00008C   8E82         MOV     DPL,R6
   \   00008E   8F83         MOV     DPH,R7
   \   000090   E5..         MOV     A,?V0 + 1
   \   000092   F0           MOVX    @DPTR,A
    319          
    320            return fillAndSend( &ZDP_TransID, &dstAddr, NWK_addr_req, len );
   \   000093                ; Setup parameters for call to function fillAndSend
   \   000093   75..00       MOV     ?V0 + 2,#0x0
   \   000096   75..00       MOV     ?V0 + 3,#0x0
   \   000099   78..         MOV     R0,#?V0 + 2
   \   00009B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009E   A9..         MOV     R1,?V0 + 0
   \   0000A0   7402         MOV     A,#0x2
   \   0000A2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A5   AC82         MOV     R4,DPL
   \   0000A7   AD83         MOV     R5,DPH
   \   0000A9   7A..         MOV     R2,#(ZDP_TransID & 0xff)
   \   0000AB   7B..         MOV     R3,#((ZDP_TransID >> 8) & 0xff)
   \   0000AD   12....       LCALL   ??fillAndSend?relay
   \   0000B0   7402         MOV     A,#0x2
   \   0000B2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B5   7409         MOV     A,#0x9
   \   0000B7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000BA   7F08         MOV     R7,#0x8
   \   0000BC   02....       LJMP    ?BANKED_LEAVE_XDATA
    321          }
    322          #endif
    323          
    324          #if defined ( ZDO_IEEEADDR_REQUEST )
    325          /*********************************************************************
    326           * @fn          ZDP_IEEEAddrReq
    327           *
    328           * @brief       This builds and send a IEEE_addr_req message.  This
    329           *              function sends a unicast message looking for a 64
    330           *              bit IEEE address with a 16 bit address as bait.
    331           *
    332           * @param       ReqType - ZDP_IEEEADDR_REQTYPE_SINGLE or
    333           *                        ZDP_IEEEADDR_REQTYPE_EXTENDED
    334           * @param       SecurityEnable - Security Options
    335           *
    336           * @return      afStatus_t
    337           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    338          afStatus_t ZDP_IEEEAddrReq( uint16 shortAddr, byte ReqType,
   \                     ZDP_IEEEAddrReq:
    339                                      byte StartIndex, byte SecurityEnable )
    340          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   89..         MOV     ?V0 + 6,R1
   \   000010   8C..         MOV     ?V0 + 3,R4
    341            byte *pBuf = ZDP_TmpBuf;
   \   000012   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F8           MOV     R0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   E8           MOV     A,R0
   \   00001B   FE           MOV     R6,A
   \   00001C   E9           MOV     A,R1
   \   00001D   FF           MOV     R7,A
    342            byte len = 2 + 1 + 1;  // shortAddr + ReqType + StartIndex.
   \   00001E   75..04       MOV     ?V0 + 2,#0x4
    343            zAddrType_t dstAddr;
    344          
    345            dstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000021   7402         MOV     A,#0x2
   \   000023   C0E0         PUSH    A
   \   000025   7408         MOV     A,#0x8
   \   000027   12....       LCALL   ?XSTACK_DISP0_8
   \   00002A   D0E0         POP     A
   \   00002C   F0           MOVX    @DPTR,A
    346            dstAddr.addr.shortAddr = shortAddr;
   \   00002D   85..82       MOV     DPL,?XSP + 0
   \   000030   85..83       MOV     DPH,?XSP + 1
   \   000033   E5..         MOV     A,?V0 + 0
   \   000035   F0           MOVX    @DPTR,A
   \   000036   A3           INC     DPTR
   \   000037   E5..         MOV     A,?V0 + 1
   \   000039   F0           MOVX    @DPTR,A
    347          
    348            *pBuf++ = LO_UINT16( shortAddr );
   \   00003A   8E82         MOV     DPL,R6
   \   00003C   8F83         MOV     DPH,R7
   \   00003E   E5..         MOV     A,?V0 + 0
   \   000040   F0           MOVX    @DPTR,A
   \   000041   8E82         MOV     DPL,R6
   \   000043   8F83         MOV     DPH,R7
   \   000045   A3           INC     DPTR
   \   000046   AE82         MOV     R6,DPL
   \   000048   AF83         MOV     R7,DPH
    349            *pBuf++ = HI_UINT16( shortAddr );
   \   00004A   8E82         MOV     DPL,R6
   \   00004C   8F83         MOV     DPH,R7
   \   00004E   E5..         MOV     A,?V0 + 1
   \   000050   F0           MOVX    @DPTR,A
   \   000051   8E82         MOV     DPL,R6
   \   000053   8F83         MOV     DPH,R7
   \   000055   A3           INC     DPTR
   \   000056   AE82         MOV     R6,DPL
   \   000058   AF83         MOV     R7,DPH
    350          
    351            *pBuf++ = ReqType;
   \   00005A   8E82         MOV     DPL,R6
   \   00005C   8F83         MOV     DPH,R7
   \   00005E   E5..         MOV     A,?V0 + 6
   \   000060   F0           MOVX    @DPTR,A
   \   000061   8E82         MOV     DPL,R6
   \   000063   8F83         MOV     DPH,R7
   \   000065   A3           INC     DPTR
   \   000066   AE82         MOV     R6,DPL
   \   000068   AF83         MOV     R7,DPH
    352            *pBuf++ = StartIndex;
   \   00006A   8E82         MOV     DPL,R6
   \   00006C   8F83         MOV     DPH,R7
   \   00006E   E5..         MOV     A,?V0 + 3
   \   000070   F0           MOVX    @DPTR,A
    353          
    354            return fillAndSend( &ZDP_TransID, &dstAddr, IEEE_addr_req, len );
   \   000071                ; Setup parameters for call to function fillAndSend
   \   000071   75..01       MOV     ?V0 + 4,#0x1
   \   000074   75..00       MOV     ?V0 + 5,#0x0
   \   000077   78..         MOV     R0,#?V0 + 4
   \   000079   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00007C   A9..         MOV     R1,?V0 + 2
   \   00007E   7402         MOV     A,#0x2
   \   000080   12....       LCALL   ?XSTACK_DISP0_8
   \   000083   AC82         MOV     R4,DPL
   \   000085   AD83         MOV     R5,DPH
   \   000087   7A..         MOV     R2,#(ZDP_TransID & 0xff)
   \   000089   7B..         MOV     R3,#((ZDP_TransID >> 8) & 0xff)
   \   00008B   12....       LCALL   ??fillAndSend?relay
   \   00008E   7402         MOV     A,#0x2
   \   000090   12....       LCALL   ?DEALLOC_XSTACK8
   \   000093   7409         MOV     A,#0x9
   \   000095   12....       LCALL   ?DEALLOC_XSTACK8
   \   000098   7F08         MOV     R7,#0x8
   \   00009A   02....       LJMP    ?BANKED_LEAVE_XDATA
    355          }
    356          #endif
    357          
    358          #if defined ( ZDO_MATCH_REQUEST )
    359          /*********************************************************************
    360           * @fn          ZDP_MatchDescReq
    361           *
    362           * @brief       This builds and send a Match_Desc_req message.  This
    363           *              function sends a broadcast or unicast message
    364           *              requesting the list of endpoint/interfaces that
    365           *              match profile ID and cluster IDs.
    366           *
    367           * @param       dstAddr - destination address
    368           * @param       ProfileID - Profile ID
    369           * @param       NumInClusters - number of input clusters
    370           * @param       InClusterList - input cluster ID list
    371           * @param       NumOutClusters - number of output clusters
    372           * @param       OutClusterList - output cluster ID list
    373           * @param       SecurityEnable - Security Options
    374           *
    375           * @return      afStatus_t
    376           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    377          afStatus_t ZDP_MatchDescReq( zAddrType_t *dstAddr, uint16 nwkAddr,
   \                     ZDP_MatchDescReq:
    378                                          uint16 ProfileID,
    379                                          byte NumInClusters, cId_t *InClusterList,
    380                                          byte NumOutClusters, cId_t *OutClusterList,
    381                                          byte SecurityEnable )
    382          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7403         MOV     A,#0x3
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EA           MOV     A,R2
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   EB           MOV     A,R3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   7401         MOV     A,#0x1
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   EC           MOV     A,R4
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   ED           MOV     A,R5
   \   00001D   F0           MOVX    @DPTR,A
   \   00001E   E9           MOV     A,R1
   \   00001F   85..82       MOV     DPL,?XSP + 0
   \   000022   85..83       MOV     DPH,?XSP + 1
   \   000025   F0           MOVX    @DPTR,A
   \   000026   7413         MOV     A,#0x13
   \   000028   12....       LCALL   ?XSTACK_DISP0_8
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F5..         MOV     ?V0 + 2,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F5..         MOV     ?V0 + 3,A
    383            byte *pBuf = ZDP_TmpBuf;
   \   000032   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000035   E0           MOVX    A,@DPTR
   \   000036   F8           MOV     R0,A
   \   000037   A3           INC     DPTR
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F9           MOV     R1,A
   \   00003A   E8           MOV     A,R0
   \   00003B   FE           MOV     R6,A
   \   00003C   E9           MOV     A,R1
   \   00003D   FF           MOV     R7,A
    384            // nwkAddr+ProfileID+NumInClusters+NumOutClusters.
    385            byte i, len = 2 + 2 + 1 + 1;  // nwkAddr+ProfileID+NumInClusters+NumOutClusters.
   \   00003E   75..06       MOV     ?V0 + 1,#0x6
    386            
    387            len += (NumInClusters + NumOutClusters) * sizeof(uint16);
   \   000041   75F002       MOV     B,#0x2
   \   000044   85..82       MOV     DPL,?XSP + 0
   \   000047   85..83       MOV     DPH,?XSP + 1
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   F8           MOV     R0,A
   \   00004C   7417         MOV     A,#0x17
   \   00004E   12....       LCALL   ?XSTACK_DISP0_8
   \   000051   E0           MOVX    A,@DPTR
   \   000052   28           ADD     A,R0
   \   000053   A4           MUL     AB
   \   000054   25..         ADD     A,?V0 + 1
   \   000056   F5..         MOV     ?V0 + 1,A
    388          
    389            if ( len >= ZDP_BUF_SZ-1 )
   \   000058   E5..         MOV     A,?V0 + 1
   \   00005A   C3           CLR     C
   \   00005B   944F         SUBB    A,#0x4f
   \   00005D   4005         JC      ??ZDP_MatchDescReq_0
    390            {
    391              return afStatus_MEM_FAIL;
   \   00005F   7981         MOV     R1,#-0x7f
   \   000061   02....       LJMP    ??ZDP_MatchDescReq_1 & 0xFFFF
    392            }
    393          
    394            *pBuf++ = LO_UINT16( nwkAddr );   // NWKAddrOfInterest
   \                     ??ZDP_MatchDescReq_0:
   \   000064   7401         MOV     A,#0x1
   \   000066   12....       LCALL   ?XSTACK_DISP0_8
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   8E82         MOV     DPL,R6
   \   00006C   8F83         MOV     DPH,R7
   \   00006E   F0           MOVX    @DPTR,A
   \   00006F   8E82         MOV     DPL,R6
   \   000071   8F83         MOV     DPH,R7
   \   000073   A3           INC     DPTR
   \   000074   AE82         MOV     R6,DPL
   \   000076   AF83         MOV     R7,DPH
    395            *pBuf++ = HI_UINT16( nwkAddr );
   \   000078   7401         MOV     A,#0x1
   \   00007A   12....       LCALL   ?XSTACK_DISP0_8
   \   00007D   A3           INC     DPTR
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   F9           MOV     R1,A
   \   000080   E9           MOV     A,R1
   \   000081   8E82         MOV     DPL,R6
   \   000083   8F83         MOV     DPH,R7
   \   000085   F0           MOVX    @DPTR,A
   \   000086   8E82         MOV     DPL,R6
   \   000088   8F83         MOV     DPH,R7
   \   00008A   A3           INC     DPTR
   \   00008B   AE82         MOV     R6,DPL
   \   00008D   AF83         MOV     R7,DPH
    396          
    397            *pBuf++ = LO_UINT16( ProfileID );   // Profile ID
   \   00008F   8E82         MOV     DPL,R6
   \   000091   8F83         MOV     DPH,R7
   \   000093   E5..         MOV     A,?V0 + 2
   \   000095   F0           MOVX    @DPTR,A
   \   000096   8E82         MOV     DPL,R6
   \   000098   8F83         MOV     DPH,R7
   \   00009A   A3           INC     DPTR
   \   00009B   AE82         MOV     R6,DPL
   \   00009D   AF83         MOV     R7,DPH
    398            *pBuf++ = HI_UINT16( ProfileID );
   \   00009F   8E82         MOV     DPL,R6
   \   0000A1   8F83         MOV     DPH,R7
   \   0000A3   E5..         MOV     A,?V0 + 3
   \   0000A5   F0           MOVX    @DPTR,A
   \   0000A6   8E82         MOV     DPL,R6
   \   0000A8   8F83         MOV     DPH,R7
   \   0000AA   A3           INC     DPTR
   \   0000AB   AE82         MOV     R6,DPL
   \   0000AD   AF83         MOV     R7,DPH
    399          
    400            *pBuf++ = NumInClusters; // Input cluster list
   \   0000AF   85..82       MOV     DPL,?XSP + 0
   \   0000B2   85..83       MOV     DPH,?XSP + 1
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   8E82         MOV     DPL,R6
   \   0000B8   8F83         MOV     DPH,R7
   \   0000BA   F0           MOVX    @DPTR,A
   \   0000BB   8E82         MOV     DPL,R6
   \   0000BD   8F83         MOV     DPH,R7
   \   0000BF   A3           INC     DPTR
   \   0000C0   AE82         MOV     R6,DPL
   \   0000C2   AF83         MOV     R7,DPH
    401            if ( NumInClusters )
   \   0000C4   85..82       MOV     DPL,?XSP + 0
   \   0000C7   85..83       MOV     DPH,?XSP + 1
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   7003         JNZ     $+5
   \   0000CD   02....       LJMP    ??ZDP_MatchDescReq_2 & 0xFFFF
    402            {
    403              for (i=0; i<NumInClusters; ++i)  {
   \   0000D0   75..00       MOV     ?V0 + 0,#0x0
   \                     ??ZDP_MatchDescReq_3:
   \   0000D3   85..82       MOV     DPL,?XSP + 0
   \   0000D6   85..83       MOV     DPH,?XSP + 1
   \   0000D9   E0           MOVX    A,@DPTR
   \   0000DA   FA           MOV     R2,A
   \   0000DB   E5..         MOV     A,?V0 + 0
   \   0000DD   C3           CLR     C
   \   0000DE   9A           SUBB    A,R2
   \   0000DF   5076         JNC     ??ZDP_MatchDescReq_2
    404                *pBuf++ = LO_UINT16( InClusterList[i] );
   \   0000E1   A8..         MOV     R0,?V0 + 0
   \   0000E3   7900         MOV     R1,#0x0
   \   0000E5   E8           MOV     A,R0
   \   0000E6   75F002       MOV     B,#0x2
   \   0000E9   A4           MUL     AB
   \   0000EA   C8           XCH     A,R0
   \   0000EB   AAF0         MOV     R2,B
   \   0000ED   75F000       MOV     B,#0x0
   \   0000F0   A4           MUL     AB
   \   0000F1   2A           ADD     A,R2
   \   0000F2   FA           MOV     R2,A
   \   0000F3   75F002       MOV     B,#0x2
   \   0000F6   E9           MOV     A,R1
   \   0000F7   A4           MUL     AB
   \   0000F8   2A           ADD     A,R2
   \   0000F9   F9           MOV     R1,A
   \   0000FA   7415         MOV     A,#0x15
   \   0000FC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FF   E0           MOVX    A,@DPTR
   \   000100   28           ADD     A,R0
   \   000101   FA           MOV     R2,A
   \   000102   A3           INC     DPTR
   \   000103   E0           MOVX    A,@DPTR
   \   000104   39           ADDC    A,R1
   \   000105   8A82         MOV     DPL,R2
   \   000107   F583         MOV     DPH,A
   \   000109   E0           MOVX    A,@DPTR
   \   00010A   8E82         MOV     DPL,R6
   \   00010C   8F83         MOV     DPH,R7
   \   00010E   F0           MOVX    @DPTR,A
   \   00010F   8E82         MOV     DPL,R6
   \   000111   8F83         MOV     DPH,R7
   \   000113   A3           INC     DPTR
   \   000114   AE82         MOV     R6,DPL
   \   000116   AF83         MOV     R7,DPH
    405                *pBuf++ = HI_UINT16( InClusterList[i] );
   \   000118   A8..         MOV     R0,?V0 + 0
   \   00011A   7900         MOV     R1,#0x0
   \   00011C   E8           MOV     A,R0
   \   00011D   75F002       MOV     B,#0x2
   \   000120   A4           MUL     AB
   \   000121   C8           XCH     A,R0
   \   000122   AAF0         MOV     R2,B
   \   000124   75F000       MOV     B,#0x0
   \   000127   A4           MUL     AB
   \   000128   2A           ADD     A,R2
   \   000129   FA           MOV     R2,A
   \   00012A   75F002       MOV     B,#0x2
   \   00012D   E9           MOV     A,R1
   \   00012E   A4           MUL     AB
   \   00012F   2A           ADD     A,R2
   \   000130   F9           MOV     R1,A
   \   000131   7415         MOV     A,#0x15
   \   000133   12....       LCALL   ?XSTACK_DISP0_8
   \   000136   E0           MOVX    A,@DPTR
   \   000137   28           ADD     A,R0
   \   000138   FA           MOV     R2,A
   \   000139   A3           INC     DPTR
   \   00013A   E0           MOVX    A,@DPTR
   \   00013B   39           ADDC    A,R1
   \   00013C   8A82         MOV     DPL,R2
   \   00013E   F583         MOV     DPH,A
   \   000140   A3           INC     DPTR
   \   000141   E0           MOVX    A,@DPTR
   \   000142   F9           MOV     R1,A
   \   000143   E9           MOV     A,R1
   \   000144   8E82         MOV     DPL,R6
   \   000146   8F83         MOV     DPH,R7
   \   000148   F0           MOVX    @DPTR,A
   \   000149   8E82         MOV     DPL,R6
   \   00014B   8F83         MOV     DPH,R7
   \   00014D   A3           INC     DPTR
   \   00014E   AE82         MOV     R6,DPL
   \   000150   AF83         MOV     R7,DPH
    406              }
   \   000152   05..         INC     ?V0 + 0
   \   000154   02....       LJMP    ??ZDP_MatchDescReq_3 & 0xFFFF
    407            }
    408          
    409            *pBuf++ = NumOutClusters; // Output cluster list
   \                     ??ZDP_MatchDescReq_2:
   \   000157   7417         MOV     A,#0x17
   \   000159   12....       LCALL   ?XSTACK_DISP0_8
   \   00015C   E0           MOVX    A,@DPTR
   \   00015D   8E82         MOV     DPL,R6
   \   00015F   8F83         MOV     DPH,R7
   \   000161   F0           MOVX    @DPTR,A
   \   000162   8E82         MOV     DPL,R6
   \   000164   8F83         MOV     DPH,R7
   \   000166   A3           INC     DPTR
   \   000167   AE82         MOV     R6,DPL
   \   000169   AF83         MOV     R7,DPH
    410            if ( NumOutClusters )
   \   00016B   7417         MOV     A,#0x17
   \   00016D   12....       LCALL   ?XSTACK_DISP0_8
   \   000170   E0           MOVX    A,@DPTR
   \   000171   7003         JNZ     $+5
   \   000173   02....       LJMP    ??ZDP_MatchDescReq_4 & 0xFFFF
    411            {
    412              for (i=0; i<NumOutClusters; ++i)  {
   \   000176   75..00       MOV     ?V0 + 0,#0x0
   \                     ??ZDP_MatchDescReq_5:
   \   000179   7417         MOV     A,#0x17
   \   00017B   12....       LCALL   ?XSTACK_DISP0_8
   \   00017E   E0           MOVX    A,@DPTR
   \   00017F   FA           MOV     R2,A
   \   000180   E5..         MOV     A,?V0 + 0
   \   000182   C3           CLR     C
   \   000183   9A           SUBB    A,R2
   \   000184   5076         JNC     ??ZDP_MatchDescReq_4
    413                *pBuf++ = LO_UINT16( OutClusterList[i] );
   \   000186   A8..         MOV     R0,?V0 + 0
   \   000188   7900         MOV     R1,#0x0
   \   00018A   E8           MOV     A,R0
   \   00018B   75F002       MOV     B,#0x2
   \   00018E   A4           MUL     AB
   \   00018F   C8           XCH     A,R0
   \   000190   AAF0         MOV     R2,B
   \   000192   75F000       MOV     B,#0x0
   \   000195   A4           MUL     AB
   \   000196   2A           ADD     A,R2
   \   000197   FA           MOV     R2,A
   \   000198   75F002       MOV     B,#0x2
   \   00019B   E9           MOV     A,R1
   \   00019C   A4           MUL     AB
   \   00019D   2A           ADD     A,R2
   \   00019E   F9           MOV     R1,A
   \   00019F   7418         MOV     A,#0x18
   \   0001A1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A4   E0           MOVX    A,@DPTR
   \   0001A5   28           ADD     A,R0
   \   0001A6   FA           MOV     R2,A
   \   0001A7   A3           INC     DPTR
   \   0001A8   E0           MOVX    A,@DPTR
   \   0001A9   39           ADDC    A,R1
   \   0001AA   8A82         MOV     DPL,R2
   \   0001AC   F583         MOV     DPH,A
   \   0001AE   E0           MOVX    A,@DPTR
   \   0001AF   8E82         MOV     DPL,R6
   \   0001B1   8F83         MOV     DPH,R7
   \   0001B3   F0           MOVX    @DPTR,A
   \   0001B4   8E82         MOV     DPL,R6
   \   0001B6   8F83         MOV     DPH,R7
   \   0001B8   A3           INC     DPTR
   \   0001B9   AE82         MOV     R6,DPL
   \   0001BB   AF83         MOV     R7,DPH
    414                *pBuf++ = HI_UINT16( OutClusterList[i] );
   \   0001BD   A8..         MOV     R0,?V0 + 0
   \   0001BF   7900         MOV     R1,#0x0
   \   0001C1   E8           MOV     A,R0
   \   0001C2   75F002       MOV     B,#0x2
   \   0001C5   A4           MUL     AB
   \   0001C6   C8           XCH     A,R0
   \   0001C7   AAF0         MOV     R2,B
   \   0001C9   75F000       MOV     B,#0x0
   \   0001CC   A4           MUL     AB
   \   0001CD   2A           ADD     A,R2
   \   0001CE   FA           MOV     R2,A
   \   0001CF   75F002       MOV     B,#0x2
   \   0001D2   E9           MOV     A,R1
   \   0001D3   A4           MUL     AB
   \   0001D4   2A           ADD     A,R2
   \   0001D5   F9           MOV     R1,A
   \   0001D6   7418         MOV     A,#0x18
   \   0001D8   12....       LCALL   ?XSTACK_DISP0_8
   \   0001DB   E0           MOVX    A,@DPTR
   \   0001DC   28           ADD     A,R0
   \   0001DD   FA           MOV     R2,A
   \   0001DE   A3           INC     DPTR
   \   0001DF   E0           MOVX    A,@DPTR
   \   0001E0   39           ADDC    A,R1
   \   0001E1   8A82         MOV     DPL,R2
   \   0001E3   F583         MOV     DPH,A
   \   0001E5   A3           INC     DPTR
   \   0001E6   E0           MOVX    A,@DPTR
   \   0001E7   F9           MOV     R1,A
   \   0001E8   E9           MOV     A,R1
   \   0001E9   8E82         MOV     DPL,R6
   \   0001EB   8F83         MOV     DPH,R7
   \   0001ED   F0           MOVX    @DPTR,A
   \   0001EE   8E82         MOV     DPL,R6
   \   0001F0   8F83         MOV     DPH,R7
   \   0001F2   A3           INC     DPTR
   \   0001F3   AE82         MOV     R6,DPL
   \   0001F5   AF83         MOV     R7,DPH
    415              }
   \   0001F7   05..         INC     ?V0 + 0
   \   0001F9   02....       LJMP    ??ZDP_MatchDescReq_5 & 0xFFFF
    416            }
    417          
    418            return fillAndSend( &ZDP_TransID, dstAddr, Match_Desc_req, len );
   \                     ??ZDP_MatchDescReq_4:
   \   0001FC                ; Setup parameters for call to function fillAndSend
   \   0001FC   75..06       MOV     ?V0 + 4,#0x6
   \   0001FF   75..00       MOV     ?V0 + 5,#0x0
   \   000202   78..         MOV     R0,#?V0 + 4
   \   000204   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000207   A9..         MOV     R1,?V0 + 1
   \   000209   7405         MOV     A,#0x5
   \   00020B   12....       LCALL   ?XSTACK_DISP0_8
   \   00020E   E0           MOVX    A,@DPTR
   \   00020F   FC           MOV     R4,A
   \   000210   A3           INC     DPTR
   \   000211   E0           MOVX    A,@DPTR
   \   000212   FD           MOV     R5,A
   \   000213   7A..         MOV     R2,#(ZDP_TransID & 0xff)
   \   000215   7B..         MOV     R3,#((ZDP_TransID >> 8) & 0xff)
   \   000217   12....       LCALL   ??fillAndSend?relay
   \   00021A   7402         MOV     A,#0x2
   \   00021C   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??ZDP_MatchDescReq_1:
   \   00021F   7405         MOV     A,#0x5
   \   000221   12....       LCALL   ?DEALLOC_XSTACK8
   \   000224   7F06         MOV     R7,#0x6
   \   000226   02....       LJMP    ?BANKED_LEAVE_XDATA
    419          }
    420          #endif // ZDO_MATCH_REQUEST
    421          
    422          #if defined ( ZDO_SIMPLEDESC_REQUEST )
    423          /*********************************************************************
    424           * @fn          ZDP_SimpleDescReq
    425           *
    426           * @brief       This builds and send a NWK_Simple_Desc_req
    427           *              message.  This function sends unicast message to the
    428           *              destination device.
    429           *
    430           * @param       dstAddr - destination address
    431           * @param       nwkAddr - 16 bit address
    432           * @param       epIntf - endpoint/interface
    433           * @param       SecurityEnable - Security Options
    434           *
    435           * @return      afStatus_t
    436           */
    437          afStatus_t ZDP_SimpleDescReq( zAddrType_t *dstAddr, uint16 nwkAddr,
    438                                              byte endPoint, byte SecurityEnable )
    439          
    440          {
    441            ZDP_TmpBuf[0] = LO_UINT16( nwkAddr );
    442            ZDP_TmpBuf[1] = HI_UINT16( nwkAddr );
    443            ZDP_TmpBuf[2] = endPoint;
    444          
    445            return fillAndSend( &ZDP_TransID, dstAddr, Simple_Desc_req, 3 );
    446          }
    447          #endif // ZDO_SIMPLEDESC_REQUEST
    448          
    449          #if defined ( ZDO_USERDESCSET_REQUEST )
    450          /*********************************************************************
    451           * @fn          ZDP_UserDescSet
    452           *
    453           * @brief       This builds and send a User_Desc_set message to set
    454           *              the user descriptor.  This function sends unicast
    455           *              message to the destination device.
    456           *
    457           * @param       dstAddr - destination address
    458           * @param       nwkAddr - 16 bit address
    459           * @param       UserDescriptor - user descriptor
    460           * @param       SecurityEnable - Security Options
    461           *
    462           * @return      afStatus_t
    463           */
    464          afStatus_t ZDP_UserDescSet( zAddrType_t *dstAddr, uint16 nwkAddr,
    465                                    UserDescriptorFormat_t *UserDescriptor,
    466                                    byte SecurityEnable )
    467          {
    468            byte *pBuf = ZDP_TmpBuf;
    469            byte len = (UserDescriptor->len < AF_MAX_USER_DESCRIPTOR_LEN) ?
    470                        UserDescriptor->len : AF_MAX_USER_DESCRIPTOR_LEN;
    471            byte addrLen = 2;
    472          
    473            *pBuf++ = LO_UINT16( nwkAddr );
    474            *pBuf++ = HI_UINT16( nwkAddr );
    475          
    476            *pBuf++ = len;
    477            addrLen = 3;
    478          
    479            pBuf = osal_memcpy( pBuf, UserDescriptor->desc, len );
    480            osal_memset( pBuf, AF_USER_DESCRIPTOR_FILL, AF_MAX_USER_DESCRIPTOR_LEN-len );
    481          
    482            return fillAndSend( &ZDP_TransID, dstAddr, User_Desc_set, (AF_MAX_USER_DESCRIPTOR_LEN + addrLen) );
    483          }
    484          #endif // ZDO_USERDESCSET_REQUEST
    485          
    486          #if defined ( ZDO_SERVERDISC_REQUEST )
    487          /*********************************************************************
    488           * @fn          ZDP_ServerDiscReq
    489           *
    490           * @brief       Build and send a Server_Discovery_req request message.
    491           *
    492           * @param       serverMask - 16-bit bit-mask of server services being sought.
    493           * @param       SecurityEnable - Security Options
    494           *
    495           * @return      afStatus_t
    496           */
    497          afStatus_t ZDP_ServerDiscReq( uint16 serverMask, byte SecurityEnable )
    498          {
    499            byte *pBuf = ZDP_TmpBuf;
    500            zAddrType_t dstAddr;
    501          
    502            dstAddr.addrMode = AddrBroadcast;
    503            dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR_DEVZCZR;
    504          
    505            *pBuf++ = LO_UINT16( serverMask );
    506            *pBuf = HI_UINT16( serverMask );
    507          
    508            FillAndSendTxOptions( &ZDP_TransID, &dstAddr, Server_Discovery_req, 2,
    509                       ((SecurityEnable) ? AF_EN_SECURITY : AF_TX_OPTIONS_NONE) );
    510          }
    511          #endif
    512          
    513          #if defined ( ZDO_ENDDEVICE_ANNCE_REQUEST ) || defined ( ZDO_ENDDEVICE_ANNCE_GENERATE )
    514          /*********************************************************************
    515           * @fn          ZDP_EndDeviceAnnce
    516           *
    517           * @brief       This builds and send an End_Device_Annce
    518           *              message.  This function sends a broadcast message.
    519           *
    520           * @param       nwkAddr - 16 bit address of the device
    521           * @param       IEEEAddr - 64 bit address of the device
    522           * @param       capabilities - device capabilities.  This field is only
    523           *                 sent for v1.1 networks.
    524           * @param       SecurityEnable - Security Options
    525           *
    526           * @return      afStatus_t
    527           */
    528          afStatus_t ZDP_EndDeviceAnnce( uint16 nwkAddr, byte *IEEEAddr,
    529                                        byte capabilities, byte SecurityEnable )
    530          {
    531            zAddrType_t dstAddr;
    532            uint8 len;
    533          
    534            dstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
    535            dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    536          
    537            ZDP_TmpBuf[0] = LO_UINT16( nwkAddr );
    538            ZDP_TmpBuf[1] = HI_UINT16( nwkAddr );
    539            osal_cpyExtAddr( &ZDP_TmpBuf[2], IEEEAddr );
    540            len = 2 + Z_EXTADDR_LEN;
    541          
    542            ZDP_TmpBuf[10] = capabilities;
    543            len++;
    544          
    545            return fillAndSend( &ZDP_TransID, &dstAddr, End_Device_annce, len );
    546          }
    547          #endif // ZDO_ENDDEVICE_ANNCE_REQUEST
    548          
    549          /*********************************************************************
    550           * Address Responses
    551           */
    552          
    553          /*********************************************************************
    554           * @fn      zdpProcessAddrReq
    555           *
    556           * @brief   Process an incoming NWK_addr_req or IEEE_addr_req message and then
    557           *          build and send a corresponding NWK_addr_rsp or IEEE_addr_rsp msg.
    558           *
    559           * @param   inMsg - incoming message
    560           *
    561           * @return  none
    562           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    563          void zdpProcessAddrReq( zdoIncomingMsg_t *inMsg )
   \                     zdpProcessAddrReq:
    564          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 2,R2
   \   00000C   8B..         MOV     ?V0 + 3,R3
    565            uint8 reqType;
    566            uint16 aoi = INVALID_NODE_ADDR;
   \   00000E   7EFE         MOV     R6,#-0x2
   \   000010   7FFF         MOV     R7,#-0x1
    567            uint8 *ieee = NULL;
   \   000012   75..00       MOV     ?V0 + 6,#0x0
   \   000015   75..00       MOV     ?V0 + 7,#0x0
    568          
    569            reqType = inMsg->asdu[(inMsg->clusterID == NWK_addr_req) ? Z_EXTADDR_LEN : sizeof( uint16 ) ];
   \   000018   E5..         MOV     A,?V0 + 2
   \   00001A   240C         ADD     A,#0xc
   \   00001C   F582         MOV     DPL,A
   \   00001E   E5..         MOV     A,?V0 + 3
   \   000020   3400         ADDC    A,#0x0
   \   000022   F583         MOV     DPH,A
   \   000024   E0           MOVX    A,@DPTR
   \   000025   6400         XRL     A,#0x0
   \   000027   7004         JNZ     ??zdpProcessAddrReq_0
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   6400         XRL     A,#0x0
   \                     ??zdpProcessAddrReq_0:
   \   00002D   7006         JNZ     ??zdpProcessAddrReq_1
   \   00002F   7808         MOV     R0,#0x8
   \   000031   7900         MOV     R1,#0x0
   \   000033   8004         SJMP    ??zdpProcessAddrReq_2
   \                     ??zdpProcessAddrReq_1:
   \   000035   7802         MOV     R0,#0x2
   \   000037   7900         MOV     R1,#0x0
   \                     ??zdpProcessAddrReq_2:
   \   000039   E5..         MOV     A,?V0 + 2
   \   00003B   2411         ADD     A,#0x11
   \   00003D   F582         MOV     DPL,A
   \   00003F   E5..         MOV     A,?V0 + 3
   \   000041   3400         ADDC    A,#0x0
   \   000043   F583         MOV     DPH,A
   \   000045   E0           MOVX    A,@DPTR
   \   000046   28           ADD     A,R0
   \   000047   FA           MOV     R2,A
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   39           ADDC    A,R1
   \   00004B   8A82         MOV     DPL,R2
   \   00004D   F583         MOV     DPH,A
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   85..82       MOV     DPL,?XSP + 0
   \   000053   85..83       MOV     DPH,?XSP + 1
   \   000056   F0           MOVX    @DPTR,A
    570            
    571            if ( inMsg->clusterID == NWK_addr_req )
   \   000057   E5..         MOV     A,?V0 + 2
   \   000059   240C         ADD     A,#0xc
   \   00005B   F582         MOV     DPL,A
   \   00005D   E5..         MOV     A,?V0 + 3
   \   00005F   3400         ADDC    A,#0x0
   \   000061   F583         MOV     DPH,A
   \   000063   E0           MOVX    A,@DPTR
   \   000064   6400         XRL     A,#0x0
   \   000066   7004         JNZ     ??zdpProcessAddrReq_3
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   6400         XRL     A,#0x0
   \                     ??zdpProcessAddrReq_3:
   \   00006C   702D         JNZ     ??zdpProcessAddrReq_4
    572            {
    573              ieee = inMsg->asdu;
   \   00006E   E5..         MOV     A,?V0 + 2
   \   000070   2411         ADD     A,#0x11
   \   000072   F582         MOV     DPL,A
   \   000074   E5..         MOV     A,?V0 + 3
   \   000076   3400         ADDC    A,#0x0
   \   000078   F583         MOV     DPH,A
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   F8           MOV     R0,A
   \   00007C   A3           INC     DPTR
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   F9           MOV     R1,A
   \   00007F   88..         MOV     ?V0 + 6,R0
   \   000081   89..         MOV     ?V0 + 7,R1
    574          
    575              if ( osal_ExtAddrEqual( saveExtAddr, ieee ) )
   \   000083                ; Setup parameters for call to function osal_ExtAddrEqual
   \   000083   AC..         MOV     R4,?V0 + 6
   \   000085   AD..         MOV     R5,?V0 + 7
   \   000087   7A..         MOV     R2,#(saveExtAddr & 0xff)
   \   000089   7B..         MOV     R3,#((saveExtAddr >> 8) & 0xff)
   \   00008B   12....       LCALL   ??osal_ExtAddrEqual?relay
   \   00008E   E9           MOV     A,R1
   \   00008F   6058         JZ      ??zdpProcessAddrReq_5
    576              {
    577                aoi = ZDAppNwkAddr.addr.shortAddr;
   \   000091   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000094   E0           MOVX    A,@DPTR
   \   000095   FE           MOV     R6,A
   \   000096   A3           INC     DPTR
   \   000097   E0           MOVX    A,@DPTR
   \   000098   FF           MOV     R7,A
   \   000099   804E         SJMP    ??zdpProcessAddrReq_5
    578              }
    579              /*
    580              else if ( reqType == ZDP_ADDR_REQTYPE_MEMBERSHIP )
    581              {
    582                //ggg - what to do?
    583              }
    584              */
    585            }
    586            else  // if ( inMsg->clusterID == IEEE_addr_req )
    587            {
    588              aoi = BUILD_UINT16( inMsg->asdu[0], inMsg->asdu[1] );
   \                     ??zdpProcessAddrReq_4:
   \   00009B   E5..         MOV     A,?V0 + 2
   \   00009D   2411         ADD     A,#0x11
   \   00009F   F582         MOV     DPL,A
   \   0000A1   E5..         MOV     A,?V0 + 3
   \   0000A3   3400         ADDC    A,#0x0
   \   0000A5   F583         MOV     DPH,A
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   F8           MOV     R0,A
   \   0000A9   A3           INC     DPTR
   \   0000AA   E0           MOVX    A,@DPTR
   \   0000AB   F583         MOV     DPH,A
   \   0000AD   8882         MOV     DPL,R0
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   FA           MOV     R2,A
   \   0000B1   7B00         MOV     R3,#0x0
   \   0000B3   E5..         MOV     A,?V0 + 2
   \   0000B5   2411         ADD     A,#0x11
   \   0000B7   F582         MOV     DPL,A
   \   0000B9   E5..         MOV     A,?V0 + 3
   \   0000BB   3400         ADDC    A,#0x0
   \   0000BD   F583         MOV     DPH,A
   \   0000BF   E0           MOVX    A,@DPTR
   \   0000C0   F8           MOV     R0,A
   \   0000C1   A3           INC     DPTR
   \   0000C2   E0           MOVX    A,@DPTR
   \   0000C3   F583         MOV     DPH,A
   \   0000C5   8882         MOV     DPL,R0
   \   0000C7   A3           INC     DPTR
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   F8           MOV     R0,A
   \   0000CA   E4           CLR     A
   \   0000CB   C8           XCH     A,R0
   \   0000CC   F9           MOV     R1,A
   \   0000CD   E8           MOV     A,R0
   \   0000CE   2A           ADD     A,R2
   \   0000CF   F8           MOV     R0,A
   \   0000D0   E9           MOV     A,R1
   \   0000D1   3B           ADDC    A,R3
   \   0000D2   F9           MOV     R1,A
   \   0000D3   E8           MOV     A,R0
   \   0000D4   FE           MOV     R6,A
   \   0000D5   E9           MOV     A,R1
   \   0000D6   FF           MOV     R7,A
    589          
    590              if ( aoi == ZDAppNwkAddr.addr.shortAddr )
   \   0000D7   90....       MOV     DPTR,#ZDAppNwkAddr
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   6E           XRL     A,R6
   \   0000DC   7003         JNZ     ??zdpProcessAddrReq_6
   \   0000DE   A3           INC     DPTR
   \   0000DF   E0           MOVX    A,@DPTR
   \   0000E0   6F           XRL     A,R7
   \                     ??zdpProcessAddrReq_6:
   \   0000E1   7006         JNZ     ??zdpProcessAddrReq_5
    591              {
    592                ieee = saveExtAddr;
   \   0000E3   75....       MOV     ?V0 + 6,#(saveExtAddr & 0xff)
   \   0000E6   75....       MOV     ?V0 + 7,#((saveExtAddr >> 8) & 0xff)
    593              }
    594            }
    595          
    596            if ( (aoi != INVALID_NODE_ADDR) && (ieee != NULL) )
   \                     ??zdpProcessAddrReq_5:
   \   0000E9   74FE         MOV     A,#-0x2
   \   0000EB   6E           XRL     A,R6
   \   0000EC   7003         JNZ     ??zdpProcessAddrReq_7
   \   0000EE   74FF         MOV     A,#-0x1
   \   0000F0   6F           XRL     A,R7
   \                     ??zdpProcessAddrReq_7:
   \   0000F1   7003         JNZ     $+5
   \   0000F3   02....       LJMP    ??zdpProcessAddrReq_8 & 0xFFFF
   \   0000F6   E5..         MOV     A,?V0 + 6
   \   0000F8   6400         XRL     A,#0x0
   \   0000FA   7004         JNZ     ??zdpProcessAddrReq_9
   \   0000FC   E5..         MOV     A,?V0 + 7
   \   0000FE   6400         XRL     A,#0x0
   \                     ??zdpProcessAddrReq_9:
   \   000100   7003         JNZ     $+5
   \   000102   02....       LJMP    ??zdpProcessAddrReq_8 & 0xFFFF
    597            {
    598              byte *pBuf = ZDP_TmpBuf;
   \   000105   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000108   E0           MOVX    A,@DPTR
   \   000109   F8           MOV     R0,A
   \   00010A   A3           INC     DPTR
   \   00010B   E0           MOVX    A,@DPTR
   \   00010C   F9           MOV     R1,A
   \   00010D   88..         MOV     ?V0 + 0,R0
   \   00010F   89..         MOV     ?V0 + 1,R1
    599              // Status + IEEE-Addr + Nwk-Addr.
    600              byte len = 1 + Z_EXTADDR_LEN + 2;
   \   000111   740B         MOV     A,#0xb
   \   000113   C0E0         PUSH    A
   \   000115   7401         MOV     A,#0x1
   \   000117   12....       LCALL   ?XSTACK_DISP0_8
   \   00011A   D0E0         POP     A
   \   00011C   F0           MOVX    @DPTR,A
    601          
    602              byte stat = ((reqType == ZDP_ADDR_REQTYPE_SINGLE) 
    603                      || (reqType == ZDP_ADDR_REQTYPE_EXTENDED) 
    604                    || ((reqType == ZDP_ADDR_REQTYPE_MEMBERSHIP) 
    605                   && (inMsg->clusterID == NWK_addr_req)) ) ? ZDP_SUCCESS : ZDP_INVALID_REQTYPE;
   \   00011D   85..82       MOV     DPL,?XSP + 0
   \   000120   85..83       MOV     DPH,?XSP + 1
   \   000123   E0           MOVX    A,@DPTR
   \   000124   602D         JZ      ??zdpProcessAddrReq_10
   \   000126   85..82       MOV     DPL,?XSP + 0
   \   000129   85..83       MOV     DPH,?XSP + 1
   \   00012C   E0           MOVX    A,@DPTR
   \   00012D   6401         XRL     A,#0x1
   \   00012F   6022         JZ      ??zdpProcessAddrReq_10
   \   000131   85..82       MOV     DPL,?XSP + 0
   \   000134   85..83       MOV     DPH,?XSP + 1
   \   000137   E0           MOVX    A,@DPTR
   \   000138   6402         XRL     A,#0x2
   \   00013A   701B         JNZ     ??zdpProcessAddrReq_11
   \   00013C   E5..         MOV     A,?V0 + 2
   \   00013E   240C         ADD     A,#0xc
   \   000140   F582         MOV     DPL,A
   \   000142   E5..         MOV     A,?V0 + 3
   \   000144   3400         ADDC    A,#0x0
   \   000146   F583         MOV     DPH,A
   \   000148   E0           MOVX    A,@DPTR
   \   000149   6400         XRL     A,#0x0
   \   00014B   7004         JNZ     ??zdpProcessAddrReq_12
   \   00014D   A3           INC     DPTR
   \   00014E   E0           MOVX    A,@DPTR
   \   00014F   6400         XRL     A,#0x0
   \                     ??zdpProcessAddrReq_12:
   \   000151   7004         JNZ     ??zdpProcessAddrReq_11
   \                     ??zdpProcessAddrReq_10:
   \   000153   7A00         MOV     R2,#0x0
   \   000155   8002         SJMP    ??zdpProcessAddrReq_13
   \                     ??zdpProcessAddrReq_11:
   \   000157   7A80         MOV     R2,#-0x80
   \                     ??zdpProcessAddrReq_13:
   \   000159   EA           MOV     A,R2
   \   00015A   C0E0         PUSH    A
   \   00015C   7402         MOV     A,#0x2
   \   00015E   12....       LCALL   ?XSTACK_DISP0_8
   \   000161   D0E0         POP     A
   \   000163   F0           MOVX    @DPTR,A
    606          
    607              *pBuf++ = stat;
   \   000164   7402         MOV     A,#0x2
   \   000166   12....       LCALL   ?XSTACK_DISP0_8
   \   000169   E0           MOVX    A,@DPTR
   \   00016A   85..82       MOV     DPL,?V0 + 0
   \   00016D   85..83       MOV     DPH,?V0 + 1
   \   000170   F0           MOVX    @DPTR,A
   \   000171   85..82       MOV     DPL,?V0 + 0
   \   000174   85..83       MOV     DPH,?V0 + 1
   \   000177   A3           INC     DPTR
   \   000178   8582..       MOV     ?V0 + 0,DPL
   \   00017B   8583..       MOV     ?V0 + 1,DPH
    608          
    609              pBuf = osal_cpyExtAddr( pBuf, ieee );
   \   00017E                ; Setup parameters for call to function osal_cpyExtAddr
   \   00017E   AC..         MOV     R4,?V0 + 6
   \   000180   AD..         MOV     R5,?V0 + 7
   \   000182   AA..         MOV     R2,?V0 + 0
   \   000184   AB..         MOV     R3,?V0 + 1
   \   000186   12....       LCALL   ??osal_cpyExtAddr?relay
   \   000189   8A..         MOV     ?V0 + 4,R2
   \   00018B   8B..         MOV     ?V0 + 5,R3
   \   00018D   85....       MOV     ?V0 + 0,?V0 + 4
   \   000190   85....       MOV     ?V0 + 1,?V0 + 5
    610          
    611              *pBuf++ = LO_UINT16( aoi );
   \   000193   EE           MOV     A,R6
   \   000194   85..82       MOV     DPL,?V0 + 0
   \   000197   85..83       MOV     DPH,?V0 + 1
   \   00019A   F0           MOVX    @DPTR,A
   \   00019B   85..82       MOV     DPL,?V0 + 0
   \   00019E   85..83       MOV     DPH,?V0 + 1
   \   0001A1   A3           INC     DPTR
   \   0001A2   8582..       MOV     ?V0 + 0,DPL
   \   0001A5   8583..       MOV     ?V0 + 1,DPH
    612              *pBuf++ = HI_UINT16( aoi );
   \   0001A8   EF           MOV     A,R7
   \   0001A9   F9           MOV     R1,A
   \   0001AA   E9           MOV     A,R1
   \   0001AB   85..82       MOV     DPL,?V0 + 0
   \   0001AE   85..83       MOV     DPH,?V0 + 1
   \   0001B1   F0           MOVX    @DPTR,A
    613          
    614          #if defined( RTR_NWK )
    615              if ( (reqType == ZDP_ADDR_REQTYPE_EXTENDED) &&
    616                   (aoi == ZDAppNwkAddr.addr.shortAddr) )
    617              {
    618                byte cnt = 0;
    619                uint16 *list = AssocMakeList( &cnt );
    620          
    621                if ( list != NULL )
    622                {
    623                  byte idx = inMsg->asdu[(((inMsg->clusterID == NWK_addr_req) ? Z_EXTADDR_LEN : sizeof( uint16 )) + 1)];
    624                  uint16 *pList = list + idx;
    625          
    626                  // NumAssocDev field is only present on success.
    627                  if ( cnt > idx )
    628                  {
    629                    cnt -= idx;
    630                    len += (cnt * sizeof( uint16 ));
    631                  }
    632                  else
    633                  {
    634                    cnt = 0;
    635                  }
    636                  *pBuf++ = cnt;
    637                  len++;
    638                  
    639                  // StartIndex field is only present if NumAssocDev field is non-zero.
    640                  *pBuf++ = idx;
    641                  len++;
    642          
    643                  while ( cnt != 0 )
    644                  {
    645                    *pBuf++ = LO_UINT16( *pList );
    646                    *pBuf++ = HI_UINT16( *pList );
    647                    pList++;
    648                    cnt--;
    649                  }
    650          
    651                  osal_mem_free( (uint8 *)list );
    652                }
    653                else
    654                {
    655                  // NumAssocDev field is only present on success.
    656                  *pBuf++ = 0;
    657                  len++;
    658                }
    659              }
    660          
    661          #endif
    662          
    663              ZDP_TxOptions = AF_MSG_ACK_REQUEST;
   \   0001B2   7410         MOV     A,#0x10
   \   0001B4   90....       MOV     DPTR,#ZDP_TxOptions
   \   0001B7   F0           MOVX    @DPTR,A
    664              fillAndSend( &(inMsg->TransSeq), &(inMsg->srcAddr), 
    665                          (cId_t)(inMsg->clusterID | ZDO_RESPONSE_BIT), len );
   \   0001B8                ; Setup parameters for call to function fillAndSend
   \   0001B8   E5..         MOV     A,?V0 + 2
   \   0001BA   240C         ADD     A,#0xc
   \   0001BC   F582         MOV     DPL,A
   \   0001BE   E5..         MOV     A,?V0 + 3
   \   0001C0   3400         ADDC    A,#0x0
   \   0001C2   F583         MOV     DPH,A
   \   0001C4   E0           MOVX    A,@DPTR
   \   0001C5   4400         ORL     A,#0x0
   \   0001C7   F5..         MOV     ?V0 + 4,A
   \   0001C9   A3           INC     DPTR
   \   0001CA   E0           MOVX    A,@DPTR
   \   0001CB   4480         ORL     A,#0x80
   \   0001CD   F5..         MOV     ?V0 + 5,A
   \   0001CF   78..         MOV     R0,#?V0 + 4
   \   0001D1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001D4   7403         MOV     A,#0x3
   \   0001D6   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D9   E0           MOVX    A,@DPTR
   \   0001DA   F9           MOV     R1,A
   \   0001DB   E5..         MOV     A,?V0 + 2
   \   0001DD   2402         ADD     A,#0x2
   \   0001DF   FC           MOV     R4,A
   \   0001E0   E5..         MOV     A,?V0 + 3
   \   0001E2   3400         ADDC    A,#0x0
   \   0001E4   FD           MOV     R5,A
   \   0001E5   E5..         MOV     A,?V0 + 2
   \   0001E7   240F         ADD     A,#0xf
   \   0001E9   FA           MOV     R2,A
   \   0001EA   E5..         MOV     A,?V0 + 3
   \   0001EC   3400         ADDC    A,#0x0
   \   0001EE   FB           MOV     R3,A
   \   0001EF   12....       LCALL   ??fillAndSend?relay
   \   0001F2   7402         MOV     A,#0x2
   \   0001F4   12....       LCALL   ?DEALLOC_XSTACK8
    666              ZDP_TxOptions = AF_TX_OPTIONS_NONE;
   \   0001F7   7400         MOV     A,#0x0
   \   0001F9   90....       MOV     DPTR,#ZDP_TxOptions
   \   0001FC   F0           MOVX    @DPTR,A
    667            }
    668          }
   \                     ??zdpProcessAddrReq_8:
   \   0001FD   7403         MOV     A,#0x3
   \   0001FF   12....       LCALL   ?DEALLOC_XSTACK8
   \   000202   7F08         MOV     R7,#0x8
   \   000204   02....       LJMP    ?BANKED_LEAVE_XDATA
    669          
    670          /*********************************************************************
    671           * @fn          ZDP_NodeDescMsg
    672           *
    673           * @brief       Builds and sends a Node Descriptor message, unicast to the
    674           *              specified device.
    675           *
    676           * @param       inMsg - incoming message
    677           * @param       nwkAddr - 16 bit network address for device
    678           * @param       pNodeDesc - pointer to the node descriptor
    679           *
    680           * @return      afStatus_t
    681           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    682          afStatus_t ZDP_NodeDescMsg( zdoIncomingMsg_t *inMsg, 
   \                     ZDP_NodeDescMsg:
    683                                     uint16 nwkAddr, NodeDescriptorFormat_t *pNodeDesc )
    684          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   \   000015   8C..         MOV     ?V0 + 2,R4
   \   000017   8D..         MOV     ?V0 + 3,R5
   \   000019   7411         MOV     A,#0x11
   \   00001B   12....       LCALL   ?XSTACK_DISP0_8
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F5..         MOV     ?V0 + 0,A
   \   000021   A3           INC     DPTR
   \   000022   E0           MOVX    A,@DPTR
   \   000023   F5..         MOV     ?V0 + 1,A
    685            byte *pBuf = ZDP_TmpBuf;
   \   000025   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F8           MOV     R0,A
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   E8           MOV     A,R0
   \   00002E   FE           MOV     R6,A
   \   00002F   E9           MOV     A,R1
   \   000030   FF           MOV     R7,A
    686            byte len;
    687          
    688            len = 1 + 2 + 10;  // Status + nwkAddr + Node descriptor
   \   000031   75..0D       MOV     ?V0 + 6,#0xd
    689          
    690            *pBuf++ = ZDP_SUCCESS;
   \   000034   7400         MOV     A,#0x0
   \   000036   8E82         MOV     DPL,R6
   \   000038   8F83         MOV     DPH,R7
   \   00003A   F0           MOVX    @DPTR,A
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   A3           INC     DPTR
   \   000040   AE82         MOV     R6,DPL
   \   000042   AF83         MOV     R7,DPH
    691          
    692            *pBuf++ = LO_UINT16( nwkAddr );
   \   000044   8E82         MOV     DPL,R6
   \   000046   8F83         MOV     DPH,R7
   \   000048   E5..         MOV     A,?V0 + 2
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   8E82         MOV     DPL,R6
   \   00004D   8F83         MOV     DPH,R7
   \   00004F   A3           INC     DPTR
   \   000050   AE82         MOV     R6,DPL
   \   000052   AF83         MOV     R7,DPH
    693            *pBuf++ = HI_UINT16( nwkAddr );
   \   000054   8E82         MOV     DPL,R6
   \   000056   8F83         MOV     DPH,R7
   \   000058   E5..         MOV     A,?V0 + 3
   \   00005A   F0           MOVX    @DPTR,A
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   AE82         MOV     R6,DPL
   \   000062   AF83         MOV     R7,DPH
    694          
    695            *pBuf++ = (byte)((pNodeDesc->ComplexDescAvail << 3) |
    696                               (pNodeDesc->UserDescAvail << 4) |
    697                               (pNodeDesc->LogicalType & 0x07));
   \   000064   85..82       MOV     DPL,?V0 + 0
   \   000067   85..83       MOV     DPH,?V0 + 1
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   5407         ANL     A,#0x7
   \   00006D   C0E0         PUSH    A
   \   00006F   85..82       MOV     DPL,?V0 + 0
   \   000072   85..83       MOV     DPH,?V0 + 1
   \   000075   E0           MOVX    A,@DPTR
   \   000076   A2E4         MOV     C,0xE0 /* A   */.4
   \   000078   E4           CLR     A
   \   000079   92E0         MOV     0xE0 /* A   */.0,C
   \   00007B   C4           SWAP    A
   \   00007C   54F0         ANL     A,#0xf0
   \   00007E   C0E0         PUSH    A
   \   000080   85..82       MOV     DPL,?V0 + 0
   \   000083   85..83       MOV     DPH,?V0 + 1
   \   000086   E0           MOVX    A,@DPTR
   \   000087   A2E3         MOV     C,0xE0 /* A   */.3
   \   000089   E4           CLR     A
   \   00008A   92E0         MOV     0xE0 /* A   */.0,C
   \   00008C   33           RLC     A
   \   00008D   33           RLC     A
   \   00008E   33           RLC     A
   \   00008F   54F8         ANL     A,#0xf8
   \   000091   FA           MOV     R2,A
   \   000092   D0E0         POP     A
   \   000094   4A           ORL     A,R2
   \   000095   FA           MOV     R2,A
   \   000096   D0E0         POP     A
   \   000098   4A           ORL     A,R2
   \   000099   8E82         MOV     DPL,R6
   \   00009B   8F83         MOV     DPH,R7
   \   00009D   F0           MOVX    @DPTR,A
   \   00009E   8E82         MOV     DPL,R6
   \   0000A0   8F83         MOV     DPH,R7
   \   0000A2   A3           INC     DPTR
   \   0000A3   AE82         MOV     R6,DPL
   \   0000A5   AF83         MOV     R7,DPH
    698          
    699            *pBuf++ = (byte)((pNodeDesc->FrequencyBand << 3) | (pNodeDesc->APSFlags & 0x07));
   \   0000A7   85..82       MOV     DPL,?V0 + 0
   \   0000AA   85..83       MOV     DPH,?V0 + 1
   \   0000AD   A3           INC     DPTR
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   5407         ANL     A,#0x7
   \   0000B1   C0E0         PUSH    A
   \   0000B3   85..82       MOV     DPL,?V0 + 0
   \   0000B6   85..83       MOV     DPH,?V0 + 1
   \   0000B9   A3           INC     DPTR
   \   0000BA   E0           MOVX    A,@DPTR
   \   0000BB   13           RRC     A
   \   0000BC   13           RRC     A
   \   0000BD   13           RRC     A
   \   0000BE   541F         ANL     A,#0x1f
   \   0000C0   33           RLC     A
   \   0000C1   33           RLC     A
   \   0000C2   33           RLC     A
   \   0000C3   54F8         ANL     A,#0xf8
   \   0000C5   FA           MOV     R2,A
   \   0000C6   D0E0         POP     A
   \   0000C8   4A           ORL     A,R2
   \   0000C9   8E82         MOV     DPL,R6
   \   0000CB   8F83         MOV     DPH,R7
   \   0000CD   F0           MOVX    @DPTR,A
   \   0000CE   8E82         MOV     DPL,R6
   \   0000D0   8F83         MOV     DPH,R7
   \   0000D2   A3           INC     DPTR
   \   0000D3   AE82         MOV     R6,DPL
   \   0000D5   AF83         MOV     R7,DPH
    700            *pBuf++ = pNodeDesc->CapabilityFlags;
   \   0000D7   85..82       MOV     DPL,?V0 + 0
   \   0000DA   85..83       MOV     DPH,?V0 + 1
   \   0000DD   A3           INC     DPTR
   \   0000DE   A3           INC     DPTR
   \   0000DF   E0           MOVX    A,@DPTR
   \   0000E0   8E82         MOV     DPL,R6
   \   0000E2   8F83         MOV     DPH,R7
   \   0000E4   F0           MOVX    @DPTR,A
   \   0000E5   8E82         MOV     DPL,R6
   \   0000E7   8F83         MOV     DPH,R7
   \   0000E9   A3           INC     DPTR
   \   0000EA   AE82         MOV     R6,DPL
   \   0000EC   AF83         MOV     R7,DPH
    701            *pBuf++ = pNodeDesc->ManufacturerCode[0];
   \   0000EE   85..82       MOV     DPL,?V0 + 0
   \   0000F1   85..83       MOV     DPH,?V0 + 1
   \   0000F4   A3           INC     DPTR
   \   0000F5   A3           INC     DPTR
   \   0000F6   A3           INC     DPTR
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   8E82         MOV     DPL,R6
   \   0000FA   8F83         MOV     DPH,R7
   \   0000FC   F0           MOVX    @DPTR,A
   \   0000FD   8E82         MOV     DPL,R6
   \   0000FF   8F83         MOV     DPH,R7
   \   000101   A3           INC     DPTR
   \   000102   AE82         MOV     R6,DPL
   \   000104   AF83         MOV     R7,DPH
    702            *pBuf++ = pNodeDesc->ManufacturerCode[1];
   \   000106   85..82       MOV     DPL,?V0 + 0
   \   000109   85..83       MOV     DPH,?V0 + 1
   \   00010C   A3           INC     DPTR
   \   00010D   A3           INC     DPTR
   \   00010E   A3           INC     DPTR
   \   00010F   A3           INC     DPTR
   \   000110   E0           MOVX    A,@DPTR
   \   000111   8E82         MOV     DPL,R6
   \   000113   8F83         MOV     DPH,R7
   \   000115   F0           MOVX    @DPTR,A
   \   000116   8E82         MOV     DPL,R6
   \   000118   8F83         MOV     DPH,R7
   \   00011A   A3           INC     DPTR
   \   00011B   AE82         MOV     R6,DPL
   \   00011D   AF83         MOV     R7,DPH
    703            *pBuf++ = pNodeDesc->MaxBufferSize;
   \   00011F   85..82       MOV     DPL,?V0 + 0
   \   000122   85..83       MOV     DPH,?V0 + 1
   \   000125   A3           INC     DPTR
   \   000126   A3           INC     DPTR
   \   000127   A3           INC     DPTR
   \   000128   A3           INC     DPTR
   \   000129   A3           INC     DPTR
   \   00012A   E0           MOVX    A,@DPTR
   \   00012B   8E82         MOV     DPL,R6
   \   00012D   8F83         MOV     DPH,R7
   \   00012F   F0           MOVX    @DPTR,A
   \   000130   8E82         MOV     DPL,R6
   \   000132   8F83         MOV     DPH,R7
   \   000134   A3           INC     DPTR
   \   000135   AE82         MOV     R6,DPL
   \   000137   AF83         MOV     R7,DPH
    704            *pBuf++ = pNodeDesc->MaxTransferSize[0];
   \   000139   85..82       MOV     DPL,?V0 + 0
   \   00013C   85..83       MOV     DPH,?V0 + 1
   \   00013F   A3           INC     DPTR
   \   000140   A3           INC     DPTR
   \   000141   A3           INC     DPTR
   \   000142   A3           INC     DPTR
   \   000143   A3           INC     DPTR
   \   000144   A3           INC     DPTR
   \   000145   E0           MOVX    A,@DPTR
   \   000146   8E82         MOV     DPL,R6
   \   000148   8F83         MOV     DPH,R7
   \   00014A   F0           MOVX    @DPTR,A
   \   00014B   8E82         MOV     DPL,R6
   \   00014D   8F83         MOV     DPH,R7
   \   00014F   A3           INC     DPTR
   \   000150   AE82         MOV     R6,DPL
   \   000152   AF83         MOV     R7,DPH
    705            *pBuf++ = pNodeDesc->MaxTransferSize[1];
   \   000154   85..82       MOV     DPL,?V0 + 0
   \   000157   85..83       MOV     DPH,?V0 + 1
   \   00015A   A3           INC     DPTR
   \   00015B   A3           INC     DPTR
   \   00015C   A3           INC     DPTR
   \   00015D   A3           INC     DPTR
   \   00015E   A3           INC     DPTR
   \   00015F   A3           INC     DPTR
   \   000160   A3           INC     DPTR
   \   000161   E0           MOVX    A,@DPTR
   \   000162   8E82         MOV     DPL,R6
   \   000164   8F83         MOV     DPH,R7
   \   000166   F0           MOVX    @DPTR,A
   \   000167   8E82         MOV     DPL,R6
   \   000169   8F83         MOV     DPH,R7
   \   00016B   A3           INC     DPTR
   \   00016C   AE82         MOV     R6,DPL
   \   00016E   AF83         MOV     R7,DPH
    706          
    707            *pBuf++ = LO_UINT16( pNodeDesc->ServerMask );
   \   000170   85..82       MOV     DPL,?V0 + 0
   \   000173   85..83       MOV     DPH,?V0 + 1
   \   000176   A3           INC     DPTR
   \   000177   A3           INC     DPTR
   \   000178   A3           INC     DPTR
   \   000179   A3           INC     DPTR
   \   00017A   A3           INC     DPTR
   \   00017B   A3           INC     DPTR
   \   00017C   A3           INC     DPTR
   \   00017D   A3           INC     DPTR
   \   00017E   E0           MOVX    A,@DPTR
   \   00017F   8E82         MOV     DPL,R6
   \   000181   8F83         MOV     DPH,R7
   \   000183   F0           MOVX    @DPTR,A
   \   000184   8E82         MOV     DPL,R6
   \   000186   8F83         MOV     DPH,R7
   \   000188   A3           INC     DPTR
   \   000189   AE82         MOV     R6,DPL
   \   00018B   AF83         MOV     R7,DPH
    708            *pBuf++ = HI_UINT16( pNodeDesc->ServerMask );
   \   00018D   85..82       MOV     DPL,?V0 + 0
   \   000190   85..83       MOV     DPH,?V0 + 1
   \   000193   A3           INC     DPTR
   \   000194   A3           INC     DPTR
   \   000195   A3           INC     DPTR
   \   000196   A3           INC     DPTR
   \   000197   A3           INC     DPTR
   \   000198   A3           INC     DPTR
   \   000199   A3           INC     DPTR
   \   00019A   A3           INC     DPTR
   \   00019B   A3           INC     DPTR
   \   00019C   E0           MOVX    A,@DPTR
   \   00019D   F9           MOV     R1,A
   \   00019E   E9           MOV     A,R1
   \   00019F   8E82         MOV     DPL,R6
   \   0001A1   8F83         MOV     DPH,R7
   \   0001A3   F0           MOVX    @DPTR,A
    709          
    710            return fillAndSend( &(inMsg->TransSeq), &(inMsg->srcAddr), Node_Desc_rsp, len );
   \   0001A4                ; Setup parameters for call to function fillAndSend
   \   0001A4   75..02       MOV     ?V0 + 4,#0x2
   \   0001A7   75..80       MOV     ?V0 + 5,#-0x80
   \   0001AA   78..         MOV     R0,#?V0 + 4
   \   0001AC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001AF   A9..         MOV     R1,?V0 + 6
   \   0001B1   7402         MOV     A,#0x2
   \   0001B3   12....       LCALL   ?XSTACK_DISP0_8
   \   0001B6   E0           MOVX    A,@DPTR
   \   0001B7   2402         ADD     A,#0x2
   \   0001B9   FC           MOV     R4,A
   \   0001BA   A3           INC     DPTR
   \   0001BB   E0           MOVX    A,@DPTR
   \   0001BC   3400         ADDC    A,#0x0
   \   0001BE   FD           MOV     R5,A
   \   0001BF   7402         MOV     A,#0x2
   \   0001C1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C4   E0           MOVX    A,@DPTR
   \   0001C5   240F         ADD     A,#0xf
   \   0001C7   FA           MOV     R2,A
   \   0001C8   A3           INC     DPTR
   \   0001C9   E0           MOVX    A,@DPTR
   \   0001CA   3400         ADDC    A,#0x0
   \   0001CC   FB           MOV     R3,A
   \   0001CD   12....       LCALL   ??fillAndSend?relay
   \   0001D0   7402         MOV     A,#0x2
   \   0001D2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001D5   7402         MOV     A,#0x2
   \   0001D7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001DA   7F07         MOV     R7,#0x7
   \   0001DC   02....       LJMP    ?BANKED_LEAVE_XDATA
    711          }
    712          
    713          /*********************************************************************
    714           * @fn          ZDP_PowerDescMsg
    715           *
    716           * @brief       Builds and sends a Power Descriptor message, unicast to the
    717           *              specified device.
    718           *
    719           * @param       inMsg - incoming message (request)
    720           * @param       nwkAddr - 16 bit network address for device
    721           * @param       pPowerDesc - pointer to the node descriptor
    722           *
    723           * @return      afStatus_t
    724           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    725          afStatus_t ZDP_PowerDescMsg( zdoIncomingMsg_t *inMsg,
   \                     ZDP_PowerDescMsg:
    726                               uint16 nwkAddr, NodePowerDescriptorFormat_t *pPowerDesc )
    727          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   \   000015   8C..         MOV     ?V0 + 0,R4
   \   000017   8D..         MOV     ?V0 + 1,R5
   \   000019   7412         MOV     A,#0x12
   \   00001B   12....       LCALL   ?XSTACK_DISP0_8
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F5..         MOV     ?V0 + 6,A
   \   000021   A3           INC     DPTR
   \   000022   E0           MOVX    A,@DPTR
   \   000023   F5..         MOV     ?V0 + 7,A
    728            byte *pBuf = ZDP_TmpBuf;
   \   000025   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F8           MOV     R0,A
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   E8           MOV     A,R0
   \   00002E   FE           MOV     R6,A
   \   00002F   E9           MOV     A,R1
   \   000030   FF           MOV     R7,A
    729            byte len = 1 + 2 + 2;  // Status + nwkAddr + Node Power descriptor.
   \   000031   75..05       MOV     ?V0 + 2,#0x5
    730          
    731            *pBuf++ = ZDP_SUCCESS;
   \   000034   7400         MOV     A,#0x0
   \   000036   8E82         MOV     DPL,R6
   \   000038   8F83         MOV     DPH,R7
   \   00003A   F0           MOVX    @DPTR,A
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   A3           INC     DPTR
   \   000040   AE82         MOV     R6,DPL
   \   000042   AF83         MOV     R7,DPH
    732          
    733            *pBuf++ = LO_UINT16( nwkAddr );
   \   000044   8E82         MOV     DPL,R6
   \   000046   8F83         MOV     DPH,R7
   \   000048   E5..         MOV     A,?V0 + 0
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   8E82         MOV     DPL,R6
   \   00004D   8F83         MOV     DPH,R7
   \   00004F   A3           INC     DPTR
   \   000050   AE82         MOV     R6,DPL
   \   000052   AF83         MOV     R7,DPH
    734            *pBuf++ = HI_UINT16( nwkAddr );
   \   000054   8E82         MOV     DPL,R6
   \   000056   8F83         MOV     DPH,R7
   \   000058   E5..         MOV     A,?V0 + 1
   \   00005A   F0           MOVX    @DPTR,A
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   AE82         MOV     R6,DPL
   \   000062   AF83         MOV     R7,DPH
    735          
    736            *pBuf++ = (byte)((pPowerDesc->AvailablePowerSources << 4)
    737                              | (pPowerDesc->PowerMode & 0x0F));
   \   000064   85..82       MOV     DPL,?V0 + 6
   \   000067   85..83       MOV     DPH,?V0 + 7
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   540F         ANL     A,#0xf
   \   00006D   C0E0         PUSH    A
   \   00006F   85..82       MOV     DPL,?V0 + 6
   \   000072   85..83       MOV     DPH,?V0 + 7
   \   000075   E0           MOVX    A,@DPTR
   \   000076   C4           SWAP    A
   \   000077   540F         ANL     A,#0xf
   \   000079   C4           SWAP    A
   \   00007A   54F0         ANL     A,#0xf0
   \   00007C   FA           MOV     R2,A
   \   00007D   D0E0         POP     A
   \   00007F   4A           ORL     A,R2
   \   000080   8E82         MOV     DPL,R6
   \   000082   8F83         MOV     DPH,R7
   \   000084   F0           MOVX    @DPTR,A
   \   000085   8E82         MOV     DPL,R6
   \   000087   8F83         MOV     DPH,R7
   \   000089   A3           INC     DPTR
   \   00008A   AE82         MOV     R6,DPL
   \   00008C   AF83         MOV     R7,DPH
    738            *pBuf++ = (byte)((pPowerDesc->CurrentPowerSourceLevel << 4)
    739                              | (pPowerDesc->CurrentPowerSource & 0x0F));
   \   00008E   85..82       MOV     DPL,?V0 + 6
   \   000091   85..83       MOV     DPH,?V0 + 7
   \   000094   A3           INC     DPTR
   \   000095   E0           MOVX    A,@DPTR
   \   000096   F9           MOV     R1,A
   \   000097   E9           MOV     A,R1
   \   000098   540F         ANL     A,#0xf
   \   00009A   C0E0         PUSH    A
   \   00009C   85..82       MOV     DPL,?V0 + 6
   \   00009F   85..83       MOV     DPH,?V0 + 7
   \   0000A2   A3           INC     DPTR
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   F9           MOV     R1,A
   \   0000A5   E9           MOV     A,R1
   \   0000A6   54F0         ANL     A,#0xf0
   \   0000A8   FA           MOV     R2,A
   \   0000A9   D0E0         POP     A
   \   0000AB   4A           ORL     A,R2
   \   0000AC   8E82         MOV     DPL,R6
   \   0000AE   8F83         MOV     DPH,R7
   \   0000B0   F0           MOVX    @DPTR,A
    740          
    741            return fillAndSend( &(inMsg->TransSeq), &(inMsg->srcAddr), Power_Desc_rsp, len );
   \   0000B1                ; Setup parameters for call to function fillAndSend
   \   0000B1   75..03       MOV     ?V0 + 4,#0x3
   \   0000B4   75..80       MOV     ?V0 + 5,#-0x80
   \   0000B7   78..         MOV     R0,#?V0 + 4
   \   0000B9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000BC   A9..         MOV     R1,?V0 + 2
   \   0000BE   7402         MOV     A,#0x2
   \   0000C0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C3   E0           MOVX    A,@DPTR
   \   0000C4   2402         ADD     A,#0x2
   \   0000C6   FC           MOV     R4,A
   \   0000C7   A3           INC     DPTR
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   3400         ADDC    A,#0x0
   \   0000CB   FD           MOV     R5,A
   \   0000CC   7402         MOV     A,#0x2
   \   0000CE   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   240F         ADD     A,#0xf
   \   0000D4   FA           MOV     R2,A
   \   0000D5   A3           INC     DPTR
   \   0000D6   E0           MOVX    A,@DPTR
   \   0000D7   3400         ADDC    A,#0x0
   \   0000D9   FB           MOV     R3,A
   \   0000DA   12....       LCALL   ??fillAndSend?relay
   \   0000DD   7402         MOV     A,#0x2
   \   0000DF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E2   7402         MOV     A,#0x2
   \   0000E4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E7   7F08         MOV     R7,#0x8
   \   0000E9   02....       LJMP    ?BANKED_LEAVE_XDATA
    742          }
    743          
    744          /*********************************************************************
    745           * @fn          ZDP_SimpleDescMsg
    746           *
    747           * @brief       Builds and sends a Simple Descriptor message, unicast to the
    748           *              specified device.
    749           *
    750           * @param       inMsg - incoming message (request)
    751           * @param       Status - message status (ZDP_SUCCESS or other)
    752           * @param       pSimpleDesc - pointer to the node descriptor
    753           *
    754           * @return      afStatus_t
    755           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    756          afStatus_t ZDP_SimpleDescMsg( zdoIncomingMsg_t *inMsg, byte Status,
   \                     ZDP_SimpleDescMsg:
    757                                        SimpleDescriptionFormat_t *pSimpleDesc )
    758          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   \   000015   89..         MOV     ?V0 + 6,R1
   \   000017   8C..         MOV     ?V0 + 0,R4
   \   000019   8D..         MOV     ?V0 + 1,R5
    759            uint8 *pBuf = ZDP_TmpBuf;
   \   00001B   90....       MOV     DPTR,#ZDP_TmpBuf
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F8           MOV     R0,A
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \   000022   F9           MOV     R1,A
   \   000023   E8           MOV     A,R0
   \   000024   FE           MOV     R6,A
   \   000025   E9           MOV     A,R1
   \   000026   FF           MOV     R7,A
    760            uint8 i, len;
    761          
    762            if ( Status == ZDP_SUCCESS && pSimpleDesc )
   \   000027   E5..         MOV     A,?V0 + 6
   \   000029   7038         JNZ     ??ZDP_SimpleDescMsg_0
   \   00002B   E5..         MOV     A,?V0 + 0
   \   00002D   6400         XRL     A,#0x0
   \   00002F   7004         JNZ     ??ZDP_SimpleDescMsg_1
   \   000031   E5..         MOV     A,?V0 + 1
   \   000033   6400         XRL     A,#0x0
   \                     ??ZDP_SimpleDescMsg_1:
   \   000035   602C         JZ      ??ZDP_SimpleDescMsg_0
    763            {
    764              // Status + NWKAddrOfInterest + desc length + empty simple descriptor.
    765              len = 1 + 2 + 1 + 8;
   \   000037   75..0C       MOV     ?V0 + 3,#0xc
    766              len += (pSimpleDesc->AppNumInClusters + pSimpleDesc->AppNumOutClusters) * sizeof ( uint16 );
   \   00003A   75F002       MOV     B,#0x2
   \   00003D   85..82       MOV     DPL,?V0 + 0
   \   000040   85..83       MOV     DPH,?V0 + 1
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F8           MOV     R0,A
   \   00004B   85..82       MOV     DPL,?V0 + 0
   \   00004E   85..83       MOV     DPH,?V0 + 1
   \   000051   A3           INC     DPTR
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   A3           INC     DPTR
   \   000057   A3           INC     DPTR
   \   000058   A3           INC     DPTR
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   28           ADD     A,R0
   \   00005C   A4           MUL     AB
   \   00005D   25..         ADD     A,?V0 + 3
   \   00005F   F5..         MOV     ?V0 + 3,A
   \   000061   8003         SJMP    ??ZDP_SimpleDescMsg_2
    767            }
    768            else
    769            {
    770              len = 2; // Status + desc length
   \                     ??ZDP_SimpleDescMsg_0:
   \   000063   75..02       MOV     ?V0 + 3,#0x2
    771            }
    772            if ( len >= ZDP_BUF_SZ-1 )
   \                     ??ZDP_SimpleDescMsg_2:
   \   000066   E5..         MOV     A,?V0 + 3
   \   000068   C3           CLR     C
   \   000069   944F         SUBB    A,#0x4f
   \   00006B   4005         JC      ??ZDP_SimpleDescMsg_3
    773            {
    774              return afStatus_MEM_FAIL;
   \   00006D   7981         MOV     R1,#-0x7f
   \   00006F   02....       LJMP    ??ZDP_SimpleDescMsg_4 & 0xFFFF
    775            }
    776          
    777            *pBuf++ = Status;
   \                     ??ZDP_SimpleDescMsg_3:
   \   000072   8E82         MOV     DPL,R6
   \   000074   8F83         MOV     DPH,R7
   \   000076   E5..         MOV     A,?V0 + 6
   \   000078   F0           MOVX    @DPTR,A
   \   000079   8E82         MOV     DPL,R6
   \   00007B   8F83         MOV     DPH,R7
   \   00007D   A3           INC     DPTR
   \   00007E   AE82         MOV     R6,DPL
   \   000080   AF83         MOV     R7,DPH
    778          
    779            *pBuf++ = LO_UINT16( ZDAppNwkAddr.addr.shortAddr );
   \   000082   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000085   E0           MOVX    A,@DPTR
   \   000086   8E82         MOV     DPL,R6
   \   000088   8F83         MOV     DPH,R7
   \   00008A   F0           MOVX    @DPTR,A
   \   00008B   8E82         MOV     DPL,R6
   \   00008D   8F83         MOV     DPH,R7
   \   00008F   A3           INC     DPTR
   \   000090   AE82         MOV     R6,DPL
   \   000092   AF83         MOV     R7,DPH
    780            *pBuf++ = HI_UINT16( ZDAppNwkAddr.addr.shortAddr );
   \   000094   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000097   A3           INC     DPTR
   \   000098   E0           MOVX    A,@DPTR
   \   000099   F9           MOV     R1,A
   \   00009A   E9           MOV     A,R1
   \   00009B   8E82         MOV     DPL,R6
   \   00009D   8F83         MOV     DPH,R7
   \   00009F   F0           MOVX    @DPTR,A
   \   0000A0   8E82         MOV     DPL,R6
   \   0000A2   8F83         MOV     DPH,R7
   \   0000A4   A3           INC     DPTR
   \   0000A5   AE82         MOV     R6,DPL
   \   0000A7   AF83         MOV     R7,DPH
    781          
    782            if ( len > 2 )
   \   0000A9   E5..         MOV     A,?V0 + 3
   \   0000AB   C3           CLR     C
   \   0000AC   9403         SUBB    A,#0x3
   \   0000AE   5003         JNC     $+5
   \   0000B0   02....       LJMP    ??ZDP_SimpleDescMsg_5 & 0xFFFF
    783            {
    784              *pBuf++ = len - 4;   // Simple descriptor length
   \   0000B3   74FC         MOV     A,#-0x4
   \   0000B5   25..         ADD     A,?V0 + 3
   \   0000B7   8E82         MOV     DPL,R6
   \   0000B9   8F83         MOV     DPH,R7
   \   0000BB   F0           MOVX    @DPTR,A
   \   0000BC   8E82         MOV     DPL,R6
   \   0000BE   8F83         MOV     DPH,R7
   \   0000C0   A3           INC     DPTR
   \   0000C1   AE82         MOV     R6,DPL
   \   0000C3   AF83         MOV     R7,DPH
    785          
    786              *pBuf++ = pSimpleDesc->EndPoint;
   \   0000C5   85..82       MOV     DPL,?V0 + 0
   \   0000C8   85..83       MOV     DPH,?V0 + 1
   \   0000CB   E0           MOVX    A,@DPTR
   \   0000CC   8E82         MOV     DPL,R6
   \   0000CE   8F83         MOV     DPH,R7
   \   0000D0   F0           MOVX    @DPTR,A
   \   0000D1   8E82         MOV     DPL,R6
   \   0000D3   8F83         MOV     DPH,R7
   \   0000D5   A3           INC     DPTR
   \   0000D6   AE82         MOV     R6,DPL
   \   0000D8   AF83         MOV     R7,DPH
    787              *pBuf++ = LO_UINT16( pSimpleDesc->AppProfId );
   \   0000DA   85..82       MOV     DPL,?V0 + 0
   \   0000DD   85..83       MOV     DPH,?V0 + 1
   \   0000E0   A3           INC     DPTR
   \   0000E1   E0           MOVX    A,@DPTR
   \   0000E2   8E82         MOV     DPL,R6
   \   0000E4   8F83         MOV     DPH,R7
   \   0000E6   F0           MOVX    @DPTR,A
   \   0000E7   8E82         MOV     DPL,R6
   \   0000E9   8F83         MOV     DPH,R7
   \   0000EB   A3           INC     DPTR
   \   0000EC   AE82         MOV     R6,DPL
   \   0000EE   AF83         MOV     R7,DPH
    788              *pBuf++ = HI_UINT16( pSimpleDesc->AppProfId );
   \   0000F0   85..82       MOV     DPL,?V0 + 0
   \   0000F3   85..83       MOV     DPH,?V0 + 1
   \   0000F6   A3           INC     DPTR
   \   0000F7   A3           INC     DPTR
   \   0000F8   E0           MOVX    A,@DPTR
   \   0000F9   F9           MOV     R1,A
   \   0000FA   E9           MOV     A,R1
   \   0000FB   8E82         MOV     DPL,R6
   \   0000FD   8F83         MOV     DPH,R7
   \   0000FF   F0           MOVX    @DPTR,A
   \   000100   8E82         MOV     DPL,R6
   \   000102   8F83         MOV     DPH,R7
   \   000104   A3           INC     DPTR
   \   000105   AE82         MOV     R6,DPL
   \   000107   AF83         MOV     R7,DPH
    789              *pBuf++ = LO_UINT16( pSimpleDesc->AppDeviceId );
   \   000109   85..82       MOV     DPL,?V0 + 0
   \   00010C   85..83       MOV     DPH,?V0 + 1
   \   00010F   A3           INC     DPTR
   \   000110   A3           INC     DPTR
   \   000111   A3           INC     DPTR
   \   000112   E0           MOVX    A,@DPTR
   \   000113   8E82         MOV     DPL,R6
   \   000115   8F83         MOV     DPH,R7
   \   000117   F0           MOVX    @DPTR,A
   \   000118   8E82         MOV     DPL,R6
   \   00011A   8F83         MOV     DPH,R7
   \   00011C   A3           INC     DPTR
   \   00011D   AE82         MOV     R6,DPL
   \   00011F   AF83         MOV     R7,DPH
    790              *pBuf++ = HI_UINT16( pSimpleDesc->AppDeviceId );
   \   000121   85..82       MOV     DPL,?V0 + 0
   \   000124   85..83       MOV     DPH,?V0 + 1
   \   000127   A3           INC     DPTR
   \   000128   A3           INC     DPTR
   \   000129   A3           INC     DPTR
   \   00012A   A3           INC     DPTR
   \   00012B   E0           MOVX    A,@DPTR
   \   00012C   F9           MOV     R1,A
   \   00012D   E9           MOV     A,R1
   \   00012E   8E82         MOV     DPL,R6
   \   000130   8F83         MOV     DPH,R7
   \   000132   F0           MOVX    @DPTR,A
   \   000133   8E82         MOV     DPL,R6
   \   000135   8F83         MOV     DPH,R7
   \   000137   A3           INC     DPTR
   \   000138   AE82         MOV     R6,DPL
   \   00013A   AF83         MOV     R7,DPH
    791          
    792              *pBuf++ = (byte)(pSimpleDesc->AppDevVer << 4);
   \   00013C   85..82       MOV     DPL,?V0 + 0
   \   00013F   85..83       MOV     DPH,?V0 + 1
   \   000142   A3           INC     DPTR
   \   000143   A3           INC     DPTR
   \   000144   A3           INC     DPTR
   \   000145   A3           INC     DPTR
   \   000146   A3           INC     DPTR
   \   000147   E0           MOVX    A,@DPTR
   \   000148   C4           SWAP    A
   \   000149   54F0         ANL     A,#0xf0
   \   00014B   8E82         MOV     DPL,R6
   \   00014D   8F83         MOV     DPH,R7
   \   00014F   F0           MOVX    @DPTR,A
   \   000150   8E82         MOV     DPL,R6
   \   000152   8F83         MOV     DPH,R7
   \   000154   A3           INC     DPTR
   \   000155   AE82         MOV     R6,DPL
   \   000157   AF83         MOV     R7,DPH
    793          
    794              *pBuf++ = pSimpleDesc->AppNumInClusters;
   \   000159   85..82       MOV     DPL,?V0 + 0
   \   00015C   85..83       MOV     DPH,?V0 + 1
   \   00015F   A3           INC     DPTR
   \   000160   A3           INC     DPTR
   \   000161   A3           INC     DPTR
   \   000162   A3           INC     DPTR
   \   000163   A3           INC     DPTR
   \   000164   A3           INC     DPTR
   \   000165   E0           MOVX    A,@DPTR
   \   000166   8E82         MOV     DPL,R6
   \   000168   8F83         MOV     DPH,R7
   \   00016A   F0           MOVX    @DPTR,A
   \   00016B   8E82         MOV     DPL,R6
   \   00016D   8F83         MOV     DPH,R7
   \   00016F   A3           INC     DPTR
   \   000170   AE82         MOV     R6,DPL
   \   000172   AF83         MOV     R7,DPH
    795              if ( pSimpleDesc->AppNumInClusters )
   \   000174   85..82       MOV     DPL,?V0 + 0
   \   000177   85..83       MOV     DPH,?V0 + 1
   \   00017A   A3           INC     DPTR
   \   00017B   A3           INC     DPTR
   \   00017C   A3           INC     DPTR
   \   00017D   A3           INC     DPTR
   \   00017E   A3           INC     DPTR
   \   00017F   A3           INC     DPTR
   \   000180   E0           MOVX    A,@DPTR
   \   000181   7003         JNZ     $+5
   \   000183   02....       LJMP    ??ZDP_SimpleDescMsg_6 & 0xFFFF
    796              {
    797                for (i=0; i<pSimpleDesc->AppNumInClusters; ++i)
   \   000186   75..00       MOV     ?V0 + 2,#0x0
   \                     ??ZDP_SimpleDescMsg_7:
   \   000189   85..82       MOV     DPL,?V0 + 0
   \   00018C   85..83       MOV     DPH,?V0 + 1
   \   00018F   A3           INC     DPTR
   \   000190   A3           INC     DPTR
   \   000191   A3           INC     DPTR
   \   000192   A3           INC     DPTR
   \   000193   A3           INC     DPTR
   \   000194   A3           INC     DPTR
   \   000195   E0           MOVX    A,@DPTR
   \   000196   FA           MOV     R2,A
   \   000197   E5..         MOV     A,?V0 + 2
   \   000199   C3           CLR     C
   \   00019A   9A           SUBB    A,R2
   \   00019B   4003         JC      $+5
   \   00019D   02....       LJMP    ??ZDP_SimpleDescMsg_6 & 0xFFFF
    798                {
    799                  *pBuf++ = LO_UINT16( pSimpleDesc->pAppInClusterList[i] );
   \   0001A0   A8..         MOV     R0,?V0 + 2
   \   0001A2   7900         MOV     R1,#0x0
   \   0001A4   E8           MOV     A,R0
   \   0001A5   75F002       MOV     B,#0x2
   \   0001A8   A4           MUL     AB
   \   0001A9   C8           XCH     A,R0
   \   0001AA   AAF0         MOV     R2,B
   \   0001AC   75F000       MOV     B,#0x0
   \   0001AF   A4           MUL     AB
   \   0001B0   2A           ADD     A,R2
   \   0001B1   FA           MOV     R2,A
   \   0001B2   75F002       MOV     B,#0x2
   \   0001B5   E9           MOV     A,R1
   \   0001B6   A4           MUL     AB
   \   0001B7   2A           ADD     A,R2
   \   0001B8   F9           MOV     R1,A
   \   0001B9   85..82       MOV     DPL,?V0 + 0
   \   0001BC   85..83       MOV     DPH,?V0 + 1
   \   0001BF   A3           INC     DPTR
   \   0001C0   A3           INC     DPTR
   \   0001C1   A3           INC     DPTR
   \   0001C2   A3           INC     DPTR
   \   0001C3   A3           INC     DPTR
   \   0001C4   A3           INC     DPTR
   \   0001C5   A3           INC     DPTR
   \   0001C6   E0           MOVX    A,@DPTR
   \   0001C7   28           ADD     A,R0
   \   0001C8   FA           MOV     R2,A
   \   0001C9   A3           INC     DPTR
   \   0001CA   E0           MOVX    A,@DPTR
   \   0001CB   39           ADDC    A,R1
   \   0001CC   8A82         MOV     DPL,R2
   \   0001CE   F583         MOV     DPH,A
   \   0001D0   E0           MOVX    A,@DPTR
   \   0001D1   8E82         MOV     DPL,R6
   \   0001D3   8F83         MOV     DPH,R7
   \   0001D5   F0           MOVX    @DPTR,A
   \   0001D6   8E82         MOV     DPL,R6
   \   0001D8   8F83         MOV     DPH,R7
   \   0001DA   A3           INC     DPTR
   \   0001DB   AE82         MOV     R6,DPL
   \   0001DD   AF83         MOV     R7,DPH
    800                  *pBuf++ = HI_UINT16( pSimpleDesc->pAppInClusterList[i] );
   \   0001DF   A8..         MOV     R0,?V0 + 2
   \   0001E1   7900         MOV     R1,#0x0
   \   0001E3   E8           MOV     A,R0
   \   0001E4   75F002       MOV     B,#0x2
   \   0001E7   A4           MUL     AB
   \   0001E8   C8           XCH     A,R0
   \   0001E9   AAF0         MOV     R2,B
   \   0001EB   75F000       MOV     B,#0x0
   \   0001EE   A4           MUL     AB
   \   0001EF   2A           ADD     A,R2
   \   0001F0   FA           MOV     R2,A
   \   0001F1   75F002       MOV     B,#0x2
   \   0001F4   E9           MOV     A,R1
   \   0001F5   A4           MUL     AB
   \   0001F6   2A           ADD     A,R2
   \   0001F7   F9           MOV     R1,A
   \   0001F8   85..82       MOV     DPL,?V0 + 0
   \   0001FB   85..83       MOV     DPH,?V0 + 1
   \   0001FE   A3           INC     DPTR
   \   0001FF   A3           INC     DPTR
   \   000200   A3           INC     DPTR
   \   000201   A3           INC     DPTR
   \   000202   A3           INC     DPTR
   \   000203   A3           INC     DPTR
   \   000204   A3           INC     DPTR
   \   000205   E0           MOVX    A,@DPTR
   \   000206   28           ADD     A,R0
   \   000207   FA           MOV     R2,A
   \   000208   A3           INC     DPTR
   \   000209   E0           MOVX    A,@DPTR
   \   00020A   39           ADDC    A,R1
   \   00020B   8A82         MOV     DPL,R2
   \   00020D   F583         MOV     DPH,A
   \   00020F   A3           INC     DPTR
   \   000210   E0           MOVX    A,@DPTR
   \   000211   F9           MOV     R1,A
   \   000212   E9           MOV     A,R1
   \   000213   8E82         MOV     DPL,R6
   \   000215   8F83         MOV     DPH,R7
   \   000217   F0           MOVX    @DPTR,A
   \   000218   8E82         MOV     DPL,R6
   \   00021A   8F83         MOV     DPH,R7
   \   00021C   A3           INC     DPTR
   \   00021D   AE82         MOV     R6,DPL
   \   00021F   AF83         MOV     R7,DPH
    801                }
   \   000221   05..         INC     ?V0 + 2
   \   000223   02....       LJMP    ??ZDP_SimpleDescMsg_7 & 0xFFFF
    802              }
    803              
    804              *pBuf++ = pSimpleDesc->AppNumOutClusters;
   \                     ??ZDP_SimpleDescMsg_6:
   \   000226   85..82       MOV     DPL,?V0 + 0
   \   000229   85..83       MOV     DPH,?V0 + 1
   \   00022C   A3           INC     DPTR
   \   00022D   A3           INC     DPTR
   \   00022E   A3           INC     DPTR
   \   00022F   A3           INC     DPTR
   \   000230   A3           INC     DPTR
   \   000231   A3           INC     DPTR
   \   000232   A3           INC     DPTR
   \   000233   A3           INC     DPTR
   \   000234   A3           INC     DPTR
   \   000235   E0           MOVX    A,@DPTR
   \   000236   8E82         MOV     DPL,R6
   \   000238   8F83         MOV     DPH,R7
   \   00023A   F0           MOVX    @DPTR,A
   \   00023B   8E82         MOV     DPL,R6
   \   00023D   8F83         MOV     DPH,R7
   \   00023F   A3           INC     DPTR
   \   000240   AE82         MOV     R6,DPL
   \   000242   AF83         MOV     R7,DPH
    805              if ( pSimpleDesc->AppNumOutClusters )
   \   000244   85..82       MOV     DPL,?V0 + 0
   \   000247   85..83       MOV     DPH,?V0 + 1
   \   00024A   A3           INC     DPTR
   \   00024B   A3           INC     DPTR
   \   00024C   A3           INC     DPTR
   \   00024D   A3           INC     DPTR
   \   00024E   A3           INC     DPTR
   \   00024F   A3           INC     DPTR
   \   000250   A3           INC     DPTR
   \   000251   A3           INC     DPTR
   \   000252   A3           INC     DPTR
   \   000253   E0           MOVX    A,@DPTR
   \   000254   7003         JNZ     $+5
   \   000256   02....       LJMP    ??ZDP_SimpleDescMsg_8 & 0xFFFF
    806              {
    807                for (i=0; i<pSimpleDesc->AppNumOutClusters; ++i)
   \   000259   75..00       MOV     ?V0 + 2,#0x0
   \                     ??ZDP_SimpleDescMsg_9:
   \   00025C   85..82       MOV     DPL,?V0 + 0
   \   00025F   85..83       MOV     DPH,?V0 + 1
   \   000262   A3           INC     DPTR
   \   000263   A3           INC     DPTR
   \   000264   A3           INC     DPTR
   \   000265   A3           INC     DPTR
   \   000266   A3           INC     DPTR
   \   000267   A3           INC     DPTR
   \   000268   A3           INC     DPTR
   \   000269   A3           INC     DPTR
   \   00026A   A3           INC     DPTR
   \   00026B   E0           MOVX    A,@DPTR
   \   00026C   FA           MOV     R2,A
   \   00026D   E5..         MOV     A,?V0 + 2
   \   00026F   C3           CLR     C
   \   000270   9A           SUBB    A,R2
   \   000271   4003         JC      $+5
   \   000273   02....       LJMP    ??ZDP_SimpleDescMsg_8 & 0xFFFF
    808                {
    809                  *pBuf++ = LO_UINT16( pSimpleDesc->pAppOutClusterList[i] );
   \   000276   A8..         MOV     R0,?V0 + 2
   \   000278   7900         MOV     R1,#0x0
   \   00027A   E8           MOV     A,R0
   \   00027B   75F002       MOV     B,#0x2
   \   00027E   A4           MUL     AB
   \   00027F   C8           XCH     A,R0
   \   000280   AAF0         MOV     R2,B
   \   000282   75F000       MOV     B,#0x0
   \   000285   A4           MUL     AB
   \   000286   2A           ADD     A,R2
   \   000287   FA           MOV     R2,A
   \   000288   75F002       MOV     B,#0x2
   \   00028B   E9           MOV     A,R1
   \   00028C   A4           MUL     AB
   \   00028D   2A           ADD     A,R2
   \   00028E   F9           MOV     R1,A
   \   00028F   85..82       MOV     DPL,?V0 + 0
   \   000292   85..83       MOV     DPH,?V0 + 1
   \   000295   A3           INC     DPTR
   \   000296   A3           INC     DPTR
   \   000297   A3           INC     DPTR
   \   000298   A3           INC     DPTR
   \   000299   A3           INC     DPTR
   \   00029A   A3           INC     DPTR
   \   00029B   A3           INC     DPTR
   \   00029C   A3           INC     DPTR
   \   00029D   A3           INC     DPTR
   \   00029E   A3           INC     DPTR
   \   00029F   E0           MOVX    A,@DPTR
   \   0002A0   28           ADD     A,R0
   \   0002A1   FA           MOV     R2,A
   \   0002A2   A3           INC     DPTR
   \   0002A3   E0           MOVX    A,@DPTR
   \   0002A4   39           ADDC    A,R1
   \   0002A5   8A82         MOV     DPL,R2
   \   0002A7   F583         MOV     DPH,A
   \   0002A9   E0           MOVX    A,@DPTR
   \   0002AA   8E82         MOV     DPL,R6
   \   0002AC   8F83         MOV     DPH,R7
   \   0002AE   F0           MOVX    @DPTR,A
   \   0002AF   8E82         MOV     DPL,R6
   \   0002B1   8F83         MOV     DPH,R7
   \   0002B3   A3           INC     DPTR
   \   0002B4   AE82         MOV     R6,DPL
   \   0002B6   AF83         MOV     R7,DPH
    810                  *pBuf++ = HI_UINT16( pSimpleDesc->pAppOutClusterList[i] );
   \   0002B8   A8..         MOV     R0,?V0 + 2
   \   0002BA   7900         MOV     R1,#0x0
   \   0002BC   E8           MOV     A,R0
   \   0002BD   75F002       MOV     B,#0x2
   \   0002C0   A4           MUL     AB
   \   0002C1   C8           XCH     A,R0
   \   0002C2   AAF0         MOV     R2,B
   \   0002C4   75F000       MOV     B,#0x0
   \   0002C7   A4           MUL     AB
   \   0002C8   2A           ADD     A,R2
   \   0002C9   FA           MOV     R2,A
   \   0002CA   75F002       MOV     B,#0x2
   \   0002CD   E9           MOV     A,R1
   \   0002CE   A4           MUL     AB
   \   0002CF   2A           ADD     A,R2
   \   0002D0   F9           MOV     R1,A
   \   0002D1   85..82       MOV     DPL,?V0 + 0
   \   0002D4   85..83       MOV     DPH,?V0 + 1
   \   0002D7   A3           INC     DPTR
   \   0002D8   A3           INC     DPTR
   \   0002D9   A3           INC     DPTR
   \   0002DA   A3           INC     DPTR
   \   0002DB   A3           INC     DPTR
   \   0002DC   A3           INC     DPTR
   \   0002DD   A3           INC     DPTR
   \   0002DE   A3           INC     DPTR
   \   0002DF   A3           INC     DPTR
   \   0002E0   A3           INC     DPTR
   \   0002E1   E0           MOVX    A,@DPTR
   \   0002E2   28           ADD     A,R0
   \   0002E3   FA           MOV     R2,A
   \   0002E4   A3           INC     DPTR
   \   0002E5   E0           MOVX    A,@DPTR
   \   0002E6   39           ADDC    A,R1
   \   0002E7   8A82         MOV     DPL,R2
   \   0002E9   F583         MOV     DPH,A
   \   0002EB   A3           INC     DPTR
   \   0002EC   E0           MOVX    A,@DPTR
   \   0002ED   F9           MOV     R1,A
   \   0002EE   E9           MOV     A,R1
   \   0002EF   8E82         MOV     DPL,R6
   \   0002F1   8F83         MOV     DPH,R7
   \   0002F3   F0           MOVX    @DPTR,A
   \   0002F4   8E82         MOV     DPL,R6
   \   0002F6   8F83         MOV     DPH,R7
   \   0002F8   A3           INC     DPTR
   \   0002F9   AE82         MOV     R6,DPL
   \   0002FB   AF83         MOV     R7,DPH
    811                }
   \   0002FD   05..         INC     ?V0 + 2
   \   0002FF   02....       LJMP    ??ZDP_SimpleDescMsg_9 & 0xFFFF
    812              }
    813            }
    814            
    815            else
    816            {
    817              *pBuf = 0; // Description Length = 0;
   \                     ??ZDP_SimpleDescMsg_5:
   \   000302   7400         MOV     A,#0x0
   \   000304   8E82         MOV     DPL,R6
   \   000306   8F83         MOV     DPH,R7
   \   000308   F0           MOVX    @DPTR,A
    818            }
    819          
    820            return fillAndSend( &(inMsg->TransSeq), &(inMsg->srcAddr), Simple_Desc_rsp, len );
   \                     ??ZDP_SimpleDescMsg_8:
   \   000309                ; Setup parameters for call to function fillAndSend
   \   000309   75..04       MOV     ?V0 + 4,#0x4
   \   00030C   75..80       MOV     ?V0 + 5,#-0x80
   \   00030F   78..         MOV     R0,#?V0 + 4
   \   000311   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000314   A9..         MOV     R1,?V0 + 3
   \   000316   7402         MOV     A,#0x2
   \   000318   12....       LCALL   ?XSTACK_DISP0_8
   \   00031B   E0           MOVX    A,@DPTR
   \   00031C   2402         ADD     A,#0x2
   \   00031E   FC           MOV     R4,A
   \   00031F   A3           INC     DPTR
   \   000320   E0           MOVX    A,@DPTR
   \   000321   3400         ADDC    A,#0x0
   \   000323   FD           MOV     R5,A
   \   000324   7402         MOV     A,#0x2
   \   000326   12....       LCALL   ?XSTACK_DISP0_8
   \   000329   E0           MOVX    A,@DPTR
   \   00032A   240F         ADD     A,#0xf
   \   00032C   FA           MOV     R2,A
   \   00032D   A3           INC     DPTR
   \   00032E   E0           MOVX    A,@DPTR
   \   00032F   3400         ADDC    A,#0x0
   \   000331   FB           MOV     R3,A
   \   000332   12....       LCALL   ??fillAndSend?relay
   \   000335   7402         MOV     A,#0x2
   \   000337   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??ZDP_SimpleDescMsg_4:
   \   00033A   7402         MOV     A,#0x2
   \   00033C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00033F   7F07         MOV     R7,#0x7
   \   000341   02....       LJMP    ?BANKED_LEAVE_XDATA
    821          }
    822          
    823          /*********************************************************************
    824           * @fn          ZDP_EPRsp
    825           *
    826           * @brief       This builds and send an endpoint list. Used in
    827           *              Active_EP_rsp and Match_Desc_Rsp
    828           *              message.  This function sends unicast message to the
    829           *              requesting device.
    830           *
    831           * @param       MsgType - either Active_EP_rsp or Match_Desc_Rsp
    832           * @param       dstAddr - destination address
    833           * @param       Status - message status (ZDP_SUCCESS or other)
    834           * @param       nwkAddr - Device's short address that this response describes
    835           * @param       Count - number of endpoint/interfaces in list
    836           * @param       pEPIntfList - Array of Endpoint/Interfaces
    837           * @param       SecurityEnable - Security Options
    838           *
    839           * @return      afStatus_t
    840           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    841          afStatus_t ZDP_EPRsp( uint16 MsgType, byte TransSeq, zAddrType_t *dstAddr,
   \                     ZDP_EPRsp:
    842                                  byte Status, uint16 nwkAddr, byte Count,
    843                                  byte *pEPList,
    844                                  byte SecurityEnable )
    845          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   C0E0         PUSH    A
   \   00000D   7401         MOV     A,#0x1
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   D0E0         POP     A
   \   000014   F0           MOVX    @DPTR,A
   \   000015   7402         MOV     A,#0x2
   \   000017   12....       LCALL   ?XSTACK_DISP0_8
   \   00001A   EC           MOV     A,R4
   \   00001B   F0           MOVX    @DPTR,A
   \   00001C   A3           INC     DPTR
   \   00001D   ED           MOV     A,R5
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   8A..         MOV     ?V0 + 6,R2
   \   000021   8B..         MOV     ?V0 + 7,R3
   \   000023   7415         MOV     A,#0x15
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F5..         MOV     ?V0 + 4,A
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F5..         MOV     ?V0 + 5,A
    846            byte *pBuf = ZDP_TmpBuf;
   \   00002F   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F8           MOV     R0,A
   \   000034   A3           INC     DPTR
   \   000035   E0           MOVX    A,@DPTR
   \   000036   F9           MOV     R1,A
   \   000037   E8           MOV     A,R0
   \   000038   FE           MOV     R6,A
   \   000039   E9           MOV     A,R1
   \   00003A   FF           MOV     R7,A
    847            byte len = 1 + 2 + 1;  // Status + nwkAddr + endpoint/interface count.
   \   00003B   75..04       MOV     ?V0 + 3,#0x4
    848            byte txOptions;
    849          
    850            if ( MsgType == Match_Desc_rsp )
   \   00003E   7406         MOV     A,#0x6
   \   000040   65..         XRL     A,?V0 + 6
   \   000042   7004         JNZ     ??ZDP_EPRsp_0
   \   000044   7480         MOV     A,#-0x80
   \   000046   65..         XRL     A,?V0 + 7
   \                     ??ZDP_EPRsp_0:
   \   000048   700B         JNZ     ??ZDP_EPRsp_1
    851              txOptions = AF_MSG_ACK_REQUEST;
   \   00004A   7410         MOV     A,#0x10
   \   00004C   85..82       MOV     DPL,?XSP + 0
   \   00004F   85..83       MOV     DPH,?XSP + 1
   \   000052   F0           MOVX    @DPTR,A
   \   000053   8009         SJMP    ??ZDP_EPRsp_2
    852            else
    853              txOptions = 0;
   \                     ??ZDP_EPRsp_1:
   \   000055   7400         MOV     A,#0x0
   \   000057   85..82       MOV     DPL,?XSP + 0
   \   00005A   85..83       MOV     DPH,?XSP + 1
   \   00005D   F0           MOVX    @DPTR,A
    854          
    855              *pBuf++ = Status;
   \                     ??ZDP_EPRsp_2:
   \   00005E   7414         MOV     A,#0x14
   \   000060   12....       LCALL   ?XSTACK_DISP0_8
   \   000063   E0           MOVX    A,@DPTR
   \   000064   8E82         MOV     DPL,R6
   \   000066   8F83         MOV     DPH,R7
   \   000068   F0           MOVX    @DPTR,A
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   A3           INC     DPTR
   \   00006E   AE82         MOV     R6,DPL
   \   000070   AF83         MOV     R7,DPH
    856            *pBuf++ = LO_UINT16( nwkAddr );
   \   000072   8E82         MOV     DPL,R6
   \   000074   8F83         MOV     DPH,R7
   \   000076   E5..         MOV     A,?V0 + 4
   \   000078   F0           MOVX    @DPTR,A
   \   000079   8E82         MOV     DPL,R6
   \   00007B   8F83         MOV     DPH,R7
   \   00007D   A3           INC     DPTR
   \   00007E   AE82         MOV     R6,DPL
   \   000080   AF83         MOV     R7,DPH
    857            *pBuf++ = HI_UINT16( nwkAddr );
   \   000082   8E82         MOV     DPL,R6
   \   000084   8F83         MOV     DPH,R7
   \   000086   E5..         MOV     A,?V0 + 5
   \   000088   F0           MOVX    @DPTR,A
   \   000089   8E82         MOV     DPL,R6
   \   00008B   8F83         MOV     DPH,R7
   \   00008D   A3           INC     DPTR
   \   00008E   AE82         MOV     R6,DPL
   \   000090   AF83         MOV     R7,DPH
    858          
    859            *pBuf++ = Count;   // Endpoint/Interface count
   \   000092   7417         MOV     A,#0x17
   \   000094   12....       LCALL   ?XSTACK_DISP0_8
   \   000097   E0           MOVX    A,@DPTR
   \   000098   8E82         MOV     DPL,R6
   \   00009A   8F83         MOV     DPH,R7
   \   00009C   F0           MOVX    @DPTR,A
   \   00009D   8E82         MOV     DPL,R6
   \   00009F   8F83         MOV     DPH,R7
   \   0000A1   A3           INC     DPTR
   \   0000A2   AE82         MOV     R6,DPL
   \   0000A4   AF83         MOV     R7,DPH
    860          
    861            if ( Count )
   \   0000A6   7417         MOV     A,#0x17
   \   0000A8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   6036         JZ      ??ZDP_EPRsp_3
    862            {
    863              len += Count;
   \   0000AE   7417         MOV     A,#0x17
   \   0000B0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B3   E0           MOVX    A,@DPTR
   \   0000B4   25..         ADD     A,?V0 + 3
   \   0000B6   F5..         MOV     ?V0 + 3,A
    864              osal_memcpy( pBuf, pEPList, Count );
   \   0000B8                ; Setup parameters for call to function osal_memcpy
   \   0000B8   7418         MOV     A,#0x18
   \   0000BA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   F5..         MOV     ?V0 + 0,A
   \   0000C0   A3           INC     DPTR
   \   0000C1   E0           MOVX    A,@DPTR
   \   0000C2   F5..         MOV     ?V0 + 1,A
   \   0000C4   75..00       MOV     ?V0 + 2,#0x0
   \   0000C7   78..         MOV     R0,#?V0 + 0
   \   0000C9   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000CC   741A         MOV     A,#0x1a
   \   0000CE   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   F5..         MOV     ?V0 + 0,A
   \   0000D4   AC..         MOV     R4,?V0 + 0
   \   0000D6   7D00         MOV     R5,#0x0
   \   0000D8   EE           MOV     A,R6
   \   0000D9   FA           MOV     R2,A
   \   0000DA   EF           MOV     A,R7
   \   0000DB   FB           MOV     R3,A
   \   0000DC   12....       LCALL   ??osal_memcpy?relay
   \   0000DF   7403         MOV     A,#0x3
   \   0000E1   12....       LCALL   ?DEALLOC_XSTACK8
    865            }
    866          
    867            FillAndSendTxOptions( &TransSeq, dstAddr, MsgType, len, txOptions );
   \                     ??ZDP_EPRsp_3:
   \   0000E4   85..82       MOV     DPL,?XSP + 0
   \   0000E7   85..83       MOV     DPH,?XSP + 1
   \   0000EA   E0           MOVX    A,@DPTR
   \   0000EB   90....       MOV     DPTR,#ZDP_TxOptions
   \   0000EE   F0           MOVX    @DPTR,A
   \   0000EF                ; Setup parameters for call to function fillAndSend
   \   0000EF   78..         MOV     R0,#?V0 + 6
   \   0000F1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F4   A9..         MOV     R1,?V0 + 3
   \   0000F6   7404         MOV     A,#0x4
   \   0000F8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   FC           MOV     R4,A
   \   0000FD   A3           INC     DPTR
   \   0000FE   E0           MOVX    A,@DPTR
   \   0000FF   FD           MOV     R5,A
   \   000100   7403         MOV     A,#0x3
   \   000102   12....       LCALL   ?XSTACK_DISP0_8
   \   000105   AA82         MOV     R2,DPL
   \   000107   AB83         MOV     R3,DPH
   \   000109   12....       LCALL   ??fillAndSend?relay
   \   00010C   7402         MOV     A,#0x2
   \   00010E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000111   E9           MOV     A,R1
   \   000112   F5..         MOV     ?V0 + 0,A
   \   000114   7400         MOV     A,#0x0
   \   000116   90....       MOV     DPTR,#ZDP_TxOptions
   \   000119   F0           MOVX    @DPTR,A
   \   00011A   A9..         MOV     R1,?V0 + 0
   \   00011C   7404         MOV     A,#0x4
   \   00011E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000121   7F08         MOV     R7,#0x8
   \   000123   02....       LJMP    ?BANKED_LEAVE_XDATA
    868          }
    869          
    870          #if defined ( ZDO_USERDESC_RESPONSE )
    871          /*********************************************************************
    872           * @fn          ZDP_UserDescRsp
    873           *
    874           * @brief       Build and send the User Decriptor Response.
    875           *
    876           *
    877           * @param       dstAddr - destination address
    878           * @param       nwkAddrOfInterest -
    879           * @param       userDesc -
    880           * @param       SecurityEnable - Security Options
    881           *
    882           * @return      ZStatus_t
    883           */
    884          ZStatus_t ZDP_UserDescRsp( byte TransSeq, zAddrType_t *dstAddr,
    885                          uint16 nwkAddrOfInterest, UserDescriptorFormat_t *userDesc,
    886                          byte SecurityEnable )
    887          {
    888            byte *pBuf = ZDP_TmpBuf;
    889            byte len = 1 + 2 + 1;  // Status + nwkAddr + descriptor length.
    890          
    891            len += userDesc->len;
    892          
    893            *pBuf++ = ZSUCCESS;
    894          
    895            *pBuf++ = LO_UINT16( nwkAddrOfInterest );
    896            *pBuf++ = HI_UINT16( nwkAddrOfInterest );
    897          
    898            *pBuf++ = userDesc->len;
    899            osal_memcpy( pBuf, userDesc->desc, userDesc->len );
    900          
    901            return (ZStatus_t)fillAndSend( &TransSeq, dstAddr, User_Desc_rsp, len );
    902          }
    903          #endif // ZDO_USERDESC_RESPONSE
    904          
    905          #if defined ( ZDO_SERVERDISC_RESPONSE )
    906          /*********************************************************************
    907           * @fn          ZDP_ServerDiscRsp
    908           *
    909           * @brief       Build and send the Server_Discovery_rsp response.
    910           *
    911           * @param       transID - Transaction sequence number of request.
    912           * @param       dstAddr - Network Destination Address.
    913           * @param       status - Status of response to request.
    914           * @param       aoi - Network Address of Interest of request.
    915           * @param       serverMask - Bit map of service(s) being sought.
    916           * @param       SecurityEnable - Security Options
    917           *
    918           * @return      ZStatus_t
    919           */
    920          ZStatus_t ZDP_ServerDiscRsp( byte transID, zAddrType_t *dstAddr, byte status,
    921                                     uint16 aoi, uint16 serverMask, byte SecurityEnable )
    922          {
    923            const byte len = 1  + 2;  // status + aoi + mask.
    924            byte *pBuf = ZDP_TmpBuf;
    925          
    926            *pBuf++ = status;
    927          
    928            *pBuf++ = LO_UINT16( serverMask );
    929            *pBuf++ = HI_UINT16( serverMask );
    930          
    931            return (ZStatus_t)fillAndSend( &transID, dstAddr, Server_Discovery_rsp, len );
    932          }
    933          #endif // ZDO_USERDESC_RESPONSE
    934          
    935          /*********************************************************************
    936           * @fn          ZDP_GenericRsp
    937           *
    938           * @brief       Sends a response message with only the parameter status
    939           *              byte and the addr of interest for data.
    940           *              This function sends unicast message to the
    941           *              requesting device.
    942           *
    943           * @param       dstAddr - destination address
    944           * @param       status  - generic status for response
    945           * @param       aoi     - address of interest
    946           * @param       dstAddr - destination address
    947           * @param       rspId   - response cluster ID
    948           * @param       SecurityEnable - Security Options
    949           *
    950           * @return      afStatus_t
    951           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    952          afStatus_t ZDP_GenericRsp( byte TransSeq, zAddrType_t *dstAddr,
   \                     ZDP_GenericRsp:
    953                               byte status, uint16 aoi, uint16 rspID, byte SecurityEnable )
    954          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   85..82       MOV     DPL,?XSP + 0
   \   00000E   85..83       MOV     DPH,?XSP + 1
   \   000011   F0           MOVX    @DPTR,A
   \   000012   8A..         MOV     ?V0 + 6,R2
   \   000014   8B..         MOV     ?V0 + 7,R3
   \   000016   8C..         MOV     ?V0 + 1,R4
   \   000018   7411         MOV     A,#0x11
   \   00001A   12....       LCALL   ?XSTACK_DISP0_8
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   A3           INC     DPTR
   \   000020   E0           MOVX    A,@DPTR
   \   000021   FF           MOV     R7,A
   \   000022   7413         MOV     A,#0x13
   \   000024   12....       LCALL   ?XSTACK_DISP0_8
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F5..         MOV     ?V0 + 2,A
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F5..         MOV     ?V0 + 3,A
    955            uint8 len;
    956          
    957            ZDP_TmpBuf[0] = status;
   \   00002E   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F8           MOV     R0,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F583         MOV     DPH,A
   \   000037   8882         MOV     DPL,R0
   \   000039   E5..         MOV     A,?V0 + 1
   \   00003B   F0           MOVX    @DPTR,A
    958            ZDP_TmpBuf[1] = LO_UINT16( aoi );
   \   00003C   EE           MOV     A,R6
   \   00003D   C0E0         PUSH    A
   \   00003F   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000042   E0           MOVX    A,@DPTR
   \   000043   F8           MOV     R0,A
   \   000044   A3           INC     DPTR
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F583         MOV     DPH,A
   \   000048   8882         MOV     DPL,R0
   \   00004A   A3           INC     DPTR
   \   00004B   D0E0         POP     A
   \   00004D   F0           MOVX    @DPTR,A
    959            ZDP_TmpBuf[2] = HI_UINT16( aoi );
   \   00004E   EF           MOV     A,R7
   \   00004F   F9           MOV     R1,A
   \   000050   E9           MOV     A,R1
   \   000051   C0E0         PUSH    A
   \   000053   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F8           MOV     R0,A
   \   000058   A3           INC     DPTR
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F583         MOV     DPH,A
   \   00005C   8882         MOV     DPL,R0
   \   00005E   A3           INC     DPTR
   \   00005F   A3           INC     DPTR
   \   000060   D0E0         POP     A
   \   000062   F0           MOVX    @DPTR,A
    960          
    961            // Length byte
    962            ZDP_TmpBuf[3] = 0;
   \   000063   7400         MOV     A,#0x0
   \   000065   C0E0         PUSH    A
   \   000067   90....       MOV     DPTR,#ZDP_TmpBuf
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   F8           MOV     R0,A
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   F583         MOV     DPH,A
   \   000070   8882         MOV     DPL,R0
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   D0E0         POP     A
   \   000077   F0           MOVX    @DPTR,A
    963            len = 4;
   \   000078   75..04       MOV     ?V0 + 0,#0x4
    964            
    965            return fillAndSend( &TransSeq, dstAddr, rspID, len );
   \   00007B                ; Setup parameters for call to function fillAndSend
   \   00007B   78..         MOV     R0,#?V0 + 2
   \   00007D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000080   A9..         MOV     R1,?V0 + 0
   \   000082   AC..         MOV     R4,?V0 + 6
   \   000084   AD..         MOV     R5,?V0 + 7
   \   000086   7402         MOV     A,#0x2
   \   000088   12....       LCALL   ?XSTACK_DISP0_8
   \   00008B   AA82         MOV     R2,DPL
   \   00008D   AB83         MOV     R3,DPH
   \   00008F   12....       LCALL   ??fillAndSend?relay
   \   000092   7402         MOV     A,#0x2
   \   000094   12....       LCALL   ?DEALLOC_XSTACK8
   \   000097   7401         MOV     A,#0x1
   \   000099   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009C   7F08         MOV     R7,#0x8
   \   00009E   02....       LJMP    ?BANKED_LEAVE_XDATA
    966          }
    967          
    968          /*********************************************************************
    969           * Binding
    970           */
    971          #if defined ( ZDO_ENDDEVICEBIND_REQUEST )
    972          /*********************************************************************
    973           * @fn          ZDP_EndDeviceBindReq
    974           *
    975           * @brief       This builds and sends a End_Device_Bind_req message.
    976           *              This function sends a unicast message.
    977           *
    978           * @param       dstAddr - destination address
    979           * @param       LocalCoordinator - short address of local coordinator
    980           * @param       epIntf - Endpoint/Interface of Simple Desc
    981           * @param       ProfileID - Profile ID
    982           *
    983           *   The Input cluster list is the opposite of what you would think.
    984           *   This is the output cluster list of this device
    985           * @param       NumInClusters - number of input clusters
    986           * @param       InClusterList - input cluster ID list
    987           *
    988           *   The Output cluster list is the opposite of what you would think.
    989           *   This is the input cluster list of this device
    990           * @param       NumOutClusters - number of output clusters
    991           * @param       OutClusterList - output cluster ID list
    992           *
    993           * @param       SecurityEnable - Security Options
    994           *
    995           * @return      afStatus_t
    996           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    997          afStatus_t ZDP_EndDeviceBindReq( zAddrType_t *dstAddr,
   \                     ZDP_EndDeviceBindReq:
    998                                           uint16 LocalCoordinator,
    999                                           byte endPoint,
   1000                                           uint16 ProfileID,
   1001                                           byte NumInClusters, cId_t *InClusterList,
   1002                                           byte NumOutClusters, cId_t *OutClusterList,
   1003                                           byte SecurityEnable )
   1004          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7403         MOV     A,#0x3
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EA           MOV     A,R2
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   EB           MOV     A,R3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   E9           MOV     A,R1
   \   000015   85..82       MOV     DPL,?XSP + 0
   \   000018   85..83       MOV     DPH,?XSP + 1
   \   00001B   F0           MOVX    @DPTR,A
   \   00001C   8C..         MOV     ?V0 + 2,R4
   \   00001E   8D..         MOV     ?V0 + 3,R5
   1005            uint8 *pBuf = ZDP_TmpBuf;
   \   000020   90....       MOV     DPTR,#ZDP_TmpBuf
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F8           MOV     R0,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F9           MOV     R1,A
   \   000028   E8           MOV     A,R0
   \   000029   FE           MOV     R6,A
   \   00002A   E9           MOV     A,R1
   \   00002B   FF           MOV     R7,A
   1006            uint8 i, len;
   1007            uint8 *ieeeAddr;
   1008          
   1009            // LocalCoordinator + SrcExtAddr + ep + ProfileID +  NumInClusters + NumOutClusters.
   1010            len = 2 + Z_EXTADDR_LEN + 1 + 2 + 1 + 1;
   \   00002C   75..0F       MOV     ?V0 + 1,#0xf
   1011            len += (NumInClusters + NumOutClusters) * sizeof ( uint16 );
   \   00002F   75F002       MOV     B,#0x2
   \   000032   7415         MOV     A,#0x15
   \   000034   12....       LCALL   ?XSTACK_DISP0_8
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F8           MOV     R0,A
   \   000039   7418         MOV     A,#0x18
   \   00003B   12....       LCALL   ?XSTACK_DISP0_8
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   28           ADD     A,R0
   \   000040   A4           MUL     AB
   \   000041   25..         ADD     A,?V0 + 1
   \   000043   F5..         MOV     ?V0 + 1,A
   1012           
   1013            if ( len >= ZDP_BUF_SZ-1 )
   \   000045   E5..         MOV     A,?V0 + 1
   \   000047   C3           CLR     C
   \   000048   944F         SUBB    A,#0x4f
   \   00004A   4005         JC      ??ZDP_EndDeviceBindReq_0
   1014            {
   1015              return afStatus_MEM_FAIL;
   \   00004C   7981         MOV     R1,#-0x7f
   \   00004E   02....       LJMP    ??ZDP_EndDeviceBindReq_1 & 0xFFFF
   1016            }
   1017            
   1018            if ( LocalCoordinator != NLME_GetShortAddr() )
   \                     ??ZDP_EndDeviceBindReq_0:
   \   000051                ; Setup parameters for call to function NLME_GetShortAddr
   \   000051   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000054   8A..         MOV     ?V0 + 4,R2
   \   000056   8B..         MOV     ?V0 + 5,R3
   \   000058   E5..         MOV     A,?V0 + 4
   \   00005A   65..         XRL     A,?V0 + 2
   \   00005C   7004         JNZ     ??ZDP_EndDeviceBindReq_2
   \   00005E   E5..         MOV     A,?V0 + 5
   \   000060   65..         XRL     A,?V0 + 3
   \                     ??ZDP_EndDeviceBindReq_2:
   \   000062   6005         JZ      ??ZDP_EndDeviceBindReq_3
   1019            {
   1020              return afStatus_INVALID_PARAMETER;
   \   000064   7982         MOV     R1,#-0x7e
   \   000066   02....       LJMP    ??ZDP_EndDeviceBindReq_1 & 0xFFFF
   1021            }
   1022          
   1023            *pBuf++ = LO_UINT16( LocalCoordinator );
   \                     ??ZDP_EndDeviceBindReq_3:
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   E5..         MOV     A,?V0 + 2
   \   00006F   F0           MOVX    @DPTR,A
   \   000070   8E82         MOV     DPL,R6
   \   000072   8F83         MOV     DPH,R7
   \   000074   A3           INC     DPTR
   \   000075   AE82         MOV     R6,DPL
   \   000077   AF83         MOV     R7,DPH
   1024            *pBuf++ = HI_UINT16( LocalCoordinator );
   \   000079   8E82         MOV     DPL,R6
   \   00007B   8F83         MOV     DPH,R7
   \   00007D   E5..         MOV     A,?V0 + 3
   \   00007F   F0           MOVX    @DPTR,A
   \   000080   8E82         MOV     DPL,R6
   \   000082   8F83         MOV     DPH,R7
   \   000084   A3           INC     DPTR
   \   000085   AE82         MOV     R6,DPL
   \   000087   AF83         MOV     R7,DPH
   1025          
   1026            ieeeAddr = NLME_GetExtAddr();
   \   000089                ; Setup parameters for call to function NLME_GetExtAddr
   \   000089   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00008C   7401         MOV     A,#0x1
   \   00008E   12....       LCALL   ?XSTACK_DISP0_8
   \   000091   EA           MOV     A,R2
   \   000092   F0           MOVX    @DPTR,A
   \   000093   A3           INC     DPTR
   \   000094   EB           MOV     A,R3
   \   000095   F0           MOVX    @DPTR,A
   1027            pBuf = osal_cpyExtAddr( pBuf, ieeeAddr );
   \   000096                ; Setup parameters for call to function osal_cpyExtAddr
   \   000096   7401         MOV     A,#0x1
   \   000098   12....       LCALL   ?XSTACK_DISP0_8
   \   00009B   E0           MOVX    A,@DPTR
   \   00009C   FC           MOV     R4,A
   \   00009D   A3           INC     DPTR
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   FD           MOV     R5,A
   \   0000A0   EE           MOV     A,R6
   \   0000A1   FA           MOV     R2,A
   \   0000A2   EF           MOV     A,R7
   \   0000A3   FB           MOV     R3,A
   \   0000A4   12....       LCALL   ??osal_cpyExtAddr?relay
   \   0000A7   8A..         MOV     ?V0 + 4,R2
   \   0000A9   8B..         MOV     ?V0 + 5,R3
   \   0000AB   AE..         MOV     R6,?V0 + 4
   \   0000AD   AF..         MOV     R7,?V0 + 5
   1028            
   1029            *pBuf++ = endPoint;
   \   0000AF   85..82       MOV     DPL,?XSP + 0
   \   0000B2   85..83       MOV     DPH,?XSP + 1
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   8E82         MOV     DPL,R6
   \   0000B8   8F83         MOV     DPH,R7
   \   0000BA   F0           MOVX    @DPTR,A
   \   0000BB   8E82         MOV     DPL,R6
   \   0000BD   8F83         MOV     DPH,R7
   \   0000BF   A3           INC     DPTR
   \   0000C0   AE82         MOV     R6,DPL
   \   0000C2   AF83         MOV     R7,DPH
   1030          
   1031            *pBuf++ = LO_UINT16( ProfileID );   // Profile ID
   \   0000C4   7413         MOV     A,#0x13
   \   0000C6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   8E82         MOV     DPL,R6
   \   0000CC   8F83         MOV     DPH,R7
   \   0000CE   F0           MOVX    @DPTR,A
   \   0000CF   8E82         MOV     DPL,R6
   \   0000D1   8F83         MOV     DPH,R7
   \   0000D3   A3           INC     DPTR
   \   0000D4   AE82         MOV     R6,DPL
   \   0000D6   AF83         MOV     R7,DPH
   1032            *pBuf++ = HI_UINT16( ProfileID );
   \   0000D8   7413         MOV     A,#0x13
   \   0000DA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DD   A3           INC     DPTR
   \   0000DE   E0           MOVX    A,@DPTR
   \   0000DF   F9           MOV     R1,A
   \   0000E0   E9           MOV     A,R1
   \   0000E1   8E82         MOV     DPL,R6
   \   0000E3   8F83         MOV     DPH,R7
   \   0000E5   F0           MOVX    @DPTR,A
   \   0000E6   8E82         MOV     DPL,R6
   \   0000E8   8F83         MOV     DPH,R7
   \   0000EA   A3           INC     DPTR
   \   0000EB   AE82         MOV     R6,DPL
   \   0000ED   AF83         MOV     R7,DPH
   1033          
   1034            *pBuf++ = NumInClusters; // Input cluster list
   \   0000EF   7415         MOV     A,#0x15
   \   0000F1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F4   E0           MOVX    A,@DPTR
   \   0000F5   8E82         MOV     DPL,R6
   \   0000F7   8F83         MOV     DPH,R7
   \   0000F9   F0           MOVX    @DPTR,A
   \   0000FA   8E82         MOV     DPL,R6
   \   0000FC   8F83         MOV     DPH,R7
   \   0000FE   A3           INC     DPTR
   \   0000FF   AE82         MOV     R6,DPL
   \   000101   AF83         MOV     R7,DPH
   1035            for ( i = 0; i < NumInClusters; ++i )
   \   000103   75..00       MOV     ?V0 + 0,#0x0
   \                     ??ZDP_EndDeviceBindReq_4:
   \   000106   7415         MOV     A,#0x15
   \   000108   12....       LCALL   ?XSTACK_DISP0_8
   \   00010B   E0           MOVX    A,@DPTR
   \   00010C   FA           MOV     R2,A
   \   00010D   E5..         MOV     A,?V0 + 0
   \   00010F   C3           CLR     C
   \   000110   9A           SUBB    A,R2
   \   000111   5076         JNC     ??ZDP_EndDeviceBindReq_5
   1036            {
   1037              *pBuf++ = LO_UINT16(InClusterList[i]);
   \   000113   A8..         MOV     R0,?V0 + 0
   \   000115   7900         MOV     R1,#0x0
   \   000117   E8           MOV     A,R0
   \   000118   75F002       MOV     B,#0x2
   \   00011B   A4           MUL     AB
   \   00011C   C8           XCH     A,R0
   \   00011D   AAF0         MOV     R2,B
   \   00011F   75F000       MOV     B,#0x0
   \   000122   A4           MUL     AB
   \   000123   2A           ADD     A,R2
   \   000124   FA           MOV     R2,A
   \   000125   75F002       MOV     B,#0x2
   \   000128   E9           MOV     A,R1
   \   000129   A4           MUL     AB
   \   00012A   2A           ADD     A,R2
   \   00012B   F9           MOV     R1,A
   \   00012C   7416         MOV     A,#0x16
   \   00012E   12....       LCALL   ?XSTACK_DISP0_8
   \   000131   E0           MOVX    A,@DPTR
   \   000132   28           ADD     A,R0
   \   000133   FA           MOV     R2,A
   \   000134   A3           INC     DPTR
   \   000135   E0           MOVX    A,@DPTR
   \   000136   39           ADDC    A,R1
   \   000137   8A82         MOV     DPL,R2
   \   000139   F583         MOV     DPH,A
   \   00013B   E0           MOVX    A,@DPTR
   \   00013C   8E82         MOV     DPL,R6
   \   00013E   8F83         MOV     DPH,R7
   \   000140   F0           MOVX    @DPTR,A
   \   000141   8E82         MOV     DPL,R6
   \   000143   8F83         MOV     DPH,R7
   \   000145   A3           INC     DPTR
   \   000146   AE82         MOV     R6,DPL
   \   000148   AF83         MOV     R7,DPH
   1038              *pBuf++ = HI_UINT16(InClusterList[i]);
   \   00014A   A8..         MOV     R0,?V0 + 0
   \   00014C   7900         MOV     R1,#0x0
   \   00014E   E8           MOV     A,R0
   \   00014F   75F002       MOV     B,#0x2
   \   000152   A4           MUL     AB
   \   000153   C8           XCH     A,R0
   \   000154   AAF0         MOV     R2,B
   \   000156   75F000       MOV     B,#0x0
   \   000159   A4           MUL     AB
   \   00015A   2A           ADD     A,R2
   \   00015B   FA           MOV     R2,A
   \   00015C   75F002       MOV     B,#0x2
   \   00015F   E9           MOV     A,R1
   \   000160   A4           MUL     AB
   \   000161   2A           ADD     A,R2
   \   000162   F9           MOV     R1,A
   \   000163   7416         MOV     A,#0x16
   \   000165   12....       LCALL   ?XSTACK_DISP0_8
   \   000168   E0           MOVX    A,@DPTR
   \   000169   28           ADD     A,R0
   \   00016A   FA           MOV     R2,A
   \   00016B   A3           INC     DPTR
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   39           ADDC    A,R1
   \   00016E   8A82         MOV     DPL,R2
   \   000170   F583         MOV     DPH,A
   \   000172   A3           INC     DPTR
   \   000173   E0           MOVX    A,@DPTR
   \   000174   F9           MOV     R1,A
   \   000175   E9           MOV     A,R1
   \   000176   8E82         MOV     DPL,R6
   \   000178   8F83         MOV     DPH,R7
   \   00017A   F0           MOVX    @DPTR,A
   \   00017B   8E82         MOV     DPL,R6
   \   00017D   8F83         MOV     DPH,R7
   \   00017F   A3           INC     DPTR
   \   000180   AE82         MOV     R6,DPL
   \   000182   AF83         MOV     R7,DPH
   1039            }
   \   000184   05..         INC     ?V0 + 0
   \   000186   02....       LJMP    ??ZDP_EndDeviceBindReq_4 & 0xFFFF
   1040          
   1041            *pBuf++ = NumOutClusters; // Output cluster list
   \                     ??ZDP_EndDeviceBindReq_5:
   \   000189   7418         MOV     A,#0x18
   \   00018B   12....       LCALL   ?XSTACK_DISP0_8
   \   00018E   E0           MOVX    A,@DPTR
   \   00018F   8E82         MOV     DPL,R6
   \   000191   8F83         MOV     DPH,R7
   \   000193   F0           MOVX    @DPTR,A
   \   000194   8E82         MOV     DPL,R6
   \   000196   8F83         MOV     DPH,R7
   \   000198   A3           INC     DPTR
   \   000199   AE82         MOV     R6,DPL
   \   00019B   AF83         MOV     R7,DPH
   1042            for ( i = 0; i < NumOutClusters; ++i )
   \   00019D   75..00       MOV     ?V0 + 0,#0x0
   \                     ??ZDP_EndDeviceBindReq_6:
   \   0001A0   7418         MOV     A,#0x18
   \   0001A2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A5   E0           MOVX    A,@DPTR
   \   0001A6   FA           MOV     R2,A
   \   0001A7   E5..         MOV     A,?V0 + 0
   \   0001A9   C3           CLR     C
   \   0001AA   9A           SUBB    A,R2
   \   0001AB   5076         JNC     ??ZDP_EndDeviceBindReq_7
   1043            {
   1044              *pBuf++ = LO_UINT16(OutClusterList[i]);
   \   0001AD   A8..         MOV     R0,?V0 + 0
   \   0001AF   7900         MOV     R1,#0x0
   \   0001B1   E8           MOV     A,R0
   \   0001B2   75F002       MOV     B,#0x2
   \   0001B5   A4           MUL     AB
   \   0001B6   C8           XCH     A,R0
   \   0001B7   AAF0         MOV     R2,B
   \   0001B9   75F000       MOV     B,#0x0
   \   0001BC   A4           MUL     AB
   \   0001BD   2A           ADD     A,R2
   \   0001BE   FA           MOV     R2,A
   \   0001BF   75F002       MOV     B,#0x2
   \   0001C2   E9           MOV     A,R1
   \   0001C3   A4           MUL     AB
   \   0001C4   2A           ADD     A,R2
   \   0001C5   F9           MOV     R1,A
   \   0001C6   7419         MOV     A,#0x19
   \   0001C8   12....       LCALL   ?XSTACK_DISP0_8
   \   0001CB   E0           MOVX    A,@DPTR
   \   0001CC   28           ADD     A,R0
   \   0001CD   FA           MOV     R2,A
   \   0001CE   A3           INC     DPTR
   \   0001CF   E0           MOVX    A,@DPTR
   \   0001D0   39           ADDC    A,R1
   \   0001D1   8A82         MOV     DPL,R2
   \   0001D3   F583         MOV     DPH,A
   \   0001D5   E0           MOVX    A,@DPTR
   \   0001D6   8E82         MOV     DPL,R6
   \   0001D8   8F83         MOV     DPH,R7
   \   0001DA   F0           MOVX    @DPTR,A
   \   0001DB   8E82         MOV     DPL,R6
   \   0001DD   8F83         MOV     DPH,R7
   \   0001DF   A3           INC     DPTR
   \   0001E0   AE82         MOV     R6,DPL
   \   0001E2   AF83         MOV     R7,DPH
   1045              *pBuf++ = HI_UINT16(OutClusterList[i]);
   \   0001E4   A8..         MOV     R0,?V0 + 0
   \   0001E6   7900         MOV     R1,#0x0
   \   0001E8   E8           MOV     A,R0
   \   0001E9   75F002       MOV     B,#0x2
   \   0001EC   A4           MUL     AB
   \   0001ED   C8           XCH     A,R0
   \   0001EE   AAF0         MOV     R2,B
   \   0001F0   75F000       MOV     B,#0x0
   \   0001F3   A4           MUL     AB
   \   0001F4   2A           ADD     A,R2
   \   0001F5   FA           MOV     R2,A
   \   0001F6   75F002       MOV     B,#0x2
   \   0001F9   E9           MOV     A,R1
   \   0001FA   A4           MUL     AB
   \   0001FB   2A           ADD     A,R2
   \   0001FC   F9           MOV     R1,A
   \   0001FD   7419         MOV     A,#0x19
   \   0001FF   12....       LCALL   ?XSTACK_DISP0_8
   \   000202   E0           MOVX    A,@DPTR
   \   000203   28           ADD     A,R0
   \   000204   FA           MOV     R2,A
   \   000205   A3           INC     DPTR
   \   000206   E0           MOVX    A,@DPTR
   \   000207   39           ADDC    A,R1
   \   000208   8A82         MOV     DPL,R2
   \   00020A   F583         MOV     DPH,A
   \   00020C   A3           INC     DPTR
   \   00020D   E0           MOVX    A,@DPTR
   \   00020E   F9           MOV     R1,A
   \   00020F   E9           MOV     A,R1
   \   000210   8E82         MOV     DPL,R6
   \   000212   8F83         MOV     DPH,R7
   \   000214   F0           MOVX    @DPTR,A
   \   000215   8E82         MOV     DPL,R6
   \   000217   8F83         MOV     DPH,R7
   \   000219   A3           INC     DPTR
   \   00021A   AE82         MOV     R6,DPL
   \   00021C   AF83         MOV     R7,DPH
   1046            }
   \   00021E   05..         INC     ?V0 + 0
   \   000220   02....       LJMP    ??ZDP_EndDeviceBindReq_6 & 0xFFFF
   1047          
   1048            return fillAndSend( &ZDP_TransID, dstAddr, End_Device_Bind_req, len );
   \                     ??ZDP_EndDeviceBindReq_7:
   \   000223                ; Setup parameters for call to function fillAndSend
   \   000223   75..20       MOV     ?V0 + 4,#0x20
   \   000226   75..00       MOV     ?V0 + 5,#0x0
   \   000229   78..         MOV     R0,#?V0 + 4
   \   00022B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00022E   A9..         MOV     R1,?V0 + 1
   \   000230   7405         MOV     A,#0x5
   \   000232   12....       LCALL   ?XSTACK_DISP0_8
   \   000235   E0           MOVX    A,@DPTR
   \   000236   FC           MOV     R4,A
   \   000237   A3           INC     DPTR
   \   000238   E0           MOVX    A,@DPTR
   \   000239   FD           MOV     R5,A
   \   00023A   7A..         MOV     R2,#(ZDP_TransID & 0xff)
   \   00023C   7B..         MOV     R3,#((ZDP_TransID >> 8) & 0xff)
   \   00023E   12....       LCALL   ??fillAndSend?relay
   \   000241   7402         MOV     A,#0x2
   \   000243   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??ZDP_EndDeviceBindReq_1:
   \   000246   7405         MOV     A,#0x5
   \   000248   12....       LCALL   ?DEALLOC_XSTACK8
   \   00024B   7F06         MOV     R7,#0x6
   \   00024D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1049          }
   1050          #endif // ZDO_ENDDEVICEBIND_REQUEST
   1051          
   1052          #if defined ( ZDO_BIND_UNBIND_REQUEST ) || defined ( ZDO_COORDINATOR )
   1053          /*********************************************************************
   1054           * @fn          ZDP_BindUnbindReq
   1055           *
   1056           * @brief       This builds and send a Bind_req or Unbind_req message
   1057           *              Depending on the ClusterID. This function
   1058           *              sends a unicast message to the local coordinator.
   1059           *
   1060           * @param       BindOrUnbind - either Bind_req or Unbind_req
   1061           * @param       dstAddr - destination address of the message
   1062           * @param       SourceAddr - source 64 bit address of the binding
   1063           * @param       SrcEPIntf - Source endpoint/interface
   1064           * @param       ClusterID - Binding cluster ID
   1065           * @param       DestinationAddr - destination 64 bit addr of binding
   1066           * @param       DstEPIntf - destination endpoint/interface
   1067           * @param       SecurityEnable - Security Options
   1068           *
   1069           * @return      afStatus_t
   1070           */
   1071          afStatus_t ZDP_BindUnbindReq( uint16 BindOrUnbind, zAddrType_t *dstAddr,
   1072                                        byte *SourceAddr, byte SrcEndPoint,
   1073                                        cId_t ClusterID,
   1074                                        zAddrType_t *destinationAddr, byte DstEndPoint,
   1075                                        byte SecurityEnable )
   1076          {
   1077            uint8 *pBuf = ZDP_TmpBuf;
   1078            byte len;
   1079          
   1080            // SourceAddr + SrcEPIntf + ClusterID +  addrMode.
   1081            len = Z_EXTADDR_LEN + 1 + sizeof( cId_t ) + sizeof( uint8 );
   1082            if ( destinationAddr->addrMode == Addr64Bit )
   1083              len += Z_EXTADDR_LEN + 1;     // +1 for DstEPIntf
   1084            else if ( destinationAddr->addrMode == AddrGroup )
   1085              len += sizeof ( uint16 );
   1086          
   1087            pBuf = osal_cpyExtAddr( pBuf, SourceAddr );
   1088            *pBuf++ = SrcEndPoint;
   1089          
   1090            *pBuf++ = LO_UINT16( ClusterID );
   1091          
   1092            *pBuf++ = HI_UINT16( ClusterID );
   1093            *pBuf++ = destinationAddr->addrMode;
   1094            if ( destinationAddr->addrMode == Addr64Bit )
   1095            {
   1096              pBuf = osal_cpyExtAddr( pBuf, destinationAddr->addr.extAddr );
   1097              *pBuf = DstEndPoint;
   1098            }
   1099            else if ( destinationAddr->addrMode == AddrGroup )
   1100            {
   1101              *pBuf++ = LO_UINT16( destinationAddr->addr.shortAddr );
   1102              *pBuf++ = HI_UINT16( destinationAddr->addr.shortAddr );
   1103            }
   1104          
   1105            FillAndSendTxOptions( &ZDP_TransID, dstAddr, BindOrUnbind, len, AF_MSG_ACK_REQUEST );
   1106          }
   1107          #endif // ZDO_BIND_UNBIND_REQUEST
   1108          
   1109          /*********************************************************************
   1110           * Network Management
   1111           */
   1112          
   1113          #if defined ( ZDO_MGMT_NWKDISC_REQUEST )
   1114          /*********************************************************************
   1115           * @fn          ZDP_MgmtNwkDiscReq
   1116           *
   1117           * @brief       This builds and send a Mgmt_NWK_Disc_req message. This
   1118           *              function sends a unicast message.
   1119           *
   1120           * @param       dstAddr - destination address of the message
   1121           * @param       ScanChannels - 32 bit address bit map
   1122           * @param       StartIndex - Starting index within the reporting network
   1123           *                           list
   1124           * @param       SecurityEnable - Security Options
   1125           *
   1126           * @return      afStatus_t
   1127           */
   1128          afStatus_t ZDP_MgmtNwkDiscReq( zAddrType_t *dstAddr,
   1129                                         uint32 ScanChannels,
   1130                                         byte ScanDuration,
   1131                                         byte StartIndex,
   1132                                         byte SecurityEnable )
   1133          {
   1134            byte *pBuf = ZDP_TmpBuf;
   1135            byte len = sizeof( uint32 )+1+1;  // ScanChannels + ScanDuration + StartIndex.
   1136          
   1137            *pBuf++ = BREAK_UINT32( ScanChannels, 0 );
   1138            *pBuf++ = BREAK_UINT32( ScanChannels, 1 );
   1139            *pBuf++ = BREAK_UINT32( ScanChannels, 2 );
   1140            *pBuf++ = BREAK_UINT32( ScanChannels, 3 );
   1141          
   1142            *pBuf++ = ScanDuration;
   1143            *pBuf = StartIndex;
   1144          
   1145            return fillAndSend( &ZDP_TransID, dstAddr, Mgmt_NWK_Disc_req, len );
   1146          }
   1147          #endif // ZDO_MGMT_NWKDISC_REQUEST
   1148          
   1149          #if defined ( ZDO_MGMT_JOINDIRECT_REQUEST )
   1150          /*********************************************************************
   1151           * @fn          ZDP_MgmtDirectJoinReq
   1152           *
   1153           * @brief       This builds and send a Mgmt_Direct_Join_req message. This
   1154           *              function sends a unicast message.
   1155           *
   1156           * @param       dstAddr - destination address of the message
   1157           * @param       deviceAddr - 64 bit IEEE Address
   1158           * @param       SecurityEnable - Security Options
   1159           *
   1160           * @return      afStatus_t
   1161           */
   1162          afStatus_t ZDP_MgmtDirectJoinReq( zAddrType_t *dstAddr,
   1163                                         byte *deviceAddr,
   1164                                         byte capInfo,
   1165                                         byte SecurityEnable )
   1166          {
   1167            osal_cpyExtAddr( ZDP_TmpBuf, deviceAddr );
   1168            ZDP_TmpBuf[Z_EXTADDR_LEN] = capInfo;
   1169          
   1170            return fillAndSend( &ZDP_TransID, dstAddr, Mgmt_Direct_Join_req, (Z_EXTADDR_LEN + 1) );
   1171          }
   1172          #endif // ZDO_MGMT_JOINDIRECT_REQUEST
   1173          
   1174          #if defined ( ZDO_MGMT_PERMIT_JOIN_REQUEST )
   1175          /*********************************************************************
   1176           * @fn          ZDP_MgmtPermitJoinReq
   1177           *
   1178           * @brief       This builds and send a Mgmt_Permit_Join_req message.
   1179           *
   1180           * @param       dstAddr - destination address of the message
   1181           * @param       duration - Permit duration
   1182           * @param       TcSignificance - Trust Center Significance
   1183           *
   1184           * @return      afStatus_t
   1185           */
   1186          afStatus_t ZDP_MgmtPermitJoinReq( zAddrType_t *dstAddr, byte duration,
   1187                                            byte TcSignificance, byte SecurityEnable )
   1188          {
   1189            // Build buffer
   1190            ZDP_TmpBuf[ZDP_MGMT_PERMIT_JOIN_REQ_DURATION] = duration;
   1191            ZDP_TmpBuf[ZDP_MGMT_PERMIT_JOIN_REQ_TC_SIG]   = TcSignificance;
   1192          
   1193            // Send the message
   1194            return fillAndSend( &ZDP_TransID, dstAddr, Mgmt_Permit_Join_req,
   1195                                ZDP_MGMT_PERMIT_JOIN_REQ_SIZE );
   1196          }
   1197          #endif // ZDO_MGMT_PERMIT_JOIN_REQUEST
   1198          
   1199          /*********************************************************************
   1200           * Network Management Responses
   1201           */
   1202          
   1203          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1204          /*********************************************************************
   1205           * @fn          ZDP_MgmtNwkDiscRsp
   1206           *
   1207           * @brief       This builds and send a Mgmt_NWK_Disc_rsp message. This
   1208           *              function sends a unicast message.
   1209           *
   1210           * @param       dstAddr - destination address of the message
   1211           * @param       Status - message status (ZDP_SUCCESS or other)
   1212           * @param       NetworkCount - Total number of networks found
   1213           * @param       StartIndex - Starting index within the reporting network
   1214           *                           list
   1215           * @param       NetworkListCount - number of network lists included
   1216           *                                 in this message
   1217           * @param       NetworkList - List of network descriptors
   1218           * @param       SecurityEnable - Security Options
   1219           *
   1220           * @return      afStatus_t
   1221           */
   1222          afStatus_t ZDP_MgmtNwkDiscRsp( byte TransSeq, zAddrType_t *dstAddr,
   1223                                      byte Status,
   1224                                      byte NetworkCount,
   1225                                      byte StartIndex,
   1226                                      byte NetworkListCount,
   1227                                      networkDesc_t *NetworkList,
   1228                                      byte SecurityEnable )
   1229          {
   1230            byte *buf;
   1231            byte *pBuf;
   1232            byte len = 1+1+1+1;  // Status + NetworkCount + StartIndex + NetworkCountList.
   1233            byte idx;
   1234          
   1235            len += ((NetworkListCount - StartIndex) * ( ZDP_NETWORK_EXTENDED_DISCRIPTOR_SIZE - 2 ));
   1236          
   1237            buf = osal_mem_alloc( len+1 );
   1238            if ( buf == NULL )
   1239            {
   1240              return afStatus_MEM_FAIL;
   1241            }
   1242          
   1243            pBuf = buf+1;
   1244          
   1245            *pBuf++ = Status;
   1246            *pBuf++ = NetworkCount;
   1247            *pBuf++ = StartIndex;
   1248            *pBuf++ = NetworkListCount;
   1249          
   1250            for ( idx = StartIndex; idx < (NetworkListCount - StartIndex); idx++ )
   1251            {
   1252              osal_cpyExtAddr( pBuf, NetworkList->extendedPANID);
   1253              pBuf += Z_EXTADDR_LEN;
   1254             
   1255              *pBuf++  = NetworkList->logicalChannel;                // LogicalChannel
   1256              *pBuf    = NetworkList->stackProfile;                  // Stack profile
   1257              *pBuf++ |= (byte)(NetworkList->version << 4);          // ZigBee Version
   1258              *pBuf    = NetworkList->beaconOrder;                   // Beacon Order
   1259              *pBuf++ |= (byte)(NetworkList->superFrameOrder << 4);  // Superframe Order
   1260          
   1261              if ( NetworkList->chosenRouter != INVALID_NODE_ADDR )
   1262              {
   1263                *pBuf++ = TRUE;                         // Permit Joining
   1264              }
   1265              else
   1266              {
   1267                *pBuf++ = FALSE;
   1268              }
   1269          
   1270              NetworkList = NetworkList->nextDesc;    // Move to next list entry
   1271            }
   1272          
   1273            FillAndSendBuffer( &TransSeq, dstAddr, Mgmt_NWK_Disc_rsp, len, buf );
   1274          }
   1275          #endif // ZDO_MGMT_NWKDISC_RESPONSE
   1276          
   1277          #if defined ( ZDO_MGMT_LQI_RESPONSE ) && defined ( RTR_NWK )
   1278          /*********************************************************************
   1279           * @fn          ZDP_MgmtLqiRsp
   1280           *
   1281           * @brief       This builds and send a Mgmt_Lqi_rsp message. This
   1282           *              function sends a unicast message.
   1283           *
   1284           * @param       dstAddr - destination address of the message
   1285           * @param       Status - message status (ZDP_SUCCESS or other)
   1286           * @param       NeighborLqiEntries - Total number of entries found
   1287           * @param       StartIndex - Starting index within the reporting list
   1288           * @param       NeighborLqiCount - number of lists included
   1289           *                                 in this message
   1290           * @param       NeighborLqiList - List of NeighborLqiItems.  This list
   1291           *                is the list to be sent, not the entire list
   1292           * @param       SecurityEnable - true if secure
   1293           *
   1294           * @return      ZStatus_t
   1295           */
   1296          ZStatus_t ZDP_MgmtLqiRsp( byte TransSeq, zAddrType_t *dstAddr,
   1297                                    byte Status,
   1298                                    byte NeighborLqiEntries,
   1299                                    byte StartIndex,
   1300                                    byte NeighborLqiCount,
   1301                                    ZDP_MgmtLqiItem_t* NeighborList,
   1302                                    byte SecurityEnable )
   1303          {
   1304            ZDP_MgmtLqiItem_t* list = NeighborList;
   1305            byte *buf, *pBuf;
   1306            byte len, x;
   1307          
   1308            if ( ZSuccess != Status )
   1309            {
   1310              ZDP_TmpBuf[0] = Status;
   1311              return fillAndSend( &TransSeq, dstAddr, Mgmt_Lqi_rsp, 1 );
   1312            }
   1313          
   1314            // (Status + NeighborLqiEntries + StartIndex + NeighborLqiCount) +
   1315            //  neighbor LQI data.
   1316            len = (1 + 1 + 1 + 1) + (NeighborLqiCount * ZDP_MGMTLQI_EXTENDED_SIZE);
   1317          
   1318            buf = osal_mem_alloc( len+1 );
   1319            if ( buf == NULL )
   1320            {
   1321              return afStatus_MEM_FAIL;
   1322            }
   1323          
   1324            pBuf = buf+1;
   1325          
   1326            *pBuf++ = Status;
   1327            *pBuf++ = NeighborLqiEntries;
   1328            *pBuf++ = StartIndex;
   1329            *pBuf++ = NeighborLqiCount;
   1330          
   1331            for ( x = 0; x < NeighborLqiCount; x++ )
   1332            {
   1333              osal_cpyExtAddr( pBuf, list->extPanID);         // Extended PanID
   1334              pBuf += Z_EXTADDR_LEN;
   1335             
   1336              // EXTADDR
   1337              pBuf = osal_cpyExtAddr( pBuf, list->extAddr );
   1338          
   1339              // NWKADDR
   1340              *pBuf++ = LO_UINT16( list->nwkAddr );
   1341              *pBuf++ = HI_UINT16( list->nwkAddr );
   1342          
   1343              // DEVICETYPE
   1344              *pBuf = list->devType;
   1345          
   1346              // RXONIDLE
   1347              *pBuf |= (uint8)(list->rxOnIdle << 2);
   1348          
   1349              // RELATIONSHIP
   1350              *pBuf++ |= (uint8)(list->relation << 4);
   1351          
   1352              // PERMITJOINING
   1353              *pBuf++ = (uint8)(list->permit);
   1354          
   1355              // DEPTH
   1356              *pBuf++ = list->depth;
   1357              
   1358              // LQI
   1359              *pBuf++ = list->lqi;
   1360          
   1361              list++; // next list entry
   1362            }
   1363          
   1364            FillAndSendBuffer( &TransSeq, dstAddr, Mgmt_Lqi_rsp, len, buf );
   1365          }
   1366          #endif // ZDO_MGMT_LQI_RESPONSE && RTR_NWK
   1367          
   1368          #if defined ( ZDO_MGMT_RTG_RESPONSE )
   1369          /*********************************************************************
   1370           * @fn          ZDP_MgmtRtgRsp
   1371           *
   1372           * @brief       This builds and send a Mgmt_Rtg_rsp message. This
   1373           *              function sends a unicast message.
   1374           *
   1375           * @param       dstAddr - destination address of the message
   1376           * @param       Status - message status (ZDP_SUCCESS or other)
   1377           * @param       RoutingTableEntries - Total number of entries
   1378           * @param       StartIndex - Starting index within the reporting list
   1379           * @param       RoutingTableListCount - number of entries included
   1380           *                                      in this message
   1381           * @param       RoutingTableList - List of Routing Table entries
   1382           * @param       SecurityEnable - true to enable security for this message
   1383           *
   1384           * @return      ZStatus_t
   1385           */
   1386          ZStatus_t ZDP_MgmtRtgRsp( byte TransSeq, zAddrType_t *dstAddr,
   1387                                      byte Status,
   1388                                      byte RoutingTableEntries,
   1389                                      byte StartIndex,
   1390                                      byte RoutingListCount,
   1391                                      rtgItem_t *RoutingTableList,
   1392                                      byte SecurityEnable )
   1393          {
   1394            byte *buf;
   1395            byte *pBuf;
   1396            // Status + RoutingTableEntries + StartIndex + RoutingListCount.
   1397            byte len = 1 + 1 + 1 + 1;
   1398            byte x;
   1399          
   1400            // Add an array for Routing List data
   1401            len += (RoutingListCount * ZDP_ROUTINGENTRY_SIZE);
   1402          
   1403            buf = osal_mem_alloc( (short)(len+1) );
   1404            if ( buf == NULL )
   1405            {
   1406              return afStatus_MEM_FAIL;
   1407            }
   1408          
   1409            pBuf = buf+1;
   1410          
   1411            *pBuf++ = Status;
   1412            *pBuf++ = RoutingTableEntries;
   1413            *pBuf++ = StartIndex;
   1414            *pBuf++ = RoutingListCount;
   1415          
   1416            for ( x = 0; x < RoutingListCount; x++ )
   1417            {
   1418              *pBuf++ = LO_UINT16( RoutingTableList->dstAddress );  // Destination Address
   1419              *pBuf++ = HI_UINT16( RoutingTableList->dstAddress );
   1420              *pBuf++ = RoutingTableList->status;
   1421              *pBuf++ = LO_UINT16( RoutingTableList->nextHopAddress );  // Next hop
   1422              *pBuf++ = HI_UINT16( RoutingTableList->nextHopAddress );
   1423              RoutingTableList++;    // Move to next list entry
   1424            }
   1425          
   1426            FillAndSendBuffer( &TransSeq, dstAddr, Mgmt_Rtg_rsp, len, buf );
   1427          }
   1428          #endif // ZDO_MGMT_RTG_RESPONSE
   1429          
   1430          #if defined ( ZDO_MGMT_BIND_RESPONSE ) && defined ( REFLECTOR )
   1431          /*********************************************************************
   1432           * @fn          ZDP_MgmtBindRsp
   1433           *
   1434           * @brief       This builds and send a Mgmt_Bind_rsp message. This
   1435           *              function sends a unicast message.
   1436           *
   1437           * @param       dstAddr - destination address of the message
   1438           * @param       Status - message status (ZDP_SUCCESS or other)
   1439           * @param       BindingTableEntries - Total number of entries
   1440           * @param       StartIndex - Starting index within the reporting list
   1441           * @param       BindingTableListCount - number of entries included
   1442           *                                 in this message
   1443           * @param       BindingTableList - List of Binding Table entries
   1444           * @param       SecurityEnable - Security Options
   1445           *
   1446           * @return      ZStatus_t
   1447           */
   1448          ZStatus_t ZDP_MgmtBindRsp( byte TransSeq, zAddrType_t *dstAddr,
   1449                                      byte Status,
   1450                                      byte BindingTableEntries,
   1451                                      byte StartIndex,
   1452                                      byte BindingTableListCount,
   1453                                      apsBindingItem_t *BindingTableList,
   1454                                      byte SecurityEnable )
   1455          {
   1456            uint8 *buf;
   1457            uint8 *pBuf;
   1458            uint8 maxLen; // maxLen is the maximum packet length to allocate enough memory space
   1459            uint8 len;    // Actual length varies due to different addrMode
   1460            uint8 x;
   1461            byte extZdpBindEntrySize = ZDP_BINDINGENTRY_SIZE + 1 + 1; // One more byte for cluserID and DstAddrMode
   1462            byte shortZdpBindEntrySize = ZDP_BINDINGENTRY_SIZE + 1 + 1 + 2 - 8 - 1; // clusterID + DstAddrMode + shortAddr - ExtAddr - DstEndpoint
   1463          
   1464            // Status + BindingTableEntries + StartIndex + BindingTableListCount.
   1465            maxLen = 1 + 1 + 1 + 1;
   1466            maxLen += (BindingTableListCount * extZdpBindEntrySize );  //max length
   1467            buf = osal_mem_alloc( maxLen + 1 );  // +1 for transaction ID
   1468          
   1469            if ( buf == NULL )
   1470            {
   1471              return afStatus_MEM_FAIL;
   1472            }
   1473          
   1474            pBuf = buf+1;
   1475          
   1476            *pBuf++ = Status;
   1477            *pBuf++ = BindingTableEntries;
   1478            *pBuf++ = StartIndex;
   1479            *pBuf++ = BindingTableListCount;
   1480          
   1481            // Initial length = Status + BindingTableEntries + StartIndex + BindingTableListCount.
   1482            // length += ZDP_BINDINGENTRY_SIZE   -- Version 1.0
   1483            //           extZdpBindEntrySize     -- Version 1.1 extended address mode
   1484            //           shortZdpBindEntrySize   -- Version 1.1 group address mode
   1485          
   1486            len = 1 + 1 + 1 + 1;
   1487            for ( x = 0; x < BindingTableListCount; x++ )
   1488            {
   1489              pBuf = osal_cpyExtAddr( pBuf, BindingTableList->srcAddr );
   1490              *pBuf++ = BindingTableList->srcEP;
   1491          
   1492              // Cluster ID
   1493              *pBuf++ = LO_UINT16( BindingTableList->clusterID );
   1494              *pBuf++ = HI_UINT16( BindingTableList->clusterID );
   1495          
   1496              *pBuf++ = BindingTableList->dstAddr.addrMode;
   1497              if ( BindingTableList->dstAddr.addrMode == Addr64Bit )
   1498              {
   1499                len += extZdpBindEntrySize;
   1500                pBuf = osal_cpyExtAddr( pBuf, BindingTableList->dstAddr.addr.extAddr );
   1501                *pBuf++ = BindingTableList->dstEP;
   1502              }
   1503              else
   1504              {
   1505                len += shortZdpBindEntrySize;
   1506                *pBuf++ = LO_UINT16( BindingTableList->dstAddr.addr.shortAddr );
   1507                *pBuf++ = HI_UINT16( BindingTableList->dstAddr.addr.shortAddr );
   1508              }  
   1509              BindingTableList++;    // Move to next list entry
   1510            }
   1511          
   1512            FillAndSendBuffer( &TransSeq, dstAddr, Mgmt_Bind_rsp, len, buf );
   1513          }
   1514          #endif // ZDO_MGMT_BIND_RESPONSE && REFLECTOR
   1515          
   1516          /*********************************************************************
   1517           * Functions to register for ZDO Over-the-air messages
   1518           */
   1519          
   1520          /*********************************************************************
   1521           * @fn          ZDO_RegisterForZDOMsg
   1522           *
   1523           * @brief       Call this function to register of an incoming over
   1524           *              the air ZDO message - probably a response message
   1525           *              but requests can also be received.
   1526           *              Messages are delivered to the task with ZDO_CB_MSG
   1527           *              as the message ID.
   1528           *
   1529           * @param       taskID - Where you would like the message delivered
   1530           * @param       clusterID - What message?
   1531           *
   1532           * @return      ZSuccess - successful, ZMemError if not 
   1533           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1534          ZStatus_t ZDO_RegisterForZDOMsg( uint8 taskID, uint16 clusterID )
   \                     ZDO_RegisterForZDOMsg:
   1535          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 2,R1
   \   00000C   8A..         MOV     ?V0 + 6,R2
   \   00000E   8B..         MOV     ?V0 + 7,R3
   1536            ZDO_MsgCB_t *pList;
   1537            ZDO_MsgCB_t *pLast;
   1538            ZDO_MsgCB_t *pNew;
   1539          
   1540            // Look for duplicate
   1541            pList = zdoMsgCBs;
   \   000010   90....       MOV     DPTR,#zdoMsgCBs
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F8           MOV     R0,A
   \   000015   A3           INC     DPTR
   \   000016   E0           MOVX    A,@DPTR
   \   000017   F9           MOV     R1,A
   \   000018   E8           MOV     A,R0
   \   000019   FE           MOV     R6,A
   \   00001A   E9           MOV     A,R1
   \   00001B   FF           MOV     R7,A
   1542            while ( pList )
   \                     ??ZDO_RegisterForZDOMsg_0:
   \   00001C   EE           MOV     A,R6
   \   00001D   6400         XRL     A,#0x0
   \   00001F   7003         JNZ     ??ZDO_RegisterForZDOMsg_1
   \   000021   EF           MOV     A,R7
   \   000022   6400         XRL     A,#0x0
   \                     ??ZDO_RegisterForZDOMsg_1:
   \   000024   6038         JZ      ??ZDO_RegisterForZDOMsg_2
   1543            {
   1544              if ( pList->taskID == taskID && pList->clusterID == clusterID )
   \   000026   8E82         MOV     DPL,R6
   \   000028   8F83         MOV     DPH,R7
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   65..         XRL     A,?V0 + 2
   \   00002F   7017         JNZ     ??ZDO_RegisterForZDOMsg_3
   \   000031   8E82         MOV     DPL,R6
   \   000033   8F83         MOV     DPH,R7
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   E0           MOVX    A,@DPTR
   \   000039   65..         XRL     A,?V0 + 6
   \   00003B   7004         JNZ     ??ZDO_RegisterForZDOMsg_4
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   65..         XRL     A,?V0 + 7
   \                     ??ZDO_RegisterForZDOMsg_4:
   \   000041   7005         JNZ     ??ZDO_RegisterForZDOMsg_3
   1545                return ( ZSuccess );
   \   000043   7900         MOV     R1,#0x0
   \   000045   02....       LJMP    ??ZDO_RegisterForZDOMsg_5 & 0xFFFF
   1546              pLast = pList;
   \                     ??ZDO_RegisterForZDOMsg_3:
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   EE           MOV     A,R6
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   EF           MOV     A,R7
   \   000052   F0           MOVX    @DPTR,A
   1547              pList = (ZDO_MsgCB_t *)pList->next;
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FE           MOV     R6,A
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   FF           MOV     R7,A
   \   00005C   80BE         SJMP    ??ZDO_RegisterForZDOMsg_0
   1548            }
   1549            
   1550            // Add to the list
   1551            pNew = (ZDO_MsgCB_t *)osal_mem_alloc( sizeof ( ZDO_MsgCB_t ) );
   \                     ??ZDO_RegisterForZDOMsg_2:
   \   00005E                ; Setup parameters for call to function osal_mem_alloc
   \   00005E   7A05         MOV     R2,#0x5
   \   000060   7B00         MOV     R3,#0x0
   \   000062   12....       LCALL   ??osal_mem_alloc?relay
   \   000065   8A..         MOV     ?V0 + 4,R2
   \   000067   8B..         MOV     ?V0 + 5,R3
   \   000069   85....       MOV     ?V0 + 0,?V0 + 4
   \   00006C   85....       MOV     ?V0 + 1,?V0 + 5
   1552            if ( pNew )
   \   00006F   E5..         MOV     A,?V0 + 0
   \   000071   6400         XRL     A,#0x0
   \   000073   7004         JNZ     ??ZDO_RegisterForZDOMsg_6
   \   000075   E5..         MOV     A,?V0 + 1
   \   000077   6400         XRL     A,#0x0
   \                     ??ZDO_RegisterForZDOMsg_6:
   \   000079   605B         JZ      ??ZDO_RegisterForZDOMsg_7
   1553            {
   1554              pNew->taskID = taskID;
   \   00007B   85..82       MOV     DPL,?V0 + 0
   \   00007E   85..83       MOV     DPH,?V0 + 1
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   E5..         MOV     A,?V0 + 2
   \   000085   F0           MOVX    @DPTR,A
   1555              pNew->clusterID = clusterID;
   \   000086   85..82       MOV     DPL,?V0 + 0
   \   000089   85..83       MOV     DPH,?V0 + 1
   \   00008C   A3           INC     DPTR
   \   00008D   A3           INC     DPTR
   \   00008E   A3           INC     DPTR
   \   00008F   E5..         MOV     A,?V0 + 6
   \   000091   F0           MOVX    @DPTR,A
   \   000092   A3           INC     DPTR
   \   000093   E5..         MOV     A,?V0 + 7
   \   000095   F0           MOVX    @DPTR,A
   1556              pNew->next = NULL;
   \   000096   85..82       MOV     DPL,?V0 + 0
   \   000099   85..83       MOV     DPH,?V0 + 1
   \   00009C   7400         MOV     A,#0x0
   \   00009E   F0           MOVX    @DPTR,A
   \   00009F   A3           INC     DPTR
   \   0000A0   7400         MOV     A,#0x0
   \   0000A2   F0           MOVX    @DPTR,A
   1557              if ( zdoMsgCBs )
   \   0000A3   90....       MOV     DPTR,#zdoMsgCBs
   \   0000A6   E0           MOVX    A,@DPTR
   \   0000A7   6400         XRL     A,#0x0
   \   0000A9   7004         JNZ     ??ZDO_RegisterForZDOMsg_8
   \   0000AB   A3           INC     DPTR
   \   0000AC   E0           MOVX    A,@DPTR
   \   0000AD   6400         XRL     A,#0x0
   \                     ??ZDO_RegisterForZDOMsg_8:
   \   0000AF   6017         JZ      ??ZDO_RegisterForZDOMsg_9
   1558              {
   1559                pLast->next = pNew;
   \   0000B1   85..82       MOV     DPL,?XSP + 0
   \   0000B4   85..83       MOV     DPH,?XSP + 1
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F8           MOV     R0,A
   \   0000B9   A3           INC     DPTR
   \   0000BA   E0           MOVX    A,@DPTR
   \   0000BB   F583         MOV     DPH,A
   \   0000BD   8882         MOV     DPL,R0
   \   0000BF   E5..         MOV     A,?V0 + 0
   \   0000C1   F0           MOVX    @DPTR,A
   \   0000C2   A3           INC     DPTR
   \   0000C3   E5..         MOV     A,?V0 + 1
   \   0000C5   F0           MOVX    @DPTR,A
   \   0000C6   800A         SJMP    ??ZDO_RegisterForZDOMsg_10
   1560              }
   1561              else
   1562                zdoMsgCBs = pNew;
   \                     ??ZDO_RegisterForZDOMsg_9:
   \   0000C8   90....       MOV     DPTR,#zdoMsgCBs
   \   0000CB   E5..         MOV     A,?V0 + 0
   \   0000CD   F0           MOVX    @DPTR,A
   \   0000CE   A3           INC     DPTR
   \   0000CF   E5..         MOV     A,?V0 + 1
   \   0000D1   F0           MOVX    @DPTR,A
   1563              return ( ZSuccess );
   \                     ??ZDO_RegisterForZDOMsg_10:
   \   0000D2   7900         MOV     R1,#0x0
   \   0000D4   8002         SJMP    ??ZDO_RegisterForZDOMsg_5
   1564            }
   1565            else
   1566              return ( ZMemError );
   \                     ??ZDO_RegisterForZDOMsg_7:
   \   0000D6   7910         MOV     R1,#0x10
   \                     ??ZDO_RegisterForZDOMsg_5:
   \   0000D8   7402         MOV     A,#0x2
   \   0000DA   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000DD   7F08         MOV     R7,#0x8
   \   0000DF   02....       LJMP    ?BANKED_LEAVE_XDATA
   1567          }
   1568          
   1569          /*********************************************************************
   1570           * @fn          ZDO_RemoveRegisteredCB
   1571           *
   1572           * @brief       Call this function if you don't want to receive the 
   1573           *              incoming message.
   1574           *
   1575           * @param       taskID - Where the messages are being delivered.
   1576           * @param       clusterID - What message?
   1577           *
   1578           * @return      ZSuccess - successful, ZFailure if not found
   1579           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1580          ZStatus_t ZDO_RemoveRegisteredCB( uint8 taskID, uint16 clusterID )
   \                     ZDO_RemoveRegisteredCB:
   1581          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 4,R1
   \   000007   8A..         MOV     ?V0 + 2,R2
   \   000009   8B..         MOV     ?V0 + 3,R3
   1582            ZDO_MsgCB_t *pList;
   1583            ZDO_MsgCB_t *pLast = NULL;
   \   00000B   75..00       MOV     ?V0 + 0,#0x0
   \   00000E   75..00       MOV     ?V0 + 1,#0x0
   1584          
   1585            pList = zdoMsgCBs;  
   \   000011   90....       MOV     DPTR,#zdoMsgCBs
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F8           MOV     R0,A
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F9           MOV     R1,A
   \   000019   E8           MOV     A,R0
   \   00001A   FE           MOV     R6,A
   \   00001B   E9           MOV     A,R1
   \   00001C   FF           MOV     R7,A
   1586            while ( pList )
   \                     ??ZDO_RemoveRegisteredCB_0:
   \   00001D   EE           MOV     A,R6
   \   00001E   6400         XRL     A,#0x0
   \   000020   7003         JNZ     ??ZDO_RemoveRegisteredCB_1
   \   000022   EF           MOV     A,R7
   \   000023   6400         XRL     A,#0x0
   \                     ??ZDO_RemoveRegisteredCB_1:
   \   000025   7003         JNZ     $+5
   \   000027   02....       LJMP    ??ZDO_RemoveRegisteredCB_2 & 0xFFFF
   1587            {
   1588              if ( pList->taskID == taskID && pList->clusterID == clusterID )
   \   00002A   8E82         MOV     DPL,R6
   \   00002C   8F83         MOV     DPH,R7
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \   000031   65..         XRL     A,?V0 + 4
   \   000033   706B         JNZ     ??ZDO_RemoveRegisteredCB_3
   \   000035   8E82         MOV     DPL,R6
   \   000037   8F83         MOV     DPH,R7
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   65..         XRL     A,?V0 + 2
   \   00003F   7004         JNZ     ??ZDO_RemoveRegisteredCB_4
   \   000041   A3           INC     DPTR
   \   000042   E0           MOVX    A,@DPTR
   \   000043   65..         XRL     A,?V0 + 3
   \                     ??ZDO_RemoveRegisteredCB_4:
   \   000045   7059         JNZ     ??ZDO_RemoveRegisteredCB_3
   1589              {
   1590                if ( pLast )
   \   000047   E5..         MOV     A,?V0 + 0
   \   000049   6400         XRL     A,#0x0
   \   00004B   7004         JNZ     ??ZDO_RemoveRegisteredCB_5
   \   00004D   E5..         MOV     A,?V0 + 1
   \   00004F   6400         XRL     A,#0x0
   \                     ??ZDO_RemoveRegisteredCB_5:
   \   000051   6016         JZ      ??ZDO_RemoveRegisteredCB_6
   1591                {
   1592                  // remove this one from the linked list
   1593                  pLast->next = pList->next;
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   F8           MOV     R0,A
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   F9           MOV     R1,A
   \   00005C   85..82       MOV     DPL,?V0 + 0
   \   00005F   85..83       MOV     DPH,?V0 + 1
   \   000062   E8           MOV     A,R0
   \   000063   F0           MOVX    @DPTR,A
   \   000064   A3           INC     DPTR
   \   000065   E9           MOV     A,R1
   \   000066   F0           MOVX    @DPTR,A
   \   000067   802C         SJMP    ??ZDO_RemoveRegisteredCB_7
   1594                }
   1595                else if ( pList->next )
   \                     ??ZDO_RemoveRegisteredCB_6:
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   6400         XRL     A,#0x0
   \   000070   7004         JNZ     ??ZDO_RemoveRegisteredCB_8
   \   000072   A3           INC     DPTR
   \   000073   E0           MOVX    A,@DPTR
   \   000074   6400         XRL     A,#0x0
   \                     ??ZDO_RemoveRegisteredCB_8:
   \   000076   6013         JZ      ??ZDO_RemoveRegisteredCB_9
   1596                {
   1597                  // remove the first one from the linked list
   1598                  zdoMsgCBs = pList->next;
   \   000078   8E82         MOV     DPL,R6
   \   00007A   8F83         MOV     DPH,R7
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   F8           MOV     R0,A
   \   00007E   A3           INC     DPTR
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   F9           MOV     R1,A
   \   000081   90....       MOV     DPTR,#zdoMsgCBs
   \   000084   E8           MOV     A,R0
   \   000085   F0           MOVX    @DPTR,A
   \   000086   A3           INC     DPTR
   \   000087   E9           MOV     A,R1
   \   000088   F0           MOVX    @DPTR,A
   \   000089   800A         SJMP    ??ZDO_RemoveRegisteredCB_7
   1599                }
   1600                else
   1601                {
   1602                  // remove the only item from the list
   1603                  zdoMsgCBs = (ZDO_MsgCB_t *)NULL;
   \                     ??ZDO_RemoveRegisteredCB_9:
   \   00008B   90....       MOV     DPTR,#zdoMsgCBs
   \   00008E   7400         MOV     A,#0x0
   \   000090   F0           MOVX    @DPTR,A
   \   000091   A3           INC     DPTR
   \   000092   7400         MOV     A,#0x0
   \   000094   F0           MOVX    @DPTR,A
   1604                }
   1605                osal_mem_free( pList );
   \                     ??ZDO_RemoveRegisteredCB_7:
   \   000095                ; Setup parameters for call to function osal_mem_free
   \   000095   EE           MOV     A,R6
   \   000096   FA           MOV     R2,A
   \   000097   EF           MOV     A,R7
   \   000098   FB           MOV     R3,A
   \   000099   12....       LCALL   ??osal_mem_free?relay
   1606                return ( ZSuccess );      
   \   00009C   7900         MOV     R1,#0x0
   \   00009E   8012         SJMP    ??ZDO_RemoveRegisteredCB_10
   1607              }
   1608              pLast = pList;
   \                     ??ZDO_RemoveRegisteredCB_3:
   \   0000A0   8E..         MOV     ?V0 + 0,R6
   \   0000A2   8F..         MOV     ?V0 + 1,R7
   1609              pList = pList->next;
   \   0000A4   8E82         MOV     DPL,R6
   \   0000A6   8F83         MOV     DPH,R7
   \   0000A8   E0           MOVX    A,@DPTR
   \   0000A9   FE           MOV     R6,A
   \   0000AA   A3           INC     DPTR
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   FF           MOV     R7,A
   \   0000AD   02....       LJMP    ??ZDO_RemoveRegisteredCB_0 & 0xFFFF
   1610            }
   1611            
   1612            return ( ZFailure );
   \                     ??ZDO_RemoveRegisteredCB_2:
   \   0000B0   7901         MOV     R1,#0x1
   \                     ??ZDO_RemoveRegisteredCB_10:
   \   0000B2   7F05         MOV     R7,#0x5
   \   0000B4   02....       LJMP    ?BANKED_LEAVE_XDATA
   1613          }
   1614          
   1615          /*********************************************************************
   1616           * @fn          ZDO_SendMsgCBs
   1617           *
   1618           * @brief       This function sends messages to registered tasks.
   1619           *              Local to ZDO and shouldn't be called outside of ZDO.
   1620           *
   1621           * @param       inMsg - incoming message
   1622           *
   1623           * @return      TRUE if sent to at least 1 task, FALSE if not
   1624           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1625          uint8 ZDO_SendMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDO_SendMsgCBs:
   1626          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   1627            uint8 ret = FALSE;
   \   000015   7E00         MOV     R6,#0x0
   1628            ZDO_MsgCB_t *pList = zdoMsgCBs;
   \   000017   90....       MOV     DPTR,#zdoMsgCBs
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F8           MOV     R0,A
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   88..         MOV     ?V0 + 6,R0
   \   000021   89..         MOV     ?V0 + 7,R1
   1629            while ( pList )
   \                     ??ZDO_SendMsgCBs_0:
   \   000023   E5..         MOV     A,?V0 + 6
   \   000025   6400         XRL     A,#0x0
   \   000027   7004         JNZ     ??ZDO_SendMsgCBs_1
   \   000029   E5..         MOV     A,?V0 + 7
   \   00002B   6400         XRL     A,#0x0
   \                     ??ZDO_SendMsgCBs_1:
   \   00002D   7003         JNZ     $+5
   \   00002F   02....       LJMP    ??ZDO_SendMsgCBs_2 & 0xFFFF
   1630            {
   1631              if ( pList->clusterID == inMsg->clusterID )
   \   000032   85..82       MOV     DPL,?V0 + 6
   \   000035   85..83       MOV     DPH,?V0 + 7
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F8           MOV     R0,A
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F9           MOV     R1,A
   \   000040   85..82       MOV     DPL,?XSP + 0
   \   000043   85..83       MOV     DPH,?XSP + 1
   \   000046   E0           MOVX    A,@DPTR
   \   000047   240C         ADD     A,#0xc
   \   000049   FA           MOV     R2,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   3400         ADDC    A,#0x0
   \   00004E   FB           MOV     R3,A
   \   00004F   8A82         MOV     DPL,R2
   \   000051   8B83         MOV     DPH,R3
   \   000053   E0           MOVX    A,@DPTR
   \   000054   68           XRL     A,R0
   \   000055   7003         JNZ     ??ZDO_SendMsgCBs_3
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   69           XRL     A,R1
   \                     ??ZDO_SendMsgCBs_3:
   \   00005A   6003         JZ      $+5
   \   00005C   02....       LJMP    ??ZDO_SendMsgCBs_4 & 0xFFFF
   1632              {
   1633                zdoIncomingMsg_t *msgPtr;
   1634          
   1635                // Send the address to the task
   1636                msgPtr = (zdoIncomingMsg_t *)osal_msg_allocate( sizeof( zdoIncomingMsg_t ) + inMsg->asduLen );
   \   00005F                ; Setup parameters for call to function osal_msg_allocate
   \   00005F   85..82       MOV     DPL,?XSP + 0
   \   000062   85..83       MOV     DPH,?XSP + 1
   \   000065   E0           MOVX    A,@DPTR
   \   000066   2410         ADD     A,#0x10
   \   000068   F8           MOV     R0,A
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   3400         ADDC    A,#0x0
   \   00006D   F9           MOV     R1,A
   \   00006E   8882         MOV     DPL,R0
   \   000070   8983         MOV     DPH,R1
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F8           MOV     R0,A
   \   000074   7900         MOV     R1,#0x0
   \   000076   7413         MOV     A,#0x13
   \   000078   28           ADD     A,R0
   \   000079   FA           MOV     R2,A
   \   00007A   7400         MOV     A,#0x0
   \   00007C   39           ADDC    A,R1
   \   00007D   FB           MOV     R3,A
   \   00007E   12....       LCALL   ??osal_msg_allocate?relay
   \   000081   8A..         MOV     ?V0 + 0,R2
   \   000083   8B..         MOV     ?V0 + 1,R3
   \   000085   85....       MOV     ?V0 + 4,?V0 + 0
   \   000088   85....       MOV     ?V0 + 5,?V0 + 1
   1637                if ( msgPtr )
   \   00008B   E5..         MOV     A,?V0 + 4
   \   00008D   6400         XRL     A,#0x0
   \   00008F   7004         JNZ     ??ZDO_SendMsgCBs_5
   \   000091   E5..         MOV     A,?V0 + 5
   \   000093   6400         XRL     A,#0x0
   \                     ??ZDO_SendMsgCBs_5:
   \   000095   7003         JNZ     $+5
   \   000097   02....       LJMP    ??ZDO_SendMsgCBs_4 & 0xFFFF
   1638                {
   1639                  // copy struct
   1640                  osal_memcpy( msgPtr, inMsg, sizeof( zdoIncomingMsg_t ));
   \   00009A                ; Setup parameters for call to function osal_memcpy
   \   00009A   85..82       MOV     DPL,?XSP + 0
   \   00009D   85..83       MOV     DPH,?XSP + 1
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   F5..         MOV     ?V0 + 0,A
   \   0000A3   A3           INC     DPTR
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   F5..         MOV     ?V0 + 1,A
   \   0000A7   75..00       MOV     ?V0 + 2,#0x0
   \   0000AA   78..         MOV     R0,#?V0 + 0
   \   0000AC   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000AF   7C13         MOV     R4,#0x13
   \   0000B1   7D00         MOV     R5,#0x0
   \   0000B3   AA..         MOV     R2,?V0 + 4
   \   0000B5   AB..         MOV     R3,?V0 + 5
   \   0000B7   12....       LCALL   ??osal_memcpy?relay
   \   0000BA   7403         MOV     A,#0x3
   \   0000BC   12....       LCALL   ?DEALLOC_XSTACK8
   1641                  
   1642                  if ( inMsg->asduLen )
   \   0000BF   85..82       MOV     DPL,?XSP + 0
   \   0000C2   85..83       MOV     DPH,?XSP + 1
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   2410         ADD     A,#0x10
   \   0000C8   F8           MOV     R0,A
   \   0000C9   A3           INC     DPTR
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   3400         ADDC    A,#0x0
   \   0000CD   F9           MOV     R1,A
   \   0000CE   8882         MOV     DPL,R0
   \   0000D0   8983         MOV     DPH,R1
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   606F         JZ      ??ZDO_SendMsgCBs_6
   1643                  {
   1644                    msgPtr->asdu = (byte*)(((byte*)msgPtr) + sizeof( zdoIncomingMsg_t ));
   \   0000D5   E5..         MOV     A,?V0 + 4
   \   0000D7   2413         ADD     A,#0x13
   \   0000D9   F8           MOV     R0,A
   \   0000DA   E5..         MOV     A,?V0 + 5
   \   0000DC   3400         ADDC    A,#0x0
   \   0000DE   F9           MOV     R1,A
   \   0000DF   E5..         MOV     A,?V0 + 4
   \   0000E1   2411         ADD     A,#0x11
   \   0000E3   F582         MOV     DPL,A
   \   0000E5   E5..         MOV     A,?V0 + 5
   \   0000E7   3400         ADDC    A,#0x0
   \   0000E9   F583         MOV     DPH,A
   \   0000EB   E8           MOV     A,R0
   \   0000EC   F0           MOVX    @DPTR,A
   \   0000ED   A3           INC     DPTR
   \   0000EE   E9           MOV     A,R1
   \   0000EF   F0           MOVX    @DPTR,A
   1645                    osal_memcpy( msgPtr->asdu, inMsg->asdu, inMsg->asduLen );
   \   0000F0                ; Setup parameters for call to function osal_memcpy
   \   0000F0   85..82       MOV     DPL,?XSP + 0
   \   0000F3   85..83       MOV     DPH,?XSP + 1
   \   0000F6   E0           MOVX    A,@DPTR
   \   0000F7   2411         ADD     A,#0x11
   \   0000F9   F8           MOV     R0,A
   \   0000FA   A3           INC     DPTR
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   3400         ADDC    A,#0x0
   \   0000FE   F9           MOV     R1,A
   \   0000FF   8882         MOV     DPL,R0
   \   000101   8983         MOV     DPH,R1
   \   000103   E0           MOVX    A,@DPTR
   \   000104   F5..         MOV     ?V0 + 0,A
   \   000106   A3           INC     DPTR
   \   000107   E0           MOVX    A,@DPTR
   \   000108   F5..         MOV     ?V0 + 1,A
   \   00010A   75..00       MOV     ?V0 + 2,#0x0
   \   00010D   78..         MOV     R0,#?V0 + 0
   \   00010F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000112   7403         MOV     A,#0x3
   \   000114   12....       LCALL   ?XSTACK_DISP0_8
   \   000117   E0           MOVX    A,@DPTR
   \   000118   2410         ADD     A,#0x10
   \   00011A   F8           MOV     R0,A
   \   00011B   A3           INC     DPTR
   \   00011C   E0           MOVX    A,@DPTR
   \   00011D   3400         ADDC    A,#0x0
   \   00011F   F9           MOV     R1,A
   \   000120   8882         MOV     DPL,R0
   \   000122   8983         MOV     DPH,R1
   \   000124   E0           MOVX    A,@DPTR
   \   000125   F5..         MOV     ?V0 + 0,A
   \   000127   AC..         MOV     R4,?V0 + 0
   \   000129   7D00         MOV     R5,#0x0
   \   00012B   E5..         MOV     A,?V0 + 4
   \   00012D   2411         ADD     A,#0x11
   \   00012F   F582         MOV     DPL,A
   \   000131   E5..         MOV     A,?V0 + 5
   \   000133   3400         ADDC    A,#0x0
   \   000135   F583         MOV     DPH,A
   \   000137   E0           MOVX    A,@DPTR
   \   000138   FA           MOV     R2,A
   \   000139   A3           INC     DPTR
   \   00013A   E0           MOVX    A,@DPTR
   \   00013B   FB           MOV     R3,A
   \   00013C   12....       LCALL   ??osal_memcpy?relay
   \   00013F   7403         MOV     A,#0x3
   \   000141   12....       LCALL   ?DEALLOC_XSTACK8
   1646                  }
   1647              
   1648                  msgPtr->hdr.event = ZDO_CB_MSG;
   \                     ??ZDO_SendMsgCBs_6:
   \   000144   74D3         MOV     A,#-0x2d
   \   000146   85..82       MOV     DPL,?V0 + 4
   \   000149   85..83       MOV     DPH,?V0 + 5
   \   00014C   F0           MOVX    @DPTR,A
   1649                  osal_msg_send( pList->taskID, (uint8 *)msgPtr );
   \   00014D                ; Setup parameters for call to function osal_msg_send
   \   00014D   AA..         MOV     R2,?V0 + 4
   \   00014F   AB..         MOV     R3,?V0 + 5
   \   000151   85..82       MOV     DPL,?V0 + 6
   \   000154   85..83       MOV     DPH,?V0 + 7
   \   000157   A3           INC     DPTR
   \   000158   A3           INC     DPTR
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   F9           MOV     R1,A
   \   00015B   12....       LCALL   ??osal_msg_send?relay
   1650                  ret = TRUE;
   \   00015E   7E01         MOV     R6,#0x1
   1651                }
   1652              }
   1653              pList = (ZDO_MsgCB_t *)pList->next;
   \                     ??ZDO_SendMsgCBs_4:
   \   000160   85..82       MOV     DPL,?V0 + 6
   \   000163   85..83       MOV     DPH,?V0 + 7
   \   000166   E0           MOVX    A,@DPTR
   \   000167   F5..         MOV     ?V0 + 6,A
   \   000169   A3           INC     DPTR
   \   00016A   E0           MOVX    A,@DPTR
   \   00016B   F5..         MOV     ?V0 + 7,A
   \   00016D   02....       LJMP    ??ZDO_SendMsgCBs_0 & 0xFFFF
   1654            }
   1655            return ( ret );
   \                     ??ZDO_SendMsgCBs_2:
   \   000170   EE           MOV     A,R6
   \   000171   F9           MOV     R1,A
   \   000172   7402         MOV     A,#0x2
   \   000174   12....       LCALL   ?DEALLOC_XSTACK8
   \   000177   7F08         MOV     R7,#0x8
   \   000179   02....       LJMP    ?BANKED_LEAVE_XDATA
   1656          }  
   1657          
   1658          /*********************************************************************
   1659           * Incoming message processor
   1660           */
   1661          
   1662          /*********************************************************************
   1663           * @fn          ZDP_IncomingData
   1664           *
   1665           * @brief       This function indicates the transfer of a data PDU (ASDU)
   1666           *              from the APS sub-layer to the ZDO.
   1667           *
   1668           * @param       pData - Incoming Message
   1669           *
   1670           * @return      none
   1671           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1672          void ZDP_IncomingData( afIncomingMSGPacket_t *pData )
   \                     ZDP_IncomingData:
   1673          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 19
   \   000005   74ED         MOV     A,#-0x13
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1674            uint8 x = 0;
   \   00000E   75..00       MOV     ?V0 + 0,#0x0
   1675            uint8 handled;
   1676            zdoIncomingMsg_t inMsg;
   1677          
   1678            inMsg.srcAddr.addrMode = Addr16Bit;
   \   000011   7402         MOV     A,#0x2
   \   000013   C0E0         PUSH    A
   \   000015   740A         MOV     A,#0xa
   \   000017   12....       LCALL   ?XSTACK_DISP0_8
   \   00001A   D0E0         POP     A
   \   00001C   F0           MOVX    @DPTR,A
   1679            inMsg.srcAddr.addr.shortAddr = pData->srcAddr.addr.shortAddr;
   \   00001D   8E82         MOV     DPL,R6
   \   00001F   8F83         MOV     DPH,R7
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F8           MOV     R0,A
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F9           MOV     R1,A
   \   00002C   7402         MOV     A,#0x2
   \   00002E   12....       LCALL   ?XSTACK_DISP0_8
   \   000031   E8           MOV     A,R0
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   E9           MOV     A,R1
   \   000035   F0           MOVX    @DPTR,A
   1680            inMsg.wasBroadcast = pData->wasBroadcast;
   \   000036   EE           MOV     A,R6
   \   000037   240B         ADD     A,#0xb
   \   000039   F582         MOV     DPL,A
   \   00003B   EF           MOV     A,R7
   \   00003C   3400         ADDC    A,#0x0
   \   00003E   F583         MOV     DPH,A
   \   000040   E0           MOVX    A,@DPTR
   \   000041   C0E0         PUSH    A
   \   000043   740B         MOV     A,#0xb
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   D0E0         POP     A
   \   00004A   F0           MOVX    @DPTR,A
   1681            inMsg.clusterID = pData->clusterId;
   \   00004B   8E82         MOV     DPL,R6
   \   00004D   8F83         MOV     DPH,R7
   \   00004F   A3           INC     DPTR
   \   000050   A3           INC     DPTR
   \   000051   A3           INC     DPTR
   \   000052   A3           INC     DPTR
   \   000053   E0           MOVX    A,@DPTR
   \   000054   F8           MOV     R0,A
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F9           MOV     R1,A
   \   000058   740C         MOV     A,#0xc
   \   00005A   12....       LCALL   ?XSTACK_DISP0_8
   \   00005D   E8           MOV     A,R0
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E9           MOV     A,R1
   \   000061   F0           MOVX    @DPTR,A
   1682            inMsg.SecurityUse = pData->SecurityUse;
   \   000062   EE           MOV     A,R6
   \   000063   240D         ADD     A,#0xd
   \   000065   F582         MOV     DPL,A
   \   000067   EF           MOV     A,R7
   \   000068   3400         ADDC    A,#0x0
   \   00006A   F583         MOV     DPH,A
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   C0E0         PUSH    A
   \   00006F   740E         MOV     A,#0xe
   \   000071   12....       LCALL   ?XSTACK_DISP0_8
   \   000074   D0E0         POP     A
   \   000076   F0           MOVX    @DPTR,A
   1683          
   1684            inMsg.asduLen = pData->cmd.DataLength-1;
   \   000077   EE           MOV     A,R6
   \   000078   2413         ADD     A,#0x13
   \   00007A   F582         MOV     DPL,A
   \   00007C   EF           MOV     A,R7
   \   00007D   3400         ADDC    A,#0x0
   \   00007F   F583         MOV     DPH,A
   \   000081   E0           MOVX    A,@DPTR
   \   000082   24FF         ADD     A,#-0x1
   \   000084   C0E0         PUSH    A
   \   000086   7410         MOV     A,#0x10
   \   000088   12....       LCALL   ?XSTACK_DISP0_8
   \   00008B   D0E0         POP     A
   \   00008D   F0           MOVX    @DPTR,A
   1685            inMsg.asdu = pData->cmd.Data+1;
   \   00008E   EE           MOV     A,R6
   \   00008F   2415         ADD     A,#0x15
   \   000091   F582         MOV     DPL,A
   \   000093   EF           MOV     A,R7
   \   000094   3400         ADDC    A,#0x0
   \   000096   F583         MOV     DPH,A
   \   000098   E0           MOVX    A,@DPTR
   \   000099   2401         ADD     A,#0x1
   \   00009B   F8           MOV     R0,A
   \   00009C   A3           INC     DPTR
   \   00009D   E0           MOVX    A,@DPTR
   \   00009E   3400         ADDC    A,#0x0
   \   0000A0   F9           MOV     R1,A
   \   0000A1   7411         MOV     A,#0x11
   \   0000A3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A6   E8           MOV     A,R0
   \   0000A7   F0           MOVX    @DPTR,A
   \   0000A8   A3           INC     DPTR
   \   0000A9   E9           MOV     A,R1
   \   0000AA   F0           MOVX    @DPTR,A
   1686            inMsg.TransSeq = pData->cmd.Data[0];
   \   0000AB   EE           MOV     A,R6
   \   0000AC   2415         ADD     A,#0x15
   \   0000AE   F582         MOV     DPL,A
   \   0000B0   EF           MOV     A,R7
   \   0000B1   3400         ADDC    A,#0x0
   \   0000B3   F583         MOV     DPH,A
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   F8           MOV     R0,A
   \   0000B7   A3           INC     DPTR
   \   0000B8   E0           MOVX    A,@DPTR
   \   0000B9   F583         MOV     DPH,A
   \   0000BB   8882         MOV     DPL,R0
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   C0E0         PUSH    A
   \   0000C0   740F         MOV     A,#0xf
   \   0000C2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C5   D0E0         POP     A
   \   0000C7   F0           MOVX    @DPTR,A
   1687            
   1688            handled = ZDO_SendMsgCBs( &inMsg );
   \   0000C8                ; Setup parameters for call to function ZDO_SendMsgCBs
   \   0000C8   85..82       MOV     DPL,?XSP + 0
   \   0000CB   85..83       MOV     DPH,?XSP + 1
   \   0000CE   AA82         MOV     R2,DPL
   \   0000D0   AB83         MOV     R3,DPH
   \   0000D2   12....       LCALL   ??ZDO_SendMsgCBs?relay
   \   0000D5   E9           MOV     A,R1
   \   0000D6   F5..         MOV     ?V0 + 1,A
   1689            
   1690          #if defined( MT_ZDO_FUNC )
   1691            MT_ZdoRsp( &inMsg );
   1692          #endif
   1693          
   1694            while ( zdpMsgProcs[x].clusterID != 0xFFFF )
   \                     ??ZDP_IncomingData_0:
   \   0000D8   A8..         MOV     R0,?V0 + 0
   \   0000DA   7900         MOV     R1,#0x0
   \   0000DC   E8           MOV     A,R0
   \   0000DD   75F004       MOV     B,#0x4
   \   0000E0   A4           MUL     AB
   \   0000E1   C8           XCH     A,R0
   \   0000E2   AAF0         MOV     R2,B
   \   0000E4   75F000       MOV     B,#0x0
   \   0000E7   A4           MUL     AB
   \   0000E8   2A           ADD     A,R2
   \   0000E9   FA           MOV     R2,A
   \   0000EA   75F004       MOV     B,#0x4
   \   0000ED   E9           MOV     A,R1
   \   0000EE   A4           MUL     AB
   \   0000EF   2A           ADD     A,R2
   \   0000F0   F9           MOV     R1,A
   \   0000F1   E8           MOV     A,R0
   \   0000F2   24..         ADD     A,#(zdpMsgProcs & 0xff)
   \   0000F4   F582         MOV     DPL,A
   \   0000F6   E9           MOV     A,R1
   \   0000F7   34..         ADDC    A,#((zdpMsgProcs >> 8) & 0xff)
   \   0000F9   F583         MOV     DPH,A
   \   0000FB   E4           CLR     A
   \   0000FC   93           MOVC    A,@A+DPTR
   \   0000FD   F8           MOV     R0,A
   \   0000FE   7401         MOV     A,#0x1
   \   000100   93           MOVC    A,@A+DPTR
   \   000101   F9           MOV     R1,A
   \   000102   74FF         MOV     A,#-0x1
   \   000104   68           XRL     A,R0
   \   000105   7003         JNZ     ??ZDP_IncomingData_1
   \   000107   74FF         MOV     A,#-0x1
   \   000109   69           XRL     A,R1
   \                     ??ZDP_IncomingData_1:
   \   00010A   607A         JZ      ??ZDP_IncomingData_2
   1695            {
   1696              if ( zdpMsgProcs[x].clusterID == inMsg.clusterID )
   \   00010C   A8..         MOV     R0,?V0 + 0
   \   00010E   7900         MOV     R1,#0x0
   \   000110   E8           MOV     A,R0
   \   000111   75F004       MOV     B,#0x4
   \   000114   A4           MUL     AB
   \   000115   C8           XCH     A,R0
   \   000116   AAF0         MOV     R2,B
   \   000118   75F000       MOV     B,#0x0
   \   00011B   A4           MUL     AB
   \   00011C   2A           ADD     A,R2
   \   00011D   FA           MOV     R2,A
   \   00011E   75F004       MOV     B,#0x4
   \   000121   E9           MOV     A,R1
   \   000122   A4           MUL     AB
   \   000123   2A           ADD     A,R2
   \   000124   F9           MOV     R1,A
   \   000125   E8           MOV     A,R0
   \   000126   24..         ADD     A,#(zdpMsgProcs & 0xff)
   \   000128   F582         MOV     DPL,A
   \   00012A   E9           MOV     A,R1
   \   00012B   34..         ADDC    A,#((zdpMsgProcs >> 8) & 0xff)
   \   00012D   F583         MOV     DPH,A
   \   00012F   E4           CLR     A
   \   000130   93           MOVC    A,@A+DPTR
   \   000131   F8           MOV     R0,A
   \   000132   7401         MOV     A,#0x1
   \   000134   93           MOVC    A,@A+DPTR
   \   000135   F9           MOV     R1,A
   \   000136   740C         MOV     A,#0xc
   \   000138   12....       LCALL   ?XSTACK_DISP0_8
   \   00013B   E0           MOVX    A,@DPTR
   \   00013C   68           XRL     A,R0
   \   00013D   7003         JNZ     ??ZDP_IncomingData_3
   \   00013F   A3           INC     DPTR
   \   000140   E0           MOVX    A,@DPTR
   \   000141   69           XRL     A,R1
   \                     ??ZDP_IncomingData_3:
   \   000142   703D         JNZ     ??ZDP_IncomingData_4
   1697              {
   1698                zdpMsgProcs[x].pFn( &inMsg );
   \   000144                ; Setup parameters for indirect call
   \   000144   85..82       MOV     DPL,?XSP + 0
   \   000147   85..83       MOV     DPH,?XSP + 1
   \   00014A   AA82         MOV     R2,DPL
   \   00014C   AB83         MOV     R3,DPH
   \   00014E   A8..         MOV     R0,?V0 + 0
   \   000150   7900         MOV     R1,#0x0
   \   000152   E8           MOV     A,R0
   \   000153   75F004       MOV     B,#0x4
   \   000156   A4           MUL     AB
   \   000157   C8           XCH     A,R0
   \   000158   ACF0         MOV     R4,B
   \   00015A   75F000       MOV     B,#0x0
   \   00015D   A4           MUL     AB
   \   00015E   2C           ADD     A,R4
   \   00015F   FC           MOV     R4,A
   \   000160   75F004       MOV     B,#0x4
   \   000163   E9           MOV     A,R1
   \   000164   A4           MUL     AB
   \   000165   2C           ADD     A,R4
   \   000166   F9           MOV     R1,A
   \   000167   E8           MOV     A,R0
   \   000168   24..         ADD     A,#((zdpMsgProcs + 2) & 0xff)
   \   00016A   F582         MOV     DPL,A
   \   00016C   E9           MOV     A,R1
   \   00016D   34..         ADDC    A,#(((zdpMsgProcs + 2) >> 8) & 0xff)
   \   00016F   F583         MOV     DPH,A
   \   000171   E4           CLR     A
   \   000172   93           MOVC    A,@A+DPTR
   \   000173   C0E0         PUSH    A
   \   000175   7401         MOV     A,#0x1
   \   000177   93           MOVC    A,@A+DPTR
   \   000178   F583         MOV     DPH,A
   \   00017A   D082         POP     DPL
   \   00017C   12....       LCALL   ?CALL_IND
   1699                return;
   \   00017F   8016         SJMP    ??ZDP_IncomingData_5
   1700              }
   1701              x++;
   \                     ??ZDP_IncomingData_4:
   \   000181   05..         INC     ?V0 + 0
   \   000183   02....       LJMP    ??ZDP_IncomingData_0 & 0xFFFF
   1702            }
   1703          
   1704            // Handle unhandled messages
   1705            if ( !handled )
   \                     ??ZDP_IncomingData_2:
   \   000186   E5..         MOV     A,?V0 + 1
   \   000188   700D         JNZ     ??ZDP_IncomingData_5
   1706              ZDApp_InMsgCB( &inMsg );
   \   00018A                ; Setup parameters for call to function ZDApp_InMsgCB
   \   00018A   85..82       MOV     DPL,?XSP + 0
   \   00018D   85..83       MOV     DPH,?XSP + 1
   \   000190   AA82         MOV     R2,DPL
   \   000192   AB83         MOV     R3,DPH
   \   000194   12....       LCALL   ??ZDApp_InMsgCB?relay
   \                     ??ZDP_IncomingData_5:
   \   000197   7413         MOV     A,#0x13
   \   000199   12....       LCALL   ?DEALLOC_XSTACK8
   \   00019C   7F02         MOV     R7,#0x2
   \   00019E   02....       LJMP    ?BANKED_LEAVE_XDATA
   1707          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDP_TmpBuf>`:
   \   000000   ....         DW ZDP_Buf + 1H

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??fillAndSend?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    fillAndSend

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_SendData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_SendData

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_NwkAddrReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_NwkAddrReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_IEEEAddrReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_IEEEAddrReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_MatchDescReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_MatchDescReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zdpProcessAddrReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zdpProcessAddrReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_NodeDescMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_NodeDescMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_PowerDescMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_PowerDescMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_SimpleDescMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_SimpleDescMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_EPRsp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_EPRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_GenericRsp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_GenericRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_EndDeviceBindReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_EndDeviceBindReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZDOMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZDOMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RemoveRegisteredCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RemoveRegisteredCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SendMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SendMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDP_IncomingData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDP_IncomingData
   1708          
   1709          /*********************************************************************
   1710          *********************************************************************/
   1711          

   Maximum stack usage in bytes:

     Function               ISTACK PSTACK XSTACK
     --------               ------ ------ ------
     ZDO_RegisterForZDOMsg      1      0     18
       -> osal_mem_alloc        0      0     36
     ZDO_RemoveRegisteredCB     0      0     13
       -> osal_mem_free         0      0     26
     ZDO_SendMsgCBs             1      0     50
       -> osal_msg_allocate     0      0     36
       -> osal_memcpy           0      0     42
       -> osal_memcpy           0      0     42
       -> osal_msg_send         0      0     36
     ZDP_EPRsp                  1      0     30
       -> osal_memcpy           0      0     46
       -> fillAndSend           0      0     44
     ZDP_EndDeviceBindReq       1      0     30
       -> NLME_GetShortAddr     0      0     38
       -> NLME_GetExtAddr       0      0     38
       -> osal_cpyExtAddr       0      0     38
       -> fillAndSend           0      0     42
     ZDP_GenericRsp             1      0     23
       -> fillAndSend           0      0     38
     ZDP_IEEEAddrReq            1      0     27
       -> fillAndSend           0      0     54
     ZDP_IncomingData           1      0     29
       -> ZDO_SendMsgCBs        0      0     58
       -> ZDApp_InMsgCB         0      0     58
     ZDP_MatchDescReq           1      0     29
       -> fillAndSend           0      0     42
     ZDP_NodeDescMsg            2      0     21
       -> fillAndSend           0      0     38
     ZDP_NwkAddrReq             1      0     27
       -> osal_ExtAddrEqual     0      0     50
       -> osal_cpyExtAddr       0      0     50
       -> fillAndSend           0      0     54
     ZDP_PowerDescMsg           1      0     22
       -> fillAndSend           0      0     40
     ZDP_SendData               1      0     25
       -> fillAndSend           0      0     40
     ZDP_SimpleDescMsg          1      0     19
       -> fillAndSend           0      0     38
     fillAndSend                1      0     56
       -> AF_DataRequest        0      0     58
     zdpProcessAddrReq          1      0     21
       -> osal_ExtAddrEqual     0      0     38
       -> osal_cpyExtAddr       0      0     38
       -> fillAndSend           0      0     42


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     ZDP_AF_ENDPOINT                   1
     ZDP_TransID                       1
     ZDP_Buf                          80
     ZDP_TmpBuf                        2
     ZDP_TxOptions                     1
     zdoMsgCBs                         2
     zdpMsgProcs                      32
     fillAndSend                     220
     ZDP_SendData                    209
     ZDP_NwkAddrReq                  191
     ZDP_IEEEAddrReq                 157
     ZDP_MatchDescReq                553
     zdpProcessAddrReq               519
     ZDP_NodeDescMsg                 479
     ZDP_PowerDescMsg                236
     ZDP_SimpleDescMsg               836
     ZDP_EPRsp                       294
     ZDP_GenericRsp                  161
     ZDP_EndDeviceBindReq            592
     ZDO_RegisterForZDOMsg           226
     ZDO_RemoveRegisteredCB          183
     ZDO_SendMsgCBs                  380
     ZDP_IncomingData                417
     ?<Initializer for ZDP_TmpBuf>     2
     ??fillAndSend?relay               6
     ??ZDP_SendData?relay              6
     ??ZDP_NwkAddrReq?relay            6
     ??ZDP_IEEEAddrReq?relay           6
     ??ZDP_MatchDescReq?relay          6
     ??zdpProcessAddrReq?relay         6
     ??ZDP_NodeDescMsg?relay           6
     ??ZDP_PowerDescMsg?relay          6
     ??ZDP_SimpleDescMsg?relay         6
     ??ZDP_EPRsp?relay                 6
     ??ZDP_GenericRsp?relay            6
     ??ZDP_EndDeviceBindReq?relay      6
     ??ZDO_RegisterForZDOMsg?relay     6
     ??ZDO_RemoveRegisteredCB?relay    6
     ??ZDO_SendMsgCBs?relay            6
     ??ZDP_IncomingData?relay          6

 
 5 653 bytes in segment BANKED_CODE
    96 bytes in segment BANK_RELAYS
    33 bytes in segment CODE_C
     2 bytes in segment XDATA_I
     2 bytes in segment XDATA_ID
    84 bytes in segment XDATA_Z
 
 5 784 bytes of CODE  memory
    86 bytes of XDATA memory

Errors: none
Warnings: none
