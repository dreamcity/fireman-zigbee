###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    19/Mar/2013  19:57:48 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \zmac\f8w\zmac.c                                   #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wEndev.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\Tools #
#                          \CC2430DB\f8wConfig.cfg" (-DSECURE=0               #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\zmac\f8w #
#                          \zmac.c" -D CC2430EB -D AXD_END -D AXD_END_B -D    #
#                          NWK_AUTO_POLL -D REFLECTOR -D xZTOOL_P1 -D         #
#                          xMT_TASK -D xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG   #
#                          -D xPOWER_SAVING -lC "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\ENDDevice2EB\L #
#                          ist\" -lA "C:\Texas Instruments\ZStack-1.4.3-1.2.1 #
#                          \Projects\zstack\Samples\cc2430-zstack-adxl345\CC2 #
#                          430DB\ENDDevice2EB\List\" --diag_suppress          #
#                          Pe001,Pa010 --diag_remark pe550 -o "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\ENDDevice2EB\O #
#                          bj\" -e --require_prototypes -z2 --no_cse          #
#                          --no_unroll --no_inline --no_code_motion           #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\SOURCE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\cc2430-zstack-adxl345 #
#                          \CC2430DB\..\Drivers\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\ZMAIN #
#                          \TI2430DB\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\ENDDe #
#                          vice2EB\List\zmac.lst                              #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\ENDDe #
#                          vice2EB\Obj\zmac.r51                               #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\zmac\f8w\zmac.c
      1          /**************************************************************************************************
      2            Filename:       zmac.c
      3            Revised:        $Date: 2007-10-28 18:43:04 -0700 (Sun, 28 Oct 2007) $
      4            Revision:       $Revision: 15800 $
      5          
      6            Description:    This file contains the ZStack MAC Porting Layer
      7          
      8          
      9            Copyright 2005-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /********************************************************************************************************
     41           *                                               INCLUDES
     42           ********************************************************************************************************/
     43          
     44          #include "ZComDef.h"
     45          #include "OSAL.h"
     46          #include "ZMAC.h"
     47          
     48          /********************************************************************************************************
     49           *                                                 MACROS
     50           ********************************************************************************************************/
     51          
     52          /********************************************************************************************************
     53           *                                               CONSTANTS
     54           ********************************************************************************************************/

   \                                 In  segment CODE_C, align 1
     55          static CONST byte TxPowerSettings[] =
   \                     TxPowerSettings:
   \   000000   00212325     DB 0, 33, 35, 37, 39, 42, 47, 57
   \            272A2F39
     56          {
     57            OUTPUT_POWER_0DBM,
     58            OUTPUT_POWER_N1DBM,
     59            OUTPUT_POWER_N3DBM,
     60            OUTPUT_POWER_N5DBM,
     61            OUTPUT_POWER_N7DBM,
     62            OUTPUT_POWER_N10DBM,
     63            OUTPUT_POWER_N15DBM,
     64            OUTPUT_POWER_N25DBM
     65          };
     66          
     67          /********************************************************************************************************
     68           *                                               GLOBALS
     69           ********************************************************************************************************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     70          uint32 _ScanChannels;
   \                     _ScanChannels:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
     71          
     72          extern uint8 aExtendedAddress[];
     73          
     74          /********************************************************************************************************
     75           *                                               LOCALS
     76           ********************************************************************************************************/
     77          
     78          /* Pointer to scan result buffer */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     79          void *ZMac_ScanBuf = NULL;
   \                     ZMac_ScanBuf:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     80          
     81          /********************************************************************************************************
     82           * LOCAL FUNCTION PROTOTYPES
     83           ********************************************************************************************************/
     84          
     85          /********************************************************************************************************
     86           *                                                TYPEDEFS
     87           ********************************************************************************************************/
     88          
     89          
     90          /********************************************************************************************************
     91           *                                                FUNCTIONS
     92           ********************************************************************************************************/
     93          
     94          /********************************************************************************************************
     95           * @fn      ZMacInit
     96           *
     97           * @brief   Initialize MAC.
     98           *
     99           * @param   none.
    100           *
    101           * @return  status.
    102           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    103          ROOT uint8 ZMacInit( void )
   \                     ZMacInit:
    104          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
    105            uint8 stat;
    106          
    107            MAC_Init();
   \   000005                ; Setup parameters for call to function MAC_Init
   \   000005   12....       LCALL   ??MAC_Init?relay
    108            MAC_InitDevice();
   \   000008                ; Setup parameters for call to function MAC_InitDevice
   \   000008   12....       LCALL   ??MAC_InitDevice?relay
    109          
    110          #if defined ( RTR_NWK )
    111            MAC_InitCoord();
    112          #endif
    113          
    114            // If OK, initialize the MAC
    115            stat = ZMacReset( TRUE );
   \   00000B                ; Setup parameters for call to function ZMacReset
   \   00000B   7901         MOV     R1,#0x1
   \   00000D   12....       LCALL   ZMacReset
   \   000010   E9           MOV     A,R1
   \   000011   FE           MOV     R6,A
    116          
    117            // Turn off interrupts
    118            osal_int_disable( INTS_ALL );
   \   000012                ; Setup parameters for call to function osal_int_disable
   \   000012   79FF         MOV     R1,#-0x1
   \   000014   12....       LCALL   ??osal_int_disable?relay
    119          
    120            return ( stat );
   \   000017   EE           MOV     A,R6
   \   000018   F9           MOV     R1,A
   \   000019   7F01         MOV     R7,#0x1
   \   00001B   02....       LJMP    ?FUNC_LEAVE_XDATA
    121          }
    122          
    123          /********************************************************************************************************
    124           * @fn      ZMacUpdate
    125           *
    126           * @brief   Gives MAC (or others) some processing time.
    127           *
    128           * @param   none.
    129           *
    130           * @return  true if CPU needs to keep running (not sleep).
    131           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    132          ROOT byte ZMacUpdate( void )
   \                     ZMacUpdate:
    133          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    134            /* Put code here that needs to run each OSAL event loop */
    135            return ( false );
   \   000000   7900         MOV     R1,#0x0
   \   000002   22           RET
    136          }
    137          
    138          /********************************************************************************************************
    139           * @fn      ZMacReset
    140           *
    141           * @brief   Reset the MAC.
    142           *
    143           * @param   Default to PIB defaults.
    144           *
    145           * @return  status.
    146           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    147          ROOT uint8 ZMacReset( bool SetDefaultPIB )
   \                     ZMacReset:
    148          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    149            byte stat;
    150            byte value;
    151          
    152            stat = MAC_MlmeResetReq( SetDefaultPIB );
   \   00000B                ; Setup parameters for call to function MAC_MlmeResetReq
   \   00000B   F9           MOV     R1,A
   \   00000C   12....       LCALL   ??MAC_MlmeResetReq?relay
   \   00000F   E9           MOV     A,R1
   \   000010   FF           MOV     R7,A
    153          
    154            // Don't send PAN ID conflict
    155            value = FALSE;
   \   000011   7400         MOV     A,#0x0
   \   000013   85..82       MOV     DPL,?XSP + 0
   \   000016   85..83       MOV     DPH,?XSP + 1
   \   000019   F0           MOVX    @DPTR,A
    156            MAC_MlmeSetReq( MAC_ASSOCIATED_PAN_COORD, &value );
   \   00001A                ; Setup parameters for call to function MAC_MlmeSetReq
   \   00001A   85..82       MOV     DPL,?XSP + 0
   \   00001D   85..83       MOV     DPH,?XSP + 1
   \   000020   AA82         MOV     R2,DPL
   \   000022   AB83         MOV     R3,DPH
   \   000024   7956         MOV     R1,#0x56
   \   000026   12....       LCALL   ??MAC_MlmeSetReq?relay
    157            MAC_MlmeSetReq( MAC_EXTENDED_ADDRESS, &aExtendedAddress );
   \   000029                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000029   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   00002B   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   00002D   79E2         MOV     R1,#-0x1e
   \   00002F   12....       LCALL   ??MAC_MlmeSetReq?relay
    158          
    159            if (ZMac_ScanBuf)
   \   000032   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000035   E0           MOVX    A,@DPTR
   \   000036   6400         XRL     A,#0x0
   \   000038   7004         JNZ     ??ZMacReset_0
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   6400         XRL     A,#0x0
   \                     ??ZMacReset_0:
   \   00003E   6015         JZ      ??ZMacReset_1
    160            {
    161              osal_mem_free(ZMac_ScanBuf);
   \   000040                ; Setup parameters for call to function osal_mem_free
   \   000040   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000043   E0           MOVX    A,@DPTR
   \   000044   FA           MOV     R2,A
   \   000045   A3           INC     DPTR
   \   000046   E0           MOVX    A,@DPTR
   \   000047   FB           MOV     R3,A
   \   000048   12....       LCALL   ??osal_mem_free?relay
    162              ZMac_ScanBuf = NULL;
   \   00004B   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00004E   7400         MOV     A,#0x0
   \   000050   F0           MOVX    @DPTR,A
   \   000051   A3           INC     DPTR
   \   000052   7400         MOV     A,#0x0
   \   000054   F0           MOVX    @DPTR,A
    163            }
    164          
    165            return ( stat );
   \                     ??ZMacReset_1:
   \   000055   EF           MOV     A,R7
   \   000056   F9           MOV     R1,A
   \   000057   7401         MOV     A,#0x1
   \   000059   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005C   7F01         MOV     R7,#0x1
   \   00005E   02....       LJMP    ?FUNC_LEAVE_XDATA
    166          }
    167          
    168          
    169          /********************************************************************************************************
    170           * @fn      ZMacGetReq
    171           *
    172           * @brief   Read a MAC PIB attribute.
    173           *
    174           * @param   attr - PIB attribute to get
    175           * @param   value - pointer to the buffer to store the attribute
    176           *
    177           * @return  status
    178           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    179          ROOT uint8 ZMacGetReq( uint8 attr, uint8 *value )
   \                     ZMacGetReq:
    180          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    181            if ( attr == ZMacExtAddr )
   \   00000B   74E2         MOV     A,#-0x1e
   \   00000D   65..         XRL     A,?V0 + 0
   \   00000F   700F         JNZ     ??ZMacGetReq_0
    182            {
    183              osal_cpyExtAddr( value, &aExtendedAddress );
   \   000011                ; Setup parameters for call to function osal_cpyExtAddr
   \   000011   7C..         MOV     R4,#(aExtendedAddress & 0xff)
   \   000013   7D..         MOV     R5,#((aExtendedAddress >> 8) & 0xff)
   \   000015   EE           MOV     A,R6
   \   000016   FA           MOV     R2,A
   \   000017   EF           MOV     A,R7
   \   000018   FB           MOV     R3,A
   \   000019   12....       LCALL   ??osal_cpyExtAddr?relay
    184              return ZMacSuccess;
   \   00001C   7900         MOV     R1,#0x0
   \   00001E   8009         SJMP    ??ZMacGetReq_1
    185            }
    186          
    187            return (ZMacStatus_t) MAC_MlmeGetReq( attr, value );
   \                     ??ZMacGetReq_0:
   \   000020                ; Setup parameters for call to function MAC_MlmeGetReq
   \   000020   EE           MOV     A,R6
   \   000021   FA           MOV     R2,A
   \   000022   EF           MOV     A,R7
   \   000023   FB           MOV     R3,A
   \   000024   A9..         MOV     R1,?V0 + 0
   \   000026   12....       LCALL   ??MAC_MlmeGetReq?relay
   \                     ??ZMacGetReq_1:
   \   000029   7F01         MOV     R7,#0x1
   \   00002B   02....       LJMP    ?FUNC_LEAVE_XDATA
    188          }
    189          
    190          
    191          /********************************************************************************************************
    192           * @fn      ZMacSetReq
    193           *
    194           * @brief   Write a MAC PIB attribute.
    195           *
    196           * @param   attr - PIB attribute to Set
    197           * @param   value - pointer to the data
    198           *
    199           * @return  status
    200           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    201          ROOT uint8 ZMacSetReq( uint8 attr, byte *value )
   \                     ZMacSetReq:
    202          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    203            if ( attr == ZMacExtAddr )
   \   00000B   74E2         MOV     A,#-0x1e
   \   00000D   65..         XRL     A,?V0 + 0
   \   00000F   700B         JNZ     ??ZMacSetReq_0
    204            {
    205              osal_cpyExtAddr( &aExtendedAddress, value );
   \   000011                ; Setup parameters for call to function osal_cpyExtAddr
   \   000011   EE           MOV     A,R6
   \   000012   FC           MOV     R4,A
   \   000013   EF           MOV     A,R7
   \   000014   FD           MOV     R5,A
   \   000015   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   000017   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   000019   12....       LCALL   ??osal_cpyExtAddr?relay
    206            }
    207          
    208            return (ZMacStatus_t) MAC_MlmeSetReq( attr, value );
   \                     ??ZMacSetReq_0:
   \   00001C                ; Setup parameters for call to function MAC_MlmeSetReq
   \   00001C   EE           MOV     A,R6
   \   00001D   FA           MOV     R2,A
   \   00001E   EF           MOV     A,R7
   \   00001F   FB           MOV     R3,A
   \   000020   A9..         MOV     R1,?V0 + 0
   \   000022   12....       LCALL   ??MAC_MlmeSetReq?relay
   \   000025   7F01         MOV     R7,#0x1
   \   000027   02....       LJMP    ?FUNC_LEAVE_XDATA
    209          }
    210          
    211          /********************************************************************************************************
    212           * @fn      ZMacAssociateReq
    213           *
    214           * @brief   Request an association with a coordinator.
    215           *
    216           * @param   structure with info need to associate.
    217           *
    218           * @return  status
    219           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    220          ROOT uint8 ZMacAssociateReq( ZMacAssociateReq_t *pData )
   \                     ZMacAssociateReq:
    221          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    222            /* Right now, set security to zero */
    223            pData->Sec.SecurityLevel = false;
   \   000009   7400         MOV     A,#0x0
   \   00000B   C0E0         PUSH    A
   \   00000D   EE           MOV     A,R6
   \   00000E   2416         ADD     A,#0x16
   \   000010   F582         MOV     DPL,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F583         MOV     DPH,A
   \   000017   D0E0         POP     A
   \   000019   F0           MOVX    @DPTR,A
    224          
    225            MAC_MlmeAssociateReq ( (macMlmeAssociateReq_t *)pData);
   \   00001A                ; Setup parameters for call to function MAC_MlmeAssociateReq
   \   00001A   EE           MOV     A,R6
   \   00001B   FA           MOV     R2,A
   \   00001C   EF           MOV     A,R7
   \   00001D   FB           MOV     R3,A
   \   00001E   12....       LCALL   ??MAC_MlmeAssociateReq?relay
    226            return ( ZMacSuccess );
   \   000021   7900         MOV     R1,#0x0
   \   000023   7F01         MOV     R7,#0x1
   \   000025   02....       LJMP    ?FUNC_LEAVE_XDATA
    227          }
    228          
    229          /********************************************************************************************************
    230           * @fn      ZMacAssociateRsp
    231           *
    232           * @brief   Request to send an association response message.
    233           *
    234           * @param   structure with associate response and info needed to send it.
    235           *
    236           * @return  status
    237           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    238          ROOT uint8 ZMacAssociateRsp( ZMacAssociateRsp_t *pData )
   \                     ZMacAssociateRsp:
    239          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    240            /* Right now, set security to zero */
    241            pData->Sec.SecurityLevel = false;
   \   000009   7400         MOV     A,#0x0
   \   00000B   C0E0         PUSH    A
   \   00000D   EE           MOV     A,R6
   \   00000E   2413         ADD     A,#0x13
   \   000010   F582         MOV     DPL,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F583         MOV     DPH,A
   \   000017   D0E0         POP     A
   \   000019   F0           MOVX    @DPTR,A
    242          
    243            MAC_MlmeAssociateRsp( (macMlmeAssociateRsp_t *) pData );
   \   00001A                ; Setup parameters for call to function MAC_MlmeAssociateRsp
   \   00001A   EE           MOV     A,R6
   \   00001B   FA           MOV     R2,A
   \   00001C   EF           MOV     A,R7
   \   00001D   FB           MOV     R3,A
   \   00001E   12....       LCALL   ??MAC_MlmeAssociateRsp?relay
    244            return ( ZMacSuccess );
   \   000021   7900         MOV     R1,#0x0
   \   000023   7F01         MOV     R7,#0x1
   \   000025   02....       LJMP    ?FUNC_LEAVE_XDATA
    245          }
    246          
    247          /********************************************************************************************************
    248           * @fn      ZMacDisassociateReq
    249           *
    250           * @brief   Request to send a disassociate request message.
    251           *
    252           * @param   structure with info need send it.
    253           *
    254           * @return  status
    255           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    256          ROOT uint8 ZMacDisassociateReq( ZMacDisassociateReq_t *pData )
   \                     ZMacDisassociateReq:
    257          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    258            /* Right now, set security to zero */
    259            pData->Sec.SecurityLevel = false;
   \   000009   7400         MOV     A,#0x0
   \   00000B   C0E0         PUSH    A
   \   00000D   EE           MOV     A,R6
   \   00000E   2415         ADD     A,#0x15
   \   000010   F582         MOV     DPL,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F583         MOV     DPH,A
   \   000017   D0E0         POP     A
   \   000019   F0           MOVX    @DPTR,A
    260          
    261            MAC_MlmeDisassociateReq( (macMlmeDisassociateReq_t *)pData);
   \   00001A                ; Setup parameters for call to function MAC_MlmeDisassociateReq
   \   00001A   EE           MOV     A,R6
   \   00001B   FA           MOV     R2,A
   \   00001C   EF           MOV     A,R7
   \   00001D   FB           MOV     R3,A
   \   00001E   12....       LCALL   ??MAC_MlmeDisassociateReq?relay
    262            return ( ZMacSuccess );
   \   000021   7900         MOV     R1,#0x0
   \   000023   7F01         MOV     R7,#0x1
   \   000025   02....       LJMP    ?FUNC_LEAVE_XDATA
    263          }
    264          
    265          /********************************************************************************************************
    266           * @fn      ZMacOrphanRsp
    267           *
    268           * @brief   Allows next higher layer to respond to an orphan indication message.
    269           *
    270           * @param   structure with info need send it.
    271           *
    272           * @return  status
    273           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    274          ROOT uint8 ZMacOrphanRsp( ZMacOrphanRsp_t *pData )
   \                     ZMacOrphanRsp:
    275          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    276            /* Right now, set security to zero */
    277            pData->Sec.SecurityLevel = false;
   \   000009   7400         MOV     A,#0x0
   \   00000B   C0E0         PUSH    A
   \   00000D   EE           MOV     A,R6
   \   00000E   2413         ADD     A,#0x13
   \   000010   F582         MOV     DPL,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F583         MOV     DPH,A
   \   000017   D0E0         POP     A
   \   000019   F0           MOVX    @DPTR,A
    278          
    279            MAC_MlmeOrphanRsp( (macMlmeOrphanRsp_t *)pData);
   \   00001A                ; Setup parameters for call to function MAC_MlmeOrphanRsp
   \   00001A   EE           MOV     A,R6
   \   00001B   FA           MOV     R2,A
   \   00001C   EF           MOV     A,R7
   \   00001D   FB           MOV     R3,A
   \   00001E   12....       LCALL   ??MAC_MlmeOrphanRsp?relay
    280            return ( ZMacSuccess );
   \   000021   7900         MOV     R1,#0x0
   \   000023   7F01         MOV     R7,#0x1
   \   000025   02....       LJMP    ?FUNC_LEAVE_XDATA
    281          }
    282          
    283          /********************************************************************************************************
    284           * @fn      ZMacRxEnableReq
    285           *
    286           * @brief   This function contains timing information that tells the
    287           *          device when to enable or disable its receiver, in order
    288           *          to schedule a data transfer between itself and another
    289           *          device. The information is sent from the upper layers
    290           *          directly to the MAC sublayer.
    291           *
    292           * @param   structure with info need send it.
    293           *
    294           * @return  status
    295           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    296          ROOT uint8 ZMacRxEnableReq( ZMacRxEnableReq_t *pData )
   \                     ZMacRxEnableReq:
    297          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    298            /* This feature is no longer in the TIMAC */
    299            return ( ZMacUnsupported );
   \   000000   79F5         MOV     R1,#-0xb
   \   000002   22           RET
    300          }
    301          
    302          /********************************************************************************************************
    303           * @fn      ZMacScanReq
    304           *
    305           * @brief   This function is called to perform a network scan.
    306           *
    307           * @param   param - structure with info need send it.
    308           *
    309           * @return  status
    310           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    311          ROOT uint8 ZMacScanReq( ZMacScanReq_t *pData )
   \                     ZMacScanReq:
    312          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    313            _ScanChannels = pData->ScanChannels;
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   78..         MOV     R0,#?V0 + 0
   \   00000F   12....       LCALL   ?L_MOV_X
   \   000012   90....       MOV     DPTR,#_ScanChannels
   \   000015   78..         MOV     R0,#?V0 + 0
   \   000017   12....       LCALL   ?L_MOV_TO_X
    314          
    315            /* scan in progress */
    316            if (ZMac_ScanBuf != NULL)
   \   00001A   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   6400         XRL     A,#0x0
   \   000020   7004         JNZ     ??ZMacScanReq_0
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \   000024   6400         XRL     A,#0x0
   \                     ??ZMacScanReq_0:
   \   000026   6005         JZ      ??ZMacScanReq_1
    317            {
    318              return MAC_SCAN_IN_PROGRESS;
   \   000028   79FC         MOV     R1,#-0x4
   \   00002A   02....       LJMP    ??ZMacScanReq_2
    319            }
    320          
    321            if (pData->ScanType != ZMAC_ORPHAN_SCAN)
   \                     ??ZMacScanReq_1:
   \   00002D   8E82         MOV     DPL,R6
   \   00002F   8F83         MOV     DPH,R7
   \   000031   A3           INC     DPTR
   \   000032   A3           INC     DPTR
   \   000033   A3           INC     DPTR
   \   000034   A3           INC     DPTR
   \   000035   E0           MOVX    A,@DPTR
   \   000036   6403         XRL     A,#0x3
   \   000038   7003         JNZ     $+5
   \   00003A   02....       LJMP    ??ZMacScanReq_3
    322            {
    323              /* Allocate memory depends on the scan type */
    324              if (pData->ScanType == ZMAC_ED_SCAN)
   \   00003D   8E82         MOV     DPL,R6
   \   00003F   8F83         MOV     DPH,R7
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   E0           MOVX    A,@DPTR
   \   000046   7054         JNZ     ??ZMacScanReq_4
    325              {
    326                if ((ZMac_ScanBuf = osal_mem_alloc(ZMAC_ED_SCAN_MAXCHANNELS)) == NULL)
   \   000048                ; Setup parameters for call to function osal_mem_alloc
   \   000048   7A1B         MOV     R2,#0x1b
   \   00004A   7B00         MOV     R3,#0x0
   \   00004C   12....       LCALL   ??osal_mem_alloc?relay
   \   00004F   8A..         MOV     ?V0 + 0,R2
   \   000051   8B..         MOV     ?V0 + 1,R3
   \   000053   A8..         MOV     R0,?V0 + 0
   \   000055   A9..         MOV     R1,?V0 + 1
   \   000057   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00005A   E8           MOV     A,R0
   \   00005B   F0           MOVX    @DPTR,A
   \   00005C   A3           INC     DPTR
   \   00005D   E9           MOV     A,R1
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   E8           MOV     A,R0
   \   000060   6400         XRL     A,#0x0
   \   000062   7003         JNZ     ??ZMacScanReq_5
   \   000064   E9           MOV     A,R1
   \   000065   6400         XRL     A,#0x0
   \                     ??ZMacScanReq_5:
   \   000067   7005         JNZ     ??ZMacScanReq_6
    327                {
    328                  return MAC_NO_RESOURCES;
   \   000069   791A         MOV     R1,#0x1a
   \   00006B   02....       LJMP    ??ZMacScanReq_2
    329                }
    330                osal_memset(ZMac_ScanBuf, 0, ZMAC_ED_SCAN_MAXCHANNELS);
   \                     ??ZMacScanReq_6:
   \   00006E                ; Setup parameters for call to function osal_memset
   \   00006E   7C1B         MOV     R4,#0x1b
   \   000070   7D00         MOV     R5,#0x0
   \   000072   7900         MOV     R1,#0x0
   \   000074   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000077   E0           MOVX    A,@DPTR
   \   000078   FA           MOV     R2,A
   \   000079   A3           INC     DPTR
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   FB           MOV     R3,A
   \   00007C   12....       LCALL   ??osal_memset?relay
    331                pData->Result.pEnergyDetect = ((uint8*)ZMac_ScanBuf) + MAC_CHAN_11;
   \   00007F   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000082   E0           MOVX    A,@DPTR
   \   000083   240B         ADD     A,#0xb
   \   000085   F8           MOV     R0,A
   \   000086   A3           INC     DPTR
   \   000087   E0           MOVX    A,@DPTR
   \   000088   3400         ADDC    A,#0x0
   \   00008A   F9           MOV     R1,A
   \   00008B   EE           MOV     A,R6
   \   00008C   2413         ADD     A,#0x13
   \   00008E   F582         MOV     DPL,A
   \   000090   EF           MOV     A,R7
   \   000091   3400         ADDC    A,#0x0
   \   000093   F583         MOV     DPH,A
   \   000095   E8           MOV     A,R0
   \   000096   F0           MOVX    @DPTR,A
   \   000097   A3           INC     DPTR
   \   000098   E9           MOV     A,R1
   \   000099   F0           MOVX    @DPTR,A
   \   00009A   8065         SJMP    ??ZMacScanReq_3
    332              }
    333              else if (pData->MaxResults > 0)
   \                     ??ZMacScanReq_4:
   \   00009C   8E82         MOV     DPL,R6
   \   00009E   8F83         MOV     DPH,R7
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   A3           INC     DPTR
   \   0000A6   A3           INC     DPTR
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   C3           CLR     C
   \   0000A9   9401         SUBB    A,#0x1
   \   0000AB   4054         JC      ??ZMacScanReq_3
    334              {
    335                if ((ZMac_ScanBuf = pData->Result.pPanDescriptor =
    336                     osal_mem_alloc( sizeof( ZMacPanDesc_t ) * pData->MaxResults )) == NULL)
   \   0000AD                ; Setup parameters for call to function osal_mem_alloc
   \   0000AD   8E82         MOV     DPL,R6
   \   0000AF   8F83         MOV     DPH,R7
   \   0000B1   A3           INC     DPTR
   \   0000B2   A3           INC     DPTR
   \   0000B3   A3           INC     DPTR
   \   0000B4   A3           INC     DPTR
   \   0000B5   A3           INC     DPTR
   \   0000B6   A3           INC     DPTR
   \   0000B7   A3           INC     DPTR
   \   0000B8   E0           MOVX    A,@DPTR
   \   0000B9   FA           MOV     R2,A
   \   0000BA   7B00         MOV     R3,#0x0
   \   0000BC   EA           MOV     A,R2
   \   0000BD   75F021       MOV     B,#0x21
   \   0000C0   A4           MUL     AB
   \   0000C1   CA           XCH     A,R2
   \   0000C2   ACF0         MOV     R4,B
   \   0000C4   75F000       MOV     B,#0x0
   \   0000C7   A4           MUL     AB
   \   0000C8   2C           ADD     A,R4
   \   0000C9   FC           MOV     R4,A
   \   0000CA   75F021       MOV     B,#0x21
   \   0000CD   EB           MOV     A,R3
   \   0000CE   A4           MUL     AB
   \   0000CF   2C           ADD     A,R4
   \   0000D0   FB           MOV     R3,A
   \   0000D1   12....       LCALL   ??osal_mem_alloc?relay
   \   0000D4   8A..         MOV     ?V0 + 0,R2
   \   0000D6   8B..         MOV     ?V0 + 1,R3
   \   0000D8   A8..         MOV     R0,?V0 + 0
   \   0000DA   A9..         MOV     R1,?V0 + 1
   \   0000DC   EE           MOV     A,R6
   \   0000DD   2413         ADD     A,#0x13
   \   0000DF   F582         MOV     DPL,A
   \   0000E1   EF           MOV     A,R7
   \   0000E2   3400         ADDC    A,#0x0
   \   0000E4   F583         MOV     DPH,A
   \   0000E6   E8           MOV     A,R0
   \   0000E7   F0           MOVX    @DPTR,A
   \   0000E8   A3           INC     DPTR
   \   0000E9   E9           MOV     A,R1
   \   0000EA   F0           MOVX    @DPTR,A
   \   0000EB   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0000EE   E8           MOV     A,R0
   \   0000EF   F0           MOVX    @DPTR,A
   \   0000F0   A3           INC     DPTR
   \   0000F1   E9           MOV     A,R1
   \   0000F2   F0           MOVX    @DPTR,A
   \   0000F3   E8           MOV     A,R0
   \   0000F4   6400         XRL     A,#0x0
   \   0000F6   7003         JNZ     ??ZMacScanReq_7
   \   0000F8   E9           MOV     A,R1
   \   0000F9   6400         XRL     A,#0x0
   \                     ??ZMacScanReq_7:
   \   0000FB   7004         JNZ     ??ZMacScanReq_3
    337                {
    338                  return MAC_NO_RESOURCES;
   \   0000FD   791A         MOV     R1,#0x1a
   \   0000FF   8027         SJMP    ??ZMacScanReq_2
    339                }
    340              }
    341            }
    342          
    343            /* Right now, set security to zero */
    344            pData->Sec.SecurityLevel = false;
   \                     ??ZMacScanReq_3:
   \   000101   7400         MOV     A,#0x0
   \   000103   C0E0         PUSH    A
   \   000105   EE           MOV     A,R6
   \   000106   2410         ADD     A,#0x10
   \   000108   F582         MOV     DPL,A
   \   00010A   EF           MOV     A,R7
   \   00010B   3400         ADDC    A,#0x0
   \   00010D   F583         MOV     DPH,A
   \   00010F   D0E0         POP     A
   \   000111   F0           MOVX    @DPTR,A
    345          
    346            /* Channel Page */
    347            pData->ChannelPage = 0x00;
   \   000112   7400         MOV     A,#0x0
   \   000114   8E82         MOV     DPL,R6
   \   000116   8F83         MOV     DPH,R7
   \   000118   A3           INC     DPTR
   \   000119   A3           INC     DPTR
   \   00011A   A3           INC     DPTR
   \   00011B   A3           INC     DPTR
   \   00011C   A3           INC     DPTR
   \   00011D   A3           INC     DPTR
   \   00011E   F0           MOVX    @DPTR,A
    348          
    349            MAC_MlmeScanReq ((macMlmeScanReq_t *)pData);
   \   00011F                ; Setup parameters for call to function MAC_MlmeScanReq
   \   00011F   EE           MOV     A,R6
   \   000120   FA           MOV     R2,A
   \   000121   EF           MOV     A,R7
   \   000122   FB           MOV     R3,A
   \   000123   12....       LCALL   ??MAC_MlmeScanReq?relay
    350          
    351            return ZMacSuccess;
   \   000126   7900         MOV     R1,#0x0
   \                     ??ZMacScanReq_2:
   \   000128   7F04         MOV     R7,#0x4
   \   00012A   02....       LJMP    ?FUNC_LEAVE_XDATA
    352          }
    353          
    354          
    355          /********************************************************************************************************
    356           * @fn      ZMacStartReq
    357           *
    358           * @brief   This function is called to tell the MAC to transmit beacons
    359           *          and become a coordinator.
    360           *
    361           * @param   structure with info need send it.
    362           *
    363           * @return  status
    364           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    365          ROOT uint8 ZMacStartReq( ZMacStartReq_t *pData )
   \                     ZMacStartReq:
    366          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    367            uint8 stat;
    368          
    369            // Probably want to keep the receiver on
    370            stat = true;
   \   00000E   7401         MOV     A,#0x1
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   F0           MOVX    @DPTR,A
    371            MAC_MlmeSetReq( MAC_RX_ON_WHEN_IDLE, &stat );
   \   000017                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000017   85..82       MOV     DPL,?XSP + 0
   \   00001A   85..83       MOV     DPH,?XSP + 1
   \   00001D   AA82         MOV     R2,DPL
   \   00001F   AB83         MOV     R3,DPH
   \   000021   7952         MOV     R1,#0x52
   \   000023   12....       LCALL   ??MAC_MlmeSetReq?relay
    372          
    373            /* Right now, set security to zero */
    374            pData->RealignSec.SecurityLevel = false;
   \   000026   7400         MOV     A,#0x0
   \   000028   C0E0         PUSH    A
   \   00002A   EE           MOV     A,R6
   \   00002B   2415         ADD     A,#0x15
   \   00002D   F582         MOV     DPL,A
   \   00002F   EF           MOV     A,R7
   \   000030   3400         ADDC    A,#0x0
   \   000032   F583         MOV     DPH,A
   \   000034   D0E0         POP     A
   \   000036   F0           MOVX    @DPTR,A
    375            pData->BeaconSec.SecurityLevel = false;
   \   000037   7400         MOV     A,#0x0
   \   000039   C0E0         PUSH    A
   \   00003B   EE           MOV     A,R6
   \   00003C   2420         ADD     A,#0x20
   \   00003E   F582         MOV     DPL,A
   \   000040   EF           MOV     A,R7
   \   000041   3400         ADDC    A,#0x0
   \   000043   F583         MOV     DPH,A
   \   000045   D0E0         POP     A
   \   000047   F0           MOVX    @DPTR,A
    376          
    377          
    378            MAC_MlmeStartReq((macMlmeStartReq_t *) pData);
   \   000048                ; Setup parameters for call to function MAC_MlmeStartReq
   \   000048   EE           MOV     A,R6
   \   000049   FA           MOV     R2,A
   \   00004A   EF           MOV     A,R7
   \   00004B   FB           MOV     R3,A
   \   00004C   12....       LCALL   ??MAC_MlmeStartReq?relay
    379          
    380            // MAC does not issue mlmeStartConfirm(), so we have to
    381            // mlmeStartConfirm( stat );  This needs to be addressed some how
    382          
    383            return ZMacSuccess;
   \   00004F   7900         MOV     R1,#0x0
   \   000051   7401         MOV     A,#0x1
   \   000053   12....       LCALL   ?DEALLOC_XSTACK8
   \   000056   7F01         MOV     R7,#0x1
   \   000058   02....       LJMP    ?FUNC_LEAVE_XDATA
    384          }
    385          
    386          /********************************************************************************************************
    387           * @fn      ZMacSyncReq
    388           *
    389           * @brief   This function is called to request a sync to the current
    390           *          networks beacons.
    391           *
    392           * @param   LogicalChannel -
    393           * @param   TrackBeacon - true/false
    394           *
    395           * @return  status
    396           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    397          ROOT uint8 ZMacSyncReq( ZMacSyncReq_t *pData )
   \                     ZMacSyncReq:
    398          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    399            MAC_MlmeSyncReq( (macMlmeSyncReq_t *)pData);
   \   000009                ; Setup parameters for call to function MAC_MlmeSyncReq
   \   000009   EE           MOV     A,R6
   \   00000A   FA           MOV     R2,A
   \   00000B   EF           MOV     A,R7
   \   00000C   FB           MOV     R3,A
   \   00000D   12....       LCALL   ??MAC_MlmeSyncReq?relay
    400            return ZMacSuccess;
   \   000010   7900         MOV     R1,#0x0
   \   000012   7F01         MOV     R7,#0x1
   \   000014   02....       LJMP    ?FUNC_LEAVE_XDATA
    401          }
    402          
    403          /********************************************************************************************************
    404           * @fn      ZMacPollReq
    405           *
    406           * @brief   This function is called to request MAC data request poll.
    407           *
    408           * @param   coordAddr -
    409           * @param   coordPanId -
    410           * @param   SecurityEnable - true or false.
    411           *
    412           * @return  status
    413           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    414          ROOT uint8 ZMacPollReq( ZMacPollReq_t *pData )
   \                     ZMacPollReq:
    415          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    416            /* Right now, set security to zero */
    417            pData->Sec.SecurityLevel = false;
   \   000009   7400         MOV     A,#0x0
   \   00000B   C0E0         PUSH    A
   \   00000D   EE           MOV     A,R6
   \   00000E   2413         ADD     A,#0x13
   \   000010   F582         MOV     DPL,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F583         MOV     DPH,A
   \   000017   D0E0         POP     A
   \   000019   F0           MOVX    @DPTR,A
    418          
    419            MAC_MlmePollReq ((macMlmePollReq_t *)pData);
   \   00001A                ; Setup parameters for call to function MAC_MlmePollReq
   \   00001A   EE           MOV     A,R6
   \   00001B   FA           MOV     R2,A
   \   00001C   EF           MOV     A,R7
   \   00001D   FB           MOV     R3,A
   \   00001E   12....       LCALL   ??MAC_MlmePollReq?relay
    420            return ( ZMacSuccess );
   \   000021   7900         MOV     R1,#0x0
   \   000023   7F01         MOV     R7,#0x1
   \   000025   02....       LJMP    ?FUNC_LEAVE_XDATA
    421          }
    422          
    423          /********************************************************************************************************
    424           * @fn      ZMacDataReq
    425           *
    426           * @brief   Send a MAC Data Frame packet.
    427           *
    428           * @param   structure containing data and where to send it.
    429           *
    430           * @return  status
    431           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    432          ROOT uint8 ZMacDataReq( ZMacDataReq_t *pData )
   \                     ZMacDataReq:
    433          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 4,R2
   \   000007   8B..         MOV     ?V0 + 5,R3
    434            macMcpsDataReq_t *pBuf;
    435          
    436            /* Allocate memory */
    437            pBuf = MAC_McpsDataAlloc(pData->msduLength, MAC_SEC_LEVEL_NONE, MAC_KEY_ID_MODE_NONE);
   \   000009                ; Setup parameters for call to function MAC_McpsDataAlloc
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   7A00         MOV     R2,#0x0
   \   00000D   E5..         MOV     A,?V0 + 4
   \   00000F   241B         ADD     A,#0x1b
   \   000011   F582         MOV     DPL,A
   \   000013   E5..         MOV     A,?V0 + 5
   \   000015   3400         ADDC    A,#0x0
   \   000017   F583         MOV     DPH,A
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F9           MOV     R1,A
   \   00001B   12....       LCALL   ??MAC_McpsDataAlloc?relay
   \   00001E   8A..         MOV     ?V0 + 0,R2
   \   000020   8B..         MOV     ?V0 + 1,R3
   \   000022   AE..         MOV     R6,?V0 + 0
   \   000024   AF..         MOV     R7,?V0 + 1
    438          
    439            if (pBuf)
   \   000026   EE           MOV     A,R6
   \   000027   6400         XRL     A,#0x0
   \   000029   7003         JNZ     ??ZMacDataReq_0
   \   00002B   EF           MOV     A,R7
   \   00002C   6400         XRL     A,#0x0
   \                     ??ZMacDataReq_0:
   \   00002E   7003         JNZ     $+5
   \   000030   02....       LJMP    ??ZMacDataReq_1
    440            {
    441              /* Copy the addresses */
    442              osal_memcpy (&pBuf->mac, pData, sizeof (macDataReq_t));
   \   000033                ; Setup parameters for call to function osal_memcpy
   \   000033   85....       MOV     ?V0 + 0,?V0 + 4
   \   000036   85....       MOV     ?V0 + 1,?V0 + 5
   \   000039   75..00       MOV     ?V0 + 2,#0x0
   \   00003C   78..         MOV     R0,#?V0 + 0
   \   00003E   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000041   7C10         MOV     R4,#0x10
   \   000043   7D00         MOV     R5,#0x0
   \   000045   EE           MOV     A,R6
   \   000046   2422         ADD     A,#0x22
   \   000048   FA           MOV     R2,A
   \   000049   EF           MOV     A,R7
   \   00004A   3400         ADDC    A,#0x0
   \   00004C   FB           MOV     R3,A
   \   00004D   12....       LCALL   ??osal_memcpy?relay
   \   000050   7403         MOV     A,#0x3
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
    443          
    444              /* Copy data */
    445              pBuf->msdu.len = pData->msduLength;
   \   000055   E5..         MOV     A,?V0 + 4
   \   000057   241B         ADD     A,#0x1b
   \   000059   F582         MOV     DPL,A
   \   00005B   E5..         MOV     A,?V0 + 5
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   F583         MOV     DPH,A
   \   000061   E0           MOVX    A,@DPTR
   \   000062   8E82         MOV     DPL,R6
   \   000064   8F83         MOV     DPH,R7
   \   000066   A3           INC     DPTR
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   A3           INC     DPTR
   \   00006A   F0           MOVX    @DPTR,A
    446              osal_memcpy (pBuf->msdu.p, pData->msdu, pData->msduLength);
   \   00006B                ; Setup parameters for call to function osal_memcpy
   \   00006B   E5..         MOV     A,?V0 + 4
   \   00006D   241C         ADD     A,#0x1c
   \   00006F   F582         MOV     DPL,A
   \   000071   E5..         MOV     A,?V0 + 5
   \   000073   3400         ADDC    A,#0x0
   \   000075   F583         MOV     DPH,A
   \   000077   E0           MOVX    A,@DPTR
   \   000078   F5..         MOV     ?V0 + 0,A
   \   00007A   A3           INC     DPTR
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F5..         MOV     ?V0 + 1,A
   \   00007E   75..00       MOV     ?V0 + 2,#0x0
   \   000081   78..         MOV     R0,#?V0 + 0
   \   000083   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000086   E5..         MOV     A,?V0 + 4
   \   000088   241B         ADD     A,#0x1b
   \   00008A   F582         MOV     DPL,A
   \   00008C   E5..         MOV     A,?V0 + 5
   \   00008E   3400         ADDC    A,#0x0
   \   000090   F583         MOV     DPH,A
   \   000092   E0           MOVX    A,@DPTR
   \   000093   F5..         MOV     ?V0 + 0,A
   \   000095   AC..         MOV     R4,?V0 + 0
   \   000097   7D00         MOV     R5,#0x0
   \   000099   8E82         MOV     DPL,R6
   \   00009B   8F83         MOV     DPH,R7
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   FA           MOV     R2,A
   \   0000A1   A3           INC     DPTR
   \   0000A2   E0           MOVX    A,@DPTR
   \   0000A3   FB           MOV     R3,A
   \   0000A4   12....       LCALL   ??osal_memcpy?relay
   \   0000A7   7403         MOV     A,#0x3
   \   0000A9   12....       LCALL   ?DEALLOC_XSTACK8
    447          
    448              /* Right now, set security to zero */
    449              pBuf->sec.securityLevel = false;
   \   0000AC   7400         MOV     A,#0x0
   \   0000AE   C0E0         PUSH    A
   \   0000B0   EE           MOV     A,R6
   \   0000B1   241F         ADD     A,#0x1f
   \   0000B3   F582         MOV     DPL,A
   \   0000B5   EF           MOV     A,R7
   \   0000B6   3400         ADDC    A,#0x0
   \   0000B8   F583         MOV     DPH,A
   \   0000BA   D0E0         POP     A
   \   0000BC   F0           MOVX    @DPTR,A
    450          
    451              /* Call Mac Data Request */
    452              MAC_McpsDataReq(pBuf);
   \   0000BD                ; Setup parameters for call to function MAC_McpsDataReq
   \   0000BD   EE           MOV     A,R6
   \   0000BE   FA           MOV     R2,A
   \   0000BF   EF           MOV     A,R7
   \   0000C0   FB           MOV     R3,A
   \   0000C1   12....       LCALL   ??MAC_McpsDataReq?relay
    453          
    454              return ( ZMacSuccess );
   \   0000C4   7900         MOV     R1,#0x0
   \   0000C6   8002         SJMP    ??ZMacDataReq_2
    455            }
    456          
    457            return MAC_NO_RESOURCES;
   \                     ??ZMacDataReq_1:
   \   0000C8   791A         MOV     R1,#0x1a
   \                     ??ZMacDataReq_2:
   \   0000CA   7F06         MOV     R7,#0x6
   \   0000CC   02....       LJMP    ?FUNC_LEAVE_XDATA
    458          }
    459          
    460          /********************************************************************************************************
    461           * @fn      ZMacPurgeReq
    462           *
    463           * @brief   Purge a MAC Data Frame packet.
    464           *
    465           * @param   MSDU data handle.
    466           *
    467           * @return  status
    468           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    469          ROOT uint8 ZMacPurgeReq( byte Handle )
   \                     ZMacPurgeReq:
    470          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    471            MAC_McpsPurgeReq( Handle );
   \   000006                ; Setup parameters for call to function MAC_McpsPurgeReq
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??MAC_McpsPurgeReq?relay
    472            return ZMacSuccess;
   \   00000A   7900         MOV     R1,#0x0
   \   00000C   7F01         MOV     R7,#0x1
   \   00000E   02....       LJMP    ?FUNC_LEAVE_XDATA
    473          }
    474          
    475          /********************************************************************************************************
    476           * @fn      - ZMACPwrOnReq
    477           *
    478           * @brief   - This function requests the MAC to power on the radio hardware
    479           *            and wake up.  When the power on procedure is complete the MAC
    480           *            will send a MAC_PWR_ON_CNF to the application.
    481           *
    482           * @input   - None.
    483           *
    484           * @output  - None.
    485           *
    486           * @return  - None.
    487           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    488          void ZMacPwrOnReq ( void )
   \                     ZMacPwrOnReq:
    489          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    490            MAC_PwrOnReq();
   \   000004                ; Setup parameters for call to function MAC_PwrOnReq
   \   000004   12....       LCALL   ??MAC_PwrOnReq?relay
    491          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    492          
    493          /********************************************************************************************************
    494           * @fn          MAC_PwrMode
    495           *
    496           * @brief       This function returns the current power mode of the MAC.
    497           *
    498           * input parameters
    499           *
    500           * None.
    501           *
    502           * output parameters
    503           *
    504           * None.
    505           *
    506           * @return      The current power mode of the MAC.
    507           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    508          uint8 ZMac_PwrMode(void)
   \                     ZMac_PwrMode:
    509          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    510            return (MAC_PwrMode());
   \   000004                ; Setup parameters for call to function MAC_PwrMode
   \   000004   12....       LCALL   ??MAC_PwrMode?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    511          }
    512          
    513          /********************************************************************************************************
    514           * @fn      ZMacSetTransmitPower
    515           *
    516           * @brief   Set the transmitter power according to the level setting param.
    517           *
    518           * @param   Valid power level setting as defined in ZMAC.h.
    519           *
    520           * @return  ZMacSuccess if PHY_TRANSMIT_POWER found or ZMacUnsupportedAttribute.
    521           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    522          ROOT uint8 ZMacSetTransmitPower( ZMacTransmitPower_t level )
   \                     ZMacSetTransmitPower:
    523          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    524            uint8 pwr;
    525          
    526            if ( (level /= 2) >= 8 )
   \   00000B   75F002       MOV     B,#0x2
   \   00000E   84           DIV     AB
   \   00000F   FA           MOV     R2,A
   \   000010   EA           MOV     A,R2
   \   000011   FE           MOV     R6,A
   \   000012   EA           MOV     A,R2
   \   000013   C3           CLR     C
   \   000014   9408         SUBB    A,#0x8
   \   000016   400E         JC      ??ZMacSetTransmitPower_0
    527            {
    528              pwr = TxPowerSettings[0];
   \   000018   90....       MOV     DPTR,#TxPowerSettings
   \   00001B   E4           CLR     A
   \   00001C   93           MOVC    A,@A+DPTR
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   F0           MOVX    @DPTR,A
   \   000024   801A         SJMP    ??ZMacSetTransmitPower_1
    529            }
    530            else
    531            {
    532              pwr = TxPowerSettings[level];
   \                     ??ZMacSetTransmitPower_0:
   \   000026   8E..         MOV     ?V0 + 0,R6
   \   000028   75..00       MOV     ?V0 + 1,#0x0
   \   00002B   E5..         MOV     A,?V0 + 0
   \   00002D   24..         ADD     A,#(TxPowerSettings & 0xff)
   \   00002F   F582         MOV     DPL,A
   \   000031   E5..         MOV     A,?V0 + 1
   \   000033   34..         ADDC    A,#((TxPowerSettings >> 8) & 0xff)
   \   000035   F583         MOV     DPH,A
   \   000037   E4           CLR     A
   \   000038   93           MOVC    A,@A+DPTR
   \   000039   85..82       MOV     DPL,?XSP + 0
   \   00003C   85..83       MOV     DPH,?XSP + 1
   \   00003F   F0           MOVX    @DPTR,A
    533            }
    534          
    535            if ( MAC_MlmeSetReq( ZMacPhyTransmitPower, &pwr ) == ZSUCCESS )
   \                     ??ZMacSetTransmitPower_1:
   \   000040                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000040   85..82       MOV     DPL,?XSP + 0
   \   000043   85..83       MOV     DPH,?XSP + 1
   \   000046   AA82         MOV     R2,DPL
   \   000048   AB83         MOV     R3,DPH
   \   00004A   79E0         MOV     R1,#-0x20
   \   00004C   12....       LCALL   ??MAC_MlmeSetReq?relay
   \   00004F   E9           MOV     A,R1
   \   000050   7004         JNZ     ??ZMacSetTransmitPower_2
    536            {
    537              //msupSetTransmitPower();
    538              return ZMacSuccess;
   \   000052   7900         MOV     R1,#0x0
   \   000054   8002         SJMP    ??ZMacSetTransmitPower_3
    539            }
    540          
    541            return ZMacUnsupportedAttribute;
   \                     ??ZMacSetTransmitPower_2:
   \   000056   79F4         MOV     R1,#-0xc
   \                     ??ZMacSetTransmitPower_3:
   \   000058   7401         MOV     A,#0x1
   \   00005A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005D   7F02         MOV     R7,#0x2
   \   00005F   02....       LJMP    ?FUNC_LEAVE_XDATA
    542          }
    543          
    544          /********************************************************************************************************
    545           * @fn      ZMacSendNoData
    546           *
    547           * @brief   This function sends an empty msg
    548           *
    549           * @param   DstAddr   - destination short address
    550           *          DstPANId  - destination pan id
    551           *
    552           * @return  None
    553           ********************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    554          ROOT void ZMacSendNoData ( uint16 DstAddr, uint16 DstPANId )
   \                     ZMacSendNoData:
    555          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 2,R2
   \   000007   8B..         MOV     ?V0 + 3,R3
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
    556            macMcpsDataReq_t *pBuf;
    557          
    558            /* Allocate memory */
    559            pBuf = MAC_McpsDataAlloc(0, MAC_SEC_LEVEL_NONE, MAC_KEY_ID_MODE_NONE);
   \   00000D                ; Setup parameters for call to function MAC_McpsDataAlloc
   \   00000D   7B00         MOV     R3,#0x0
   \   00000F   7A00         MOV     R2,#0x0
   \   000011   7900         MOV     R1,#0x0
   \   000013   12....       LCALL   ??MAC_McpsDataAlloc?relay
   \   000016   8A..         MOV     ?V0 + 4,R2
   \   000018   8B..         MOV     ?V0 + 5,R3
   \   00001A   AE..         MOV     R6,?V0 + 4
   \   00001C   AF..         MOV     R7,?V0 + 5
    560          
    561            if (pBuf)
   \   00001E   EE           MOV     A,R6
   \   00001F   6400         XRL     A,#0x0
   \   000021   7003         JNZ     ??ZMacSendNoData_0
   \   000023   EF           MOV     A,R7
   \   000024   6400         XRL     A,#0x0
   \                     ??ZMacSendNoData_0:
   \   000026   607E         JZ      ??ZMacSendNoData_1
    562            {
    563              /* Fill in src information */
    564              pBuf->mac.srcAddrMode              = SADDR_MODE_SHORT;
   \   000028   7402         MOV     A,#0x2
   \   00002A   C0E0         PUSH    A
   \   00002C   EE           MOV     A,R6
   \   00002D   242D         ADD     A,#0x2d
   \   00002F   F582         MOV     DPL,A
   \   000031   EF           MOV     A,R7
   \   000032   3400         ADDC    A,#0x0
   \   000034   F583         MOV     DPH,A
   \   000036   D0E0         POP     A
   \   000038   F0           MOVX    @DPTR,A
    565          
    566              /* Fill in dst information */
    567              pBuf->mac.dstAddr.addr.shortAddr   = DstAddr;
   \   000039   EE           MOV     A,R6
   \   00003A   2422         ADD     A,#0x22
   \   00003C   F582         MOV     DPL,A
   \   00003E   EF           MOV     A,R7
   \   00003F   3400         ADDC    A,#0x0
   \   000041   F583         MOV     DPH,A
   \   000043   E5..         MOV     A,?V0 + 2
   \   000045   F0           MOVX    @DPTR,A
   \   000046   A3           INC     DPTR
   \   000047   E5..         MOV     A,?V0 + 3
   \   000049   F0           MOVX    @DPTR,A
    568              pBuf->mac.dstAddr.addrMode         = SADDR_MODE_SHORT;
   \   00004A   7402         MOV     A,#0x2
   \   00004C   C0E0         PUSH    A
   \   00004E   EE           MOV     A,R6
   \   00004F   242A         ADD     A,#0x2a
   \   000051   F582         MOV     DPL,A
   \   000053   EF           MOV     A,R7
   \   000054   3400         ADDC    A,#0x0
   \   000056   F583         MOV     DPH,A
   \   000058   D0E0         POP     A
   \   00005A   F0           MOVX    @DPTR,A
    569              pBuf->mac.dstPanId                 = DstPANId;
   \   00005B   EE           MOV     A,R6
   \   00005C   242B         ADD     A,#0x2b
   \   00005E   F582         MOV     DPL,A
   \   000060   EF           MOV     A,R7
   \   000061   3400         ADDC    A,#0x0
   \   000063   F583         MOV     DPH,A
   \   000065   E5..         MOV     A,?V0 + 0
   \   000067   F0           MOVX    @DPTR,A
   \   000068   A3           INC     DPTR
   \   000069   E5..         MOV     A,?V0 + 1
   \   00006B   F0           MOVX    @DPTR,A
    570          
    571              /* Misc information */
    572              pBuf->mac.msduHandle               = 0;
   \   00006C   7400         MOV     A,#0x0
   \   00006E   C0E0         PUSH    A
   \   000070   EE           MOV     A,R6
   \   000071   242E         ADD     A,#0x2e
   \   000073   F582         MOV     DPL,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   F583         MOV     DPH,A
   \   00007A   D0E0         POP     A
   \   00007C   F0           MOVX    @DPTR,A
    573              pBuf->mac.txOptions                = ZMAC_TXOPTION_ACK | ZMAC_TXOPTION_NO_RETRANS | ZMAC_TXOPTION_NO_CNF;
   \   00007D   7431         MOV     A,#0x31
   \   00007F   C0E0         PUSH    A
   \   000081   EE           MOV     A,R6
   \   000082   242F         ADD     A,#0x2f
   \   000084   F582         MOV     DPL,A
   \   000086   EF           MOV     A,R7
   \   000087   3400         ADDC    A,#0x0
   \   000089   F583         MOV     DPH,A
   \   00008B   D0E0         POP     A
   \   00008D   F0           MOVX    @DPTR,A
    574          
    575              /* Right now, set security to zero */
    576              pBuf->sec.securityLevel = false;
   \   00008E   7400         MOV     A,#0x0
   \   000090   C0E0         PUSH    A
   \   000092   EE           MOV     A,R6
   \   000093   241F         ADD     A,#0x1f
   \   000095   F582         MOV     DPL,A
   \   000097   EF           MOV     A,R7
   \   000098   3400         ADDC    A,#0x0
   \   00009A   F583         MOV     DPH,A
   \   00009C   D0E0         POP     A
   \   00009E   F0           MOVX    @DPTR,A
    577          
    578              /* Call Mac Data Request */
    579              MAC_McpsDataReq(pBuf);
   \   00009F                ; Setup parameters for call to function MAC_McpsDataReq
   \   00009F   EE           MOV     A,R6
   \   0000A0   FA           MOV     R2,A
   \   0000A1   EF           MOV     A,R7
   \   0000A2   FB           MOV     R3,A
   \   0000A3   12....       LCALL   ??MAC_McpsDataReq?relay
    580            }
    581          
    582          }
   \                     ??ZMacSendNoData_1:
   \   0000A6   7F06         MOV     R7,#0x6
   \   0000A8   02....       LJMP    ?FUNC_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacPwrOnReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacPwrOnReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMac_PwrMode?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMac_PwrMode

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     ZMacAssociateReq                 1      0      8
       -> MAC_MlmeAssociateReq        0      0     16
     ZMacAssociateRsp                 1      0      8
       -> MAC_MlmeAssociateRsp        0      0     16
     ZMacDataReq                      1      0     16
       -> MAC_McpsDataAlloc           0      0     26
       -> osal_memcpy                 0      0     32
       -> osal_memcpy                 0      0     32
       -> MAC_McpsDataReq             0      0     26
     ZMacDisassociateReq              1      0      8
       -> MAC_MlmeDisassociateReq     0      0     16
     ZMacGetReq                       0      0      8
       -> osal_cpyExtAddr             0      0     16
       -> MAC_MlmeGetReq              0      0     16
     ZMacInit                         0      0      8
       -> MAC_Init                    0      0     16
       -> MAC_InitDevice              0      0     16
       -> ZMacReset                   0      0     16
       -> osal_int_disable            0      0     16
     ZMacOrphanRsp                    1      0      8
       -> MAC_MlmeOrphanRsp           0      0     16
     ZMacPollReq                      1      0      8
       -> MAC_MlmePollReq             0      0     16
     ZMacPurgeReq                     0      0      8
       -> MAC_McpsPurgeReq            0      0     16
     ZMacPwrOnReq                     2      0      0
       -> MAC_PwrOnReq                4      0      0
     ZMacReset                        1      0     17
       -> MAC_MlmeResetReq            0      0     18
       -> MAC_MlmeSetReq              0      0     18
       -> MAC_MlmeSetReq              0      0     18
       -> osal_mem_free               0      0     18
     ZMacRxEnableReq                  0      0      0
     ZMacScanReq                      1      0     11
       -> osal_mem_alloc              0      0     22
       -> osal_memset                 0      0     22
       -> osal_mem_alloc              0      0     22
       -> MAC_MlmeScanReq             0      0     22
     ZMacSendNoData                   1      0     13
       -> MAC_McpsDataAlloc           0      0     26
       -> MAC_McpsDataReq             0      0     26
     ZMacSetReq                       0      0      8
       -> osal_cpyExtAddr             0      0     16
       -> MAC_MlmeSetReq              0      0     16
     ZMacSetTransmitPower             1      0     10
       -> MAC_MlmeSetReq              0      0     20
     ZMacStartReq                     1      0      9
       -> MAC_MlmeSetReq              0      0     18
       -> MAC_MlmeStartReq            0      0     18
     ZMacSyncReq                      0      0      8
       -> MAC_MlmeSyncReq             0      0     16
     ZMacUpdate                       0      0      0
     ZMac_PwrMode                     2      0      0
       -> MAC_PwrMode                 4      0      0


   Segment part sizes:

     Function/Label       Bytes
     --------------       -----
     TxPowerSettings         8
     _ScanChannels           4
     ZMac_ScanBuf            2
     ZMacInit               30
     ZMacUpdate              3
     ZMacReset              97
     ZMacGetReq             46
     ZMacSetReq             42
     ZMacAssociateReq       40
     ZMacAssociateRsp       40
     ZMacDisassociateReq    40
     ZMacOrphanRsp          40
     ZMacRxEnableReq         3
     ZMacScanReq           301
     ZMacStartReq           91
     ZMacSyncReq            23
     ZMacPollReq            40
     ZMacDataReq           207
     ZMacPurgeReq           17
     ZMacPwrOnReq           14
     ZMac_PwrMode           14
     ZMacSetTransmitPower   98
     ZMacSendNoData        171
     ??ZMacPwrOnReq?relay    6
     ??ZMac_PwrMode?relay    6

 
    28 bytes in segment BANKED_CODE
    12 bytes in segment BANK_RELAYS
     8 bytes in segment CODE_C
 1 329 bytes in segment NEAR_CODE
     6 bytes in segment XDATA_Z
 
 1 377 bytes of CODE  memory
     6 bytes of XDATA memory

Errors: none
Warnings: none
