###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    19/Mar/2013  19:57:50 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \stack\af\AF.c                                     #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wEndev.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\Tools #
#                          \CC2430DB\f8wConfig.cfg" (-DSECURE=0               #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\stack\af #
#                          \AF.c" -D CC2430EB -D AXD_END -D AXD_END_B -D      #
#                          NWK_AUTO_POLL -D REFLECTOR -D xZTOOL_P1 -D         #
#                          xMT_TASK -D xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG   #
#                          -D xPOWER_SAVING -lC "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\ENDDevice2EB\L #
#                          ist\" -lA "C:\Texas Instruments\ZStack-1.4.3-1.2.1 #
#                          \Projects\zstack\Samples\cc2430-zstack-adxl345\CC2 #
#                          430DB\ENDDevice2EB\List\" --diag_suppress          #
#                          Pe001,Pa010 --diag_remark pe550 -o "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\ENDDevice2EB\O #
#                          bj\" -e --require_prototypes -z2 --no_cse          #
#                          --no_unroll --no_inline --no_code_motion           #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\SOURCE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\cc2430-zstack-adxl345 #
#                          \CC2430DB\..\Drivers\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\ZMAIN #
#                          \TI2430DB\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\ENDDe #
#                          vice2EB\List\AF.lst                                #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\ENDDe #
#                          vice2EB\Obj\AF.r51                                 #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\stack\af\AF.c
      1          /**************************************************************************************************
      2            Filename:       AF.c
      3            Revised:        $Date: 2007-11-13 14:46:00 -0800 (Tue, 13 Nov 2007) $
      4            Revision:       $Revision: 15923 $
      5          
      6            Description:    Application Framework - Device Description helper functions
      7          
      8          
      9            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          
     44          #include "OSAL.h"
     45          #include "AF.h"
     46          #include "nwk_globals.h"
     47          #include "nwk_util.h"
     48          #include "aps_groups.h"
     49          #include "ZDProfile.h"
     50          #include "aps_frag.h"
     51          
     52          #if ( AF_FLOAT_SUPPORT )
     53            #include "math.h"
     54          #endif
     55          
     56          #if defined ( MT_AF_CB_FUNC )
     57            #include "MT_AF.h"
     58          #endif
     59          
     60          /*********************************************************************
     61           * MACROS
     62           */
     63          
     64          /*********************************************************************
     65           * @fn      afSend
     66           *
     67           * @brief   Helper macro for V1 API to invoke V2 API.
     68           *
     69           * input parameters
     70           *
     71           * @param  *dstAddr - Full ZB destination address: Nwk Addr + End Point.
     72           * @param   srcEP - Origination (i.e. respond to or ack to) End Point.
     73           * @param   cID - A valid cluster ID as specified by the Profile.
     74           * @param   len - Number of bytes of data pointed to by next param.
     75           * @param  *buf - A pointer to the data bytes to send.
     76           * @param   options - Valid bit mask of AF Tx Options as defined in AF.h.
     77           * @param  *transID - A pointer to a byte which can be modified and which will
     78           *                    be used as the transaction sequence number of the msg.
     79           *
     80           * output parameters
     81           *
     82           * @param  *transID - Incremented by one if the return value is success.
     83           *
     84           * @return  afStatus_t - See previous definition of afStatus_... types.
     85           */
     86          #define afSend( dstAddr, srcEP, cID, len, buf, transID, options, radius ) \
     87                  AF_DataRequest( (dstAddr), afFindEndPointDesc( (srcEP) ), \
     88                                    (cID), (len), (buf), (transID), (options), (radius) )
     89          
     90          /*********************************************************************
     91           * CONSTANTS
     92           */
     93          
     94          /*********************************************************************
     95           * TYPEDEFS
     96           */
     97          
     98          /*********************************************************************
     99           * GLOBAL VARIABLES
    100           */
    101          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    102          epList_t *epList;
   \                     epList:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    103          
    104          /*********************************************************************
    105           * EXTERNAL VARIABLES
    106           */
    107          
    108          /*********************************************************************
    109           * EXTERNAL FUNCTIONS
    110           */
    111          
    112          /*********************************************************************
    113           * LOCAL VARIABLES
    114           */
    115          
    116          /*********************************************************************
    117           * LOCAL FUNCTIONS
    118           */
    119          
    120          static void afBuildMSGIncoming( aps_FrameFormat_t *aff, endPointDesc_t *epDesc,
    121                          zAddrType_t *SrcAddress, uint8 LinkQuality, byte SecurityUse,
    122                          uint32 timestamp );
    123          
    124          static epList_t *afFindEndPointDescList( byte EndPoint );
    125          
    126          static pDescCB afGetDescCB( endPointDesc_t *epDesc );
    127          
    128          /*********************************************************************
    129           * NETWORK LAYER CALLBACKS
    130           */
    131          
    132          /*********************************************************************
    133           * PUBLIC FUNCTIONS
    134           */
    135          
    136          /*********************************************************************
    137           * @fn      afInit
    138           *
    139           * @brief   Initialization function for the AF.
    140           *
    141           * @param   none
    142           *
    143           * @return  none
    144           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    145          void afInit( void )
   \                     afInit:
    146          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    147            // Start with no endpoint defined
    148            epList = NULL;
   \   000004   90....       MOV     DPTR,#epList
   \   000007   7400         MOV     A,#0x0
   \   000009   F0           MOVX    @DPTR,A
   \   00000A   A3           INC     DPTR
   \   00000B   7400         MOV     A,#0x0
   \   00000D   F0           MOVX    @DPTR,A
    149          }
   \   00000E   D083         POP     DPH
   \   000010   D082         POP     DPL
   \   000012   02....       LJMP    ?BRET
    150          
    151          /*********************************************************************
    152           * @fn      afRegisterExtended
    153           *
    154           * @brief   Register an Application's EndPoint description.
    155           *
    156           * @param   epDesc - pointer to the Application's endpoint descriptor.
    157           * @param   descFn - pointer to descriptor callback function
    158           *
    159           * NOTE:  The memory that epDesc is pointing to must exist after this call.
    160           *
    161           * @return  Pointer to epList_t on success, NULL otherwise.
    162           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    163          epList_t *afRegisterExtended( endPointDesc_t *epDesc, pDescCB descFn )
   \                     afRegisterExtended:
    164          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 6,R2
   \   000007   8B..         MOV     ?V0 + 7,R3
   \   000009   8C..         MOV     ?V0 + 2,R4
   \   00000B   8D..         MOV     ?V0 + 3,R5
    165            epList_t *ep;
    166            epList_t *epSearch;
    167          
    168            ep = osal_mem_alloc( sizeof ( epList_t ) );
   \   00000D                ; Setup parameters for call to function osal_mem_alloc
   \   00000D   7A07         MOV     R2,#0x7
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   12....       LCALL   ??osal_mem_alloc?relay
   \   000014   8A..         MOV     ?V0 + 4,R2
   \   000016   8B..         MOV     ?V0 + 5,R3
   \   000018   AE..         MOV     R6,?V0 + 4
   \   00001A   AF..         MOV     R7,?V0 + 5
    169            if ( ep )
   \   00001C   EE           MOV     A,R6
   \   00001D   6400         XRL     A,#0x0
   \   00001F   7003         JNZ     ??afRegisterExtended_0
   \   000021   EF           MOV     A,R7
   \   000022   6400         XRL     A,#0x0
   \                     ??afRegisterExtended_0:
   \   000024   7003         JNZ     $+5
   \   000026   02....       LJMP    ??afRegisterExtended_1 & 0xFFFF
    170            {
    171              // Fill in the new list entry
    172              ep->epDesc = epDesc;
   \   000029   8E82         MOV     DPL,R6
   \   00002B   8F83         MOV     DPH,R7
   \   00002D   E5..         MOV     A,?V0 + 6
   \   00002F   F0           MOVX    @DPTR,A
   \   000030   A3           INC     DPTR
   \   000031   E5..         MOV     A,?V0 + 7
   \   000033   F0           MOVX    @DPTR,A
    173          
    174              // Default to allow Match Descriptor.
    175              ep->flags = eEP_AllowMatch;
   \   000034   7401         MOV     A,#0x1
   \   000036   8E82         MOV     DPL,R6
   \   000038   8F83         MOV     DPH,R7
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   F0           MOVX    @DPTR,A
    176              ep->pfnDescCB = descFn;
   \   00003D   8E82         MOV     DPL,R6
   \   00003F   8F83         MOV     DPH,R7
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   E5..         MOV     A,?V0 + 2
   \   000046   F0           MOVX    @DPTR,A
   \   000047   A3           INC     DPTR
   \   000048   E5..         MOV     A,?V0 + 3
   \   00004A   F0           MOVX    @DPTR,A
    177              ep->nextDesc = NULL;
   \   00004B   8E82         MOV     DPL,R6
   \   00004D   8F83         MOV     DPH,R7
   \   00004F   A3           INC     DPTR
   \   000050   A3           INC     DPTR
   \   000051   A3           INC     DPTR
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   7400         MOV     A,#0x0
   \   000056   F0           MOVX    @DPTR,A
   \   000057   A3           INC     DPTR
   \   000058   7400         MOV     A,#0x0
   \   00005A   F0           MOVX    @DPTR,A
    178          
    179              // Does a list exist?
    180              if ( epList == NULL )
   \   00005B   90....       MOV     DPTR,#epList
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   6400         XRL     A,#0x0
   \   000061   7004         JNZ     ??afRegisterExtended_2
   \   000063   A3           INC     DPTR
   \   000064   E0           MOVX    A,@DPTR
   \   000065   6400         XRL     A,#0x0
   \                     ??afRegisterExtended_2:
   \   000067   700A         JNZ     ??afRegisterExtended_3
    181                epList = ep;  // Make this the first entry
   \   000069   90....       MOV     DPTR,#epList
   \   00006C   EE           MOV     A,R6
   \   00006D   F0           MOVX    @DPTR,A
   \   00006E   A3           INC     DPTR
   \   00006F   EF           MOV     A,R7
   \   000070   F0           MOVX    @DPTR,A
   \   000071   8046         SJMP    ??afRegisterExtended_1
    182              else
    183              {
    184                // Look for the end of the list
    185                epSearch = epList;
   \                     ??afRegisterExtended_3:
   \   000073   90....       MOV     DPTR,#epList
   \   000076   E0           MOVX    A,@DPTR
   \   000077   F8           MOV     R0,A
   \   000078   A3           INC     DPTR
   \   000079   E0           MOVX    A,@DPTR
   \   00007A   F9           MOV     R1,A
   \   00007B   88..         MOV     ?V0 + 0,R0
   \   00007D   89..         MOV     ?V0 + 1,R1
    186                while( epSearch->nextDesc != NULL )
   \                     ??afRegisterExtended_4:
   \   00007F   85..82       MOV     DPL,?V0 + 0
   \   000082   85..83       MOV     DPH,?V0 + 1
   \   000085   A3           INC     DPTR
   \   000086   A3           INC     DPTR
   \   000087   A3           INC     DPTR
   \   000088   A3           INC     DPTR
   \   000089   A3           INC     DPTR
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   6400         XRL     A,#0x0
   \   00008D   7004         JNZ     ??afRegisterExtended_5
   \   00008F   A3           INC     DPTR
   \   000090   E0           MOVX    A,@DPTR
   \   000091   6400         XRL     A,#0x0
   \                     ??afRegisterExtended_5:
   \   000093   6014         JZ      ??afRegisterExtended_6
    187                  epSearch = epSearch->nextDesc;
   \   000095   85..82       MOV     DPL,?V0 + 0
   \   000098   85..83       MOV     DPH,?V0 + 1
   \   00009B   A3           INC     DPTR
   \   00009C   A3           INC     DPTR
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   F5..         MOV     ?V0 + 0,A
   \   0000A3   A3           INC     DPTR
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   F5..         MOV     ?V0 + 1,A
   \   0000A7   80D6         SJMP    ??afRegisterExtended_4
    188          
    189                // Add new entry to end of list
    190                epSearch->nextDesc = ep;
   \                     ??afRegisterExtended_6:
   \   0000A9   85..82       MOV     DPL,?V0 + 0
   \   0000AC   85..83       MOV     DPH,?V0 + 1
   \   0000AF   A3           INC     DPTR
   \   0000B0   A3           INC     DPTR
   \   0000B1   A3           INC     DPTR
   \   0000B2   A3           INC     DPTR
   \   0000B3   A3           INC     DPTR
   \   0000B4   EE           MOV     A,R6
   \   0000B5   F0           MOVX    @DPTR,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   EF           MOV     A,R7
   \   0000B8   F0           MOVX    @DPTR,A
    191              }
    192            }
    193          
    194            return ep;
   \                     ??afRegisterExtended_1:
   \   0000B9   EE           MOV     A,R6
   \   0000BA   FA           MOV     R2,A
   \   0000BB   EF           MOV     A,R7
   \   0000BC   FB           MOV     R3,A
   \   0000BD   7F08         MOV     R7,#0x8
   \   0000BF   02....       LJMP    ?BANKED_LEAVE_XDATA
    195          }
    196          
    197          /*********************************************************************
    198           * @fn      afRegister
    199           *
    200           * @brief   Register an Application's EndPoint description.
    201           *
    202           * @param   epDesc - pointer to the Application's endpoint descriptor.
    203           *
    204           * NOTE:  The memory that epDesc is pointing to must exist after this call.
    205           *
    206           * @return  afStatus_SUCCESS - Registered
    207           *          afStatus_MEM_FAIL - not enough memory to add descriptor
    208           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    209          afStatus_t afRegister( endPointDesc_t *epDesc )
   \                     afRegister:
    210          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    211            epList_t *ep = afRegisterExtended( epDesc, NULL );
   \   000009                ; Setup parameters for call to function afRegisterExtended
   \   000009   7C00         MOV     R4,#0x0
   \   00000B   7D00         MOV     R5,#0x0
   \   00000D   AA..         MOV     R2,?V0 + 0
   \   00000F   AB..         MOV     R3,?V0 + 1
   \   000011   12....       LCALL   ??afRegisterExtended?relay
   \   000014   8A..         MOV     ?V0 + 2,R2
   \   000016   8B..         MOV     ?V0 + 3,R3
    212          
    213            return ((ep == NULL) ? afStatus_MEM_FAIL : afStatus_SUCCESS);
   \   000018   E5..         MOV     A,?V0 + 2
   \   00001A   6400         XRL     A,#0x0
   \   00001C   7004         JNZ     ??afRegister_0
   \   00001E   E5..         MOV     A,?V0 + 3
   \   000020   6400         XRL     A,#0x0
   \                     ??afRegister_0:
   \   000022   7004         JNZ     ??afRegister_1
   \   000024   7981         MOV     R1,#-0x7f
   \   000026   8002         SJMP    ??afRegister_2
   \                     ??afRegister_1:
   \   000028   7900         MOV     R1,#0x0
   \                     ??afRegister_2:
   \   00002A   7F04         MOV     R7,#0x4
   \   00002C   02....       LJMP    ?BANKED_LEAVE_XDATA
    214          }
    215          
    216          
    217          /*********************************************************************
    218           * @fn          afDataConfirm
    219           *
    220           * @brief       This function will generate the Data Confirm back to
    221           *              the application.
    222           *
    223           * @param       endPoint - confirm end point
    224           * @param       transID - transaction ID from APSDE_DATA_REQUEST
    225           * @param       status - status of APSDE_DATA_REQUEST
    226           *
    227           * @return      none
    228           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    229          void afDataConfirm( uint8 endPoint, uint8 transID, ZStatus_t status )
   \                     afDataConfirm:
    230          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   8A..         MOV     ?V0 + 4,R2
   \   000009   8B..         MOV     ?V0 + 1,R3
    231            endPointDesc_t *epDesc;
    232            afDataConfirm_t *msgPtr;
    233          
    234            // Find the endpoint description
    235            epDesc = afFindEndPointDesc( endPoint );
   \   00000B                ; Setup parameters for call to function afFindEndPointDesc
   \   00000B   A9..         MOV     R1,?V0 + 0
   \   00000D   12....       LCALL   ??afFindEndPointDesc?relay
   \   000010   8A..         MOV     ?V0 + 2,R2
   \   000012   8B..         MOV     ?V0 + 3,R3
   \   000014   85....       MOV     ?V0 + 6,?V0 + 2
   \   000017   85....       MOV     ?V0 + 7,?V0 + 3
    236            if ( epDesc == NULL )
   \   00001A   E5..         MOV     A,?V0 + 6
   \   00001C   6400         XRL     A,#0x0
   \   00001E   7004         JNZ     ??afDataConfirm_0
   \   000020   E5..         MOV     A,?V0 + 7
   \   000022   6400         XRL     A,#0x0
   \                     ??afDataConfirm_0:
   \   000024   6053         JZ      ??afDataConfirm_1
    237              return;
    238          
    239          #if defined ( MT_AF_CB_FUNC )
    240              // If MT has subscribed for this callback, don't send as a message.
    241            if ( ( AFCB_CHECK( endPoint, *(epDesc->task_id), SPI_CB_AF_DATA_CNF ) ) )
    242            {
    243              // Send callback if it's subscribed
    244              MT_AfDataConfirm ( endPoint, transID, status );
    245              return;
    246            }
    247          #endif
    248          
    249            // Determine the incoming command type
    250            msgPtr = (afDataConfirm_t *)osal_msg_allocate( sizeof(afDataConfirm_t) );
   \   000026                ; Setup parameters for call to function osal_msg_allocate
   \   000026   7A04         MOV     R2,#0x4
   \   000028   7B00         MOV     R3,#0x0
   \   00002A   12....       LCALL   ??osal_msg_allocate?relay
   \   00002D   8A..         MOV     ?V0 + 2,R2
   \   00002F   8B..         MOV     ?V0 + 3,R3
   \   000031   AE..         MOV     R6,?V0 + 2
   \   000033   AF..         MOV     R7,?V0 + 3
    251            if ( msgPtr )
   \   000035   EE           MOV     A,R6
   \   000036   6400         XRL     A,#0x0
   \   000038   7003         JNZ     ??afDataConfirm_2
   \   00003A   EF           MOV     A,R7
   \   00003B   6400         XRL     A,#0x0
   \                     ??afDataConfirm_2:
   \   00003D   603A         JZ      ??afDataConfirm_1
    252            {
    253              // Build the Data Confirm message
    254              msgPtr->hdr.event = AF_DATA_CONFIRM_CMD;
   \   00003F   74FD         MOV     A,#-0x3
   \   000041   8E82         MOV     DPL,R6
   \   000043   8F83         MOV     DPH,R7
   \   000045   F0           MOVX    @DPTR,A
    255              msgPtr->hdr.status = status;
   \   000046   8E82         MOV     DPL,R6
   \   000048   8F83         MOV     DPH,R7
   \   00004A   A3           INC     DPTR
   \   00004B   E5..         MOV     A,?V0 + 1
   \   00004D   F0           MOVX    @DPTR,A
    256              msgPtr->endpoint = endPoint;
   \   00004E   8E82         MOV     DPL,R6
   \   000050   8F83         MOV     DPH,R7
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   E5..         MOV     A,?V0 + 0
   \   000056   F0           MOVX    @DPTR,A
    257              msgPtr->transID = transID;
   \   000057   8E82         MOV     DPL,R6
   \   000059   8F83         MOV     DPH,R7
   \   00005B   A3           INC     DPTR
   \   00005C   A3           INC     DPTR
   \   00005D   A3           INC     DPTR
   \   00005E   E5..         MOV     A,?V0 + 4
   \   000060   F0           MOVX    @DPTR,A
    258          
    259              // send message through task message
    260              osal_msg_send( *(epDesc->task_id), (byte *)msgPtr );
   \   000061                ; Setup parameters for call to function osal_msg_send
   \   000061   EE           MOV     A,R6
   \   000062   FA           MOV     R2,A
   \   000063   EF           MOV     A,R7
   \   000064   FB           MOV     R3,A
   \   000065   85..82       MOV     DPL,?V0 + 6
   \   000068   85..83       MOV     DPH,?V0 + 7
   \   00006B   A3           INC     DPTR
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F8           MOV     R0,A
   \   00006E   A3           INC     DPTR
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F583         MOV     DPH,A
   \   000072   8882         MOV     DPL,R0
   \   000074   E0           MOVX    A,@DPTR
   \   000075   F9           MOV     R1,A
   \   000076   12....       LCALL   ??osal_msg_send?relay
   \                     ??afDataConfirm_1:
   \   000079   7F08         MOV     R7,#0x8
   \   00007B   02....       LJMP    ?BANKED_LEAVE_XDATA
    261            }
    262          }
    263          
    264          /*********************************************************************
    265           * @fn          afIncomingData
    266           *
    267           * @brief       Transfer a data PDU (ASDU) from the APS sub-layer to the AF.
    268           *
    269           * @param       aff  - pointer to APS frame format
    270           * @param       SrcAddress  - Source address
    271           * @param       LinkQuality - incoming message's link quality
    272           * @param       SecurityUse - Security enable/disable
    273           *
    274           * @return      none
    275           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    276          void afIncomingData( aps_FrameFormat_t *aff, zAddrType_t *SrcAddress,
   \                     afIncomingData:
    277                               uint8 LinkQuality, byte SecurityUse, uint32 timestamp )
    278          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 11
   \   000005   74F5         MOV     A,#-0xb
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7402         MOV     A,#0x2
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EA           MOV     A,R2
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   EB           MOV     A,R3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   7409         MOV     A,#0x9
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   EC           MOV     A,R4
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   ED           MOV     A,R5
   \   00001D   F0           MOVX    @DPTR,A
   \   00001E   E9           MOV     A,R1
   \   00001F   C0E0         PUSH    A
   \   000021   7408         MOV     A,#0x8
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   D0E0         POP     A
   \   000028   F0           MOVX    @DPTR,A
   \   000029   741B         MOV     A,#0x1b
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?L_MOV_X
    279            endPointDesc_t *epDesc = NULL;
   \   000033   7E00         MOV     R6,#0x0
   \   000035   7F00         MOV     R7,#0x0
    280            uint16 epProfileID = 0xFFFF;  // Invalid Profile ID
   \   000037   7406         MOV     A,#0x6
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   74FF         MOV     A,#-0x1
   \   00003E   F0           MOVX    @DPTR,A
   \   00003F   A3           INC     DPTR
   \   000040   74FF         MOV     A,#-0x1
   \   000042   F0           MOVX    @DPTR,A
    281            epList_t *pList;
    282            uint8 grpEp;
    283          
    284            if ( ((aff->FrmCtrl & APS_DELIVERYMODE_MASK) == APS_FC_DM_GROUP) )
   \   000043   7402         MOV     A,#0x2
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F8           MOV     R0,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F583         MOV     DPH,A
   \   00004E   8882         MOV     DPL,R0
   \   000050   E0           MOVX    A,@DPTR
   \   000051   540C         ANL     A,#0xc
   \   000053   640C         XRL     A,#0xc
   \   000055   7058         JNZ     ??afIncomingData_0
    285            {
    286              // Find the first endpoint for this group
    287              grpEp = aps_FindGroupForEndpoint( aff->GroupID, APS_GROUPS_FIND_FIRST );
   \   000057                ; Setup parameters for call to function aps_FindGroupForEndpoint
   \   000057   79FE         MOV     R1,#-0x2
   \   000059   7402         MOV     A,#0x2
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   F8           MOV     R0,A
   \   000060   A3           INC     DPTR
   \   000061   E0           MOVX    A,@DPTR
   \   000062   F583         MOV     DPH,A
   \   000064   8882         MOV     DPL,R0
   \   000066   A3           INC     DPTR
   \   000067   A3           INC     DPTR
   \   000068   A3           INC     DPTR
   \   000069   A3           INC     DPTR
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   FA           MOV     R2,A
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   FB           MOV     R3,A
   \   00006F   12....       LCALL   ??aps_FindGroupForEndpoint?relay
   \   000072   E9           MOV     A,R1
   \   000073   F5..         MOV     ?V0 + 6,A
    288              if ( grpEp == APS_GROUPS_EP_NOT_FOUND )
   \   000075   74FE         MOV     A,#-0x2
   \   000077   65..         XRL     A,?V0 + 6
   \   000079   7003         JNZ     $+5
   \   00007B   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    289                return;   // No endpoint found
    290          
    291              epDesc = afFindEndPointDesc( grpEp );
   \   00007E                ; Setup parameters for call to function afFindEndPointDesc
   \   00007E   A9..         MOV     R1,?V0 + 6
   \   000080   12....       LCALL   ??afFindEndPointDesc?relay
   \   000083   8A..         MOV     ?V0 + 4,R2
   \   000085   8B..         MOV     ?V0 + 5,R3
   \   000087   AE..         MOV     R6,?V0 + 4
   \   000089   AF..         MOV     R7,?V0 + 5
    292              if ( epDesc == NULL )
   \   00008B   EE           MOV     A,R6
   \   00008C   6400         XRL     A,#0x0
   \   00008E   7003         JNZ     ??afIncomingData_2
   \   000090   EF           MOV     A,R7
   \   000091   6400         XRL     A,#0x0
   \                     ??afIncomingData_2:
   \   000093   7003         JNZ     $+5
   \   000095   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    293                return;   // Endpoint descriptor not found
    294          
    295              pList = afFindEndPointDescList( epDesc->endPoint );
   \   000098                ; Setup parameters for call to function afFindEndPointDescList
   \   000098   8E82         MOV     DPL,R6
   \   00009A   8F83         MOV     DPH,R7
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   F9           MOV     R1,A
   \   00009E   12....       LCALL   ??afFindEndPointDescList?relay
   \   0000A1   85..82       MOV     DPL,?XSP + 0
   \   0000A4   85..83       MOV     DPH,?XSP + 1
   \   0000A7   EA           MOV     A,R2
   \   0000A8   F0           MOVX    @DPTR,A
   \   0000A9   A3           INC     DPTR
   \   0000AA   EB           MOV     A,R3
   \   0000AB   F0           MOVX    @DPTR,A
   \   0000AC   02....       LJMP    ??afIncomingData_3 & 0xFFFF
    296            }
    297            else if ( aff->DstEndPoint == AF_BROADCAST_ENDPOINT )
   \                     ??afIncomingData_0:
   \   0000AF   7402         MOV     A,#0x2
   \   0000B1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F8           MOV     R0,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F583         MOV     DPH,A
   \   0000BA   8882         MOV     DPL,R0
   \   0000BC   A3           INC     DPTR
   \   0000BD   A3           INC     DPTR
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   64FF         XRL     A,#0xff
   \   0000C1   7036         JNZ     ??afIncomingData_4
    298            {
    299              // Set the list
    300              if ( (pList = epList) )
   \   0000C3   90....       MOV     DPTR,#epList
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   F8           MOV     R0,A
   \   0000C8   A3           INC     DPTR
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   F9           MOV     R1,A
   \   0000CB   85..82       MOV     DPL,?XSP + 0
   \   0000CE   85..83       MOV     DPH,?XSP + 1
   \   0000D1   E8           MOV     A,R0
   \   0000D2   F0           MOVX    @DPTR,A
   \   0000D3   A3           INC     DPTR
   \   0000D4   E9           MOV     A,R1
   \   0000D5   F0           MOVX    @DPTR,A
   \   0000D6   E8           MOV     A,R0
   \   0000D7   6400         XRL     A,#0x0
   \   0000D9   7003         JNZ     ??afIncomingData_5
   \   0000DB   E9           MOV     A,R1
   \   0000DC   6400         XRL     A,#0x0
   \                     ??afIncomingData_5:
   \   0000DE   6057         JZ      ??afIncomingData_3
    301              {
    302                epDesc = pList->epDesc;
   \   0000E0   85..82       MOV     DPL,?XSP + 0
   \   0000E3   85..83       MOV     DPH,?XSP + 1
   \   0000E6   E0           MOVX    A,@DPTR
   \   0000E7   F8           MOV     R0,A
   \   0000E8   A3           INC     DPTR
   \   0000E9   E0           MOVX    A,@DPTR
   \   0000EA   F583         MOV     DPH,A
   \   0000EC   8882         MOV     DPL,R0
   \   0000EE   E0           MOVX    A,@DPTR
   \   0000EF   F8           MOV     R0,A
   \   0000F0   A3           INC     DPTR
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   F9           MOV     R1,A
   \   0000F3   E8           MOV     A,R0
   \   0000F4   FE           MOV     R6,A
   \   0000F5   E9           MOV     A,R1
   \   0000F6   FF           MOV     R7,A
   \   0000F7   803E         SJMP    ??afIncomingData_3
    303              }
    304            }
    305            else if ( (epDesc = afFindEndPointDesc( aff->DstEndPoint )) )
   \                     ??afIncomingData_4:
   \   0000F9                ; Setup parameters for call to function afFindEndPointDesc
   \   0000F9   7402         MOV     A,#0x2
   \   0000FB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FE   E0           MOVX    A,@DPTR
   \   0000FF   F8           MOV     R0,A
   \   000100   A3           INC     DPTR
   \   000101   E0           MOVX    A,@DPTR
   \   000102   F583         MOV     DPH,A
   \   000104   8882         MOV     DPL,R0
   \   000106   A3           INC     DPTR
   \   000107   A3           INC     DPTR
   \   000108   E0           MOVX    A,@DPTR
   \   000109   F9           MOV     R1,A
   \   00010A   12....       LCALL   ??afFindEndPointDesc?relay
   \   00010D   8A..         MOV     ?V0 + 4,R2
   \   00010F   8B..         MOV     ?V0 + 5,R3
   \   000111   A8..         MOV     R0,?V0 + 4
   \   000113   A9..         MOV     R1,?V0 + 5
   \   000115   E8           MOV     A,R0
   \   000116   FE           MOV     R6,A
   \   000117   E9           MOV     A,R1
   \   000118   FF           MOV     R7,A
   \   000119   E8           MOV     A,R0
   \   00011A   6400         XRL     A,#0x0
   \   00011C   7003         JNZ     ??afIncomingData_6
   \   00011E   E9           MOV     A,R1
   \   00011F   6400         XRL     A,#0x0
   \                     ??afIncomingData_6:
   \   000121   6014         JZ      ??afIncomingData_3
    306            {
    307              pList = afFindEndPointDescList( epDesc->endPoint );
   \   000123                ; Setup parameters for call to function afFindEndPointDescList
   \   000123   8E82         MOV     DPL,R6
   \   000125   8F83         MOV     DPH,R7
   \   000127   E0           MOVX    A,@DPTR
   \   000128   F9           MOV     R1,A
   \   000129   12....       LCALL   ??afFindEndPointDescList?relay
   \   00012C   85..82       MOV     DPL,?XSP + 0
   \   00012F   85..83       MOV     DPH,?XSP + 1
   \   000132   EA           MOV     A,R2
   \   000133   F0           MOVX    @DPTR,A
   \   000134   A3           INC     DPTR
   \   000135   EB           MOV     A,R3
   \   000136   F0           MOVX    @DPTR,A
    308            }
    309          
    310            while ( epDesc )
   \                     ??afIncomingData_3:
   \   000137   EE           MOV     A,R6
   \   000138   6400         XRL     A,#0x0
   \   00013A   7003         JNZ     ??afIncomingData_7
   \   00013C   EF           MOV     A,R7
   \   00013D   6400         XRL     A,#0x0
   \                     ??afIncomingData_7:
   \   00013F   7003         JNZ     $+5
   \   000141   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    311            {
    312              if ( pList->pfnDescCB )
   \   000144   85..82       MOV     DPL,?XSP + 0
   \   000147   85..83       MOV     DPH,?XSP + 1
   \   00014A   E0           MOVX    A,@DPTR
   \   00014B   F8           MOV     R0,A
   \   00014C   A3           INC     DPTR
   \   00014D   E0           MOVX    A,@DPTR
   \   00014E   F583         MOV     DPH,A
   \   000150   8882         MOV     DPL,R0
   \   000152   A3           INC     DPTR
   \   000153   A3           INC     DPTR
   \   000154   A3           INC     DPTR
   \   000155   E0           MOVX    A,@DPTR
   \   000156   6400         XRL     A,#0x0
   \   000158   7004         JNZ     ??afIncomingData_8
   \   00015A   A3           INC     DPTR
   \   00015B   E0           MOVX    A,@DPTR
   \   00015C   6400         XRL     A,#0x0
   \                     ??afIncomingData_8:
   \   00015E   6069         JZ      ??afIncomingData_9
    313              {
    314                uint16 *pID = (uint16 *)(pList->pfnDescCB(
    315                                           AF_DESCRIPTOR_PROFILE_ID, epDesc->endPoint ));
   \   000160                ; Setup parameters for indirect call
   \   000160   8E82         MOV     DPL,R6
   \   000162   8F83         MOV     DPH,R7
   \   000164   E0           MOVX    A,@DPTR
   \   000165   FA           MOV     R2,A
   \   000166   7902         MOV     R1,#0x2
   \   000168   85..82       MOV     DPL,?XSP + 0
   \   00016B   85..83       MOV     DPH,?XSP + 1
   \   00016E   E0           MOVX    A,@DPTR
   \   00016F   F8           MOV     R0,A
   \   000170   A3           INC     DPTR
   \   000171   E0           MOVX    A,@DPTR
   \   000172   F583         MOV     DPH,A
   \   000174   8882         MOV     DPL,R0
   \   000176   A3           INC     DPTR
   \   000177   A3           INC     DPTR
   \   000178   A3           INC     DPTR
   \   000179   E0           MOVX    A,@DPTR
   \   00017A   F8           MOV     R0,A
   \   00017B   A3           INC     DPTR
   \   00017C   E0           MOVX    A,@DPTR
   \   00017D   F583         MOV     DPH,A
   \   00017F   8882         MOV     DPL,R0
   \   000181   12....       LCALL   ?CALL_IND
   \   000184   7404         MOV     A,#0x4
   \   000186   12....       LCALL   ?XSTACK_DISP0_8
   \   000189   EA           MOV     A,R2
   \   00018A   F0           MOVX    @DPTR,A
   \   00018B   A3           INC     DPTR
   \   00018C   EB           MOV     A,R3
   \   00018D   F0           MOVX    @DPTR,A
    316                if ( pID )
   \   00018E   7404         MOV     A,#0x4
   \   000190   12....       LCALL   ?XSTACK_DISP0_8
   \   000193   E0           MOVX    A,@DPTR
   \   000194   6400         XRL     A,#0x0
   \   000196   7004         JNZ     ??afIncomingData_10
   \   000198   A3           INC     DPTR
   \   000199   E0           MOVX    A,@DPTR
   \   00019A   6400         XRL     A,#0x0
   \                     ??afIncomingData_10:
   \   00019C   605C         JZ      ??afIncomingData_11
    317                {
    318                  epProfileID = *pID;
   \   00019E   7404         MOV     A,#0x4
   \   0001A0   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A3   E0           MOVX    A,@DPTR
   \   0001A4   F8           MOV     R0,A
   \   0001A5   A3           INC     DPTR
   \   0001A6   E0           MOVX    A,@DPTR
   \   0001A7   F583         MOV     DPH,A
   \   0001A9   8882         MOV     DPL,R0
   \   0001AB   E0           MOVX    A,@DPTR
   \   0001AC   F8           MOV     R0,A
   \   0001AD   A3           INC     DPTR
   \   0001AE   E0           MOVX    A,@DPTR
   \   0001AF   F9           MOV     R1,A
   \   0001B0   7406         MOV     A,#0x6
   \   0001B2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001B5   E8           MOV     A,R0
   \   0001B6   F0           MOVX    @DPTR,A
   \   0001B7   A3           INC     DPTR
   \   0001B8   E9           MOV     A,R1
   \   0001B9   F0           MOVX    @DPTR,A
    319                  osal_mem_free( pID );
   \   0001BA                ; Setup parameters for call to function osal_mem_free
   \   0001BA   7404         MOV     A,#0x4
   \   0001BC   12....       LCALL   ?XSTACK_DISP0_8
   \   0001BF   E0           MOVX    A,@DPTR
   \   0001C0   FA           MOV     R2,A
   \   0001C1   A3           INC     DPTR
   \   0001C2   E0           MOVX    A,@DPTR
   \   0001C3   FB           MOV     R3,A
   \   0001C4   12....       LCALL   ??osal_mem_free?relay
   \   0001C7   8031         SJMP    ??afIncomingData_11
    320                }
    321              }
    322              else if ( epDesc->simpleDesc )
   \                     ??afIncomingData_9:
   \   0001C9   8E82         MOV     DPL,R6
   \   0001CB   8F83         MOV     DPH,R7
   \   0001CD   A3           INC     DPTR
   \   0001CE   A3           INC     DPTR
   \   0001CF   A3           INC     DPTR
   \   0001D0   E0           MOVX    A,@DPTR
   \   0001D1   6400         XRL     A,#0x0
   \   0001D3   7004         JNZ     ??afIncomingData_12
   \   0001D5   A3           INC     DPTR
   \   0001D6   E0           MOVX    A,@DPTR
   \   0001D7   6400         XRL     A,#0x0
   \                     ??afIncomingData_12:
   \   0001D9   601F         JZ      ??afIncomingData_11
    323              {
    324                epProfileID = epDesc->simpleDesc->AppProfId;
   \   0001DB   8E82         MOV     DPL,R6
   \   0001DD   8F83         MOV     DPH,R7
   \   0001DF   A3           INC     DPTR
   \   0001E0   A3           INC     DPTR
   \   0001E1   A3           INC     DPTR
   \   0001E2   E0           MOVX    A,@DPTR
   \   0001E3   F8           MOV     R0,A
   \   0001E4   A3           INC     DPTR
   \   0001E5   E0           MOVX    A,@DPTR
   \   0001E6   F583         MOV     DPH,A
   \   0001E8   8882         MOV     DPL,R0
   \   0001EA   A3           INC     DPTR
   \   0001EB   E0           MOVX    A,@DPTR
   \   0001EC   F8           MOV     R0,A
   \   0001ED   A3           INC     DPTR
   \   0001EE   E0           MOVX    A,@DPTR
   \   0001EF   F9           MOV     R1,A
   \   0001F0   7406         MOV     A,#0x6
   \   0001F2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001F5   E8           MOV     A,R0
   \   0001F6   F0           MOVX    @DPTR,A
   \   0001F7   A3           INC     DPTR
   \   0001F8   E9           MOV     A,R1
   \   0001F9   F0           MOVX    @DPTR,A
    325              }
    326          
    327              if ( (aff->ProfileID == epProfileID) ||
    328                   ((epDesc->endPoint == ZDO_EP) && (aff->ProfileID == ZDO_PROFILE_ID)) )
   \                     ??afIncomingData_11:
   \   0001FA   7402         MOV     A,#0x2
   \   0001FC   12....       LCALL   ?XSTACK_DISP0_8
   \   0001FF   E0           MOVX    A,@DPTR
   \   000200   F8           MOV     R0,A
   \   000201   A3           INC     DPTR
   \   000202   E0           MOVX    A,@DPTR
   \   000203   F583         MOV     DPH,A
   \   000205   8882         MOV     DPL,R0
   \   000207   A3           INC     DPTR
   \   000208   A3           INC     DPTR
   \   000209   A3           INC     DPTR
   \   00020A   A3           INC     DPTR
   \   00020B   A3           INC     DPTR
   \   00020C   A3           INC     DPTR
   \   00020D   A3           INC     DPTR
   \   00020E   A3           INC     DPTR
   \   00020F   E0           MOVX    A,@DPTR
   \   000210   F8           MOV     R0,A
   \   000211   A3           INC     DPTR
   \   000212   E0           MOVX    A,@DPTR
   \   000213   F9           MOV     R1,A
   \   000214   7406         MOV     A,#0x6
   \   000216   12....       LCALL   ?XSTACK_DISP0_8
   \   000219   E0           MOVX    A,@DPTR
   \   00021A   68           XRL     A,R0
   \   00021B   7003         JNZ     ??afIncomingData_13
   \   00021D   A3           INC     DPTR
   \   00021E   E0           MOVX    A,@DPTR
   \   00021F   69           XRL     A,R1
   \                     ??afIncomingData_13:
   \   000220   6027         JZ      ??afIncomingData_14
   \   000222   8E82         MOV     DPL,R6
   \   000224   8F83         MOV     DPH,R7
   \   000226   E0           MOVX    A,@DPTR
   \   000227   7057         JNZ     ??afIncomingData_15
   \   000229   7402         MOV     A,#0x2
   \   00022B   12....       LCALL   ?XSTACK_DISP0_8
   \   00022E   E0           MOVX    A,@DPTR
   \   00022F   F8           MOV     R0,A
   \   000230   A3           INC     DPTR
   \   000231   E0           MOVX    A,@DPTR
   \   000232   F583         MOV     DPH,A
   \   000234   8882         MOV     DPL,R0
   \   000236   A3           INC     DPTR
   \   000237   A3           INC     DPTR
   \   000238   A3           INC     DPTR
   \   000239   A3           INC     DPTR
   \   00023A   A3           INC     DPTR
   \   00023B   A3           INC     DPTR
   \   00023C   A3           INC     DPTR
   \   00023D   A3           INC     DPTR
   \   00023E   E0           MOVX    A,@DPTR
   \   00023F   6400         XRL     A,#0x0
   \   000241   7004         JNZ     ??afIncomingData_16
   \   000243   A3           INC     DPTR
   \   000244   E0           MOVX    A,@DPTR
   \   000245   6400         XRL     A,#0x0
   \                     ??afIncomingData_16:
   \   000247   7037         JNZ     ??afIncomingData_15
    329              {
    330                {
    331                  afBuildMSGIncoming( aff, epDesc, SrcAddress, LinkQuality, SecurityUse, timestamp );
   \                     ??afIncomingData_14:
   \   000249                ; Setup parameters for call to function afBuildMSGIncoming
   \   000249   78..         MOV     R0,#?V0 + 0
   \   00024B   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   00024E   741E         MOV     A,#0x1e
   \   000250   12....       LCALL   ?XSTACK_DISP0_8
   \   000253   E0           MOVX    A,@DPTR
   \   000254   F5..         MOV     ?V0 + 4,A
   \   000256   78..         MOV     R0,#?V0 + 4
   \   000258   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00025B   740E         MOV     A,#0xe
   \   00025D   12....       LCALL   ?XSTACK_DISP0_8
   \   000260   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000263   740F         MOV     A,#0xf
   \   000265   12....       LCALL   ?XSTACK_DISP0_8
   \   000268   E0           MOVX    A,@DPTR
   \   000269   F9           MOV     R1,A
   \   00026A   EE           MOV     A,R6
   \   00026B   FC           MOV     R4,A
   \   00026C   EF           MOV     A,R7
   \   00026D   FD           MOV     R5,A
   \   00026E   7409         MOV     A,#0x9
   \   000270   12....       LCALL   ?XSTACK_DISP0_8
   \   000273   E0           MOVX    A,@DPTR
   \   000274   FA           MOV     R2,A
   \   000275   A3           INC     DPTR
   \   000276   E0           MOVX    A,@DPTR
   \   000277   FB           MOV     R3,A
   \   000278   12....       LCALL   ??afBuildMSGIncoming?relay
   \   00027B   7407         MOV     A,#0x7
   \   00027D   12....       LCALL   ?DEALLOC_XSTACK8
    332                }
    333              }
    334          
    335              if ( ((aff->FrmCtrl & APS_DELIVERYMODE_MASK) == APS_FC_DM_GROUP) )
   \                     ??afIncomingData_15:
   \   000280   7402         MOV     A,#0x2
   \   000282   12....       LCALL   ?XSTACK_DISP0_8
   \   000285   E0           MOVX    A,@DPTR
   \   000286   F8           MOV     R0,A
   \   000287   A3           INC     DPTR
   \   000288   E0           MOVX    A,@DPTR
   \   000289   F583         MOV     DPH,A
   \   00028B   8882         MOV     DPL,R0
   \   00028D   E0           MOVX    A,@DPTR
   \   00028E   540C         ANL     A,#0xc
   \   000290   640C         XRL     A,#0xc
   \   000292   7058         JNZ     ??afIncomingData_17
    336              {
    337                // Find the next endpoint for this group
    338                grpEp = aps_FindGroupForEndpoint( aff->GroupID, grpEp );
   \   000294                ; Setup parameters for call to function aps_FindGroupForEndpoint
   \   000294   A9..         MOV     R1,?V0 + 6
   \   000296   7402         MOV     A,#0x2
   \   000298   12....       LCALL   ?XSTACK_DISP0_8
   \   00029B   E0           MOVX    A,@DPTR
   \   00029C   F8           MOV     R0,A
   \   00029D   A3           INC     DPTR
   \   00029E   E0           MOVX    A,@DPTR
   \   00029F   F583         MOV     DPH,A
   \   0002A1   8882         MOV     DPL,R0
   \   0002A3   A3           INC     DPTR
   \   0002A4   A3           INC     DPTR
   \   0002A5   A3           INC     DPTR
   \   0002A6   A3           INC     DPTR
   \   0002A7   E0           MOVX    A,@DPTR
   \   0002A8   FA           MOV     R2,A
   \   0002A9   A3           INC     DPTR
   \   0002AA   E0           MOVX    A,@DPTR
   \   0002AB   FB           MOV     R3,A
   \   0002AC   12....       LCALL   ??aps_FindGroupForEndpoint?relay
   \   0002AF   E9           MOV     A,R1
   \   0002B0   F5..         MOV     ?V0 + 6,A
    339                if ( grpEp == APS_GROUPS_EP_NOT_FOUND )
   \   0002B2   74FE         MOV     A,#-0x2
   \   0002B4   65..         XRL     A,?V0 + 6
   \   0002B6   7003         JNZ     $+5
   \   0002B8   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    340                  return;   // No endpoint found
    341          
    342                epDesc = afFindEndPointDesc( grpEp );
   \   0002BB                ; Setup parameters for call to function afFindEndPointDesc
   \   0002BB   A9..         MOV     R1,?V0 + 6
   \   0002BD   12....       LCALL   ??afFindEndPointDesc?relay
   \   0002C0   8A..         MOV     ?V0 + 4,R2
   \   0002C2   8B..         MOV     ?V0 + 5,R3
   \   0002C4   AE..         MOV     R6,?V0 + 4
   \   0002C6   AF..         MOV     R7,?V0 + 5
    343                if ( epDesc == NULL )
   \   0002C8   EE           MOV     A,R6
   \   0002C9   6400         XRL     A,#0x0
   \   0002CB   7003         JNZ     ??afIncomingData_18
   \   0002CD   EF           MOV     A,R7
   \   0002CE   6400         XRL     A,#0x0
   \                     ??afIncomingData_18:
   \   0002D0   7003         JNZ     $+5
   \   0002D2   02....       LJMP    ??afIncomingData_1 & 0xFFFF
    344                  return;   // Endpoint descriptor not found
    345          
    346                pList = afFindEndPointDescList( epDesc->endPoint );
   \   0002D5                ; Setup parameters for call to function afFindEndPointDescList
   \   0002D5   8E82         MOV     DPL,R6
   \   0002D7   8F83         MOV     DPH,R7
   \   0002D9   E0           MOVX    A,@DPTR
   \   0002DA   F9           MOV     R1,A
   \   0002DB   12....       LCALL   ??afFindEndPointDescList?relay
   \   0002DE   85..82       MOV     DPL,?XSP + 0
   \   0002E1   85..83       MOV     DPH,?XSP + 1
   \   0002E4   EA           MOV     A,R2
   \   0002E5   F0           MOVX    @DPTR,A
   \   0002E6   A3           INC     DPTR
   \   0002E7   EB           MOV     A,R3
   \   0002E8   F0           MOVX    @DPTR,A
   \   0002E9   02....       LJMP    ??afIncomingData_3 & 0xFFFF
    347              }
    348              else if ( aff->DstEndPoint == AF_BROADCAST_ENDPOINT )
   \                     ??afIncomingData_17:
   \   0002EC   7402         MOV     A,#0x2
   \   0002EE   12....       LCALL   ?XSTACK_DISP0_8
   \   0002F1   E0           MOVX    A,@DPTR
   \   0002F2   F8           MOV     R0,A
   \   0002F3   A3           INC     DPTR
   \   0002F4   E0           MOVX    A,@DPTR
   \   0002F5   F583         MOV     DPH,A
   \   0002F7   8882         MOV     DPL,R0
   \   0002F9   A3           INC     DPTR
   \   0002FA   A3           INC     DPTR
   \   0002FB   E0           MOVX    A,@DPTR
   \   0002FC   64FF         XRL     A,#0xff
   \   0002FE   7055         JNZ     ??afIncomingData_19
    349              {
    350                pList = pList->nextDesc;
   \   000300   85..82       MOV     DPL,?XSP + 0
   \   000303   85..83       MOV     DPH,?XSP + 1
   \   000306   E0           MOVX    A,@DPTR
   \   000307   F8           MOV     R0,A
   \   000308   A3           INC     DPTR
   \   000309   E0           MOVX    A,@DPTR
   \   00030A   F583         MOV     DPH,A
   \   00030C   8882         MOV     DPL,R0
   \   00030E   A3           INC     DPTR
   \   00030F   A3           INC     DPTR
   \   000310   A3           INC     DPTR
   \   000311   A3           INC     DPTR
   \   000312   A3           INC     DPTR
   \   000313   E0           MOVX    A,@DPTR
   \   000314   F8           MOV     R0,A
   \   000315   A3           INC     DPTR
   \   000316   E0           MOVX    A,@DPTR
   \   000317   F9           MOV     R1,A
   \   000318   85..82       MOV     DPL,?XSP + 0
   \   00031B   85..83       MOV     DPH,?XSP + 1
   \   00031E   E8           MOV     A,R0
   \   00031F   F0           MOVX    @DPTR,A
   \   000320   A3           INC     DPTR
   \   000321   E9           MOV     A,R1
   \   000322   F0           MOVX    @DPTR,A
    351                if ( pList )
   \   000323   85..82       MOV     DPL,?XSP + 0
   \   000326   85..83       MOV     DPH,?XSP + 1
   \   000329   E0           MOVX    A,@DPTR
   \   00032A   6400         XRL     A,#0x0
   \   00032C   7004         JNZ     ??afIncomingData_20
   \   00032E   A3           INC     DPTR
   \   00032F   E0           MOVX    A,@DPTR
   \   000330   6400         XRL     A,#0x0
   \                     ??afIncomingData_20:
   \   000332   601A         JZ      ??afIncomingData_21
    352                  epDesc = pList->epDesc;
   \   000334   85..82       MOV     DPL,?XSP + 0
   \   000337   85..83       MOV     DPH,?XSP + 1
   \   00033A   E0           MOVX    A,@DPTR
   \   00033B   F8           MOV     R0,A
   \   00033C   A3           INC     DPTR
   \   00033D   E0           MOVX    A,@DPTR
   \   00033E   F583         MOV     DPH,A
   \   000340   8882         MOV     DPL,R0
   \   000342   E0           MOVX    A,@DPTR
   \   000343   F8           MOV     R0,A
   \   000344   A3           INC     DPTR
   \   000345   E0           MOVX    A,@DPTR
   \   000346   F9           MOV     R1,A
   \   000347   E8           MOV     A,R0
   \   000348   FE           MOV     R6,A
   \   000349   E9           MOV     A,R1
   \   00034A   FF           MOV     R7,A
   \   00034B   02....       LJMP    ??afIncomingData_3 & 0xFFFF
    353                else
    354                  epDesc = NULL;
   \                     ??afIncomingData_21:
   \   00034E   7E00         MOV     R6,#0x0
   \   000350   7F00         MOV     R7,#0x0
   \   000352   02....       LJMP    ??afIncomingData_3 & 0xFFFF
    355              }
    356              else
    357                epDesc = NULL;
   \                     ??afIncomingData_19:
   \   000355   7E00         MOV     R6,#0x0
   \   000357   7F00         MOV     R7,#0x0
   \   000359   02....       LJMP    ??afIncomingData_3 & 0xFFFF
    358            }
   \                     ??afIncomingData_1:
   \   00035C   740B         MOV     A,#0xb
   \   00035E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000361   7F07         MOV     R7,#0x7
   \   000363   02....       LJMP    ?BANKED_LEAVE_XDATA
    359          }
    360          
    361          /*********************************************************************
    362           * @fn          afBuildMSGIncoming
    363           *
    364           * @brief       Build the message for the app
    365           *
    366           * @param
    367           *
    368           * @return      pointer to next in data buffer
    369           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    370          static void afBuildMSGIncoming( aps_FrameFormat_t *aff, endPointDesc_t *epDesc,
   \                     afBuildMSGIncoming:
    371                           zAddrType_t *SrcAddress, uint8 LinkQuality, byte SecurityUse,
    372                           uint32 timestamp )
    373          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7401         MOV     A,#0x1
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EC           MOV     A,R4
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   ED           MOV     A,R5
   \   000013   F0           MOVX    @DPTR,A
   \   000014   E9           MOV     A,R1
   \   000015   85..82       MOV     DPL,?XSP + 0
   \   000018   85..83       MOV     DPH,?XSP + 1
   \   00001B   F0           MOVX    @DPTR,A
   \   00001C   8A..         MOV     ?V0 + 4,R2
   \   00001E   8B..         MOV     ?V0 + 5,R3
   \   000020   7417         MOV     A,#0x17
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F5..         MOV     ?V0 + 7,A
    374            afIncomingMSGPacket_t *MSGpkt;
    375            const byte len = sizeof( afIncomingMSGPacket_t ) + aff->asduLength;
   \   000028   E5..         MOV     A,?V0 + 4
   \   00002A   240E         ADD     A,#0xe
   \   00002C   F582         MOV     DPL,A
   \   00002E   E5..         MOV     A,?V0 + 5
   \   000030   3400         ADDC    A,#0x0
   \   000032   F583         MOV     DPH,A
   \   000034   E0           MOVX    A,@DPTR
   \   000035   2417         ADD     A,#0x17
   \   000037   F5..         MOV     ?V0 + 6,A
    376            byte *asdu = aff->asdu;
   \   000039   E5..         MOV     A,?V0 + 4
   \   00003B   240C         ADD     A,#0xc
   \   00003D   F582         MOV     DPL,A
   \   00003F   E5..         MOV     A,?V0 + 5
   \   000041   3400         ADDC    A,#0x0
   \   000043   F583         MOV     DPH,A
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F8           MOV     R0,A
   \   000047   A3           INC     DPTR
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F9           MOV     R1,A
   \   00004A   7403         MOV     A,#0x3
   \   00004C   12....       LCALL   ?XSTACK_DISP0_8
   \   00004F   E8           MOV     A,R0
   \   000050   F0           MOVX    @DPTR,A
   \   000051   A3           INC     DPTR
   \   000052   E9           MOV     A,R1
   \   000053   F0           MOVX    @DPTR,A
    377            MSGpkt = (afIncomingMSGPacket_t *)osal_msg_allocate( len );
   \   000054                ; Setup parameters for call to function osal_msg_allocate
   \   000054   E5..         MOV     A,?V0 + 6
   \   000056   F5..         MOV     ?V0 + 0,A
   \   000058   AA..         MOV     R2,?V0 + 0
   \   00005A   7B00         MOV     R3,#0x0
   \   00005C   12....       LCALL   ??osal_msg_allocate?relay
   \   00005F   8A..         MOV     ?V0 + 0,R2
   \   000061   8B..         MOV     ?V0 + 1,R3
   \   000063   AE..         MOV     R6,?V0 + 0
   \   000065   AF..         MOV     R7,?V0 + 1
    378          
    379            if ( MSGpkt == NULL )
   \   000067   EE           MOV     A,R6
   \   000068   6400         XRL     A,#0x0
   \   00006A   7003         JNZ     ??afBuildMSGIncoming_0
   \   00006C   EF           MOV     A,R7
   \   00006D   6400         XRL     A,#0x0
   \                     ??afBuildMSGIncoming_0:
   \   00006F   7003         JNZ     $+5
   \   000071   02....       LJMP    ??afBuildMSGIncoming_1 & 0xFFFF
    380            {
    381              return;
    382            }
    383          
    384            MSGpkt->hdr.event = AF_INCOMING_MSG_CMD;
   \   000074   741A         MOV     A,#0x1a
   \   000076   8E82         MOV     DPL,R6
   \   000078   8F83         MOV     DPH,R7
   \   00007A   F0           MOVX    @DPTR,A
    385            MSGpkt->groupId = aff->GroupID;
   \   00007B   85..82       MOV     DPL,?V0 + 4
   \   00007E   85..83       MOV     DPH,?V0 + 5
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   A3           INC     DPTR
   \   000084   A3           INC     DPTR
   \   000085   E0           MOVX    A,@DPTR
   \   000086   F8           MOV     R0,A
   \   000087   A3           INC     DPTR
   \   000088   E0           MOVX    A,@DPTR
   \   000089   F9           MOV     R1,A
   \   00008A   8E82         MOV     DPL,R6
   \   00008C   8F83         MOV     DPH,R7
   \   00008E   A3           INC     DPTR
   \   00008F   A3           INC     DPTR
   \   000090   E8           MOV     A,R0
   \   000091   F0           MOVX    @DPTR,A
   \   000092   A3           INC     DPTR
   \   000093   E9           MOV     A,R1
   \   000094   F0           MOVX    @DPTR,A
    386            MSGpkt->clusterId = aff->ClusterID;
   \   000095   85..82       MOV     DPL,?V0 + 4
   \   000098   85..83       MOV     DPH,?V0 + 5
   \   00009B   A3           INC     DPTR
   \   00009C   A3           INC     DPTR
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   E0           MOVX    A,@DPTR
   \   0000A2   F8           MOV     R0,A
   \   0000A3   A3           INC     DPTR
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   F9           MOV     R1,A
   \   0000A6   8E82         MOV     DPL,R6
   \   0000A8   8F83         MOV     DPH,R7
   \   0000AA   A3           INC     DPTR
   \   0000AB   A3           INC     DPTR
   \   0000AC   A3           INC     DPTR
   \   0000AD   A3           INC     DPTR
   \   0000AE   E8           MOV     A,R0
   \   0000AF   F0           MOVX    @DPTR,A
   \   0000B0   A3           INC     DPTR
   \   0000B1   E9           MOV     A,R1
   \   0000B2   F0           MOVX    @DPTR,A
    387            afCopyAddress( &MSGpkt->srcAddr, SrcAddress );
   \   0000B3                ; Setup parameters for call to function afCopyAddress
   \   0000B3   7415         MOV     A,#0x15
   \   0000B5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B8   E0           MOVX    A,@DPTR
   \   0000B9   FC           MOV     R4,A
   \   0000BA   A3           INC     DPTR
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   FD           MOV     R5,A
   \   0000BD   EE           MOV     A,R6
   \   0000BE   2406         ADD     A,#0x6
   \   0000C0   FA           MOV     R2,A
   \   0000C1   EF           MOV     A,R7
   \   0000C2   3400         ADDC    A,#0x0
   \   0000C4   FB           MOV     R3,A
   \   0000C5   12....       LCALL   ??afCopyAddress?relay
    388            MSGpkt->srcAddr.endPoint = aff->SrcEndPoint;
   \   0000C8   85..82       MOV     DPL,?V0 + 4
   \   0000CB   85..83       MOV     DPH,?V0 + 5
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   8E82         MOV     DPL,R6
   \   0000D4   8F83         MOV     DPH,R7
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   A3           INC     DPTR
   \   0000DB   A3           INC     DPTR
   \   0000DC   A3           INC     DPTR
   \   0000DD   A3           INC     DPTR
   \   0000DE   A3           INC     DPTR
   \   0000DF   F0           MOVX    @DPTR,A
    389            MSGpkt->endPoint = epDesc->endPoint;
   \   0000E0   7401         MOV     A,#0x1
   \   0000E2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   F8           MOV     R0,A
   \   0000E7   A3           INC     DPTR
   \   0000E8   E0           MOVX    A,@DPTR
   \   0000E9   F583         MOV     DPH,A
   \   0000EB   8882         MOV     DPL,R0
   \   0000ED   E0           MOVX    A,@DPTR
   \   0000EE   8E82         MOV     DPL,R6
   \   0000F0   8F83         MOV     DPH,R7
   \   0000F2   A3           INC     DPTR
   \   0000F3   A3           INC     DPTR
   \   0000F4   A3           INC     DPTR
   \   0000F5   A3           INC     DPTR
   \   0000F6   A3           INC     DPTR
   \   0000F7   A3           INC     DPTR
   \   0000F8   A3           INC     DPTR
   \   0000F9   A3           INC     DPTR
   \   0000FA   A3           INC     DPTR
   \   0000FB   A3           INC     DPTR
   \   0000FC   F0           MOVX    @DPTR,A
    390            MSGpkt->wasBroadcast = aff->wasBroadcast;
   \   0000FD   85..82       MOV     DPL,?V0 + 4
   \   000100   85..83       MOV     DPH,?V0 + 5
   \   000103   A3           INC     DPTR
   \   000104   A3           INC     DPTR
   \   000105   A3           INC     DPTR
   \   000106   A3           INC     DPTR
   \   000107   A3           INC     DPTR
   \   000108   A3           INC     DPTR
   \   000109   A3           INC     DPTR
   \   00010A   A3           INC     DPTR
   \   00010B   A3           INC     DPTR
   \   00010C   A3           INC     DPTR
   \   00010D   E0           MOVX    A,@DPTR
   \   00010E   C0E0         PUSH    A
   \   000110   EE           MOV     A,R6
   \   000111   240B         ADD     A,#0xb
   \   000113   F582         MOV     DPL,A
   \   000115   EF           MOV     A,R7
   \   000116   3400         ADDC    A,#0x0
   \   000118   F583         MOV     DPH,A
   \   00011A   D0E0         POP     A
   \   00011C   F0           MOVX    @DPTR,A
    391            MSGpkt->LinkQuality = LinkQuality;
   \   00011D   85..82       MOV     DPL,?XSP + 0
   \   000120   85..83       MOV     DPH,?XSP + 1
   \   000123   E0           MOVX    A,@DPTR
   \   000124   C0E0         PUSH    A
   \   000126   EE           MOV     A,R6
   \   000127   240C         ADD     A,#0xc
   \   000129   F582         MOV     DPL,A
   \   00012B   EF           MOV     A,R7
   \   00012C   3400         ADDC    A,#0x0
   \   00012E   F583         MOV     DPH,A
   \   000130   D0E0         POP     A
   \   000132   F0           MOVX    @DPTR,A
    392            MSGpkt->SecurityUse = SecurityUse;
   \   000133   EE           MOV     A,R6
   \   000134   240D         ADD     A,#0xd
   \   000136   F582         MOV     DPL,A
   \   000138   EF           MOV     A,R7
   \   000139   3400         ADDC    A,#0x0
   \   00013B   F583         MOV     DPH,A
   \   00013D   E5..         MOV     A,?V0 + 7
   \   00013F   F0           MOVX    @DPTR,A
    393            MSGpkt->timestamp = timestamp;
   \   000140   7418         MOV     A,#0x18
   \   000142   12....       LCALL   ?XSTACK_DISP0_8
   \   000145   78..         MOV     R0,#?V0 + 0
   \   000147   12....       LCALL   ?L_MOV_X
   \   00014A   EE           MOV     A,R6
   \   00014B   240E         ADD     A,#0xe
   \   00014D   F582         MOV     DPL,A
   \   00014F   EF           MOV     A,R7
   \   000150   3400         ADDC    A,#0x0
   \   000152   F583         MOV     DPH,A
   \   000154   E5..         MOV     A,?V0 + 0
   \   000156   F0           MOVX    @DPTR,A
   \   000157   A3           INC     DPTR
   \   000158   E5..         MOV     A,?V0 + 1
   \   00015A   F0           MOVX    @DPTR,A
   \   00015B   A3           INC     DPTR
   \   00015C   E5..         MOV     A,?V0 + 2
   \   00015E   F0           MOVX    @DPTR,A
   \   00015F   A3           INC     DPTR
   \   000160   E5..         MOV     A,?V0 + 3
   \   000162   F0           MOVX    @DPTR,A
    394          
    395            MSGpkt->cmd.TransSeqNumber = 0;
   \   000163   7400         MOV     A,#0x0
   \   000165   C0E0         PUSH    A
   \   000167   EE           MOV     A,R6
   \   000168   2412         ADD     A,#0x12
   \   00016A   F582         MOV     DPL,A
   \   00016C   EF           MOV     A,R7
   \   00016D   3400         ADDC    A,#0x0
   \   00016F   F583         MOV     DPH,A
   \   000171   D0E0         POP     A
   \   000173   F0           MOVX    @DPTR,A
    396            MSGpkt->cmd.DataLength = aff->asduLength;
   \   000174   E5..         MOV     A,?V0 + 4
   \   000176   240E         ADD     A,#0xe
   \   000178   F582         MOV     DPL,A
   \   00017A   E5..         MOV     A,?V0 + 5
   \   00017C   3400         ADDC    A,#0x0
   \   00017E   F583         MOV     DPH,A
   \   000180   E0           MOVX    A,@DPTR
   \   000181   F8           MOV     R0,A
   \   000182   7900         MOV     R1,#0x0
   \   000184   EE           MOV     A,R6
   \   000185   2413         ADD     A,#0x13
   \   000187   F582         MOV     DPL,A
   \   000189   EF           MOV     A,R7
   \   00018A   3400         ADDC    A,#0x0
   \   00018C   F583         MOV     DPH,A
   \   00018E   E8           MOV     A,R0
   \   00018F   F0           MOVX    @DPTR,A
   \   000190   A3           INC     DPTR
   \   000191   E9           MOV     A,R1
   \   000192   F0           MOVX    @DPTR,A
    397          
    398            if ( MSGpkt->cmd.DataLength )
   \   000193   EE           MOV     A,R6
   \   000194   2413         ADD     A,#0x13
   \   000196   F582         MOV     DPL,A
   \   000198   EF           MOV     A,R7
   \   000199   3400         ADDC    A,#0x0
   \   00019B   F583         MOV     DPH,A
   \   00019D   E0           MOVX    A,@DPTR
   \   00019E   6400         XRL     A,#0x0
   \   0001A0   7004         JNZ     ??afBuildMSGIncoming_2
   \   0001A2   A3           INC     DPTR
   \   0001A3   E0           MOVX    A,@DPTR
   \   0001A4   6400         XRL     A,#0x0
   \                     ??afBuildMSGIncoming_2:
   \   0001A6   6053         JZ      ??afBuildMSGIncoming_3
    399            {
    400              MSGpkt->cmd.Data = (byte *)(MSGpkt + 1);
   \   0001A8   EE           MOV     A,R6
   \   0001A9   2417         ADD     A,#0x17
   \   0001AB   F8           MOV     R0,A
   \   0001AC   EF           MOV     A,R7
   \   0001AD   3400         ADDC    A,#0x0
   \   0001AF   F9           MOV     R1,A
   \   0001B0   EE           MOV     A,R6
   \   0001B1   2415         ADD     A,#0x15
   \   0001B3   F582         MOV     DPL,A
   \   0001B5   EF           MOV     A,R7
   \   0001B6   3400         ADDC    A,#0x0
   \   0001B8   F583         MOV     DPH,A
   \   0001BA   E8           MOV     A,R0
   \   0001BB   F0           MOVX    @DPTR,A
   \   0001BC   A3           INC     DPTR
   \   0001BD   E9           MOV     A,R1
   \   0001BE   F0           MOVX    @DPTR,A
    401              osal_memcpy( MSGpkt->cmd.Data, asdu, MSGpkt->cmd.DataLength );
   \   0001BF                ; Setup parameters for call to function osal_memcpy
   \   0001BF   7403         MOV     A,#0x3
   \   0001C1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C4   E0           MOVX    A,@DPTR
   \   0001C5   F5..         MOV     ?V0 + 0,A
   \   0001C7   A3           INC     DPTR
   \   0001C8   E0           MOVX    A,@DPTR
   \   0001C9   F5..         MOV     ?V0 + 1,A
   \   0001CB   75..00       MOV     ?V0 + 2,#0x0
   \   0001CE   78..         MOV     R0,#?V0 + 0
   \   0001D0   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0001D3   EE           MOV     A,R6
   \   0001D4   2413         ADD     A,#0x13
   \   0001D6   F582         MOV     DPL,A
   \   0001D8   EF           MOV     A,R7
   \   0001D9   3400         ADDC    A,#0x0
   \   0001DB   F583         MOV     DPH,A
   \   0001DD   E0           MOVX    A,@DPTR
   \   0001DE   FC           MOV     R4,A
   \   0001DF   A3           INC     DPTR
   \   0001E0   E0           MOVX    A,@DPTR
   \   0001E1   FD           MOV     R5,A
   \   0001E2   EE           MOV     A,R6
   \   0001E3   2415         ADD     A,#0x15
   \   0001E5   F582         MOV     DPL,A
   \   0001E7   EF           MOV     A,R7
   \   0001E8   3400         ADDC    A,#0x0
   \   0001EA   F583         MOV     DPH,A
   \   0001EC   E0           MOVX    A,@DPTR
   \   0001ED   FA           MOV     R2,A
   \   0001EE   A3           INC     DPTR
   \   0001EF   E0           MOVX    A,@DPTR
   \   0001F0   FB           MOV     R3,A
   \   0001F1   12....       LCALL   ??osal_memcpy?relay
   \   0001F4   7403         MOV     A,#0x3
   \   0001F6   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001F9   8011         SJMP    ??afBuildMSGIncoming_4
    402            }
    403            else
    404            {
    405              MSGpkt->cmd.Data = NULL;
   \                     ??afBuildMSGIncoming_3:
   \   0001FB   EE           MOV     A,R6
   \   0001FC   2415         ADD     A,#0x15
   \   0001FE   F582         MOV     DPL,A
   \   000200   EF           MOV     A,R7
   \   000201   3400         ADDC    A,#0x0
   \   000203   F583         MOV     DPH,A
   \   000205   7400         MOV     A,#0x0
   \   000207   F0           MOVX    @DPTR,A
   \   000208   A3           INC     DPTR
   \   000209   7400         MOV     A,#0x0
   \   00020B   F0           MOVX    @DPTR,A
    406            }
    407          
    408          #if defined ( MT_AF_CB_FUNC )
    409            // If MT has subscribed for this callback, don't send as a message.
    410            if AFCB_CHECK(MSGpkt->endPoint, *(epDesc->task_id), SPI_CB_AF_DATA_IND)
    411            {
    412              af_MTCB_IncomingData( (void *)MSGpkt );
    413              // Release the memory.
    414              osal_msg_deallocate( (void *)MSGpkt );
    415            }
    416            else
    417          #endif
    418            {
    419              // Send message through task message.
    420              osal_msg_send( *(epDesc->task_id), (uint8 *)MSGpkt );
   \                     ??afBuildMSGIncoming_4:
   \   00020C                ; Setup parameters for call to function osal_msg_send
   \   00020C   EE           MOV     A,R6
   \   00020D   FA           MOV     R2,A
   \   00020E   EF           MOV     A,R7
   \   00020F   FB           MOV     R3,A
   \   000210   7401         MOV     A,#0x1
   \   000212   12....       LCALL   ?XSTACK_DISP0_8
   \   000215   E0           MOVX    A,@DPTR
   \   000216   F8           MOV     R0,A
   \   000217   A3           INC     DPTR
   \   000218   E0           MOVX    A,@DPTR
   \   000219   F583         MOV     DPH,A
   \   00021B   8882         MOV     DPL,R0
   \   00021D   A3           INC     DPTR
   \   00021E   E0           MOVX    A,@DPTR
   \   00021F   F8           MOV     R0,A
   \   000220   A3           INC     DPTR
   \   000221   E0           MOVX    A,@DPTR
   \   000222   F583         MOV     DPH,A
   \   000224   8882         MOV     DPL,R0
   \   000226   E0           MOVX    A,@DPTR
   \   000227   F9           MOV     R1,A
   \   000228   12....       LCALL   ??osal_msg_send?relay
    421            }
    422          }
   \                     ??afBuildMSGIncoming_1:
   \   00022B   7405         MOV     A,#0x5
   \   00022D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000230   7F08         MOV     R7,#0x8
   \   000232   02....       LJMP    ?BANKED_LEAVE_XDATA
    423          
    424          /*********************************************************************
    425           * @fn      AF_DataRequest
    426           *
    427           * @brief   Common functionality for invoking APSDE_DataReq() for both
    428           *          SendMulti and MSG-Send.
    429           *
    430           * input parameters
    431           *
    432           * @param  *dstAddr - Full ZB destination address: Nwk Addr + End Point.
    433           * @param  *srcEP - Origination (i.e. respond to or ack to) End Point Descr.
    434           * @param   cID - A valid cluster ID as specified by the Profile.
    435           * @param   len - Number of bytes of data pointed to by next param.
    436           * @param  *buf - A pointer to the data bytes to send.
    437           * @param  *transID - A pointer to a byte which can be modified and which will
    438           *                    be used as the transaction sequence number of the msg.
    439           * @param   options - Valid bit mask of Tx options.
    440           * @param   radius - Normally set to AF_DEFAULT_RADIUS.
    441           *
    442           * output parameters
    443           *
    444           * @param  *transID - Incremented by one if the return value is success.
    445           *
    446           * @return  afStatus_t - See previous definition of afStatus_... types.
    447           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    448          afStatus_t AF_DataRequest( afAddrType_t *dstAddr, endPointDesc_t *srcEP,
   \                     AF_DataRequest:
    449                                     uint16 cID, uint16 len, uint8 *buf, uint8 *transID,
    450                                     uint8 options, uint8 radius )
    451          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 30
   \   000005   74E2         MOV     A,#-0x1e
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   \   00000E   8C..         MOV     ?V0 + 0,R4
   \   000010   8D..         MOV     ?V0 + 1,R5
   \   000012   89..         MOV     ?V0 + 3,R1
    452            pDescCB pfnDescCB;
    453            ZStatus_t stat;
    454            APSDE_DataReq_t req;
    455            afDataReqMTU_t mtu;
    456          
    457            // Verify source end point
    458            if ( srcEP == NULL )
   \   000014   E5..         MOV     A,?V0 + 0
   \   000016   6400         XRL     A,#0x0
   \   000018   7004         JNZ     ??AF_DataRequest_0
   \   00001A   E5..         MOV     A,?V0 + 1
   \   00001C   6400         XRL     A,#0x0
   \                     ??AF_DataRequest_0:
   \   00001E   7005         JNZ     ??AF_DataRequest_1
    459            {
    460              return afStatus_INVALID_PARAMETER;
   \   000020   7982         MOV     R1,#-0x7e
   \   000022   02....       LJMP    ??AF_DataRequest_2 & 0xFFFF
    461            }
    462            
    463          #if !defined( REFLECTOR )
    464            if ( dstAddr->addrMode == afAddrNotPresent )
    465            {
    466              return afStatus_INVALID_PARAMETER;
    467            }
    468          #endif  
    469          
    470            // Verify destination address
    471            req.dstAddr.addr.shortAddr = dstAddr->addr.shortAddr;
   \                     ??AF_DataRequest_1:
   \   000025   8E82         MOV     DPL,R6
   \   000027   8F83         MOV     DPH,R7
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F8           MOV     R0,A
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F9           MOV     R1,A
   \   00002E   7404         MOV     A,#0x4
   \   000030   12....       LCALL   ?XSTACK_DISP0_8
   \   000033   E8           MOV     A,R0
   \   000034   F0           MOVX    @DPTR,A
   \   000035   A3           INC     DPTR
   \   000036   E9           MOV     A,R1
   \   000037   F0           MOVX    @DPTR,A
    472          
    473            // Validate broadcasting
    474            if ( ( dstAddr->addrMode == afAddr16Bit     ) ||
    475                 ( dstAddr->addrMode == afAddrBroadcast )    )
   \   000038   8E82         MOV     DPL,R6
   \   00003A   8F83         MOV     DPH,R7
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   6402         XRL     A,#0x2
   \   000041   600B         JZ      ??AF_DataRequest_3
   \   000043   8E82         MOV     DPL,R6
   \   000045   8F83         MOV     DPH,R7
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   640F         XRL     A,#0xf
   \   00004C   702A         JNZ     ??AF_DataRequest_4
    476            {
    477                // Check for valid broadcast values
    478                if( ADDR_NOT_BCAST != NLME_IsAddressBroadcast( dstAddr->addr.shortAddr )  )
   \                     ??AF_DataRequest_3:
   \   00004E                ; Setup parameters for call to function NLME_IsAddressBroadcast
   \   00004E   8E82         MOV     DPL,R6
   \   000050   8F83         MOV     DPH,R7
   \   000052   E0           MOVX    A,@DPTR
   \   000053   FA           MOV     R2,A
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   FB           MOV     R3,A
   \   000057   12....       LCALL   ??NLME_IsAddressBroadcast?relay
   \   00005A   E9           MOV     A,R1
   \   00005B   600B         JZ      ??AF_DataRequest_5
    479                {
    480                  // Force mode to broadcast
    481                  dstAddr->addrMode = afAddrBroadcast;
   \   00005D   740F         MOV     A,#0xf
   \   00005F   8E82         MOV     DPL,R6
   \   000061   8F83         MOV     DPH,R7
   \   000063   A3           INC     DPTR
   \   000064   A3           INC     DPTR
   \   000065   F0           MOVX    @DPTR,A
   \   000066   8029         SJMP    ??AF_DataRequest_6
    482                }
    483                else
    484                {
    485                  // Address is not a valid broadcast type
    486                  if ( dstAddr->addrMode == afAddrBroadcast )
   \                     ??AF_DataRequest_5:
   \   000068   8E82         MOV     DPL,R6
   \   00006A   8F83         MOV     DPH,R7
   \   00006C   A3           INC     DPTR
   \   00006D   A3           INC     DPTR
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   640F         XRL     A,#0xf
   \   000071   701E         JNZ     ??AF_DataRequest_6
    487                  {
    488                    return afStatus_INVALID_PARAMETER;
   \   000073   7982         MOV     R1,#-0x7e
   \   000075   02....       LJMP    ??AF_DataRequest_2 & 0xFFFF
    489                  }
    490              }
    491            }
    492            else if ( dstAddr->addrMode != afAddrGroup &&
    493                      dstAddr->addrMode != afAddrNotPresent )
   \                     ??AF_DataRequest_4:
   \   000078   8E82         MOV     DPL,R6
   \   00007A   8F83         MOV     DPH,R7
   \   00007C   A3           INC     DPTR
   \   00007D   A3           INC     DPTR
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   6401         XRL     A,#0x1
   \   000081   600E         JZ      ??AF_DataRequest_6
   \   000083   8E82         MOV     DPL,R6
   \   000085   8F83         MOV     DPH,R7
   \   000087   A3           INC     DPTR
   \   000088   A3           INC     DPTR
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   6005         JZ      ??AF_DataRequest_6
    494            {
    495              return afStatus_INVALID_PARAMETER;
   \   00008C   7982         MOV     R1,#-0x7e
   \   00008E   02....       LJMP    ??AF_DataRequest_2 & 0xFFFF
    496            }
    497            req.dstAddr.addrMode = dstAddr->addrMode;
   \                     ??AF_DataRequest_6:
   \   000091   8E82         MOV     DPL,R6
   \   000093   8F83         MOV     DPH,R7
   \   000095   A3           INC     DPTR
   \   000096   A3           INC     DPTR
   \   000097   E0           MOVX    A,@DPTR
   \   000098   C0E0         PUSH    A
   \   00009A   740C         MOV     A,#0xc
   \   00009C   12....       LCALL   ?XSTACK_DISP0_8
   \   00009F   D0E0         POP     A
   \   0000A1   F0           MOVX    @DPTR,A
    498          
    499            req.profileID = ZDO_PROFILE_ID;
   \   0000A2   7411         MOV     A,#0x11
   \   0000A4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A7   7400         MOV     A,#0x0
   \   0000A9   F0           MOVX    @DPTR,A
   \   0000AA   A3           INC     DPTR
   \   0000AB   7400         MOV     A,#0x0
   \   0000AD   F0           MOVX    @DPTR,A
    500          
    501            if ( (pfnDescCB = afGetDescCB( srcEP )) )
   \   0000AE                ; Setup parameters for call to function afGetDescCB
   \   0000AE   AA..         MOV     R2,?V0 + 0
   \   0000B0   AB..         MOV     R3,?V0 + 1
   \   0000B2   12....       LCALL   ??afGetDescCB?relay
   \   0000B5   8A..         MOV     ?V0 + 4,R2
   \   0000B7   8B..         MOV     ?V0 + 5,R3
   \   0000B9   A8..         MOV     R0,?V0 + 4
   \   0000BB   A9..         MOV     R1,?V0 + 5
   \   0000BD   7402         MOV     A,#0x2
   \   0000BF   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C2   E8           MOV     A,R0
   \   0000C3   F0           MOVX    @DPTR,A
   \   0000C4   A3           INC     DPTR
   \   0000C5   E9           MOV     A,R1
   \   0000C6   F0           MOVX    @DPTR,A
   \   0000C7   E8           MOV     A,R0
   \   0000C8   6400         XRL     A,#0x0
   \   0000CA   7003         JNZ     ??AF_DataRequest_7
   \   0000CC   E9           MOV     A,R1
   \   0000CD   6400         XRL     A,#0x0
   \                     ??AF_DataRequest_7:
   \   0000CF   604E         JZ      ??AF_DataRequest_8
    502            {
    503              uint16 *pID = (uint16 *)(pfnDescCB(
    504                                           AF_DESCRIPTOR_PROFILE_ID, srcEP->endPoint ));
   \   0000D1                ; Setup parameters for indirect call
   \   0000D1   85..82       MOV     DPL,?V0 + 0
   \   0000D4   85..83       MOV     DPH,?V0 + 1
   \   0000D7   E0           MOVX    A,@DPTR
   \   0000D8   FA           MOV     R2,A
   \   0000D9   7902         MOV     R1,#0x2
   \   0000DB   7402         MOV     A,#0x2
   \   0000DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   F8           MOV     R0,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   F583         MOV     DPH,A
   \   0000E6   8882         MOV     DPL,R0
   \   0000E8   12....       LCALL   ?CALL_IND
   \   0000EB   8A..         MOV     ?V0 + 4,R2
   \   0000ED   8B..         MOV     ?V0 + 5,R3
   \   0000EF   85....       MOV     ?V0 + 6,?V0 + 4
   \   0000F2   85....       MOV     ?V0 + 7,?V0 + 5
    505              if ( pID )
   \   0000F5   E5..         MOV     A,?V0 + 6
   \   0000F7   6400         XRL     A,#0x0
   \   0000F9   7004         JNZ     ??AF_DataRequest_9
   \   0000FB   E5..         MOV     A,?V0 + 7
   \   0000FD   6400         XRL     A,#0x0
   \                     ??AF_DataRequest_9:
   \   0000FF   6053         JZ      ??AF_DataRequest_10
    506              {
    507                req.profileID = *pID;
   \   000101   85..82       MOV     DPL,?V0 + 6
   \   000104   85..83       MOV     DPH,?V0 + 7
   \   000107   E0           MOVX    A,@DPTR
   \   000108   F8           MOV     R0,A
   \   000109   A3           INC     DPTR
   \   00010A   E0           MOVX    A,@DPTR
   \   00010B   F9           MOV     R1,A
   \   00010C   7411         MOV     A,#0x11
   \   00010E   12....       LCALL   ?XSTACK_DISP0_8
   \   000111   E8           MOV     A,R0
   \   000112   F0           MOVX    @DPTR,A
   \   000113   A3           INC     DPTR
   \   000114   E9           MOV     A,R1
   \   000115   F0           MOVX    @DPTR,A
    508                osal_mem_free( pID );
   \   000116                ; Setup parameters for call to function osal_mem_free
   \   000116   AA..         MOV     R2,?V0 + 6
   \   000118   AB..         MOV     R3,?V0 + 7
   \   00011A   12....       LCALL   ??osal_mem_free?relay
   \   00011D   8035         SJMP    ??AF_DataRequest_10
    509              }
    510            }
    511            else if ( srcEP->simpleDesc )
   \                     ??AF_DataRequest_8:
   \   00011F   85..82       MOV     DPL,?V0 + 0
   \   000122   85..83       MOV     DPH,?V0 + 1
   \   000125   A3           INC     DPTR
   \   000126   A3           INC     DPTR
   \   000127   A3           INC     DPTR
   \   000128   E0           MOVX    A,@DPTR
   \   000129   6400         XRL     A,#0x0
   \   00012B   7004         JNZ     ??AF_DataRequest_11
   \   00012D   A3           INC     DPTR
   \   00012E   E0           MOVX    A,@DPTR
   \   00012F   6400         XRL     A,#0x0
   \                     ??AF_DataRequest_11:
   \   000131   6021         JZ      ??AF_DataRequest_10
    512            {
    513              req.profileID = srcEP->simpleDesc->AppProfId;
   \   000133   85..82       MOV     DPL,?V0 + 0
   \   000136   85..83       MOV     DPH,?V0 + 1
   \   000139   A3           INC     DPTR
   \   00013A   A3           INC     DPTR
   \   00013B   A3           INC     DPTR
   \   00013C   E0           MOVX    A,@DPTR
   \   00013D   F8           MOV     R0,A
   \   00013E   A3           INC     DPTR
   \   00013F   E0           MOVX    A,@DPTR
   \   000140   F583         MOV     DPH,A
   \   000142   8882         MOV     DPL,R0
   \   000144   A3           INC     DPTR
   \   000145   E0           MOVX    A,@DPTR
   \   000146   F8           MOV     R0,A
   \   000147   A3           INC     DPTR
   \   000148   E0           MOVX    A,@DPTR
   \   000149   F9           MOV     R1,A
   \   00014A   7411         MOV     A,#0x11
   \   00014C   12....       LCALL   ?XSTACK_DISP0_8
   \   00014F   E8           MOV     A,R0
   \   000150   F0           MOVX    @DPTR,A
   \   000151   A3           INC     DPTR
   \   000152   E9           MOV     A,R1
   \   000153   F0           MOVX    @DPTR,A
    514            }
    515          
    516            req.txOptions = 0;
   \                     ??AF_DataRequest_10:
   \   000154   7417         MOV     A,#0x17
   \   000156   12....       LCALL   ?XSTACK_DISP0_8
   \   000159   7400         MOV     A,#0x0
   \   00015B   F0           MOVX    @DPTR,A
   \   00015C   A3           INC     DPTR
   \   00015D   7400         MOV     A,#0x0
   \   00015F   F0           MOVX    @DPTR,A
    517          
    518            if ( ( options & AF_ACK_REQUEST              ) &&
    519                 ( req.dstAddr.addrMode != AddrBroadcast ) &&
    520                 ( req.dstAddr.addrMode != AddrGroup     )    )
   \   000160   E5..         MOV     A,?V0 + 3
   \   000162   A2E4         MOV     C,0xE0 /* A   */.4
   \   000164   5022         JNC     ??AF_DataRequest_12
   \   000166   740C         MOV     A,#0xc
   \   000168   12....       LCALL   ?XSTACK_DISP0_8
   \   00016B   E0           MOVX    A,@DPTR
   \   00016C   640F         XRL     A,#0xf
   \   00016E   6018         JZ      ??AF_DataRequest_12
   \   000170   740C         MOV     A,#0xc
   \   000172   12....       LCALL   ?XSTACK_DISP0_8
   \   000175   E0           MOVX    A,@DPTR
   \   000176   6401         XRL     A,#0x1
   \   000178   600E         JZ      ??AF_DataRequest_12
    521            {
    522              req.txOptions |=  APS_TX_OPTIONS_ACK;
   \   00017A   7417         MOV     A,#0x17
   \   00017C   12....       LCALL   ?XSTACK_DISP0_8
   \   00017F   E0           MOVX    A,@DPTR
   \   000180   4404         ORL     A,#0x4
   \   000182   F0           MOVX    @DPTR,A
   \   000183   A3           INC     DPTR
   \   000184   E0           MOVX    A,@DPTR
   \   000185   4400         ORL     A,#0x0
   \   000187   F0           MOVX    @DPTR,A
    523            }
    524          
    525            if ( options & AF_SKIP_ROUTING )
   \                     ??AF_DataRequest_12:
   \   000188   E5..         MOV     A,?V0 + 3
   \   00018A   A2E7         MOV     C,0xE0 /* A   */.7
   \   00018C   500E         JNC     ??AF_DataRequest_13
    526            {
    527              req.txOptions |=  APS_TX_OPTIONS_SKIP_ROUTING;
   \   00018E   7417         MOV     A,#0x17
   \   000190   12....       LCALL   ?XSTACK_DISP0_8
   \   000193   E0           MOVX    A,@DPTR
   \   000194   4410         ORL     A,#0x10
   \   000196   F0           MOVX    @DPTR,A
   \   000197   A3           INC     DPTR
   \   000198   E0           MOVX    A,@DPTR
   \   000199   4400         ORL     A,#0x0
   \   00019B   F0           MOVX    @DPTR,A
    528            }
    529          
    530            if ( options & AF_EN_SECURITY )
   \                     ??AF_DataRequest_13:
   \   00019C   E5..         MOV     A,?V0 + 3
   \   00019E   A2E6         MOV     C,0xE0 /* A   */.6
   \   0001A0   501C         JNC     ??AF_DataRequest_14
    531            {
    532              req.txOptions |= APS_TX_OPTIONS_SECURITY_ENABLE;
   \   0001A2   7417         MOV     A,#0x17
   \   0001A4   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A7   E0           MOVX    A,@DPTR
   \   0001A8   4401         ORL     A,#0x1
   \   0001AA   F0           MOVX    @DPTR,A
   \   0001AB   A3           INC     DPTR
   \   0001AC   E0           MOVX    A,@DPTR
   \   0001AD   4400         ORL     A,#0x0
   \   0001AF   F0           MOVX    @DPTR,A
    533              mtu.aps.secure = TRUE;
   \   0001B0   7401         MOV     A,#0x1
   \   0001B2   C0E0         PUSH    A
   \   0001B4   7401         MOV     A,#0x1
   \   0001B6   12....       LCALL   ?XSTACK_DISP0_8
   \   0001B9   D0E0         POP     A
   \   0001BB   F0           MOVX    @DPTR,A
   \   0001BC   800C         SJMP    ??AF_DataRequest_15
    534            }
    535            else
    536            {
    537              mtu.aps.secure = FALSE;
   \                     ??AF_DataRequest_14:
   \   0001BE   7400         MOV     A,#0x0
   \   0001C0   C0E0         PUSH    A
   \   0001C2   7401         MOV     A,#0x1
   \   0001C4   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C7   D0E0         POP     A
   \   0001C9   F0           MOVX    @DPTR,A
    538            }
    539          
    540            mtu.kvp = FALSE;
   \                     ??AF_DataRequest_15:
   \   0001CA   7400         MOV     A,#0x0
   \   0001CC   85..82       MOV     DPL,?XSP + 0
   \   0001CF   85..83       MOV     DPH,?XSP + 1
   \   0001D2   F0           MOVX    @DPTR,A
    541          
    542            req.transID       = *transID;
   \   0001D3   7434         MOV     A,#0x34
   \   0001D5   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D8   E0           MOVX    A,@DPTR
   \   0001D9   F8           MOV     R0,A
   \   0001DA   A3           INC     DPTR
   \   0001DB   E0           MOVX    A,@DPTR
   \   0001DC   F583         MOV     DPH,A
   \   0001DE   8882         MOV     DPL,R0
   \   0001E0   E0           MOVX    A,@DPTR
   \   0001E1   C0E0         PUSH    A
   \   0001E3   7419         MOV     A,#0x19
   \   0001E5   12....       LCALL   ?XSTACK_DISP0_8
   \   0001E8   D0E0         POP     A
   \   0001EA   F0           MOVX    @DPTR,A
    543            req.srcEP         = srcEP->endPoint;
   \   0001EB   85..82       MOV     DPL,?V0 + 0
   \   0001EE   85..83       MOV     DPH,?V0 + 1
   \   0001F1   E0           MOVX    A,@DPTR
   \   0001F2   C0E0         PUSH    A
   \   0001F4   740D         MOV     A,#0xd
   \   0001F6   12....       LCALL   ?XSTACK_DISP0_8
   \   0001F9   D0E0         POP     A
   \   0001FB   F0           MOVX    @DPTR,A
    544            req.dstEP         = dstAddr->endPoint;
   \   0001FC   8E82         MOV     DPL,R6
   \   0001FE   8F83         MOV     DPH,R7
   \   000200   A3           INC     DPTR
   \   000201   A3           INC     DPTR
   \   000202   A3           INC     DPTR
   \   000203   E0           MOVX    A,@DPTR
   \   000204   C0E0         PUSH    A
   \   000206   740E         MOV     A,#0xe
   \   000208   12....       LCALL   ?XSTACK_DISP0_8
   \   00020B   D0E0         POP     A
   \   00020D   F0           MOVX    @DPTR,A
    545            req.clusterID     = cID;
   \   00020E   742E         MOV     A,#0x2e
   \   000210   12....       LCALL   ?XSTACK_DISP0_8
   \   000213   E0           MOVX    A,@DPTR
   \   000214   F8           MOV     R0,A
   \   000215   A3           INC     DPTR
   \   000216   E0           MOVX    A,@DPTR
   \   000217   F9           MOV     R1,A
   \   000218   740F         MOV     A,#0xf
   \   00021A   12....       LCALL   ?XSTACK_DISP0_8
   \   00021D   E8           MOV     A,R0
   \   00021E   F0           MOVX    @DPTR,A
   \   00021F   A3           INC     DPTR
   \   000220   E9           MOV     A,R1
   \   000221   F0           MOVX    @DPTR,A
    546            req.asduLen       = len;
   \   000222   7430         MOV     A,#0x30
   \   000224   12....       LCALL   ?XSTACK_DISP0_8
   \   000227   E0           MOVX    A,@DPTR
   \   000228   F8           MOV     R0,A
   \   000229   A3           INC     DPTR
   \   00022A   E0           MOVX    A,@DPTR
   \   00022B   F9           MOV     R1,A
   \   00022C   7413         MOV     A,#0x13
   \   00022E   12....       LCALL   ?XSTACK_DISP0_8
   \   000231   E8           MOV     A,R0
   \   000232   F0           MOVX    @DPTR,A
   \   000233   A3           INC     DPTR
   \   000234   E9           MOV     A,R1
   \   000235   F0           MOVX    @DPTR,A
    547            req.asdu          = buf;
   \   000236   7432         MOV     A,#0x32
   \   000238   12....       LCALL   ?XSTACK_DISP0_8
   \   00023B   E0           MOVX    A,@DPTR
   \   00023C   F8           MOV     R0,A
   \   00023D   A3           INC     DPTR
   \   00023E   E0           MOVX    A,@DPTR
   \   00023F   F9           MOV     R1,A
   \   000240   7415         MOV     A,#0x15
   \   000242   12....       LCALL   ?XSTACK_DISP0_8
   \   000245   E8           MOV     A,R0
   \   000246   F0           MOVX    @DPTR,A
   \   000247   A3           INC     DPTR
   \   000248   E9           MOV     A,R1
   \   000249   F0           MOVX    @DPTR,A
    548            req.discoverRoute = TRUE;//(uint8)((options & AF_DISCV_ROUTE) ? 1 : 0);
   \   00024A   7401         MOV     A,#0x1
   \   00024C   C0E0         PUSH    A
   \   00024E   741A         MOV     A,#0x1a
   \   000250   12....       LCALL   ?XSTACK_DISP0_8
   \   000253   D0E0         POP     A
   \   000255   F0           MOVX    @DPTR,A
    549            req.radiusCounter = radius;
   \   000256   7436         MOV     A,#0x36
   \   000258   12....       LCALL   ?XSTACK_DISP0_8
   \   00025B   E0           MOVX    A,@DPTR
   \   00025C   C0E0         PUSH    A
   \   00025E   741B         MOV     A,#0x1b
   \   000260   12....       LCALL   ?XSTACK_DISP0_8
   \   000263   D0E0         POP     A
   \   000265   F0           MOVX    @DPTR,A
    550          
    551            if (len > afDataReqMTU( &mtu ) )
   \   000266                ; Setup parameters for call to function afDataReqMTU
   \   000266   85..82       MOV     DPL,?XSP + 0
   \   000269   85..83       MOV     DPH,?XSP + 1
   \   00026C   AA82         MOV     R2,DPL
   \   00026E   AB83         MOV     R3,DPH
   \   000270   12....       LCALL   ??afDataReqMTU?relay
   \   000273   E9           MOV     A,R1
   \   000274   FA           MOV     R2,A
   \   000275   7B00         MOV     R3,#0x0
   \   000277   7430         MOV     A,#0x30
   \   000279   12....       LCALL   ?XSTACK_DISP0_8
   \   00027C   E0           MOVX    A,@DPTR
   \   00027D   F8           MOV     R0,A
   \   00027E   A3           INC     DPTR
   \   00027F   E0           MOVX    A,@DPTR
   \   000280   F9           MOV     R1,A
   \   000281   C3           CLR     C
   \   000282   EA           MOV     A,R2
   \   000283   98           SUBB    A,R0
   \   000284   EB           MOV     A,R3
   \   000285   99           SUBB    A,R1
   \   000286   503D         JNC     ??AF_DataRequest_16
    552            {
    553              if (apsfSendFragmented)
   \   000288   90....       MOV     DPTR,#apsfSendFragmented
   \   00028B   E0           MOVX    A,@DPTR
   \   00028C   6400         XRL     A,#0x0
   \   00028E   7004         JNZ     ??AF_DataRequest_17
   \   000290   A3           INC     DPTR
   \   000291   E0           MOVX    A,@DPTR
   \   000292   6400         XRL     A,#0x0
   \                     ??AF_DataRequest_17:
   \   000294   602A         JZ      ??AF_DataRequest_18
    554              {
    555                req.txOptions |= AF_FRAGMENTED | APS_TX_OPTIONS_ACK;
   \   000296   7417         MOV     A,#0x17
   \   000298   12....       LCALL   ?XSTACK_DISP0_8
   \   00029B   E0           MOVX    A,@DPTR
   \   00029C   4405         ORL     A,#0x5
   \   00029E   F0           MOVX    @DPTR,A
   \   00029F   A3           INC     DPTR
   \   0002A0   E0           MOVX    A,@DPTR
   \   0002A1   4400         ORL     A,#0x0
   \   0002A3   F0           MOVX    @DPTR,A
    556                stat = (*apsfSendFragmented)( &req );
   \   0002A4                ; Setup parameters for indirect call
   \   0002A4   7404         MOV     A,#0x4
   \   0002A6   12....       LCALL   ?XSTACK_DISP0_8
   \   0002A9   AA82         MOV     R2,DPL
   \   0002AB   AB83         MOV     R3,DPH
   \   0002AD   90....       MOV     DPTR,#apsfSendFragmented
   \   0002B0   E0           MOVX    A,@DPTR
   \   0002B1   F8           MOV     R0,A
   \   0002B2   A3           INC     DPTR
   \   0002B3   E0           MOVX    A,@DPTR
   \   0002B4   F583         MOV     DPH,A
   \   0002B6   8882         MOV     DPL,R0
   \   0002B8   12....       LCALL   ?CALL_IND
   \   0002BB   E9           MOV     A,R1
   \   0002BC   F5..         MOV     ?V0 + 2,A
   \   0002BE   8014         SJMP    ??AF_DataRequest_19
    557              }
    558              else
    559              {
    560                stat = afStatus_INVALID_PARAMETER;
   \                     ??AF_DataRequest_18:
   \   0002C0   75..82       MOV     ?V0 + 2,#-0x7e
   \   0002C3   800F         SJMP    ??AF_DataRequest_19
    561              }
    562            }
    563            else
    564            {
    565              stat = APSDE_DataReq( &req );
   \                     ??AF_DataRequest_16:
   \   0002C5                ; Setup parameters for call to function APSDE_DataReq
   \   0002C5   7404         MOV     A,#0x4
   \   0002C7   12....       LCALL   ?XSTACK_DISP0_8
   \   0002CA   AA82         MOV     R2,DPL
   \   0002CC   AB83         MOV     R3,DPH
   \   0002CE   12....       LCALL   ??APSDE_DataReq?relay
   \   0002D1   E9           MOV     A,R1
   \   0002D2   F5..         MOV     ?V0 + 2,A
    566            }
    567          
    568            /*
    569             * If this is an EndPoint-to-EndPoint message on the same device, it will not
    570             * get added to the NWK databufs. So it will not go OTA and it will not get
    571             * a MACCB_DATA_CONFIRM_CMD callback. Thus it is necessary to generate the
    572             * AF_DATA_CONFIRM_CMD here. Note that APSDE_DataConfirm() only generates one
    573             * message with the first in line TransSeqNumber, even on a multi message.
    574             * Also note that a reflected msg will not have its confirmation generated
    575             * here.
    576             */
    577            if ( (req.dstAddr.addrMode == Addr16Bit) &&
    578                 (req.dstAddr.addr.shortAddr == NLME_GetShortAddr()) )
   \                     ??AF_DataRequest_19:
   \   0002D4   740C         MOV     A,#0xc
   \   0002D6   12....       LCALL   ?XSTACK_DISP0_8
   \   0002D9   E0           MOVX    A,@DPTR
   \   0002DA   6402         XRL     A,#0x2
   \   0002DC   7035         JNZ     ??AF_DataRequest_20
   \   0002DE                ; Setup parameters for call to function NLME_GetShortAddr
   \   0002DE   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0002E1   8A..         MOV     ?V0 + 4,R2
   \   0002E3   8B..         MOV     ?V0 + 5,R3
   \   0002E5   A8..         MOV     R0,?V0 + 4
   \   0002E7   A9..         MOV     R1,?V0 + 5
   \   0002E9   7404         MOV     A,#0x4
   \   0002EB   12....       LCALL   ?XSTACK_DISP0_8
   \   0002EE   E0           MOVX    A,@DPTR
   \   0002EF   68           XRL     A,R0
   \   0002F0   7003         JNZ     ??AF_DataRequest_21
   \   0002F2   A3           INC     DPTR
   \   0002F3   E0           MOVX    A,@DPTR
   \   0002F4   69           XRL     A,R1
   \                     ??AF_DataRequest_21:
   \   0002F5   701C         JNZ     ??AF_DataRequest_20
    579            {
    580              afDataConfirm( srcEP->endPoint, *transID, stat );
   \   0002F7                ; Setup parameters for call to function afDataConfirm
   \   0002F7   AB..         MOV     R3,?V0 + 2
   \   0002F9   7434         MOV     A,#0x34
   \   0002FB   12....       LCALL   ?XSTACK_DISP0_8
   \   0002FE   E0           MOVX    A,@DPTR
   \   0002FF   F8           MOV     R0,A
   \   000300   A3           INC     DPTR
   \   000301   E0           MOVX    A,@DPTR
   \   000302   F583         MOV     DPH,A
   \   000304   8882         MOV     DPL,R0
   \   000306   E0           MOVX    A,@DPTR
   \   000307   FA           MOV     R2,A
   \   000308   85..82       MOV     DPL,?V0 + 0
   \   00030B   85..83       MOV     DPH,?V0 + 1
   \   00030E   E0           MOVX    A,@DPTR
   \   00030F   F9           MOV     R1,A
   \   000310   12....       LCALL   ??afDataConfirm?relay
    581            }
    582          
    583            if ( stat == afStatus_SUCCESS )
   \                     ??AF_DataRequest_20:
   \   000313   E5..         MOV     A,?V0 + 2
   \   000315   7011         JNZ     ??AF_DataRequest_22
    584            {
    585              (*transID)++;
   \   000317   7434         MOV     A,#0x34
   \   000319   12....       LCALL   ?XSTACK_DISP0_8
   \   00031C   E0           MOVX    A,@DPTR
   \   00031D   F8           MOV     R0,A
   \   00031E   A3           INC     DPTR
   \   00031F   E0           MOVX    A,@DPTR
   \   000320   F583         MOV     DPH,A
   \   000322   8882         MOV     DPL,R0
   \   000324   E0           MOVX    A,@DPTR
   \   000325   2401         ADD     A,#0x1
   \   000327   F0           MOVX    @DPTR,A
    586            }
    587          
    588            return (afStatus_t)stat;
   \                     ??AF_DataRequest_22:
   \   000328   A9..         MOV     R1,?V0 + 2
   \                     ??AF_DataRequest_2:
   \   00032A   741E         MOV     A,#0x1e
   \   00032C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00032F   7F08         MOV     R7,#0x8
   \   000331   02....       LJMP    ?BANKED_LEAVE_XDATA
    589          }
    590          
    591          /*********************************************************************
    592           * @fn      afFindEndPointDescList
    593           *
    594           * @brief   Find the endpoint description entry from the endpoint
    595           *          number.
    596           *
    597           * @param   EndPoint - Application Endpoint to look for
    598           *
    599           * @return  the address to the endpoint/interface description entry
    600           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    601          static epList_t *afFindEndPointDescList( byte EndPoint )
   \                     afFindEndPointDescList:
    602          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    603            epList_t *epSearch;
    604          
    605            // Start at the beginning
    606            epSearch = epList;
   \   000004   90....       MOV     DPTR,#epList
   \   000007   E0           MOVX    A,@DPTR
   \   000008   FA           MOV     R2,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   FB           MOV     R3,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
    607          
    608            // Look through the list until the end
    609            while ( epSearch )
   \                     ??afFindEndPointDescList_0:
   \   000010   EC           MOV     A,R4
   \   000011   6400         XRL     A,#0x0
   \   000013   7003         JNZ     ??afFindEndPointDescList_1
   \   000015   ED           MOV     A,R5
   \   000016   6400         XRL     A,#0x0
   \                     ??afFindEndPointDescList_1:
   \   000018   6026         JZ      ??afFindEndPointDescList_2
    610            {
    611              // Is there a match?
    612              if ( epSearch->epDesc->endPoint == EndPoint )
   \   00001A   8C82         MOV     DPL,R4
   \   00001C   8D83         MOV     DPH,R5
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F8           MOV     R0,A
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \   000022   F583         MOV     DPH,A
   \   000024   8882         MOV     DPL,R0
   \   000026   E0           MOVX    A,@DPTR
   \   000027   69           XRL     A,R1
   \   000028   7006         JNZ     ??afFindEndPointDescList_3
    613              {
    614                return ( epSearch );
   \   00002A   EC           MOV     A,R4
   \   00002B   FA           MOV     R2,A
   \   00002C   ED           MOV     A,R5
   \   00002D   FB           MOV     R3,A
   \   00002E   8014         SJMP    ??afFindEndPointDescList_4
    615              }
    616              else
    617                epSearch = epSearch->nextDesc;  // Next entry
   \                     ??afFindEndPointDescList_3:
   \   000030   8C82         MOV     DPL,R4
   \   000032   8D83         MOV     DPH,R5
   \   000034   A3           INC     DPTR
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   FC           MOV     R4,A
   \   00003B   A3           INC     DPTR
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   FD           MOV     R5,A
   \   00003E   80D0         SJMP    ??afFindEndPointDescList_0
    618            }
    619          
    620            return ( (epList_t *)NULL );
   \                     ??afFindEndPointDescList_2:
   \   000040   7A00         MOV     R2,#0x0
   \   000042   7B00         MOV     R3,#0x0
   \                     ??afFindEndPointDescList_4:
   \   000044   D083         POP     DPH
   \   000046   D082         POP     DPL
   \   000048   02....       LJMP    ?BRET
    621          }
    622          
    623          /*********************************************************************
    624           * @fn      afFindEndPointDesc
    625           *
    626           * @brief   Find the endpoint description entry from the endpoint
    627           *          number.
    628           *
    629           * @param   EndPoint - Application Endpoint to look for
    630           *
    631           * @return  the address to the endpoint/interface description entry
    632           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    633          endPointDesc_t *afFindEndPointDesc( byte EndPoint )
   \                     afFindEndPointDesc:
    634          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
    635            epList_t *epSearch;
    636          
    637            // Look for the endpoint
    638            epSearch = afFindEndPointDescList( EndPoint );
   \   000007                ; Setup parameters for call to function afFindEndPointDescList
   \   000007   A9..         MOV     R1,?V0 + 0
   \   000009   12....       LCALL   ??afFindEndPointDescList?relay
   \   00000C   8A..         MOV     ?V0 + 2,R2
   \   00000E   8B..         MOV     ?V0 + 3,R3
   \   000010   AE..         MOV     R6,?V0 + 2
   \   000012   AF..         MOV     R7,?V0 + 3
    639          
    640            if ( epSearch )
   \   000014   EE           MOV     A,R6
   \   000015   6400         XRL     A,#0x0
   \   000017   7003         JNZ     ??afFindEndPointDesc_0
   \   000019   EF           MOV     A,R7
   \   00001A   6400         XRL     A,#0x0
   \                     ??afFindEndPointDesc_0:
   \   00001C   600B         JZ      ??afFindEndPointDesc_1
    641              return ( epSearch->epDesc );
   \   00001E   8E82         MOV     DPL,R6
   \   000020   8F83         MOV     DPH,R7
   \   000022   E0           MOVX    A,@DPTR
   \   000023   FA           MOV     R2,A
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FB           MOV     R3,A
   \   000027   8004         SJMP    ??afFindEndPointDesc_2
    642            else
    643              return ( (endPointDesc_t *)NULL );
   \                     ??afFindEndPointDesc_1:
   \   000029   7A00         MOV     R2,#0x0
   \   00002B   7B00         MOV     R3,#0x0
   \                     ??afFindEndPointDesc_2:
   \   00002D   7F04         MOV     R7,#0x4
   \   00002F   02....       LJMP    ?BANKED_LEAVE_XDATA
    644          }
    645          
    646          /*********************************************************************
    647           * @fn      afFindSimpleDesc
    648           *
    649           * @brief   Find the Simple Descriptor from the endpoint number.
    650           *
    651           * @param   EP - Application Endpoint to look for.
    652           *
    653           * @return  Non-zero to indicate that the descriptor memory must be freed.
    654           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    655          byte afFindSimpleDesc( SimpleDescriptionFormat_t **ppDesc, byte EP )
   \                     afFindSimpleDesc:
    656          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   89..         MOV     ?V0 + 4,R1
    657            epList_t *epItem = afFindEndPointDescList( EP );
   \   00000B                ; Setup parameters for call to function afFindEndPointDescList
   \   00000B   A9..         MOV     R1,?V0 + 4
   \   00000D   12....       LCALL   ??afFindEndPointDescList?relay
   \   000010   8A..         MOV     ?V0 + 2,R2
   \   000012   8B..         MOV     ?V0 + 3,R3
   \   000014   AE..         MOV     R6,?V0 + 2
   \   000016   AF..         MOV     R7,?V0 + 3
    658            byte rtrn = FALSE;
   \   000018   75..00       MOV     ?V0 + 5,#0x0
    659          
    660            if ( epItem )
   \   00001B   EE           MOV     A,R6
   \   00001C   6400         XRL     A,#0x0
   \   00001E   7003         JNZ     ??afFindSimpleDesc_0
   \   000020   EF           MOV     A,R7
   \   000021   6400         XRL     A,#0x0
   \                     ??afFindSimpleDesc_0:
   \   000023   6059         JZ      ??afFindSimpleDesc_1
    661            {
    662              if ( epItem->pfnDescCB )
   \   000025   8E82         MOV     DPL,R6
   \   000027   8F83         MOV     DPH,R7
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   6400         XRL     A,#0x0
   \   00002F   7004         JNZ     ??afFindSimpleDesc_2
   \   000031   A3           INC     DPTR
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6400         XRL     A,#0x0
   \                     ??afFindSimpleDesc_2:
   \   000035   6026         JZ      ??afFindSimpleDesc_3
    663              {
    664                *ppDesc = epItem->pfnDescCB( AF_DESCRIPTOR_SIMPLE, EP );
   \   000037                ; Setup parameters for indirect call
   \   000037   AA..         MOV     R2,?V0 + 4
   \   000039   7901         MOV     R1,#0x1
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   A3           INC     DPTR
   \   000042   E0           MOVX    A,@DPTR
   \   000043   F8           MOV     R0,A
   \   000044   A3           INC     DPTR
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F583         MOV     DPH,A
   \   000048   8882         MOV     DPL,R0
   \   00004A   12....       LCALL   ?CALL_IND
   \   00004D   85..82       MOV     DPL,?V0 + 0
   \   000050   85..83       MOV     DPH,?V0 + 1
   \   000053   EA           MOV     A,R2
   \   000054   F0           MOVX    @DPTR,A
   \   000055   A3           INC     DPTR
   \   000056   EB           MOV     A,R3
   \   000057   F0           MOVX    @DPTR,A
    665                rtrn = TRUE;
   \   000058   75..01       MOV     ?V0 + 5,#0x1
   \   00005B   802E         SJMP    ??afFindSimpleDesc_4
    666              }
    667              else
    668              {
    669                *ppDesc = epItem->epDesc->simpleDesc;
   \                     ??afFindSimpleDesc_3:
   \   00005D   8E82         MOV     DPL,R6
   \   00005F   8F83         MOV     DPH,R7
   \   000061   E0           MOVX    A,@DPTR
   \   000062   F8           MOV     R0,A
   \   000063   A3           INC     DPTR
   \   000064   E0           MOVX    A,@DPTR
   \   000065   F583         MOV     DPH,A
   \   000067   8882         MOV     DPL,R0
   \   000069   A3           INC     DPTR
   \   00006A   A3           INC     DPTR
   \   00006B   A3           INC     DPTR
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F8           MOV     R0,A
   \   00006E   A3           INC     DPTR
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   F9           MOV     R1,A
   \   000071   85..82       MOV     DPL,?V0 + 0
   \   000074   85..83       MOV     DPH,?V0 + 1
   \   000077   E8           MOV     A,R0
   \   000078   F0           MOVX    @DPTR,A
   \   000079   A3           INC     DPTR
   \   00007A   E9           MOV     A,R1
   \   00007B   F0           MOVX    @DPTR,A
   \   00007C   800D         SJMP    ??afFindSimpleDesc_4
    670              }
    671            }
    672            else
    673            {
    674              *ppDesc = NULL;
   \                     ??afFindSimpleDesc_1:
   \   00007E   85..82       MOV     DPL,?V0 + 0
   \   000081   85..83       MOV     DPH,?V0 + 1
   \   000084   7400         MOV     A,#0x0
   \   000086   F0           MOVX    @DPTR,A
   \   000087   A3           INC     DPTR
   \   000088   7400         MOV     A,#0x0
   \   00008A   F0           MOVX    @DPTR,A
    675            }
    676          
    677            return rtrn;
   \                     ??afFindSimpleDesc_4:
   \   00008B   A9..         MOV     R1,?V0 + 5
   \   00008D   7F06         MOV     R7,#0x6
   \   00008F   02....       LJMP    ?BANKED_LEAVE_XDATA
    678          }
    679          
    680          /*********************************************************************
    681           * @fn      afGetDescCB
    682           *
    683           * @brief   Get the Descriptor callback function.
    684           *
    685           * @param   epDesc - pointer to the endpoint descriptor
    686           *
    687           * @return  function pointer or NULL
    688           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    689          static pDescCB afGetDescCB( endPointDesc_t *epDesc )
   \                     afGetDescCB:
    690          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EA           MOV     A,R2
   \   000005   F8           MOV     R0,A
   \   000006   EB           MOV     A,R3
   \   000007   F9           MOV     R1,A
    691            epList_t *epSearch;
    692          
    693            // Start at the beginning
    694            epSearch = epList;
   \   000008   90....       MOV     DPTR,#epList
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   FA           MOV     R2,A
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   FB           MOV     R3,A
   \   000010   EA           MOV     A,R2
   \   000011   FC           MOV     R4,A
   \   000012   EB           MOV     A,R3
   \   000013   FD           MOV     R5,A
    695          
    696            // Look through the list until the end
    697            while ( epSearch )
   \                     ??afGetDescCB_0:
   \   000014   EC           MOV     A,R4
   \   000015   6400         XRL     A,#0x0
   \   000017   7003         JNZ     ??afGetDescCB_1
   \   000019   ED           MOV     A,R5
   \   00001A   6400         XRL     A,#0x0
   \                     ??afGetDescCB_1:
   \   00001C   6033         JZ      ??afGetDescCB_2
    698            {
    699              // Is there a match?
    700              if ( epSearch->epDesc == epDesc )
   \   00001E   8C82         MOV     DPL,R4
   \   000020   8D83         MOV     DPH,R5
   \   000022   E0           MOVX    A,@DPTR
   \   000023   FA           MOV     R2,A
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FB           MOV     R3,A
   \   000027   E8           MOV     A,R0
   \   000028   6A           XRL     A,R2
   \   000029   7002         JNZ     ??afGetDescCB_3
   \   00002B   E9           MOV     A,R1
   \   00002C   6B           XRL     A,R3
   \                     ??afGetDescCB_3:
   \   00002D   700E         JNZ     ??afGetDescCB_4
    701              {
    702                return ( epSearch->pfnDescCB );
   \   00002F   8C82         MOV     DPL,R4
   \   000031   8D83         MOV     DPH,R5
   \   000033   A3           INC     DPTR
   \   000034   A3           INC     DPTR
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   FA           MOV     R2,A
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   FB           MOV     R3,A
   \   00003B   8018         SJMP    ??afGetDescCB_5
    703              }
    704              else
    705                epSearch = epSearch->nextDesc;  // Next entry
   \                     ??afGetDescCB_4:
   \   00003D   8C82         MOV     DPL,R4
   \   00003F   8D83         MOV     DPH,R5
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   E0           MOVX    A,@DPTR
   \   000047   FA           MOV     R2,A
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FB           MOV     R3,A
   \   00004B   EA           MOV     A,R2
   \   00004C   FC           MOV     R4,A
   \   00004D   EB           MOV     A,R3
   \   00004E   FD           MOV     R5,A
   \   00004F   80C3         SJMP    ??afGetDescCB_0
    706            }
    707          
    708            return ( (pDescCB)NULL );
   \                     ??afGetDescCB_2:
   \   000051   7A00         MOV     R2,#0x0
   \   000053   7B00         MOV     R3,#0x0
   \                     ??afGetDescCB_5:
   \   000055   D083         POP     DPH
   \   000057   D082         POP     DPL
   \   000059   02....       LJMP    ?BRET
    709          }
    710          
    711          /*********************************************************************
    712           * @fn      afDataReqMTU
    713           *
    714           * @brief   Get the Data Request MTU(Max Transport Unit).
    715           *
    716           * @param   fields - afDataReqMTU_t
    717           *
    718           * @return  uint8(MTU)
    719           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    720          uint8 afDataReqMTU( afDataReqMTU_t* fields )
   \                     afDataReqMTU:
    721          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    722            uint8 len;
    723            uint8 hdr;
    724          
    725            if ( fields->kvp == TRUE )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6401         XRL     A,#0x1
   \   000010   7005         JNZ     ??afDataReqMTU_0
    726            {
    727              hdr = AF_HDR_KVP_MAX_LEN;
   \   000012   75..08       MOV     ?V0 + 1,#0x8
   \   000015   8003         SJMP    ??afDataReqMTU_1
    728            }
    729            else
    730            {
    731              hdr = AF_HDR_V1_1_MAX_LEN;
   \                     ??afDataReqMTU_0:
   \   000017   75..00       MOV     ?V0 + 1,#0x0
    732            }
    733          
    734            len = (uint8)(APSDE_DataReqMTU(&fields->aps) - hdr);
   \                     ??afDataReqMTU_1:
   \   00001A                ; Setup parameters for call to function APSDE_DataReqMTU
   \   00001A   8E82         MOV     DPL,R6
   \   00001C   8F83         MOV     DPH,R7
   \   00001E   A3           INC     DPTR
   \   00001F   AA82         MOV     R2,DPL
   \   000021   AB83         MOV     R3,DPH
   \   000023   12....       LCALL   ??APSDE_DataReqMTU?relay
   \   000026   E9           MOV     A,R1
   \   000027   C3           CLR     C
   \   000028   95..         SUBB    A,?V0 + 1
   \   00002A   F5..         MOV     ?V0 + 0,A
    735          
    736            return len;
   \   00002C   A9..         MOV     R1,?V0 + 0
   \   00002E   7F02         MOV     R7,#0x2
   \   000030   02....       LJMP    ?BANKED_LEAVE_XDATA
    737          }
    738          
    739          /*********************************************************************
    740           * @fn      afGetMatch
    741           *
    742           * @brief   Set the allow response flag.
    743           *
    744           * @param   ep - Application Endpoint to look for
    745           * @param   action - true - allow response, false - no response
    746           *
    747           * @return  TRUE allow responses, FALSE no response
    748           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    749          uint8 afGetMatch( uint8 ep )
   \                     afGetMatch:
    750          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
    751            epList_t *epSearch;
    752          
    753            // Look for the endpoint
    754            epSearch = afFindEndPointDescList( ep );
   \   000007                ; Setup parameters for call to function afFindEndPointDescList
   \   000007   A9..         MOV     R1,?V0 + 0
   \   000009   12....       LCALL   ??afFindEndPointDescList?relay
   \   00000C   8A..         MOV     ?V0 + 2,R2
   \   00000E   8B..         MOV     ?V0 + 3,R3
   \   000010   AE..         MOV     R6,?V0 + 2
   \   000012   AF..         MOV     R7,?V0 + 3
    755          
    756            if ( epSearch )
   \   000014   EE           MOV     A,R6
   \   000015   6400         XRL     A,#0x0
   \   000017   7003         JNZ     ??afGetMatch_0
   \   000019   EF           MOV     A,R7
   \   00001A   6400         XRL     A,#0x0
   \                     ??afGetMatch_0:
   \   00001C   6013         JZ      ??afGetMatch_1
    757            {
    758              if ( epSearch->flags & eEP_AllowMatch )
   \   00001E   8E82         MOV     DPL,R6
   \   000020   8F83         MOV     DPH,R7
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \   000025   A2E0         MOV     C,0xE0 /* A   */.0
   \   000027   5004         JNC     ??afGetMatch_2
    759                return ( TRUE );
   \   000029   7901         MOV     R1,#0x1
   \   00002B   8006         SJMP    ??afGetMatch_3
    760              else
    761                return ( FALSE );
   \                     ??afGetMatch_2:
   \   00002D   7900         MOV     R1,#0x0
   \   00002F   8002         SJMP    ??afGetMatch_3
    762            }
    763            else
    764              return ( FALSE );
   \                     ??afGetMatch_1:
   \   000031   7900         MOV     R1,#0x0
   \                     ??afGetMatch_3:
   \   000033   7F04         MOV     R7,#0x4
   \   000035   02....       LJMP    ?BANKED_LEAVE_XDATA
    765          }
    766          
    767          /*********************************************************************
    768           * @fn      afSetMatch
    769           *
    770           * @brief   Set the allow response flag.
    771           *
    772           * @param   ep - Application Endpoint to look for
    773           * @param   action - true - allow response, false - no response
    774           *
    775           * @return  TRUE if success, FALSE if endpoint not found
    776           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    777          uint8 afSetMatch( uint8 ep, uint8 action )
   \                     afSetMatch:
    778          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   8A..         MOV     ?V0 + 1,R2
    779            epList_t *epSearch;
    780          
    781            // Look for the endpoint
    782            epSearch = afFindEndPointDescList( ep );
   \   000009                ; Setup parameters for call to function afFindEndPointDescList
   \   000009   A9..         MOV     R1,?V0 + 0
   \   00000B   12....       LCALL   ??afFindEndPointDescList?relay
   \   00000E   8A..         MOV     ?V0 + 2,R2
   \   000010   8B..         MOV     ?V0 + 3,R3
   \   000012   AE..         MOV     R6,?V0 + 2
   \   000014   AF..         MOV     R7,?V0 + 3
    783          
    784            if ( epSearch )
   \   000016   EE           MOV     A,R6
   \   000017   6400         XRL     A,#0x0
   \   000019   7003         JNZ     ??afSetMatch_0
   \   00001B   EF           MOV     A,R7
   \   00001C   6400         XRL     A,#0x0
   \                     ??afSetMatch_0:
   \   00001E   601E         JZ      ??afSetMatch_1
    785            {
    786              if ( action )
   \   000020   E5..         MOV     A,?V0 + 1
   \   000022   600C         JZ      ??afSetMatch_2
    787              {
    788                epSearch->flags |= eEP_AllowMatch;
   \   000024   8E82         MOV     DPL,R6
   \   000026   8F83         MOV     DPH,R7
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   D2E0         SETB    0xE0 /* A   */.0
   \   00002D   F0           MOVX    @DPTR,A
   \   00002E   800A         SJMP    ??afSetMatch_3
    789              }
    790              else
    791              {
    792                epSearch->flags &= (0xff ^ eEP_AllowMatch);
   \                     ??afSetMatch_2:
   \   000030   8E82         MOV     DPL,R6
   \   000032   8F83         MOV     DPH,R7
   \   000034   A3           INC     DPTR
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   C2E0         CLR     0xE0 /* A   */.0
   \   000039   F0           MOVX    @DPTR,A
    793              }
    794              return ( TRUE );
   \                     ??afSetMatch_3:
   \   00003A   7901         MOV     R1,#0x1
   \   00003C   8002         SJMP    ??afSetMatch_4
    795            }
    796            else
    797              return ( FALSE );
   \                     ??afSetMatch_1:
   \   00003E   7900         MOV     R1,#0x0
   \                     ??afSetMatch_4:
   \   000040   7F04         MOV     R7,#0x4
   \   000042   02....       LJMP    ?BANKED_LEAVE_XDATA
    798          }
    799          
    800          /*********************************************************************
    801           * @fn      afNumEndPoints
    802           *
    803           * @brief   Returns the number of endpoints defined (including 0)
    804           *
    805           * @param   none
    806           *
    807           * @return  number of endpoints
    808           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    809          byte afNumEndPoints( void )
   \                     afNumEndPoints:
    810          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    811            epList_t *epSearch;
    812            byte endpoints;
    813          
    814            // Start at the beginning
    815            epSearch = epList;
   \   000004   90....       MOV     DPTR,#epList
   \   000007   E0           MOVX    A,@DPTR
   \   000008   FC           MOV     R4,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   FD           MOV     R5,A
   \   00000C   EC           MOV     A,R4
   \   00000D   FA           MOV     R2,A
   \   00000E   ED           MOV     A,R5
   \   00000F   FB           MOV     R3,A
    816            endpoints = 0;
   \   000010   7900         MOV     R1,#0x0
    817          
    818            while ( epSearch )
   \                     ??afNumEndPoints_0:
   \   000012   EA           MOV     A,R2
   \   000013   6400         XRL     A,#0x0
   \   000015   7003         JNZ     ??afNumEndPoints_1
   \   000017   EB           MOV     A,R3
   \   000018   6400         XRL     A,#0x0
   \                     ??afNumEndPoints_1:
   \   00001A   6011         JZ      ??afNumEndPoints_2
    819            {
    820              endpoints++;
   \   00001C   09           INC     R1
    821              epSearch = epSearch->nextDesc;
   \   00001D   8A82         MOV     DPL,R2
   \   00001F   8B83         MOV     DPH,R3
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FA           MOV     R2,A
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   FB           MOV     R3,A
   \   00002B   80E5         SJMP    ??afNumEndPoints_0
    822            }
    823          
    824            return ( endpoints );
   \                     ??afNumEndPoints_2:
   \   00002D   D083         POP     DPH
   \   00002F   D082         POP     DPL
   \   000031   02....       LJMP    ?BRET
    825          }
    826          
    827          /*********************************************************************
    828           * @fn      afEndPoints
    829           *
    830           * @brief   Fills in the passed in buffer with the endpoint (numbers).
    831           *          Use afNumEndPoints to find out how big a buffer to supply.
    832           *
    833           * @param   epBuf - pointer to mem used
    834           *
    835           * @return  void
    836           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    837          void afEndPoints( byte *epBuf, byte skipZDO )
   \                     afEndPoints:
    838          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    839            epList_t *epSearch;
    840            byte endPoint;
    841          
    842            // Start at the beginning
    843            epSearch = epList;
   \   000007   90....       MOV     DPTR,#epList
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   FC           MOV     R4,A
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   FD           MOV     R5,A
   \   00000F   EC           MOV     A,R4
   \   000010   F8           MOV     R0,A
   \   000011   ED           MOV     A,R5
   \   000012   F9           MOV     R1,A
    844          
    845            while ( epSearch )
   \                     ??afEndPoints_0:
   \   000013   E8           MOV     A,R0
   \   000014   6400         XRL     A,#0x0
   \   000016   7003         JNZ     ??afEndPoints_1
   \   000018   E9           MOV     A,R1
   \   000019   6400         XRL     A,#0x0
   \                     ??afEndPoints_1:
   \   00001B   6033         JZ      ??afEndPoints_2
    846            {
    847              endPoint = epSearch->epDesc->endPoint;
   \   00001D   8882         MOV     DPL,R0
   \   00001F   8983         MOV     DPH,R1
   \   000021   E0           MOVX    A,@DPTR
   \   000022   FC           MOV     R4,A
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F583         MOV     DPH,A
   \   000027   8C82         MOV     DPL,R4
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   FF           MOV     R7,A
    848          
    849              if ( !skipZDO || endPoint != 0 )
   \   00002B   EE           MOV     A,R6
   \   00002C   6003         JZ      ??afEndPoints_3
   \   00002E   EF           MOV     A,R7
   \   00002F   600F         JZ      ??afEndPoints_4
    850                *epBuf++ = endPoint;
   \                     ??afEndPoints_3:
   \   000031   EF           MOV     A,R7
   \   000032   8A82         MOV     DPL,R2
   \   000034   8B83         MOV     DPH,R3
   \   000036   F0           MOVX    @DPTR,A
   \   000037   8A82         MOV     DPL,R2
   \   000039   8B83         MOV     DPH,R3
   \   00003B   A3           INC     DPTR
   \   00003C   AA82         MOV     R2,DPL
   \   00003E   AB83         MOV     R3,DPH
    851          
    852              epSearch = epSearch->nextDesc;
   \                     ??afEndPoints_4:
   \   000040   8882         MOV     DPL,R0
   \   000042   8983         MOV     DPH,R1
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F8           MOV     R0,A
   \   00004B   A3           INC     DPTR
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   F9           MOV     R1,A
   \   00004E   80C3         SJMP    ??afEndPoints_0
    853            }
    854          }
   \                     ??afEndPoints_2:
   \   000050   7F01         MOV     R7,#0x1
   \   000052   02....       LJMP    ?BANKED_LEAVE_XDATA
    855          
    856          /*********************************************************************
    857           * Semi-Precision fuctions
    858           */
    859          
    860          #if ( AF_FLOAT_SUPPORT )
    861          /*********************************************************************
    862           * @fn      afCnvtSP_uint16
    863           *
    864           * @brief   Converts uint16 to semi-precision structure format
    865           *
    866           * @param   sp - semi-precision structure format
    867           *
    868           * @return  16 bit value for semiprecision.
    869           */
    870          uint16 afCnvtSP_uint16( afSemiPrecision_t sp )
    871          {
    872            return ( ((sp.sign & 0x0001) << 15)
    873                        | ((sp.exponent & 0x001F) << 10)
    874                        | (sp.mantissa & 0x03FF) );
    875          }
    876          
    877          /*********************************************************************
    878           * @fn      afCnvtuint16_SP
    879           *
    880           * @brief   Converts uint16 to semi-precision structure format
    881           *
    882           * @param   rawSP - Raw representation of SemiPrecision
    883           *
    884           * @return  SemiPrecision conversion.
    885           */
    886          afSemiPrecision_t afCnvtuint16_SP( uint16 rawSP )
    887          {
    888            afSemiPrecision_t sp = {0,0,0};
    889          
    890            sp.sign = ((rawSP >> 15) & 0x0001);
    891            sp.exponent = ((rawSP >> 10) & 0x001F);
    892            sp.mantissa = (rawSP & 0x03FF);
    893            return ( sp );
    894          }
    895          
    896          /*********************************************************************
    897           * @fn      afCnvtFloat_SP
    898           *
    899           * @brief   Converts float to semi-precision structure format
    900           *
    901           * @param   f - float value to convert from
    902           *
    903           * NOTE: This function will convert to the closest possible
    904           *       representation in a 16 bit format.  Meaning that
    905           *       the number may not be exact.  For example, 10.7 will
    906           *       convert to 10.69531, because .7 is a repeating binary
    907           *       number.  The mantissa for afSemiPrecision_t is 10 bits
    908           *       and .69531 is the 10 bit representative of .7.
    909           *
    910           * @return  SemiPrecision conversion.
    911           */
    912          afSemiPrecision_t afCnvtFloat_SP( float f )
    913          {
    914            afSemiPrecision_t sp = {0,0,0};
    915            unsigned long mantissa;
    916            unsigned int oldexp;
    917            int tempexp;
    918            float calcMant;
    919            unsigned long *uf;
    920          
    921            if ( f < 0 )
    922            {
    923              sp.sign = 1;
    924              f = f * -1;
    925            }
    926            else
    927              sp.sign = 0;
    928          
    929            if ( f == 0 )
    930            {
    931              sp.exponent = (unsigned int)0;
    932              sp.mantissa = (unsigned int)0;
    933            }
    934            else
    935            {
    936              uf = (void*)&f;
    937          
    938              mantissa = *uf & 0x7fffff;
    939              oldexp = (unsigned int)((*uf >> 23) & 0xff);
    940              tempexp = oldexp - 127;
    941          
    942              calcMant = (float)((float)(mantissa) / (float)(0x800000));
    943              mantissa = (unsigned long)(calcMant * 1024);
    944          
    945              sp.exponent = (unsigned int)(tempexp + 15);
    946              sp.mantissa = (unsigned int)(mantissa);
    947            }
    948          
    949            return ( sp );
    950          }
    951          
    952          /*********************************************************************
    953           * @fn      afCnvtSP_Float
    954           *
    955           * @brief   Converts semi-precision structure format to float
    956           *
    957           * @param   sp - afSemiPrecision format to convert from
    958           *
    959           * @return  float
    960           */
    961          float afCnvtSP_Float( afSemiPrecision_t sp )
    962          {
    963            float a, b, c;
    964          
    965            if ( sp.exponent == 0 && sp.mantissa == 0 )
    966            {
    967              a = 0;
    968              b = 0;
    969            }
    970            else
    971            {
    972              a = (float)((float)1 + (float)((float)(sp.mantissa)/1024));
    973          
    974          #if defined( __MWERKS__ )
    975              b = powf( 2.0, (float)((float)sp.exponent - 15.0) );
    976          #else
    977              b = (float)pow( 2.0, sp.exponent - 15 );
    978          #endif
    979            }
    980          
    981            if ( sp.sign )
    982              c = a * b * -1;
    983            else
    984              c = a * b;
    985          
    986            return ( c );
    987          }
    988          #endif
    989          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    990          void afCopyAddress ( afAddrType_t *afAddr, zAddrType_t *zAddr )
   \                     afCopyAddress:
    991          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    992            afAddr->addrMode = (afAddrMode_t)zAddr->addrMode;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   E0           MOVX    A,@DPTR
   \   000012   8A82         MOV     DPL,R2
   \   000014   8B83         MOV     DPH,R3
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   F0           MOVX    @DPTR,A
    993            afAddr->addr.shortAddr = zAddr->addr.shortAddr;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F8           MOV     R0,A
   \   00001F   A3           INC     DPTR
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F9           MOV     R1,A
   \   000022   8A82         MOV     DPL,R2
   \   000024   8B83         MOV     DPH,R3
   \   000026   E8           MOV     A,R0
   \   000027   F0           MOVX    @DPTR,A
   \   000028   A3           INC     DPTR
   \   000029   E9           MOV     A,R1
   \   00002A   F0           MOVX    @DPTR,A
    994          }
   \   00002B   7F01         MOV     R7,#0x1
   \   00002D   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afRegisterExtended?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afRegisterExtended

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afRegister?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afRegister

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afDataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afDataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afIncomingData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afIncomingData

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afBuildMSGIncoming?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afBuildMSGIncoming

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AF_DataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AF_DataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afFindEndPointDescList?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afFindEndPointDescList

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afFindEndPointDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afFindEndPointDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afFindSimpleDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afFindSimpleDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afGetDescCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afGetDescCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afDataReqMTU?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afDataReqMTU

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afGetMatch?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afGetMatch

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afSetMatch?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afSetMatch

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afNumEndPoints?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afNumEndPoints

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afEndPoints?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afEndPoints

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??afCopyAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    afCopyAddress
    995          
    996          /*********************************************************************
    997          *********************************************************************/
    998          

   Maximum stack usage in bytes:

     Function                      ISTACK PSTACK XSTACK
     --------                      ------ ------ ------
     AF_DataRequest                    1      0     55
       -> NLME_IsAddressBroadcast      0      0     92
       -> afGetDescCB                  0      0     92
       -> osal_mem_free                0      0     92
       -> afDataReqMTU                 0      0     92
       -> APSDE_DataReq                0      0     92
       -> NLME_GetShortAddr            0      0     92
       -> afDataConfirm                0      0     92
     afBuildMSGIncoming                1      0     57
       -> osal_msg_allocate            0      0     42
       -> afCopyAddress                0      0     42
       -> osal_memcpy                  0      0     48
       -> osal_msg_send                0      0     42
     afCopyAddress                     1      0     30
     afDataConfirm                     1      0     62
       -> afFindEndPointDesc           0      0     32
       -> osal_msg_allocate            0      0     32
       -> osal_msg_send                0      0     32
     afDataReqMTU                      0      0     56
       -> APSDE_DataReqMTU             0      0     20
     afEndPoints                       1      0      9
     afFindEndPointDesc                0      0     38
       -> afFindEndPointDescList       0      0     24
     afFindEndPointDescList            2      0     26
     afFindSimpleDesc                  0      0     14
       -> afFindEndPointDescList       0      0     28
     afGetDescCB                       2      0     46
     afGetMatch                        0      0     12
       -> afFindEndPointDescList       0      0     24
     afIncomingData                    1      0     38
       -> aps_FindGroupForEndpoint     0      0     52
       -> afFindEndPointDesc           0      0     52
       -> afFindEndPointDescList       0      0     52
       -> afFindEndPointDesc           0      0     52
       -> afFindEndPointDescList       0      0     52
       -> osal_mem_free                0      0     52
       -> afBuildMSGIncoming           0      0     66
       -> aps_FindGroupForEndpoint     0      0     52
       -> afFindEndPointDesc           0      0     52
       -> afFindEndPointDescList       0      0     52
     afInit                            2      0      0
     afNumEndPoints                    2      0      0
     afRegister                        0      0     12
       -> afRegisterExtended           0      0     24
     afRegisterExtended                1      0     28
       -> osal_mem_alloc               0      0     32
     afSetMatch                        0      0     12
       -> afFindEndPointDescList       0      0     24


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     epList                            2
     afInit                           21
     afRegisterExtended              194
     afRegister                       47
     afDataConfirm                   126
     afIncomingData                  870
     afBuildMSGIncoming              565
     AF_DataRequest                  820
     afFindEndPointDescList           75
     afFindEndPointDesc               50
     afFindSimpleDesc                146
     afGetDescCB                      92
     afDataReqMTU                     51
     afGetMatch                       56
     afSetMatch                       69
     afNumEndPoints                   52
     afEndPoints                      85
     afCopyAddress                    48
     ??afInit?relay                    6
     ??afRegisterExtended?relay        6
     ??afRegister?relay                6
     ??afDataConfirm?relay             6
     ??afIncomingData?relay            6
     ??afBuildMSGIncoming?relay        6
     ??AF_DataRequest?relay            6
     ??afFindEndPointDescList?relay    6
     ??afFindEndPointDesc?relay        6
     ??afFindSimpleDesc?relay          6
     ??afGetDescCB?relay               6
     ??afDataReqMTU?relay              6
     ??afGetMatch?relay                6
     ??afSetMatch?relay                6
     ??afNumEndPoints?relay            6
     ??afEndPoints?relay               6
     ??afCopyAddress?relay             6

 
 3 367 bytes in segment BANKED_CODE
   102 bytes in segment BANK_RELAYS
     2 bytes in segment XDATA_Z
 
 3 469 bytes of CODE  memory
     2 bytes of XDATA memory

Errors: none
Warnings: none
