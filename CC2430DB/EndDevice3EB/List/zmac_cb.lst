###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    03/Apr/2013  14:45:16 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \zmac\f8w\zmac_cb.c                                #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\..\..\..\Tools\CC2430DB\f8wEndev.cfg"   #
#                          (-DCPU32MHZ -DFORCE_MAC_NEAR -DROOT=__near_func    #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\..\..\..\Tools\CC2430DB\f8wConfig.cfg"  #
#                          (-DSECURE=0 -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\zmac\f8w #
#                          \zmac_cb.c" -D CC2430EB -D AXD_END -D AXD_END_C    #
#                          -D NWK_AUTO_POLL -D REFLECTOR -D xZTOOL_P1 -D      #
#                          xMT_TASK -D xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG   #
#                          -D xPOWER_SAVING -lC "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\EndDevice3EB\List\" -lA "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\EndDevice3EB\List\" --diag_suppress     #
#                          Pe001,Pa010 --diag_remark pe550 -o "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\EndDevice3EB\Obj\" -e                   #
#                          --require_prototypes -z2 --no_cse --no_unroll      #
#                          --no_inline --no_code_motion --no_tbaa --debug     #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data --nr_virtual_regs 8  #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\" -I "C:\Texas                          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\..\SOURCE\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\..\Drivers\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\..\..\..\ZMAIN\TI2430DB\" -I "C:\Texas  #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345 -                       #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\MT\" -I       #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345 -             #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\" #
#                           -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Proje #
#                          cts\zstack\Samples\cc2430-zstack-adxl345 -         #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC #
#                          2430EB\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2 #
#                          .1\Projects\zstack\Samples\cc2430-zstack-adxl345   #
#                          - 2\CC2430DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CC #
#                          SOC\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\ #
#                          Projects\zstack\Samples\cc2430-zstack-adxl345 -    #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\ #
#                          " -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Proj #
#                          ects\zstack\Samples\cc2430-zstack-adxl345 -        #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\STACK\AF\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\STACK\NWK\"   #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\STACK\SEC\"   #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\STACK\SYS\"   #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\"   #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345 -          #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\ZMAC\" -I     #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345 -             #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\SERVICES\SADD #
#                          R\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Pr #
#                          ojects\zstack\Samples\cc2430-zstack-adxl345 -      #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\SERVICES\SDAT #
#                          A\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Pr #
#                          ojects\zstack\Samples\cc2430-zstack-adxl345 -      #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\" #
#                           -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Proje #
#                          cts\zstack\Samples\cc2430-zstack-adxl345 -         #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVE #
#                          L\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Pr #
#                          ojects\zstack\Samples\cc2430-zstack-adxl345 -      #
#                          2\CC2430DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL #
#                          \SRF03\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2 #
#                          .1\Projects\zstack\Samples\cc2430-zstack-adxl345   #
#                          - 2\CC2430DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEV #
#                          EL\SRF03\SINGLE_CHIP\" -I "C:\Program Files\IAR    #
#                          Systems\Embedded Workbench 4.0 Evaluation          #
#                          version\8051\INC\" -I "C:\Program Files\IAR        #
#                          Systems\Embedded Workbench 4.0 Evaluation          #
#                          version\8051\INC\CLIB\"                            #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345 -              #
#                          2\CC2430DB\EndDevice3EB\List\zmac_cb.lst           #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345 -              #
#                          2\CC2430DB\EndDevice3EB\Obj\zmac_cb.r51            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\zmac\f8w\zmac_cb.c
      1          /**************************************************************************************************
      2            Filename:       zmac_cb.c
      3            Revised:        $Date: 2007-10-28 18:43:04 -0700 (Sun, 28 Oct 2007) $
      4            Revision:       $Revision: 15800 $
      5          
      6            Description:    This file contains the NWK functions that the ZMAC calls
      7          
      8          
      9            Copyright 2005-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /********************************************************************************************************
     41           *                                               INCLUDES
     42           ********************************************************************************************************/
     43          #include "ZComDef.h"
     44          #include "OSAL.h"
     45          #include "ZMAC.h"
     46          #include "MT_MAC.h"
     47          
     48          #if !defined NONWK
     49          #include "nwk.h"
     50          #include "nwk_bufs.h"
     51          #endif
     52          
     53          #if defined( MACSIM )
     54            #include "mac_sim.h"
     55          #endif
     56          
     57          extern void *ZMac_ScanBuf;
     58          
     59          /********************************************************************************************************
     60           *                                                 MACROS
     61           ********************************************************************************************************/
     62          
     63          #define ZMAC_EVENT_ID           0x00
     64          #define ZMAC_EVENT_STATUS       0x01
     65          
     66          /********************************************************************************************************
     67           *                                               CONSTANTS
     68           ********************************************************************************************************/
     69          
     70          #if !defined NONWK
     71          
     72          #define INVALID_SHORT_ADDR    0xFFFE
     73          #define BROADCAST_ADDR        0xFFFF
     74          
     75          /* Lookup table for size of structures. Must match with the order of MAC callback events */

   \                                 In  segment CODE_C, align 1
     76          const uint8 CODE zmacCBSizeTable [] = {
   \                     zmacCBSizeTable:
   \   000000   00160F16     DB 0, 22, 15, 22, 13, 11, 21, 11, 2, 17, 2, 34, 11, 48, 3, 0, 6
   \            0D0B150B
   \            02110222
   \            0B300300
   \            06      
     77            0,
     78            sizeof (ZMacAssociateInd_t),
     79            sizeof (ZMacAssociateCnf_t),
     80            sizeof (ZMacDisassociateInd_t),
     81            sizeof (ZMacDisassociateCnf_t),
     82            sizeof (ZMacBeaconNotifyInd_t) ,
     83            /*  0, // sizeof (ZMacGTSInd_t), */
     84            /*  0, // sizeof (ZMacGTSCnf_t), */
     85            sizeof (ZMacOrphanInd_t),
     86            sizeof (ZMacScanCnf_t),
     87            sizeof (ZMacStartCnf_t),
     88            sizeof (ZMacSyncLossInd_t),
     89            sizeof (ZMacPollCnf_t),
     90            sizeof (ZMacCommStatusInd_t),
     91            /*  0, // sizeof (ZMacRxEnableCnf_t), */
     92            sizeof (ZMacDataCnf_t),
     93            sizeof (ZMacDataInd_t),
     94            sizeof (ZMacPurgeCnf_t),
     95            0,
     96            sizeof (ZMacPollInd_t)
     97          };
     98          
     99          uint16 getZMacDynamicSize(uint8 event, macCbackEvent_t *pData);

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    100          uint16 getZMacDynamicSize(uint8 event, macCbackEvent_t *pData)
   \                     getZMacDynamicSize:
    101          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FC           MOV     R4,A
   \   000006   EA           MOV     A,R2
   \   000007   F8           MOV     R0,A
   \   000008   EB           MOV     A,R3
   \   000009   F9           MOV     R1,A
    102            switch(event)
   \   00000A   EC           MOV     A,R4
   \   00000B   12....       LCALL   ?UC_SWITCH_DENSE
   \                     `?<Jumptable for getZMacDynamicSize>_0`:
   \   00000E   05           DB        5
   \   00000F   02           DB        2
   \   000010   ....         DW        ??getZMacDynamicSize_0
   \   000012   ....         DW        ??getZMacDynamicSize_1
   \   000014   ....         DW        ??getZMacDynamicSize_0
   \   000016   ....         DW        ??getZMacDynamicSize_2
    103            {
    104            case MAC_MLME_BEACON_NOTIFY_IND:
    105              return sizeof(macPanDesc_t) + pData->beaconNotifyInd.sduLength;
   \                     ??getZMacDynamicSize_1:
   \   000018   8882         MOV     DPL,R0
   \   00001A   8983         MOV     DPH,R1
   \   00001C   A3           INC     DPTR
   \   00001D   A3           INC     DPTR
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F8           MOV     R0,A
   \   000026   7900         MOV     R1,#0x0
   \   000028   7421         MOV     A,#0x21
   \   00002A   28           ADD     A,R0
   \   00002B   FA           MOV     R2,A
   \   00002C   7400         MOV     A,#0x0
   \   00002E   39           ADDC    A,R1
   \   00002F   FB           MOV     R3,A
   \   000030   803A         SJMP    ??getZMacDynamicSize_3
    106            case MAC_MLME_SCAN_CNF:
    107              if (pData->scanCnf.scanType == ZMAC_ED_SCAN)
   \                     ??getZMacDynamicSize_2:
   \   000032   8882         MOV     DPL,R0
   \   000034   8983         MOV     DPH,R1
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   E0           MOVX    A,@DPTR
   \   000039   7006         JNZ     ??getZMacDynamicSize_4
    108                return ZMAC_ED_SCAN_MAXCHANNELS;
   \   00003B   7A1B         MOV     R2,#0x1b
   \   00003D   7B00         MOV     R3,#0x0
   \   00003F   802B         SJMP    ??getZMacDynamicSize_3
    109              else
    110                return sizeof( ZMacPanDesc_t ) * pData->scanCnf.resultListSize;
   \                     ??getZMacDynamicSize_4:
   \   000041   8882         MOV     DPL,R0
   \   000043   8983         MOV     DPH,R1
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   A3           INC     DPTR
   \   00004C   A3           INC     DPTR
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   FA           MOV     R2,A
   \   00004F   7B00         MOV     R3,#0x0
   \   000051   EA           MOV     A,R2
   \   000052   75F021       MOV     B,#0x21
   \   000055   A4           MUL     AB
   \   000056   CA           XCH     A,R2
   \   000057   ADF0         MOV     R5,B
   \   000059   75F000       MOV     B,#0x0
   \   00005C   A4           MUL     AB
   \   00005D   2D           ADD     A,R5
   \   00005E   FD           MOV     R5,A
   \   00005F   75F021       MOV     B,#0x21
   \   000062   EB           MOV     A,R3
   \   000063   A4           MUL     AB
   \   000064   2D           ADD     A,R5
   \   000065   FB           MOV     R3,A
   \   000066   8004         SJMP    ??getZMacDynamicSize_3
    111            }
    112          
    113            return 0;
   \                     ??getZMacDynamicSize_0:
   \   000068   7A00         MOV     R2,#0x0
   \   00006A   7B00         MOV     R3,#0x0
   \                     ??getZMacDynamicSize_3:
   \   00006C   D083         POP     DPH
   \   00006E   D082         POP     DPL
   \   000070   02....       LJMP    ?BRET
    114          }
    115          

   \                                 In  segment CODE_C, align 1
    116          const uint8 CODE zmacCBEventTable [] = {
   \                     zmacCBEventTable:
   \   000000   FF222324     DB 255, 34, 35, 36, 42, 38, 41, 37, 49, 50, 51, 55, 32, 33, 54, 255, 65
   \            2A262925
   \            31323337
   \            202136FF
   \            41      
    117            0xff,                         /* Unused */
    118            MACCB_ASSOCIATE_IND_CMD,      /* MAC_MLME_ASSOCIATE_IND */
    119            MACCB_ASSOCIATE_CNF_CMD,      /* MAC_MLME_ASSOCIATE_CNF */
    120            MACCB_DISASSOCIATE_IND_CMD,   /* MAC_MLME_DISASSOCIATE_IND */
    121            MACCB_DISASSOCIATE_CNF_CMD,   /* MAC_MLME_DISASSOCIATE_CNF */
    122            MACCB_BEACON_NOTIFY_IND_CMD,  /* MAC_MLME_BEACON_NOTIFY_IND */
    123            /*  0xff,  */                 /* MAC_MLME_GTS_IND */
    124            /*  0xff,  */                 /* MAC_MLME_GTS_CNF */
    125            MACCB_ORPHAN_IND_CMD,         /* MAC_MLME_ORPHAN_IND */
    126            MACCB_SCAN_CNF_CMD,           /* MAC_MLME_SCAN_CNF */
    127            MACCB_START_CNF_CMD,          /* MAC_MLME_START_CNF */
    128            MACCB_SYNC_LOSS_IND_CMD,      /* MAC_MLME_SYNC_LOSS_IND */
    129            MACCB_POLL_CNF_CMD,           /* MAC_MLME_POLL_CNF */
    130            MACCB_COMM_STATUS_IND_CMD,    /* MAC_MLME_COMM_STATUS_IND */
    131            /*  0xff,  */                 /* MAC_MLME_RX_ENABLE_CNF */
    132            MACCB_DATA_CNF_CMD,           /* MAC_MCPS_DATA_CNF */
    133            MACCB_DATA_IND_CMD,           /* MAC_MCPS_DATA_IND */
    134            MACCB_PURGE_CNF_CMD,          /* MAC_MCPS_PURGE_CNF */
    135            0xff,                         /* MAC_PWR_ON_CNF */
    136            MACCB_POLL_IND_CMD            /* MAC_MLME_POLL_IND */
    137          };
    138          
    139          #endif /* !defined NONWK */
    140          
    141          /********************************************************************************************************
    142           *                                                TYPEDEFS
    143           ********************************************************************************************************/
    144          
    145          /********************************************************************************************************
    146           *                                               GLOBALS
    147           ********************************************************************************************************/
    148          /* Send Callbacks to MT */
    149          void zmacSendMTCallback( macCbackEvent_t *pData );
    150          
    151          
    152          /********************************************************************************************************
    153           * @fn       MAC_CbackEvent()
    154           *
    155           * @brief    convert MAC data confirm and indication to ZMac and send to NWK
    156           *
    157           * @param    pData - pointer to macCbackEvent_t
    158           *
    159           * @return   none
    160           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    161          void  MAC_CbackEvent(macCbackEvent_t *pData)
   \                     MAC_CbackEvent:
    162          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 6,R2
   \   00000C   8B..         MOV     ?V0 + 7,R3
    163          #ifdef MT_MAC_CB_FUNC
    164            zmacSendMTCallback ( pData );
    165          #elif !defined NONWK
    166          
    167            uint8 macEvent = pData->hdr.event;
   \   00000E   85..82       MOV     DPL,?V0 + 6
   \   000011   85..83       MOV     DPH,?V0 + 7
   \   000014   E0           MOVX    A,@DPTR
   \   000015   FE           MOV     R6,A
    168            uint16 msgLen = zmacCBSizeTable[macEvent] + getZMacDynamicSize(macEvent, pData);
   \   000016                ; Setup parameters for call to function getZMacDynamicSize
   \   000016   AA..         MOV     R2,?V0 + 6
   \   000018   AB..         MOV     R3,?V0 + 7
   \   00001A   EE           MOV     A,R6
   \   00001B   F9           MOV     R1,A
   \   00001C   12....       LCALL   ??getZMacDynamicSize?relay
   \   00001F   8A..         MOV     ?V0 + 0,R2
   \   000021   8B..         MOV     ?V0 + 1,R3
   \   000023   A8..         MOV     R0,?V0 + 0
   \   000025   A9..         MOV     R1,?V0 + 1
   \   000027   8E..         MOV     ?V0 + 0,R6
   \   000029   75..00       MOV     ?V0 + 1,#0x0
   \   00002C   E5..         MOV     A,?V0 + 0
   \   00002E   24..         ADD     A,#(zmacCBSizeTable & 0xff)
   \   000030   F582         MOV     DPL,A
   \   000032   E5..         MOV     A,?V0 + 1
   \   000034   34..         ADDC    A,#((zmacCBSizeTable >> 8) & 0xff)
   \   000036   F583         MOV     DPH,A
   \   000038   E4           CLR     A
   \   000039   93           MOVC    A,@A+DPTR
   \   00003A   FA           MOV     R2,A
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   E8           MOV     A,R0
   \   00003E   2A           ADD     A,R2
   \   00003F   F8           MOV     R0,A
   \   000040   E9           MOV     A,R1
   \   000041   3B           ADDC    A,R3
   \   000042   F9           MOV     R1,A
   \   000043   7405         MOV     A,#0x5
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   E8           MOV     A,R0
   \   000049   F0           MOVX    @DPTR,A
   \   00004A   A3           INC     DPTR
   \   00004B   E9           MOV     A,R1
   \   00004C   F0           MOVX    @DPTR,A
    169            macCbackEvent_t *msgPtr;
    170          
    171            /* Allocate osal msg buffer */
    172            if (msgLen > 0)
   \   00004D   7405         MOV     A,#0x5
   \   00004F   12....       LCALL   ?XSTACK_DISP0_8
   \   000052   E0           MOVX    A,@DPTR
   \   000053   6400         XRL     A,#0x0
   \   000055   7004         JNZ     ??MAC_CbackEvent_0
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   6400         XRL     A,#0x0
   \                     ??MAC_CbackEvent_0:
   \   00005B   7003         JNZ     $+5
   \   00005D   02....       LJMP    ??MAC_CbackEvent_1 & 0xFFFF
    173            {
    174              if (macEvent == MAC_MCPS_DATA_IND)
   \   000060   740D         MOV     A,#0xd
   \   000062   6E           XRL     A,R6
   \   000063   700F         JNZ     ??MAC_CbackEvent_2
    175                msgPtr = pData;
   \   000065   85..82       MOV     DPL,?XSP + 0
   \   000068   85..83       MOV     DPH,?XSP + 1
   \   00006B   E5..         MOV     A,?V0 + 6
   \   00006D   F0           MOVX    @DPTR,A
   \   00006E   A3           INC     DPTR
   \   00006F   E5..         MOV     A,?V0 + 7
   \   000071   F0           MOVX    @DPTR,A
   \   000072   802E         SJMP    ??MAC_CbackEvent_3
    176              else
    177              {
    178                if ( macEvent == MAC_MCPS_DATA_CNF )
   \                     ??MAC_CbackEvent_2:
   \   000074   740C         MOV     A,#0xc
   \   000076   6E           XRL     A,R6
   \   000077   7011         JNZ     ??MAC_CbackEvent_4
    179                {
    180                  osal_msg_deallocate( (uint8*)pData->dataCnf.pDataReq );
   \   000079                ; Setup parameters for call to function osal_msg_deallocate
   \   000079   85..82       MOV     DPL,?V0 + 6
   \   00007C   85..83       MOV     DPH,?V0 + 7
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   E0           MOVX    A,@DPTR
   \   000083   FA           MOV     R2,A
   \   000084   A3           INC     DPTR
   \   000085   E0           MOVX    A,@DPTR
   \   000086   FB           MOV     R3,A
   \   000087   12....       LCALL   ??osal_msg_deallocate?relay
    181                }
    182                msgPtr = (macCbackEvent_t *)osal_msg_allocate(msgLen);
   \                     ??MAC_CbackEvent_4:
   \   00008A                ; Setup parameters for call to function osal_msg_allocate
   \   00008A   7405         MOV     A,#0x5
   \   00008C   12....       LCALL   ?XSTACK_DISP0_8
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   FA           MOV     R2,A
   \   000091   A3           INC     DPTR
   \   000092   E0           MOVX    A,@DPTR
   \   000093   FB           MOV     R3,A
   \   000094   12....       LCALL   ??osal_msg_allocate?relay
   \   000097   85..82       MOV     DPL,?XSP + 0
   \   00009A   85..83       MOV     DPH,?XSP + 1
   \   00009D   EA           MOV     A,R2
   \   00009E   F0           MOVX    @DPTR,A
   \   00009F   A3           INC     DPTR
   \   0000A0   EB           MOV     A,R3
   \   0000A1   F0           MOVX    @DPTR,A
    183              }
    184          
    185              if (msgPtr)
   \                     ??MAC_CbackEvent_3:
   \   0000A2   85..82       MOV     DPL,?XSP + 0
   \   0000A5   85..83       MOV     DPH,?XSP + 1
   \   0000A8   E0           MOVX    A,@DPTR
   \   0000A9   6400         XRL     A,#0x0
   \   0000AB   7004         JNZ     ??MAC_CbackEvent_5
   \   0000AD   A3           INC     DPTR
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   6400         XRL     A,#0x0
   \                     ??MAC_CbackEvent_5:
   \   0000B1   7003         JNZ     $+5
   \   0000B3   02....       LJMP    ??MAC_CbackEvent_1 & 0xFFFF
    186              {
    187                if (macEvent != MAC_MCPS_DATA_IND)
   \   0000B6   740D         MOV     A,#0xd
   \   0000B8   6E           XRL     A,R6
   \   0000B9   6039         JZ      ??MAC_CbackEvent_6
    188                  osal_memcpy(msgPtr, pData, zmacCBSizeTable[macEvent]);
   \   0000BB                ; Setup parameters for call to function osal_memcpy
   \   0000BB   85....       MOV     ?V0 + 0,?V0 + 6
   \   0000BE   85....       MOV     ?V0 + 1,?V0 + 7
   \   0000C1   75..00       MOV     ?V0 + 2,#0x0
   \   0000C4   78..         MOV     R0,#?V0 + 0
   \   0000C6   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000C9   8E..         MOV     ?V0 + 0,R6
   \   0000CB   75..00       MOV     ?V0 + 1,#0x0
   \   0000CE   E5..         MOV     A,?V0 + 0
   \   0000D0   24..         ADD     A,#(zmacCBSizeTable & 0xff)
   \   0000D2   F582         MOV     DPL,A
   \   0000D4   E5..         MOV     A,?V0 + 1
   \   0000D6   34..         ADDC    A,#((zmacCBSizeTable >> 8) & 0xff)
   \   0000D8   F583         MOV     DPH,A
   \   0000DA   E4           CLR     A
   \   0000DB   93           MOVC    A,@A+DPTR
   \   0000DC   F5..         MOV     ?V0 + 0,A
   \   0000DE   AC..         MOV     R4,?V0 + 0
   \   0000E0   7D00         MOV     R5,#0x0
   \   0000E2   7403         MOV     A,#0x3
   \   0000E4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   FA           MOV     R2,A
   \   0000E9   A3           INC     DPTR
   \   0000EA   E0           MOVX    A,@DPTR
   \   0000EB   FB           MOV     R3,A
   \   0000EC   12....       LCALL   ??osal_memcpy?relay
   \   0000EF   7403         MOV     A,#0x3
   \   0000F1   12....       LCALL   ?DEALLOC_XSTACK8
    189          
    190                switch (macEvent) {
   \                     ??MAC_CbackEvent_6:
   \   0000F4   EE           MOV     A,R6
   \   0000F5   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for MAC_CbackEvent>_0`:
   \   0000F8   00           DB        0
   \   0000F9   04           DB        4
   \   0000FA   05           DB        5
   \   0000FB   ....         DW        ??MAC_CbackEvent_7
   \   0000FD   07           DB        7
   \   0000FE   ....         DW        ??MAC_CbackEvent_8
   \   000100   08           DB        8
   \   000101   ....         DW        ??MAC_CbackEvent_9
   \   000103   0D           DB        13
   \   000104   ....         DW        ??MAC_CbackEvent_10
   \   000106   ....         DW        ??MAC_CbackEvent_11
    191                case MAC_MLME_BEACON_NOTIFY_IND:
    192                  {
    193                    macMlmeBeaconNotifyInd_t *pBeacon;
    194          
    195                    pBeacon = (macMlmeBeaconNotifyInd_t*)msgPtr;
   \                     ??MAC_CbackEvent_7:
   \   000108   85..82       MOV     DPL,?XSP + 0
   \   00010B   85..83       MOV     DPH,?XSP + 1
   \   00010E   E0           MOVX    A,@DPTR
   \   00010F   F8           MOV     R0,A
   \   000110   A3           INC     DPTR
   \   000111   E0           MOVX    A,@DPTR
   \   000112   F9           MOV     R1,A
   \   000113   88..         MOV     ?V0 + 4,R0
   \   000115   89..         MOV     ?V0 + 5,R1
    196          
    197                    osal_memcpy(pBeacon + 1, pBeacon->pPanDesc, sizeof(macPanDesc_t));
   \   000117                ; Setup parameters for call to function osal_memcpy
   \   000117   85..82       MOV     DPL,?V0 + 4
   \   00011A   85..83       MOV     DPH,?V0 + 5
   \   00011D   A3           INC     DPTR
   \   00011E   A3           INC     DPTR
   \   00011F   A3           INC     DPTR
   \   000120   E0           MOVX    A,@DPTR
   \   000121   F5..         MOV     ?V0 + 0,A
   \   000123   A3           INC     DPTR
   \   000124   E0           MOVX    A,@DPTR
   \   000125   F5..         MOV     ?V0 + 1,A
   \   000127   75..00       MOV     ?V0 + 2,#0x0
   \   00012A   78..         MOV     R0,#?V0 + 0
   \   00012C   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00012F   7C21         MOV     R4,#0x21
   \   000131   7D00         MOV     R5,#0x0
   \   000133   E5..         MOV     A,?V0 + 4
   \   000135   240B         ADD     A,#0xb
   \   000137   FA           MOV     R2,A
   \   000138   E5..         MOV     A,?V0 + 5
   \   00013A   3400         ADDC    A,#0x0
   \   00013C   FB           MOV     R3,A
   \   00013D   12....       LCALL   ??osal_memcpy?relay
   \   000140   7403         MOV     A,#0x3
   \   000142   12....       LCALL   ?DEALLOC_XSTACK8
    198                    pBeacon->pPanDesc = (macPanDesc_t *) (pBeacon + 1);
   \   000145   E5..         MOV     A,?V0 + 4
   \   000147   240B         ADD     A,#0xb
   \   000149   F8           MOV     R0,A
   \   00014A   E5..         MOV     A,?V0 + 5
   \   00014C   3400         ADDC    A,#0x0
   \   00014E   F9           MOV     R1,A
   \   00014F   85..82       MOV     DPL,?V0 + 4
   \   000152   85..83       MOV     DPH,?V0 + 5
   \   000155   A3           INC     DPTR
   \   000156   A3           INC     DPTR
   \   000157   A3           INC     DPTR
   \   000158   E8           MOV     A,R0
   \   000159   F0           MOVX    @DPTR,A
   \   00015A   A3           INC     DPTR
   \   00015B   E9           MOV     A,R1
   \   00015C   F0           MOVX    @DPTR,A
    199                    osal_memcpy(pBeacon->pPanDesc + 1, pBeacon->pSdu, pBeacon->sduLength);
   \   00015D                ; Setup parameters for call to function osal_memcpy
   \   00015D   85..82       MOV     DPL,?V0 + 4
   \   000160   85..83       MOV     DPH,?V0 + 5
   \   000163   A3           INC     DPTR
   \   000164   A3           INC     DPTR
   \   000165   A3           INC     DPTR
   \   000166   A3           INC     DPTR
   \   000167   A3           INC     DPTR
   \   000168   A3           INC     DPTR
   \   000169   A3           INC     DPTR
   \   00016A   A3           INC     DPTR
   \   00016B   A3           INC     DPTR
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   F5..         MOV     ?V0 + 0,A
   \   00016F   A3           INC     DPTR
   \   000170   E0           MOVX    A,@DPTR
   \   000171   F5..         MOV     ?V0 + 1,A
   \   000173   75..00       MOV     ?V0 + 2,#0x0
   \   000176   78..         MOV     R0,#?V0 + 0
   \   000178   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00017B   85..82       MOV     DPL,?V0 + 4
   \   00017E   85..83       MOV     DPH,?V0 + 5
   \   000181   A3           INC     DPTR
   \   000182   A3           INC     DPTR
   \   000183   A3           INC     DPTR
   \   000184   A3           INC     DPTR
   \   000185   A3           INC     DPTR
   \   000186   A3           INC     DPTR
   \   000187   A3           INC     DPTR
   \   000188   A3           INC     DPTR
   \   000189   E0           MOVX    A,@DPTR
   \   00018A   F5..         MOV     ?V0 + 0,A
   \   00018C   AC..         MOV     R4,?V0 + 0
   \   00018E   7D00         MOV     R5,#0x0
   \   000190   85..82       MOV     DPL,?V0 + 4
   \   000193   85..83       MOV     DPH,?V0 + 5
   \   000196   A3           INC     DPTR
   \   000197   A3           INC     DPTR
   \   000198   A3           INC     DPTR
   \   000199   E0           MOVX    A,@DPTR
   \   00019A   2421         ADD     A,#0x21
   \   00019C   FA           MOV     R2,A
   \   00019D   A3           INC     DPTR
   \   00019E   E0           MOVX    A,@DPTR
   \   00019F   3400         ADDC    A,#0x0
   \   0001A1   FB           MOV     R3,A
   \   0001A2   12....       LCALL   ??osal_memcpy?relay
   \   0001A5   7403         MOV     A,#0x3
   \   0001A7   12....       LCALL   ?DEALLOC_XSTACK8
    200                    pBeacon->pSdu = (uint8 *) (pBeacon->pPanDesc + 1);
   \   0001AA   85..82       MOV     DPL,?V0 + 4
   \   0001AD   85..83       MOV     DPH,?V0 + 5
   \   0001B0   A3           INC     DPTR
   \   0001B1   A3           INC     DPTR
   \   0001B2   A3           INC     DPTR
   \   0001B3   E0           MOVX    A,@DPTR
   \   0001B4   2421         ADD     A,#0x21
   \   0001B6   F8           MOV     R0,A
   \   0001B7   A3           INC     DPTR
   \   0001B8   E0           MOVX    A,@DPTR
   \   0001B9   3400         ADDC    A,#0x0
   \   0001BB   F9           MOV     R1,A
   \   0001BC   85..82       MOV     DPL,?V0 + 4
   \   0001BF   85..83       MOV     DPH,?V0 + 5
   \   0001C2   A3           INC     DPTR
   \   0001C3   A3           INC     DPTR
   \   0001C4   A3           INC     DPTR
   \   0001C5   A3           INC     DPTR
   \   0001C6   A3           INC     DPTR
   \   0001C7   A3           INC     DPTR
   \   0001C8   A3           INC     DPTR
   \   0001C9   A3           INC     DPTR
   \   0001CA   A3           INC     DPTR
   \   0001CB   E8           MOV     A,R0
   \   0001CC   F0           MOVX    @DPTR,A
   \   0001CD   A3           INC     DPTR
   \   0001CE   E9           MOV     A,R1
   \   0001CF   F0           MOVX    @DPTR,A
   \   0001D0   02....       LJMP    ??MAC_CbackEvent_11 & 0xFFFF
    201                  }
    202                  break;
    203          
    204                case MAC_MLME_SCAN_CNF:
    205                  {
    206                    macMlmeScanCnf_t *pScan = (macMlmeScanCnf_t*)msgPtr;
   \                     ??MAC_CbackEvent_8:
   \   0001D3   85..82       MOV     DPL,?XSP + 0
   \   0001D6   85..83       MOV     DPH,?XSP + 1
   \   0001D9   E0           MOVX    A,@DPTR
   \   0001DA   F8           MOV     R0,A
   \   0001DB   A3           INC     DPTR
   \   0001DC   E0           MOVX    A,@DPTR
   \   0001DD   F9           MOV     R1,A
   \   0001DE   88..         MOV     ?V0 + 4,R0
   \   0001E0   89..         MOV     ?V0 + 5,R1
    207          
    208                    if (ZMac_ScanBuf != NULL)
   \   0001E2   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0001E5   E0           MOVX    A,@DPTR
   \   0001E6   6400         XRL     A,#0x0
   \   0001E8   7004         JNZ     ??MAC_CbackEvent_12
   \   0001EA   A3           INC     DPTR
   \   0001EB   E0           MOVX    A,@DPTR
   \   0001EC   6400         XRL     A,#0x0
   \                     ??MAC_CbackEvent_12:
   \   0001EE   7003         JNZ     $+5
   \   0001F0   02....       LJMP    ??MAC_CbackEvent_11 & 0xFFFF
    209                    {
    210                      if (pScan->scanType == ZMAC_ED_SCAN)
   \   0001F3   85..82       MOV     DPL,?V0 + 4
   \   0001F6   85..83       MOV     DPH,?V0 + 5
   \   0001F9   A3           INC     DPTR
   \   0001FA   A3           INC     DPTR
   \   0001FB   E0           MOVX    A,@DPTR
   \   0001FC   7052         JNZ     ??MAC_CbackEvent_13
    211                      {
    212                        pScan->result.pEnergyDetect = (uint8*) (pScan + 1);
   \   0001FE   E5..         MOV     A,?V0 + 4
   \   000200   240B         ADD     A,#0xb
   \   000202   F8           MOV     R0,A
   \   000203   E5..         MOV     A,?V0 + 5
   \   000205   3400         ADDC    A,#0x0
   \   000207   F9           MOV     R1,A
   \   000208   85..82       MOV     DPL,?V0 + 4
   \   00020B   85..83       MOV     DPH,?V0 + 5
   \   00020E   A3           INC     DPTR
   \   00020F   A3           INC     DPTR
   \   000210   A3           INC     DPTR
   \   000211   A3           INC     DPTR
   \   000212   A3           INC     DPTR
   \   000213   A3           INC     DPTR
   \   000214   A3           INC     DPTR
   \   000215   A3           INC     DPTR
   \   000216   A3           INC     DPTR
   \   000217   E8           MOV     A,R0
   \   000218   F0           MOVX    @DPTR,A
   \   000219   A3           INC     DPTR
   \   00021A   E9           MOV     A,R1
   \   00021B   F0           MOVX    @DPTR,A
    213                        osal_memcpy(pScan->result.pEnergyDetect, ZMac_ScanBuf, ZMAC_ED_SCAN_MAXCHANNELS);
   \   00021C                ; Setup parameters for call to function osal_memcpy
   \   00021C   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00021F   E0           MOVX    A,@DPTR
   \   000220   F5..         MOV     ?V0 + 0,A
   \   000222   A3           INC     DPTR
   \   000223   E0           MOVX    A,@DPTR
   \   000224   F5..         MOV     ?V0 + 1,A
   \   000226   75..00       MOV     ?V0 + 2,#0x0
   \   000229   78..         MOV     R0,#?V0 + 0
   \   00022B   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00022E   7C1B         MOV     R4,#0x1b
   \   000230   7D00         MOV     R5,#0x0
   \   000232   85..82       MOV     DPL,?V0 + 4
   \   000235   85..83       MOV     DPH,?V0 + 5
   \   000238   A3           INC     DPTR
   \   000239   A3           INC     DPTR
   \   00023A   A3           INC     DPTR
   \   00023B   A3           INC     DPTR
   \   00023C   A3           INC     DPTR
   \   00023D   A3           INC     DPTR
   \   00023E   A3           INC     DPTR
   \   00023F   A3           INC     DPTR
   \   000240   A3           INC     DPTR
   \   000241   E0           MOVX    A,@DPTR
   \   000242   FA           MOV     R2,A
   \   000243   A3           INC     DPTR
   \   000244   E0           MOVX    A,@DPTR
   \   000245   FB           MOV     R3,A
   \   000246   12....       LCALL   ??osal_memcpy?relay
   \   000249   7403         MOV     A,#0x3
   \   00024B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00024E   8069         SJMP    ??MAC_CbackEvent_14
    214                      }
    215                      else
    216                      {
    217                        pScan->result.pPanDescriptor = (macPanDesc_t*) (pScan + 1);
   \                     ??MAC_CbackEvent_13:
   \   000250   E5..         MOV     A,?V0 + 4
   \   000252   240B         ADD     A,#0xb
   \   000254   F8           MOV     R0,A
   \   000255   E5..         MOV     A,?V0 + 5
   \   000257   3400         ADDC    A,#0x0
   \   000259   F9           MOV     R1,A
   \   00025A   85..82       MOV     DPL,?V0 + 4
   \   00025D   85..83       MOV     DPH,?V0 + 5
   \   000260   A3           INC     DPTR
   \   000261   A3           INC     DPTR
   \   000262   A3           INC     DPTR
   \   000263   A3           INC     DPTR
   \   000264   A3           INC     DPTR
   \   000265   A3           INC     DPTR
   \   000266   A3           INC     DPTR
   \   000267   A3           INC     DPTR
   \   000268   A3           INC     DPTR
   \   000269   E8           MOV     A,R0
   \   00026A   F0           MOVX    @DPTR,A
   \   00026B   A3           INC     DPTR
   \   00026C   E9           MOV     A,R1
   \   00026D   F0           MOVX    @DPTR,A
    218                        osal_memcpy(pScan + 1, ZMac_ScanBuf, sizeof( ZMacPanDesc_t ) * pScan->resultListSize);
   \   00026E                ; Setup parameters for call to function osal_memcpy
   \   00026E   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000271   E0           MOVX    A,@DPTR
   \   000272   F5..         MOV     ?V0 + 0,A
   \   000274   A3           INC     DPTR
   \   000275   E0           MOVX    A,@DPTR
   \   000276   F5..         MOV     ?V0 + 1,A
   \   000278   75..00       MOV     ?V0 + 2,#0x0
   \   00027B   78..         MOV     R0,#?V0 + 0
   \   00027D   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000280   85..82       MOV     DPL,?V0 + 4
   \   000283   85..83       MOV     DPH,?V0 + 5
   \   000286   A3           INC     DPTR
   \   000287   A3           INC     DPTR
   \   000288   A3           INC     DPTR
   \   000289   A3           INC     DPTR
   \   00028A   A3           INC     DPTR
   \   00028B   A3           INC     DPTR
   \   00028C   A3           INC     DPTR
   \   00028D   A3           INC     DPTR
   \   00028E   E0           MOVX    A,@DPTR
   \   00028F   FC           MOV     R4,A
   \   000290   7D00         MOV     R5,#0x0
   \   000292   EC           MOV     A,R4
   \   000293   75F021       MOV     B,#0x21
   \   000296   A4           MUL     AB
   \   000297   CC           XCH     A,R4
   \   000298   AAF0         MOV     R2,B
   \   00029A   75F000       MOV     B,#0x0
   \   00029D   A4           MUL     AB
   \   00029E   2A           ADD     A,R2
   \   00029F   FA           MOV     R2,A
   \   0002A0   75F021       MOV     B,#0x21
   \   0002A3   ED           MOV     A,R5
   \   0002A4   A4           MUL     AB
   \   0002A5   2A           ADD     A,R2
   \   0002A6   FD           MOV     R5,A
   \   0002A7   E5..         MOV     A,?V0 + 4
   \   0002A9   240B         ADD     A,#0xb
   \   0002AB   FA           MOV     R2,A
   \   0002AC   E5..         MOV     A,?V0 + 5
   \   0002AE   3400         ADDC    A,#0x0
   \   0002B0   FB           MOV     R3,A
   \   0002B1   12....       LCALL   ??osal_memcpy?relay
   \   0002B4   7403         MOV     A,#0x3
   \   0002B6   12....       LCALL   ?DEALLOC_XSTACK8
    219                      }
    220          
    221                      osal_mem_free(ZMac_ScanBuf);
   \                     ??MAC_CbackEvent_14:
   \   0002B9                ; Setup parameters for call to function osal_mem_free
   \   0002B9   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0002BC   E0           MOVX    A,@DPTR
   \   0002BD   FA           MOV     R2,A
   \   0002BE   A3           INC     DPTR
   \   0002BF   E0           MOVX    A,@DPTR
   \   0002C0   FB           MOV     R3,A
   \   0002C1   12....       LCALL   ??osal_mem_free?relay
    222                      ZMac_ScanBuf = NULL;
   \   0002C4   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0002C7   7400         MOV     A,#0x0
   \   0002C9   F0           MOVX    @DPTR,A
   \   0002CA   A3           INC     DPTR
   \   0002CB   7400         MOV     A,#0x0
   \   0002CD   F0           MOVX    @DPTR,A
   \   0002CE   02....       LJMP    ??MAC_CbackEvent_11 & 0xFFFF
    223                    }
    224                  }
    225                  break;
    226          
    227                case MAC_MLME_START_CNF:
    228                  msgPtr->hdr.status = pData->startCnf.hdr.status;
   \                     ??MAC_CbackEvent_9:
   \   0002D1   85..82       MOV     DPL,?V0 + 6
   \   0002D4   85..83       MOV     DPH,?V0 + 7
   \   0002D7   A3           INC     DPTR
   \   0002D8   E0           MOVX    A,@DPTR
   \   0002D9   C0E0         PUSH    A
   \   0002DB   85..82       MOV     DPL,?XSP + 0
   \   0002DE   85..83       MOV     DPH,?XSP + 1
   \   0002E1   E0           MOVX    A,@DPTR
   \   0002E2   F8           MOV     R0,A
   \   0002E3   A3           INC     DPTR
   \   0002E4   E0           MOVX    A,@DPTR
   \   0002E5   F583         MOV     DPH,A
   \   0002E7   8882         MOV     DPL,R0
   \   0002E9   A3           INC     DPTR
   \   0002EA   D0E0         POP     A
   \   0002EC   F0           MOVX    @DPTR,A
   \   0002ED   02....       LJMP    ??MAC_CbackEvent_11 & 0xFFFF
    229                  break;
    230          
    231                case MAC_MCPS_DATA_IND:
    232                  {
    233                    /* Data Ind is unconventional: to save an alloc/copy, reuse the MAC
    234                       buffer and re-organize the contents into ZMAC format. */
    235                    uint16 shortAddr = INVALID_SHORT_ADDR;
   \                     ??MAC_CbackEvent_10:
   \   0002F0   7403         MOV     A,#0x3
   \   0002F2   12....       LCALL   ?XSTACK_DISP0_8
   \   0002F5   74FE         MOV     A,#-0x2
   \   0002F7   F0           MOVX    @DPTR,A
   \   0002F8   A3           INC     DPTR
   \   0002F9   74FF         MOV     A,#-0x1
   \   0002FB   F0           MOVX    @DPTR,A
    236                    ZMacDataInd_t *pDataInd = (ZMacDataInd_t *) pData;
   \   0002FC   85....       MOV     ?V0 + 4,?V0 + 6
   \   0002FF   85....       MOV     ?V0 + 5,?V0 + 7
    237                    uint8 event, status, len, *msdu;
    238          
    239                    MAC_MlmeGetReq( MAC_SHORT_ADDRESS, &shortAddr );
   \   000302                ; Setup parameters for call to function MAC_MlmeGetReq
   \   000302   7403         MOV     A,#0x3
   \   000304   12....       LCALL   ?XSTACK_DISP0_8
   \   000307   AA82         MOV     R2,DPL
   \   000309   AB83         MOV     R3,DPH
   \   00030B   7953         MOV     R1,#0x53
   \   00030D   12....       LCALL   ??MAC_MlmeGetReq?relay
    240                    if ( shortAddr == INVALID_SHORT_ADDR || shortAddr == BROADCAST_ADDR )
   \   000310   7403         MOV     A,#0x3
   \   000312   12....       LCALL   ?XSTACK_DISP0_8
   \   000315   E0           MOVX    A,@DPTR
   \   000316   64FE         XRL     A,#0xfe
   \   000318   7004         JNZ     ??MAC_CbackEvent_15
   \   00031A   A3           INC     DPTR
   \   00031B   E0           MOVX    A,@DPTR
   \   00031C   64FF         XRL     A,#0xff
   \                     ??MAC_CbackEvent_15:
   \   00031E   6010         JZ      ??MAC_CbackEvent_16
   \   000320   7403         MOV     A,#0x3
   \   000322   12....       LCALL   ?XSTACK_DISP0_8
   \   000325   E0           MOVX    A,@DPTR
   \   000326   64FF         XRL     A,#0xff
   \   000328   7004         JNZ     ??MAC_CbackEvent_17
   \   00032A   A3           INC     DPTR
   \   00032B   E0           MOVX    A,@DPTR
   \   00032C   64FF         XRL     A,#0xff
   \                     ??MAC_CbackEvent_17:
   \   00032E   7011         JNZ     ??MAC_CbackEvent_18
    241                    {
    242                      osal_msg_deallocate( (uint8 *)msgPtr );
   \                     ??MAC_CbackEvent_16:
   \   000330                ; Setup parameters for call to function osal_msg_deallocate
   \   000330   85..82       MOV     DPL,?XSP + 0
   \   000333   85..83       MOV     DPH,?XSP + 1
   \   000336   E0           MOVX    A,@DPTR
   \   000337   FA           MOV     R2,A
   \   000338   A3           INC     DPTR
   \   000339   E0           MOVX    A,@DPTR
   \   00033A   FB           MOV     R3,A
   \   00033B   12....       LCALL   ??osal_msg_deallocate?relay
    243                      return;
   \   00033E   02....       LJMP    ??MAC_CbackEvent_1 & 0xFFFF
    244                    }
    245          
    246                    /* Store parameters */
    247                    event = pData->hdr.event;
   \                     ??MAC_CbackEvent_18:
   \   000341   85..82       MOV     DPL,?V0 + 6
   \   000344   85..83       MOV     DPH,?V0 + 7
   \   000347   E0           MOVX    A,@DPTR
   \   000348   C0E0         PUSH    A
   \   00034A   7402         MOV     A,#0x2
   \   00034C   12....       LCALL   ?XSTACK_DISP0_8
   \   00034F   D0E0         POP     A
   \   000351   F0           MOVX    @DPTR,A
    248                    status = pData->hdr.status;
   \   000352   85..82       MOV     DPL,?V0 + 6
   \   000355   85..83       MOV     DPH,?V0 + 7
   \   000358   A3           INC     DPTR
   \   000359   E0           MOVX    A,@DPTR
   \   00035A   F5..         MOV     ?V0 + 3,A
    249                    len = pData->dataInd.msdu.len;
   \   00035C   85..82       MOV     DPL,?V0 + 6
   \   00035F   85..83       MOV     DPH,?V0 + 7
   \   000362   A3           INC     DPTR
   \   000363   A3           INC     DPTR
   \   000364   A3           INC     DPTR
   \   000365   A3           INC     DPTR
   \   000366   E0           MOVX    A,@DPTR
   \   000367   FF           MOV     R7,A
    250                    msdu = pData->dataInd.msdu.p;
   \   000368   85..82       MOV     DPL,?V0 + 6
   \   00036B   85..83       MOV     DPH,?V0 + 7
   \   00036E   A3           INC     DPTR
   \   00036F   A3           INC     DPTR
   \   000370   E0           MOVX    A,@DPTR
   \   000371   F8           MOV     R0,A
   \   000372   A3           INC     DPTR
   \   000373   E0           MOVX    A,@DPTR
   \   000374   F9           MOV     R1,A
   \   000375   7407         MOV     A,#0x7
   \   000377   12....       LCALL   ?XSTACK_DISP0_8
   \   00037A   E8           MOV     A,R0
   \   00037B   F0           MOVX    @DPTR,A
   \   00037C   A3           INC     DPTR
   \   00037D   E9           MOV     A,R1
   \   00037E   F0           MOVX    @DPTR,A
    251          
    252                    /* Copy header */
    253          #if defined ( ZBIT )
    254                    // ZBIT requires two copies to handle 32 bit alignment  
    255                    osal_memcpy(&pDataInd->SrcAddr, &pData->dataInd.mac, sizeof(zAddrType_t) * 2 );
    256                    osal_memcpy(&pDataInd->Timestamp, &pData->dataInd.mac.timestamp, sizeof(macDataInd_t) - sizeof(ZMacEventHdr_t) - sizeof(zAddrType_t) * 2);
    257          #else
    258                    osal_memcpy(&pDataInd->SrcAddr, &pData->dataInd.mac, sizeof(macDataInd_t) - sizeof(ZMacEventHdr_t));
   \   00037F                ; Setup parameters for call to function osal_memcpy
   \   00037F   E5..         MOV     A,?V0 + 6
   \   000381   2412         ADD     A,#0x12
   \   000383   F5..         MOV     ?V0 + 0,A
   \   000385   E5..         MOV     A,?V0 + 7
   \   000387   3400         ADDC    A,#0x0
   \   000389   F5..         MOV     ?V0 + 1,A
   \   00038B   75..00       MOV     ?V0 + 2,#0x0
   \   00038E   78..         MOV     R0,#?V0 + 0
   \   000390   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000393   7C1E         MOV     R4,#0x1e
   \   000395   7D00         MOV     R5,#0x0
   \   000397   E5..         MOV     A,?V0 + 4
   \   000399   2402         ADD     A,#0x2
   \   00039B   FA           MOV     R2,A
   \   00039C   E5..         MOV     A,?V0 + 5
   \   00039E   3400         ADDC    A,#0x0
   \   0003A0   FB           MOV     R3,A
   \   0003A1   12....       LCALL   ??osal_memcpy?relay
   \   0003A4   7403         MOV     A,#0x3
   \   0003A6   12....       LCALL   ?DEALLOC_XSTACK8
    259          #endif
    260                    /* Security - set to zero for now */
    261                    pDataInd->Sec.SecurityLevel = false;
   \   0003A9   7400         MOV     A,#0x0
   \   0003AB   C0E0         PUSH    A
   \   0003AD   E5..         MOV     A,?V0 + 4
   \   0003AF   242A         ADD     A,#0x2a
   \   0003B1   F582         MOV     DPL,A
   \   0003B3   E5..         MOV     A,?V0 + 5
   \   0003B5   3400         ADDC    A,#0x0
   \   0003B7   F583         MOV     DPH,A
   \   0003B9   D0E0         POP     A
   \   0003BB   F0           MOVX    @DPTR,A
    262          
    263                    /* Restore parameters */
    264                    pDataInd->hdr.Status = status;
   \   0003BC   85..82       MOV     DPL,?V0 + 4
   \   0003BF   85..83       MOV     DPH,?V0 + 5
   \   0003C2   A3           INC     DPTR
   \   0003C3   E5..         MOV     A,?V0 + 3
   \   0003C5   F0           MOVX    @DPTR,A
    265                    pDataInd->hdr.Event = event;
   \   0003C6   7402         MOV     A,#0x2
   \   0003C8   12....       LCALL   ?XSTACK_DISP0_8
   \   0003CB   E0           MOVX    A,@DPTR
   \   0003CC   85..82       MOV     DPL,?V0 + 4
   \   0003CF   85..83       MOV     DPH,?V0 + 5
   \   0003D2   F0           MOVX    @DPTR,A
    266                    pDataInd->msduLength = len;
   \   0003D3   EF           MOV     A,R7
   \   0003D4   C0E0         PUSH    A
   \   0003D6   E5..         MOV     A,?V0 + 4
   \   0003D8   242D         ADD     A,#0x2d
   \   0003DA   F582         MOV     DPL,A
   \   0003DC   E5..         MOV     A,?V0 + 5
   \   0003DE   3400         ADDC    A,#0x0
   \   0003E0   F583         MOV     DPH,A
   \   0003E2   D0E0         POP     A
   \   0003E4   F0           MOVX    @DPTR,A
    267          
    268                    if (len)
   \   0003E5   EF           MOV     A,R7
   \   0003E6   601D         JZ      ??MAC_CbackEvent_19
    269                      pDataInd->msdu = msdu;
   \   0003E8   7407         MOV     A,#0x7
   \   0003EA   12....       LCALL   ?XSTACK_DISP0_8
   \   0003ED   E0           MOVX    A,@DPTR
   \   0003EE   F8           MOV     R0,A
   \   0003EF   A3           INC     DPTR
   \   0003F0   E0           MOVX    A,@DPTR
   \   0003F1   F9           MOV     R1,A
   \   0003F2   E5..         MOV     A,?V0 + 4
   \   0003F4   242E         ADD     A,#0x2e
   \   0003F6   F582         MOV     DPL,A
   \   0003F8   E5..         MOV     A,?V0 + 5
   \   0003FA   3400         ADDC    A,#0x0
   \   0003FC   F583         MOV     DPH,A
   \   0003FE   E8           MOV     A,R0
   \   0003FF   F0           MOVX    @DPTR,A
   \   000400   A3           INC     DPTR
   \   000401   E9           MOV     A,R1
   \   000402   F0           MOVX    @DPTR,A
   \   000403   8013         SJMP    ??MAC_CbackEvent_11
    270                    else
    271                      pDataInd->msdu = NULL;
   \                     ??MAC_CbackEvent_19:
   \   000405   E5..         MOV     A,?V0 + 4
   \   000407   242E         ADD     A,#0x2e
   \   000409   F582         MOV     DPL,A
   \   00040B   E5..         MOV     A,?V0 + 5
   \   00040D   3400         ADDC    A,#0x0
   \   00040F   F583         MOV     DPH,A
   \   000411   7400         MOV     A,#0x0
   \   000413   F0           MOVX    @DPTR,A
   \   000414   A3           INC     DPTR
   \   000415   7400         MOV     A,#0x0
   \   000417   F0           MOVX    @DPTR,A
    272          
    273                    break;
    274                  }
    275                }
    276          
    277                msgPtr->hdr.event = zmacCBEventTable[macEvent];
   \                     ??MAC_CbackEvent_11:
   \   000418   8E..         MOV     ?V0 + 0,R6
   \   00041A   75..00       MOV     ?V0 + 1,#0x0
   \   00041D   E5..         MOV     A,?V0 + 0
   \   00041F   24..         ADD     A,#(zmacCBEventTable & 0xff)
   \   000421   F582         MOV     DPL,A
   \   000423   E5..         MOV     A,?V0 + 1
   \   000425   34..         ADDC    A,#((zmacCBEventTable >> 8) & 0xff)
   \   000427   F583         MOV     DPH,A
   \   000429   E4           CLR     A
   \   00042A   93           MOVC    A,@A+DPTR
   \   00042B   C0E0         PUSH    A
   \   00042D   85..82       MOV     DPL,?XSP + 0
   \   000430   85..83       MOV     DPH,?XSP + 1
   \   000433   E0           MOVX    A,@DPTR
   \   000434   F8           MOV     R0,A
   \   000435   A3           INC     DPTR
   \   000436   E0           MOVX    A,@DPTR
   \   000437   F583         MOV     DPH,A
   \   000439   8882         MOV     DPL,R0
   \   00043B   D0E0         POP     A
   \   00043D   F0           MOVX    @DPTR,A
    278                osal_msg_send( NWK_TaskID, (uint8 *)msgPtr );
   \   00043E                ; Setup parameters for call to function osal_msg_send
   \   00043E   85..82       MOV     DPL,?XSP + 0
   \   000441   85..83       MOV     DPH,?XSP + 1
   \   000444   E0           MOVX    A,@DPTR
   \   000445   FA           MOV     R2,A
   \   000446   A3           INC     DPTR
   \   000447   E0           MOVX    A,@DPTR
   \   000448   FB           MOV     R3,A
   \   000449   90....       MOV     DPTR,#NWK_TaskID
   \   00044C   E0           MOVX    A,@DPTR
   \   00044D   F9           MOV     R1,A
   \   00044E   12....       LCALL   ??osal_msg_send?relay
   \                     ??MAC_CbackEvent_1:
   \   000451   7409         MOV     A,#0x9
   \   000453   12....       LCALL   ?DEALLOC_XSTACK8
   \   000456   7F08         MOV     R7,#0x8
   \   000458   02....       LJMP    ?BANKED_LEAVE_XDATA
    279              }
    280            }
    281          #endif
    282          }
    283          
    284          /********************************************************************************************************
    285           * @fn       zmacSendMTCallback()
    286           *
    287           * @brief    convert MAC data confirm to ZMac and send to NWK
    288           *
    289           * @param    status -
    290           * @param    msduHandle -
    291           *
    292           * @return   none
    293           ********************************************************************************************************/
    294          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    295          void zmacSendMTCallback ( macCbackEvent_t *pData )
   \                     zmacSendMTCallback:
    296          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    297          #ifdef MT_MAC_CB_FUNC
    298          
    299            /* Check if MT has subscribed for this callback If so, pass it as an event to MonitorTest */
    300            switch (pData->hdr.event)
    301            {
    302              case MAC_MLME_ASSOCIATE_IND:
    303                if ( _macCallbackSub & CB_ID_NWK_ASSOCIATE_IND )
    304                  nwk_MTCallbackSubNwkAssociateInd ( (ZMacAssociateInd_t *)pData );
    305                break;
    306          
    307              case MAC_MLME_ASSOCIATE_CNF:
    308                if ( _macCallbackSub & CB_ID_NWK_ASSOCIATE_CNF )
    309                  nwk_MTCallbackSubNwkAssociateCnf ( (ZMacAssociateCnf_t *)pData );
    310                break;
    311          
    312              case MAC_MLME_DISASSOCIATE_IND:
    313                if ( _macCallbackSub & CB_ID_NWK_DISASSOCIATE_IND )
    314                  nwk_MTCallbackSubNwkDisassociateInd ( (ZMacDisassociateInd_t *)pData );
    315                break;
    316          
    317              case MAC_MLME_DISASSOCIATE_CNF:
    318                if ( _macCallbackSub & CB_ID_NWK_DISASSOCIATE_CNF )
    319                  nwk_MTCallbackSubNwkDisassociateCnf ( (ZMacDisassociateCnf_t *)pData );
    320                break;
    321          
    322              case MAC_MLME_BEACON_NOTIFY_IND:
    323                if ( _macCallbackSub & CB_ID_NWK_BEACON_NOTIFY_IND )
    324                  nwk_MTCallbackSubNwkBeaconNotifyInd( (ZMacBeaconNotifyInd_t *)pData );
    325                break;
    326          
    327              case MAC_MLME_ORPHAN_IND:
    328                if ( _macCallbackSub & CB_ID_NWK_ORPHAN_IND )
    329                  nwk_MTCallbackSubNwkOrphanInd( (ZMacOrphanInd_t *) pData );
    330                break;
    331          
    332              case MAC_MLME_SCAN_CNF:
    333                if ( _macCallbackSub & CB_ID_NWK_SCAN_CNF )
    334                {
    335                  pData->scanCnf.result.pEnergyDetect = ZMac_ScanBuf;
    336                  nwk_MTCallbackSubNwkScanCnf ( (ZMacScanCnf_t *) pData );
    337                }
    338          
    339                if (ZMac_ScanBuf != NULL)
    340                {
    341                  osal_mem_free(ZMac_ScanBuf);
    342                  ZMac_ScanBuf = NULL;
    343                }
    344                break;
    345          
    346              case MAC_MLME_START_CNF:
    347                if ( _macCallbackSub & CB_ID_NWK_START_CNF )
    348                  nwk_MTCallbackSubNwkStartCnf ( pData->hdr.status );
    349                break;
    350          
    351              case MAC_MLME_SYNC_LOSS_IND:
    352                if ( _macCallbackSub & CB_ID_NWK_SYNC_LOSS_IND )
    353                 nwk_MTCallbackSubNwkSyncLossInd( (ZMacSyncLossInd_t *) pData );
    354                break;
    355          
    356              case MAC_MLME_POLL_CNF:
    357                if ( _macCallbackSub & CB_ID_NWK_POLL_CNF )
    358                   nwk_MTCallbackSubNwkPollCnf( pData->hdr.status );
    359                break;
    360          
    361              case MAC_MLME_COMM_STATUS_IND:
    362                if ( _macCallbackSub & CB_ID_NWK_COMM_STATUS_IND )
    363                  nwk_MTCallbackSubCommStatusInd ( (ZMacCommStatusInd_t *) pData );
    364                break;
    365          
    366              case MAC_MCPS_DATA_CNF:
    367                osal_msg_deallocate((uint8*)pData->dataCnf.pDataReq);
    368          
    369                if ( _macCallbackSub & CB_ID_NWK_DATA_CNF )
    370                  nwk_MTCallbackSubNwkDataCnf( (ZMacDataCnf_t *) pData );
    371                break;
    372          
    373              case MAC_MCPS_DATA_IND:
    374                  {
    375                    /*
    376                       Data Ind is unconventional: to save an alloc/copy, reuse the MAC
    377                       buffer and re-organize the contents into ZMAC format.
    378                    */
    379                    ZMacDataInd_t *pDataInd = (ZMacDataInd_t *) pData;
    380                    uint8 event, status, len, *msdu;
    381          
    382                    /* Store parameters */
    383                    event = pData->hdr.event;
    384                    status = pData->hdr.status;
    385                    len = pData->dataInd.msdu.len;
    386                    msdu = pData->dataInd.msdu.p;
    387          
    388                    /* Copy header */
    389                    osal_memcpy(&pDataInd->SrcAddr, &pData->dataInd.mac, sizeof(ZMacDataInd_t) - sizeof(ZMacEventHdr_t));
    390          
    391                    /* Security - set to zero for now*/
    392                    pDataInd->Sec.SecurityLevel = false;
    393          
    394                    /* Restore parameters */
    395                    pDataInd->hdr.Status = status;
    396                    pDataInd->hdr.Event = event;
    397                    pDataInd->msduLength = len;
    398          
    399                    if (len)
    400                      pDataInd->msdu = msdu;
    401                    else
    402                      pDataInd->msdu = NULL;
    403          
    404                    if ( _macCallbackSub & CB_ID_NWK_DATA_IND )
    405                      nwk_MTCallbackSubNwkDataInd ( pDataInd );
    406          
    407                    /* free buffer */
    408                    osal_msg_deallocate( (uint8 *) pData );
    409                  }
    410                  break;
    411          
    412              case MAC_MCPS_PURGE_CNF:
    413                if ( _macCallbackSub & CB_ID_NWK_PURGE_CNF )
    414                  nwk_MTCallbackSubNwkPurgeCnf( (ZMacPurgeCnf_t *) pData);
    415                break;
    416          
    417              default:
    418                break;
    419            }
    420          
    421          #endif
    422          }
   \   000000   02....       LJMP    ?BRET
    423          
    424          /********************************************************************************************************
    425           * @fn      MAC_CbackCheckPending
    426           *
    427           * @brief   Return number of pending indirect msg
    428           *
    429           * @param   None
    430           *
    431           * @return  Number of indirect msg holding
    432           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    433          uint8 MAC_CbackCheckPending(void)
   \                     MAC_CbackCheckPending:
    434          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    435          #if !defined (NONWK) && defined (RTR_NWK)
    436            return (nwkDB_ReturnIndirectHoldingCnt());
    437          #else
    438            return (0);
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
    439          #endif
    440          }

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??getZMacDynamicSize?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    getZMacDynamicSize

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_CbackEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_CbackEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zmacSendMTCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zmacSendMTCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MAC_CbackCheckPending?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MAC_CbackCheckPending
    441          
    442          
    443          /********************************************************************************************************
    444           ********************************************************************************************************/
    445          
    446          

   Maximum stack usage in bytes:

     Function                 ISTACK PSTACK XSTACK
     --------                 ------ ------ ------
     MAC_CbackCheckPending        0      0      0
     MAC_CbackEvent               1      0     28
       -> getZMacDynamicSize      0      0     50
       -> osal_msg_deallocate     0      0     50
       -> osal_msg_allocate       0      0     50
       -> osal_memcpy             0      0     56
       -> osal_memcpy             0      0     56
       -> osal_memcpy             0      0     56
       -> osal_memcpy             0      0     56
       -> osal_memcpy             0      0     56
       -> osal_mem_free           0      0     50
       -> MAC_MlmeGetReq          0      0     50
       -> osal_msg_deallocate     0      0     50
       -> osal_memcpy             0      0     56
       -> osal_msg_send           0      0     50
     getZMacDynamicSize           2      0     25
     zmacSendMTCallback           0      0      0


   Segment part sizes:

     Function/Label                Bytes
     --------------                -----
     zmacCBSizeTable                 17
     getZMacDynamicSize             115
     zmacCBEventTable                17
     MAC_CbackEvent                1115
     zmacSendMTCallback               3
     MAC_CbackCheckPending            5
     ??getZMacDynamicSize?relay       6
     ??MAC_CbackEvent?relay           6
     ??zmacSendMTCallback?relay       6
     ??MAC_CbackCheckPending?relay    6

 
 1 238 bytes in segment BANKED_CODE
    24 bytes in segment BANK_RELAYS
    34 bytes in segment CODE_C
 
 1 296 bytes of CODE memory

Errors: none
Warnings: none
