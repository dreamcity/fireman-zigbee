###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    20/Dec/2012  21:41:02 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \stack\zdo\ZDApp.c                                 #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\AXDApp\CC2430DB\..\..\..\Tools\C #
#                          C2430DB\f8wEndev.cfg" (-DCPU32MHZ                  #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_OPT_FFD=0 -DBLINK_LEDS "-DCONST=const        #
#                          __code" -DGENERIC=__generic) -f "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\Tools\CC2430DB\f8wCo #
#                          nfig.cfg" (-DSECURE=0 -DDEFAULT_CHANLIST=0x0000080 #
#                          0 -DZDAPP_CONFIG_PAN_ID=0xFFFF                     #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\stack\zd #
#                          o\ZDApp.c" -D CC2430DB -D NWK_AUTO_POLL -D         #
#                          REFLECTOR -D xZTOOL_P2 -D xMT_TASK -D              #
#                          xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG -D            #
#                          xPOWER_SAVING -lC "C:\Texas                        #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\EndDeviceDB\List\" -lA        #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\AXDApp\CC2430DB\EndDeviceDB\List\"  #
#                          --diag_suppress Pe001,Pa010 --diag_remark pe550    #
#                          -o "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\AXDApp\CC2430DB\EndDeviceDB\Obj\ #
#                          " -e --require_prototypes -z9 --no_code_motion     #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\AXDApp\CC2430DB\" -I "C:\Texas      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\SOURCE\" -I "C:\Texas      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\Drivers\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\ZMAIN\TI2430DB\" -I  #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\AXDApp\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\MT\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\HAL #
#                          \INCLUDE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\AXDApp\CC2430DB\..\.. #
#                          \..\..\..\COMPONENTS\HAL\TARGET\CC2430DB\" -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\AXDApp\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\OSA #
#                          L\INCLUDE\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\STA #
#                          CK\AF\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2. #
#                          1\Projects\zstack\Samples\AXDApp\CC2430DB\..\..\.. #
#                          \..\..\COMPONENTS\STACK\NWK\" -I "C:\Texas         #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\STA #
#                          CK\SEC\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2 #
#                          .1\Projects\zstack\Samples\AXDApp\CC2430DB\..\..\. #
#                          .\..\..\COMPONENTS\STACK\SYS\" -I "C:\Texas        #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\STA #
#                          CK\ZDO\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2 #
#                          .1\Projects\zstack\Samples\AXDApp\CC2430DB\..\..\. #
#                          .\..\..\COMPONENTS\ZMAC\F8W\" -I "C:\Texas         #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\ZMA #
#                          C\" -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Pr #
#                          ojects\zstack\Samples\AXDApp\CC2430DB\..\..\..\..\ #
#                          ..\COMPONENTS\SERVICES\SADDR\" -I "C:\Texas        #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\SER #
#                          VICES\SDATA\" -I "C:\Texas                         #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\MAC #
#                          \INCLUDE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\AXDApp\CC2430DB\..\.. #
#                          \..\..\..\COMPONENTS\MAC\HIGH_LEVEL\" -I           #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\AXDApp\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\AXDApp\CC2430DB\..\..\..\..\..\COMPONENTS\MAC #
#                          \LOW_LEVEL\SRF03\SINGLE_CHIP\" -I "C:\Program      #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\" -I "C:\Program       #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\AXDApp\CC2430DB\EndDeviceDB\List\ZDA #
#                          pp.lst                                             #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\AXDApp\CC2430DB\EndDeviceDB\Obj\ZDAp #
#                          p.r51                                              #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2007-11-28 15:44:45 -0800 (Wed, 28 Nov 2007) $
      4            Revision:       $Revision: 15983 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          
     64          #if   ( SECURE != 0  )
     65            #include "ssp.h"
     66          #endif
     67          
     68          #if defined( MT_ZDO_FUNC )
     69            #include "MT_ZDO.h"
     70          #endif
     71          
     72          /* HAL */
     73          #include "hal_led.h"
     74          #include "hal_lcd.h"
     75          #include "hal_key.h"
     76          
     77          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     78            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     79          #endif
     80          /*********************************************************************
     81           * MACROS
     82           */
     83          
     84          /*********************************************************************
     85           * CONSTANTS
     86           */
     87          #if !defined( NWK_START_DELAY )
     88            #define NWK_START_DELAY             100   // in milliseconds
     89          #endif
     90          
     91          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     92            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     93          #endif
     94          
     95          #if !defined( BEACON_REQUEST_DELAY )
     96            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     97          #endif
     98          
     99          #if !defined( BEACON_REQ_DELAY_MASK )
    100            #define BEACON_REQ_DELAY_MASK       0x007F
    101          #endif
    102          
    103          #if defined (AUTO_SOFT_START)
    104            #define MAX_RESUME_RETRY            3
    105            #define NUM_DISC_ATTEMPTS           3
    106          #else
    107            #define MAX_RESUME_RETRY            1
    108          #endif
    109          
    110          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    111          
    112          // Beacon Order Settings (see NLMEDE.h)
    113          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    114          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    115          
    116          #if ( SECURE != 0 )
    117            #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    118              // The number of times the frame counter can change before
    119              // saving to NV
    120              #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    121            #endif
    122          #endif
    123          
    124          // Leave control bits
    125          #define ZDAPP_LEAVE_CTRL_INIT 0
    126          #define ZDAPP_LEAVE_CTRL_SET  1
    127          #define ZDAPP_LEAVE_CTRL_RA   2
    128          
    129          // Standard time to update NWK NV data
    130          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    131          
    132          // Address Manager Stub Implementation
    133          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    134          
    135          /*********************************************************************
    136           * TYPEDEFS
    137           */
    138          
    139          /*********************************************************************
    140           * GLOBAL VARIABLES
    141           */
    142          
    143          #if defined( LCD_SUPPORTED )
    144            byte MatchRsps = 0;
    145          #endif
    146          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    147          byte zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    148          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    150          
    151          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
    152            byte zdappMgmtNwkDiscRspTransSeq;
    153            byte zdappMgmtNwkDiscReqInProgress = FALSE;
    154            zAddrType_t zdappMgmtNwkDiscRspAddr;
    155            byte zdappMgmtNwkDiscStartIndex;
    156            byte zdappMgmtSavedNwkState;
    157          #endif
    158          
    159          #if ( SECURE != 0 )
    160            uint16 nwkFrameCounterChanges = 0;
    161          #endif
    162          
    163          #if defined ( SOFT_START )
    164            static uint8 softStartAllowCoord = TRUE;
    165          #endif
    166          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    167          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    168          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    169          byte  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    170          
    171          /*********************************************************************
    172           * EXTERNAL VARIABLES
    173           */
    174          
    175          /*********************************************************************
    176           * EXTERNAL FUNCTIONS
    177           */
    178          
    179          /*********************************************************************
    180           * LOCAL FUNCTIONS
    181           */
    182          
    183          void ZDApp_NetworkStartEvt( void );
    184          void ZDApp_DeviceAuthEvt( void );
    185          void ZDApp_SaveNetworkStateEvt( void );
    186          
    187          uint8 ZDApp_ReadNetworkRestoreState( void );
    188          uint8 ZDApp_RestoreNetworkState( void );
    189          void ZDAppDetermineDeviceType( void );
    190          void ZDApp_InitUserDesc( void );
    191          void ZDAppCheckForHoldKey( void );
    192          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    193          void ZDApp_ProcessNetworkJoin( void );
    194          void ZDApp_SetCoordAddress( byte endPoint, byte dstEP );
    195          
    196          #if ( SECURE != 0 )
    197            void ZDApp_SaveNwkKey( void );
    198            byte ZDApp_RestoreNwkKey( void );
    199          #endif
    200          
    201          void ZDApp_SendMsg( byte taskID, byte cmd, byte len, byte *buf );
    202          
    203          void ZDApp_ResetTimerStart( uint16 delay );
    204          void ZDApp_ResetTimerCancel( void );
    205          void ZDApp_LeaveCtrlInit( void );
    206          void ZDApp_LeaveCtrlSet( uint8 ra );
    207          uint8 ZDApp_LeaveCtrlBypass( void );
    208          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    209          void ZDApp_LeaveReset( uint8 ra );
    210          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    211                                  uint8 removeChildren );
    212          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    213          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    214          void ZDApp_RegisterCBs( void );
    215          void ZDApp_SecInit( uint8 state );
    216          
    217          /*********************************************************************
    218           * LOCAL VARIABLES
    219           */
    220          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    221          byte ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    222          byte nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    223          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    224          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    225          
    226          #if defined( HOLD_AUTO_START )
    227            devStates_t devState = DEV_HOLD;
    228          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    229            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    230          #endif
    231          
    232          #if defined( ZDO_COORDINATOR ) && !defined( SOFT_START )
    233            // Set the default to coodinator
    234            devStartModes_t devStartMode = MODE_HARD;
    235          #else

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    236            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    237            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    238                                  // to parent. Set to make the device do an Orphan scan.
    239          #endif
    240          
    241          #if !defined( ZDO_COORDINATOR ) || defined( SOFT_START )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    242            static uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    243          #endif
    244          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    245          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    246          {
    247            ZDO_EP,
    248            &ZDAppTaskID,
    249            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    250            (afNetworkLatencyReq_t)0            // No Network Latency req
    251          };
    252          
    253          /*********************************************************************
    254           * @fn      ZDApp_Init
    255           *
    256           * @brief   ZDApp Initialization function.
    257           *
    258           * @param   task_id - ZDApp Task ID
    259           *
    260           * @return  None
    261           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    262          void ZDApp_Init( byte task_id )
   \                     ZDApp_Init:
    263          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 1
   \   000004   74FF         MOV     A,#-0x1
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    264            uint8 capabilities;
    265          
    266            // Save the task ID
    267            ZDAppTaskID = task_id;
   \   000009   E9           MOV     A,R1
   \   00000A   90....       MOV     DPTR,#ZDAppTaskID
   \   00000D   F0           MOVX    @DPTR,A
    268          
    269            // Initialize the ZDO global device short address storage
    270            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   00000E   7402         MOV     A,#0x2
   \   000010   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   000013   F0           MOVX    @DPTR,A
    271            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   000014   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000017   74FE         MOV     A,#-0x2
   \   000019   F0           MOVX    @DPTR,A
   \   00001A   A3           INC     DPTR
   \   00001B   74FF         MOV     A,#-0x1
   \   00001D   F0           MOVX    @DPTR,A
    272            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   00001E                ; Setup parameters for call to function NLME_GetExtAddr
   \   00001E   12....       LCALL   ??NLME_GetExtAddr?relay
    273          
    274            // Check for manual "Hold Auto Start"
    275            ZDAppCheckForHoldKey();
   \   000021                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   000021   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    276          
    277            // Initialize ZDO items and setup the device - type of device to create.
    278            ZDO_Init();
   \   000024                ; Setup parameters for call to function ZDO_Init
   \   000024   12....       LCALL   ??ZDO_Init?relay
    279          
    280            // Register the endpoint description with the AF
    281            // This task doesn't have a Simple description, but we still need
    282            // to register the endpoint.
    283            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000027                ; Setup parameters for call to function afRegister
   \   000027   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   000029   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   00002B   12....       LCALL   ??afRegister?relay
    284          
    285          #if defined( ZDO_USERDESC_RESPONSE )
    286            ZDApp_InitUserDesc();
    287          #endif // ZDO_USERDESC_RESPONSE
    288          
    289            // set broadcast address mask to support broadcast filtering
    290            NLME_GetRequest(nwkCapabilityInfo, 0, &capabilities);
   \   00002E                ; Setup parameters for call to function NLME_GetRequest
   \   00002E   85..82       MOV     DPL,?XSP + 0
   \   000031   85..83       MOV     DPH,?XSP + 1
   \   000034   AC82         MOV     R4,DPL
   \   000036   AD83         MOV     R5,DPH
   \   000038   7A00         MOV     R2,#0x0
   \   00003A   7B00         MOV     R3,#0x0
   \   00003C   798F         MOV     R1,#-0x71
   \   00003E   12....       LCALL   ??NLME_GetRequest?relay
    291            NLME_SetBroadcastFilter( capabilities );
   \   000041                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F9           MOV     R1,A
   \   000049   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    292          
    293            // Start the device?
    294            if ( devState != DEV_HOLD )
   \   00004C   90....       MOV     DPTR,#devState
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   6009         JZ      ??ZDApp_Init_0
    295            {
    296              ZDOInitDevice( 0 );
   \   000052                ; Setup parameters for call to function ZDOInitDevice
   \   000052   7A00         MOV     R2,#0x0
   \   000054   7B00         MOV     R3,#0x0
   \   000056   12....       LCALL   ??ZDOInitDevice?relay
   \   000059   800D         SJMP    ??ZDApp_Init_1
    297            }
    298            else
    299            {
    300              // Blink LED to indicate HOLD_START
    301              HalLedBlink ( HAL_LED_4, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   00005B                ; Setup parameters for call to function HalLedBlink
   \   00005B   7CF4         MOV     R4,#-0xc
   \   00005D   7D01         MOV     R5,#0x1
   \   00005F   7B32         MOV     R3,#0x32
   \   000061   7A00         MOV     R2,#0x0
   \   000063   7908         MOV     R1,#0x8
   \   000065   12....       LCALL   ??HalLedBlink?relay
    302            }
    303            
    304            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000068                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000068   12....       LCALL   ??ZDApp_RegisterCBs?relay
    305          } /* ZDO_Init() */
   \   00006B   7401         MOV     A,#0x1
   \   00006D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000070   02....       LJMP    ??Subroutine14_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??Subroutine14_0:
   \   000003   D083         POP     DPH
   \   000005   D082         POP     DPL
   \   000007   02....       LJMP    ?BRET
    306          
    307          /*********************************************************************
    308           * @fn          ZDApp_SecInit
    309           *
    310           * @brief       ZDApp initialize security.
    311           *
    312           * @param       state - device initialization state
    313           *
    314           * @return      none
    315           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    316          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    317          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    318            // Initialize ZigBee Device Security Manager
    319            ZDSecMgrInit();
   \   000004                ; Setup parameters for call to function ZDSecMgrInit
   \   000004   12....       LCALL   ??ZDSecMgrInit?relay
    320          
    321            // -----------------------------------------------------------------
    322            #if ( SECURE != 0 )
    323            // -----------------------------------------------------------------
    324            nwkFrameCounter = 0;
    325          
    326            if( _NIB.nwkKeyLoaded == FALSE )
    327            {
    328              // ---------------------------------------------------------------
    329              #if ( SECURITY_MODE == SECURITY_RESIDENTIAL )
    330              // ---------------------------------------------------------------
    331              #if !defined (ZDO_COORDINATOR)
    332              if ( zgPreConfigKeys )
    333              #endif
    334              {
    335                SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    336                SSP_SwitchNwkKey( 0 );
    337              }
    338              // ---------------------------------------------------------------
    339              #endif // ( SECURITY_MODE == SECURITY_RESIDENTIAL )
    340              // ---------------------------------------------------------------
    341            }
    342          
    343            if ( state == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    344            {
    345              //Restore NWK frame counter
    346            }
    347            // -----------------------------------------------------------------
    348            #endif
    349            // -----------------------------------------------------------------
    350          }
   \   000007   02....       LJMP    ??Subroutine14_0 & 0xFFFF
    351          
    352          /*********************************************************************
    353           * @fn      ZDApp_event_loop()
    354           *
    355           * @brief   Main event loop for Zigbee device objects task. This function
    356           *          should be called at periodic intervals.
    357           *
    358           * @param   task_id - Task ID
    359           * @param   events  - Bitmap of events
    360           *
    361           * @return  none
    362           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    363          UINT16 ZDApp_event_loop( byte task_id, UINT16 events )
   \                     ZDApp_event_loop:
    364          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    365            uint8 *msg_ptr;
    366          
    367            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??ZDApp_event_loop_0
   \   000010   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000011   701F         JNZ     ??ZDApp_event_loop_1
    368            {
    369              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    370              {
    371                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    372          
    373                // Release the memory
    374                osal_msg_deallocate( msg_ptr );
    375              }
    376          
    377              // Return unprocessed events
    378              return (events ^ SYS_EVENT_MSG);
    379            }
    380          
    381            if ( events & ZDO_STATE_CHANGE_EVT )
   \   000013   EE           MOV     A,R6
   \   000014   5410         ANL     A,#0x10
   \   000016   6033         JZ      ??ZDApp_event_loop_2
    382            {
    383              ZDO_UpdateNwkStatus( devState );
   \   000018                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   000018   90....       MOV     DPTR,#devState
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   F9           MOV     R1,A
   \   00001D   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    384          
    385              // Return unprocessed events
    386              return (events ^ ZDO_STATE_CHANGE_EVT);
   \   000020   7410         MOV     A,#0x10
   \                     ??ZDApp_event_loop_3:
   \   000022   6E           XRL     A,R6
   \   000023   FA           MOV     R2,A
   \   000024   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_4:
   \   000025   FB           MOV     R3,A
   \   000026   8071         SJMP    ??ZDApp_event_loop_5
    387            }
   \                     ??ZDApp_event_loop_6:
   \   000028                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   000028   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   00002B                ; Setup parameters for call to function osal_msg_deallocate
   \   00002B   AA..         MOV     R2,?V0 + 0
   \   00002D   AB..         MOV     R3,?V0 + 1
   \   00002F   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_1:
   \   000032                ; Setup parameters for call to function osal_msg_receive
   \   000032   90....       MOV     DPTR,#ZDAppTaskID
   \   000035   E0           MOVX    A,@DPTR
   \   000036   F9           MOV     R1,A
   \   000037   12....       LCALL   ??osal_msg_receive?relay
   \   00003A   8A..         MOV     ?V0 + 0,R2
   \   00003C   8B..         MOV     ?V0 + 1,R3
   \   00003E   EA           MOV     A,R2
   \   00003F   7001         JNZ     ??ZDApp_event_loop_7
   \   000041   EB           MOV     A,R3
   \                     ??ZDApp_event_loop_7:
   \   000042   70E4         JNZ     ??ZDApp_event_loop_6
   \   000044   EE           MOV     A,R6
   \   000045   FA           MOV     R2,A
   \   000046   7480         MOV     A,#-0x80
   \                     ??ZDApp_event_loop_8:
   \   000048   6F           XRL     A,R7
   \   000049   80DA         SJMP    ??ZDApp_event_loop_4
    388          
    389          
    390            if ( events & ZDO_NETWORK_INIT )
   \                     ??ZDApp_event_loop_2:
   \   00004B   EE           MOV     A,R6
   \   00004C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00004E   501D         JNC     ??ZDApp_event_loop_9
    391            {
    392              // Initialize apps and start the network
    393              devState = DEV_INIT;
   \   000050   7401         MOV     A,#0x1
   \   000052   90....       MOV     DPTR,#devState
   \   000055   F0           MOVX    @DPTR,A
    394              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    395                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   000056                ; Setup parameters for call to function ZDO_StartDevice
   \   000056   7C0F         MOV     R4,#0xf
   \   000058   7B0F         MOV     R3,#0xf
   \   00005A   90....       MOV     DPTR,#devStartMode
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   FA           MOV     R2,A
   \   00005F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000062   E0           MOVX    A,@DPTR
   \   000063   5407         ANL     A,#0x7
   \   000065   F9           MOV     R1,A
   \   000066   12....       LCALL   ??ZDO_StartDevice?relay
    396          
    397              // Return unprocessed events
    398              return (events ^ ZDO_NETWORK_INIT);
   \   000069   7401         MOV     A,#0x1
   \   00006B   80B5         SJMP    ??ZDApp_event_loop_3
    399            }
    400          
    401          #if defined (RTR_NWK)
    402            if ( events & ZDO_NETWORK_START )
    403            {
    404              ZDApp_NetworkStartEvt();
    405          
    406              // Return unprocessed events
    407              return (events ^ ZDO_NETWORK_START);
    408            }
    409          #endif  //RTR_NWK
    410          
    411          #if defined ( RTR_NWK )
    412            if ( events & ZDO_ROUTER_START )
    413            {
    414              if ( nwkStatus == ZSuccess )
    415              {
    416                if ( devState == DEV_END_DEVICE )
    417                  devState = DEV_ROUTER;
    418          
    419                osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
    420              }
    421              else
    422              {
    423                // remain as end device!!
    424              }
    425              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    426          
    427              // Return unprocessed events
    428              return (events ^ ZDO_ROUTER_START);
    429            }
    430          #endif  // RTR
    431          
    432          
    433            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_9:
   \   00006D   5408         ANL     A,#0x8
   \   00006F   6006         JZ      ??ZDApp_event_loop_10
    434            {
    435              // User defined logic
    436          
    437              // Return unprocessed events
    438              return (events ^ ZDO_COMMAND_CNF);
   \   000071   7408         MOV     A,#0x8
   \   000073   6E           XRL     A,R6
   \   000074   FA           MOV     R2,A
   \   000075   8022         SJMP    ??ZDApp_event_loop_5
    439            }
    440          
    441          #if defined( ZDSECMGR_SECURE ) && defined( RTR_NWK )
    442            if ( events & ZDO_NEW_DEVICE )
    443            {
    444              // process the new device event
    445              if ( ZDSecMgrNewDeviceEvent() == TRUE )
    446              {
    447                osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
    448              }
    449          
    450              // Return unprocessed events
    451              return (events ^ ZDO_NEW_DEVICE);
    452            }
    453          #endif  // ZDSECMGR_SECURE && RTR
    454          
    455          #if defined ( ZDSECMGR_COMMERCIAL )
    456            if ( events & ZDO_SECMGR_EVENT )
    457            {
    458              ZDSecMgrEvent();
    459          
    460              // Return unprocessed events
    461              return (events ^ ZDO_SECMGR_EVENT);
    462            }
    463          #endif // defined( ZDSECMGR_COMMERCIAL )
    464          
    465          #if   ( SECURE != 0  )
    466            if ( events & ZDO_DEVICE_AUTH )
    467            {
    468              ZDApp_DeviceAuthEvt();
    469          
    470              // Return unprocessed events
    471              return (events ^ ZDO_DEVICE_AUTH);
    472            }
    473          #endif  // SECURE
    474          
    475            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_10:
   \   000077   7402         MOV     A,#0x2
   \   000079   5F           ANL     A,R7
   \   00007A   F9           MOV     R1,A
   \   00007B   E4           CLR     A
   \   00007C   7001         JNZ     ??ZDApp_event_loop_11
   \   00007E   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_11:
   \   00007F   6004         JZ      ??ZDApp_event_loop_12
    476            {
    477              ZDApp_SaveNetworkStateEvt();
    478          
    479              // Return unprocessed events
    480              return (events ^ ZDO_NWK_UPDATE_NV);
   \   000081   7402         MOV     A,#0x2
   \   000083   80C3         SJMP    ??ZDApp_event_loop_8
    481            }
    482          
    483          #if ( SECURE != 0  )
    484            if ( events & ZDO_FRAMECOUNTER_CHANGE )
    485            {
    486              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
    487                ZDApp_SaveNwkKey();
    488          
    489              // Return unprocessed events
    490              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
    491            }
    492          #endif
    493          
    494            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_12:
   \   000085   EE           MOV     A,R6
   \   000086   5404         ANL     A,#0x4
   \   000088   600B         JZ      ??ZDApp_event_loop_13
    495            {
    496              // The device has been in the UNAUTH state, so reset
    497              // Note: there will be no return from this call
    498              SystemReset();
   \   00008A   C2AF         CLR     0xa8.7
   \   00008C   75C9AB       MOV     0xc9,#-0x55
   \   00008F   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_14:
   \   000092   00           NOP
   \   000093   80FD         SJMP    ??ZDApp_event_loop_14
    499            }
    500          
    501            // Discard or make more handlers
    502            return 0;
   \                     ??ZDApp_event_loop_13:
   \   000095   7A00         MOV     R2,#0x0
   \   000097   7B00         MOV     R3,#0x0
   \                     ??ZDApp_event_loop_5:
   \   000099   02....       LJMP    ??Subroutine15_1 & 0xFFFF
   \   00009C                REQUIRE _A_IEN0
   \   00009C                REQUIRE WDCTL
    503          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7402         MOV     A,#0x2
   \                     ??Subroutine15_0:
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Subroutine15_1:
   \   000005   7F02         MOV     R7,#0x2
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA
    504          
    505          /*********************************************************************
    506           * Application Functions
    507           */
    508          
    509          /*********************************************************************
    510           * @fn      ZDOInitDevice
    511           *
    512           * @brief   Start the device in the network.  This function will read
    513           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    514           *   restore the network state of the device.
    515           *
    516           * @param   startDelay - timeDelay to start device (in milliseconds).
    517           *      There is a jitter added to this delay:
    518           *              ((NWK_START_DELAY + startDelay)
    519           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    520           *
    521           * NOTE:    If the application would like to force a "new" join, the
    522           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    523           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    524           *          this function. "new" join means to not restore the network
    525           *          state of the device. Use zgWriteStartupOptions() to set these
    526           *          options.
    527           *
    528           * @return
    529           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    530           *          restored.
    531           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    532           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    533           *          it could mean that there was no network state to restore.
    534           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    535           *          with the rejoin option set to TRUE.  So, the device was not
    536           *          started in the network (one time only).  The next time this
    537           *          function is called it will start.
    538           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    539          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    540          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
    541            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    542            uint16 extendedDelay = 0;
    543          
    544            devState = DEV_INIT;    // Remove the Hold state
   \   000015   7401         MOV     A,#0x1
   \   000017   90....       MOV     DPTR,#devState
   \   00001A   F0           MOVX    @DPTR,A
    545          
    546            // Initialize leave control logic
    547            ZDApp_LeaveCtrlInit();
   \   00001B                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   00001B   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    548          
    549            // Check leave control reset settings
    550            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   00001E                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   00001E   85..82       MOV     DPL,?XSP + 0
   \   000021   85..83       MOV     DPH,?XSP + 1
   \   000024   AC82         MOV     R4,DPL
   \   000026   AD83         MOV     R5,DPH
   \   000028   7A..         MOV     R2,#(devState & 0xff)
   \   00002A   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   00002C   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    551          
    552            // Leave may make the hold state come back
    553            if ( devState == DEV_HOLD )
   \   00002F   90....       MOV     DPTR,#devState
   \   000032   E0           MOVX    A,@DPTR
   \   000033   7004         JNZ     ??ZDOInitDevice_0
    554              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \   000035   7902         MOV     R1,#0x2
   \   000037   802C         SJMP    ??ZDOInitDevice_1
    555          
    556          #if defined ( NV_RESTORE )
    557            // Get Keypad directly to see if a reset nv is needed.
    558            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    559            // while booting to skip past NV Restore.
    560            if ( HalKeyRead() == SW_BYPASS_NV )
    561              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    562            else
    563            {
    564              // Determine if NV should be restored
    565              networkStateNV = ZDApp_ReadNetworkRestoreState();
    566            }
    567          
    568            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    569            {
    570              networkStateNV = ZDApp_RestoreNetworkState();
    571            }
    572            else
    573            {
    574              // Wipe out the network state in NV
    575              NLME_InitNV();
    576              NLME_SetDefaultNV();
    577            }
    578          #endif
    579          
    580            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    581            {
    582              ZDAppDetermineDeviceType();
    583          
    584              // Only delay if joining network - not restoring network state
    585              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    586                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \                     ??ZDOInitDevice_0:
   \   000039                ; Setup parameters for call to function osal_rand
   \   000039   12....       LCALL   ??osal_rand?relay
   \   00003C   8A..         MOV     ?V0 + 0,R2
   \   00003E   A8..         MOV     R0,?V0 + 0
   \   000040   85..82       MOV     DPL,?XSP + 0
   \   000043   85..83       MOV     DPH,?XSP + 1
   \   000046   747F         MOV     A,#0x7f
   \   000048   58           ANL     A,R0
   \   000049   F8           MOV     R0,A
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   28           ADD     A,R0
   \   00004C   F8           MOV     R0,A
   \   00004D   A3           INC     DPTR
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   3400         ADDC    A,#0x0
   \   000051   F9           MOV     R1,A
   \   000052   7464         MOV     A,#0x64
   \   000054   28           ADD     A,R0
   \   000055   FE           MOV     R6,A
   \   000056   E4           CLR     A
   \   000057   39           ADDC    A,R1
   \   000058   FF           MOV     R7,A
    587            }
    588          
    589            // Initialize device security
    590            ZDApp_SecInit( networkStateNV );
   \   000059                ; Setup parameters for call to function ZDSecMgrInit
   \   000059   12....       LCALL   ??ZDSecMgrInit?relay
    591          
    592            // Trigger the network start
    593            ZDApp_NetworkInit( extendedDelay );
   \   00005C                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00005C   EE           MOV     A,R6
   \   00005D   FA           MOV     R2,A
   \   00005E   EF           MOV     A,R7
   \   00005F   FB           MOV     R3,A
   \   000060   12....       LCALL   ??ZDApp_NetworkInit?relay
    594          
    595            return ( networkStateNV );
   \   000063   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_1:
   \   000065   02....       LJMP    ?Subroutine15 & 0xFFFF
    596          }
    597          
    598          /*********************************************************************
    599           * @fn      ZDApp_ReadNetworkRestoreState
    600           *
    601           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    602           *          or not to restore the network state.
    603           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    604           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    605           *
    606           * @param   none
    607           *
    608           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    609           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    610           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    611           *          ZCD_NV_STARTUP_OPTION
    612           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    613          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    614          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    615            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    616          
    617            // Look for the New Network State option.
    618            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    619            {
    620              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    621            }
    622          
    623            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012                REQUIRE ?Subroutine16
   \   000012                ; // Fall through to label ?Subroutine16
    624          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    625          
    626          /*********************************************************************
    627           * @fn      ZDAppDetermineDeviceType()
    628           *
    629           * @brief   Determines the type of device to start.  Right now
    630           *          this only works with the SOFT_START feature.  So it doesn't
    631           *          support the end device type.
    632           *
    633           *          Looks at zgDeviceLogicalType and determines what type of
    634           *          device to start.  The types are:
    635           *            ZG_DEVICETYPE_COORDINATOR
    636           *            ZG_DEVICETYPE_ROUTER
    637           *            ZG_DEVICETYPE_ENDDEVICE - not supported yet.
    638           *            ZG_DEVICETYPE_SOFT - looks for coordinator, if one doesn't
    639           *               exist, becomes one.  This option is should only be used
    640           *               if the system is manually configured and you are insured
    641           *               that the first device is started before all the other
    642           *               devices are started.
    643           *
    644           * @param   none
    645           *
    646           * @return  none
    647           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    648          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    649          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    650            if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \   000000   02....       LJMP    ?BRET
    651              return;
    652          
    653          #if defined ( SOFT_START )
    654            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
    655            {
    656              devStartMode = MODE_HARD;     // Start as a coordinator
    657              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
    658            }
    659            else
    660            {
    661              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER )
    662              {
    663                softStartAllowCoord = FALSE;  // Don't allow coord to start
    664                continueJoining = TRUE;
    665              }
    666              devStartMode = MODE_JOIN;     // Assume joining
    667            }
    668          #endif // SOFT_START
    669          }
    670          
    671          /*********************************************************************
    672           * @fn      ZDApp_NetworkStartEvt()
    673           *
    674           * @brief   Process the Network Start Event
    675           *
    676           * @param   none
    677           *
    678           * @return  none
    679           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    680          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    681          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    682            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    683            {
    684              // Successfully started a ZigBee network
    685              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    686              {
    687                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    688              }
    689          
    690              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    691              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802D         SJMP    ??ZDApp_NetworkStartEvt_2
    692            }
    693            else
    694            {
    695              // Try again with a higher energy threshold !!
    696              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   F8           MOV     R0,A
   \   000021   7410         MOV     A,#0x10
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   94FF         SUBB    A,#-0x1
   \   00002C   E9           MOV     A,R1
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   500E         JNC     ??ZDApp_NetworkStartEvt_3
    697              {
    698                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000035                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000035                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000035   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000038   E9           MOV     A,R1
   \   000039   2410         ADD     A,#0x10
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    699                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003F                ; Setup parameters for call to function osal_set_event
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    700              }
    701              else
    702              {
    703                // Failed to start network. Enter a dormant state (until user intervenes)
    704                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000043   7401         MOV     A,#0x1
   \   000045   90....       MOV     DPTR,#devState
   \   000048   F0           MOVX    @DPTR,A
    705                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000049                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000049   7A10         MOV     R2,#0x10
   \                     ??ZDApp_NetworkStartEvt_4:
   \   00004B   12....       LCALL   ?Subroutine17 & 0xFFFF
    706              }
    707            }
    708          }
   \                     ??CrossCallReturnLabel_31:
   \   00004E   02....       LJMP    ??Subroutine14_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET
    709          
    710          #if ( SECURE != 0 )
    711          /*********************************************************************
    712           * @fn      ZDApp_DeviceAuthEvt()
    713           *
    714           * @brief   Process the Device Authentic Event
    715           *
    716           * @param   none
    717           *
    718           * @return  none
    719           */
    720          void ZDApp_DeviceAuthEvt( void )
    721          {
    722            // received authentication from trust center
    723            if ( devState == DEV_END_DEVICE_UNAUTH )
    724            {
    725              // Stop the reset timer so it doesn't reset
    726              ZDApp_ResetTimerCancel();
    727          
    728              devState = DEV_END_DEVICE;
    729              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    730          
    731              // Set the Power Manager Device
    732          #if defined ( POWER_SAVING )
    733              osal_pwrmgr_device( PWRMGR_BATTERY );
    734          #endif
    735          
    736          #if defined ( RTR_NWK )
    737              if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
    738              {
    739                // NOTE: first two parameters are not used, see NLMEDE.h for details
    740                NLME_StartRouterRequest( 0, 0, false );
    741              }
    742          #endif  // RTR
    743          
    744              // Notify to save info into NV
    745              ZDApp_NVUpdate();
    746          
    747              // Save off the security
    748              ZDApp_SaveNwkKey();
    749          
    750          #if defined ( ZDO_ENDDEVICE_ANNCE_GENERATE )
    751              ZDP_EndDeviceAnnce( ZDAppNwkAddr.addr.shortAddr, saveExtAddr,
    752                                 ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
    753          #endif
    754            }
    755            else
    756            {
    757              ZDApp_NVUpdate();
    758            }
    759          }
    760          #endif
    761          
    762          /*********************************************************************
    763           * @fn      ZDApp_SaveNetworkStateEvt()
    764           *
    765           * @brief   Process the Save the Network State Event
    766           *
    767           * @param   none
    768           *
    769           * @return  none
    770           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    771          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    772          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    773          #if defined ( NV_RESTORE )
    774           #if defined ( NV_TURN_OFF_RADIO )
    775            // Turn off the radio's receiver during an NV update
    776            byte RxOnIdle;
    777            byte x = false;
    778            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    779            ZMacSetReq( ZMacRxOnIdle, &x );
    780           #endif
    781          
    782            // Update the Network State in NV
    783            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    784                           NWK_NV_DEVICELIST_ENABLE |
    785                           NWK_NV_BINDING_ENABLE    |
    786                           NWK_NV_ADDRMGR_ENABLE );
    787          
    788            // Reset the NV startup option to resume from NV by
    789            // clearing the "New" join option.
    790            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    791          
    792           #if defined ( NV_TURN_OFF_RADIO )
    793            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    794           #endif
    795          #endif  // NV_RESTORE
    796          }
   \   000000   02....       LJMP    ?BRET
    797          
    798          /*********************************************************************
    799           * @fn      ZDApp_RestoreNetworkState()
    800           *
    801           * @brief   This function will restore the network state of the
    802           *          device if the network state is stored in NV.
    803           *
    804           * @param   none
    805           *
    806           * @return
    807           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    808           *          restored.
    809           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    810           *          This could mean that zgStartupOption said to not restore, or
    811           *          it could mean that there was no network state to restore.
    812           *
    813           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    814          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    815          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    816            byte nvStat;
    817          #if ( SECURE != 0 )
    818            nwkActiveKeyItems keyItems;
    819          #endif
    820          
    821            // Initialize NWK NV items
    822            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    823          
    824            if ( nvStat != NV_OPER_FAILED )
   \   00000A   7410         MOV     A,#0x10
   \   00000C   6E           XRL     A,R6
   \   00000D   6028         JZ      ??ZDApp_RestoreNetworkState_0
    825            {
    826              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6029         JZ      ??ZDApp_RestoreNetworkState_1
    827              {
    828                // Are we a coordinator
    829                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    830                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   7002         JNZ     ??ZDApp_RestoreNetworkState_2
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000028   7007         JNZ     ??ZDApp_RestoreNetworkState_3
    831                {
    832                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   54F8         ANL     A,#0xf8
   \   000030   F0           MOVX    @DPTR,A
    833                }
    834                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000031   7401         MOV     A,#0x1
   \   000033   90....       MOV     DPTR,#devStartMode
   \   000036   F0           MOVX    @DPTR,A
    835              }
    836              else
    837                nvStat = NV_ITEM_UNINIT;
    838          
    839          #if   ( SECURE != 0  )
    840              nwkFrameCounterChanges = 0;
    841              osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    842              osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    843          
    844            #if defined ( ZDO_COORDINATOR )
    845              ZDApp_RestoreNwkKey();
    846            #endif // ZDO_COORDINATOR
    847          #endif // SECURE
    848          
    849              // The default for RxOnWhenIdle is true for RTR_NWK and false for end devices
    850              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    851              // other than default.
    852            }
    853          
    854            if ( nvStat == ZSUCCESS )
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000037   EE           MOV     A,R6
   \   000038   7004         JNZ     ??ZDApp_RestoreNetworkState_1
    855              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   00003A   7900         MOV     R1,#0x0
   \   00003C   8002         SJMP    ??ZDApp_RestoreNetworkState_4
    856            else
    857              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_1:
   \   00003E   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_4:
   \   000040   02....       LJMP    ?Subroutine16 & 0xFFFF
    858          }
    859          
    860          /*********************************************************************
    861           * @fn      ZDApp_InitUserDesc()
    862           *
    863           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    864           *          when needed.  If you want to initialize the User descriptor to
    865           *          something other than all zero, do it here.
    866           *
    867           * @param   none
    868           *
    869           * @return  none
    870           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    871          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    872          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    873            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    874          
    875            // Initialize the User Descriptor, the descriptor is read from NV
    876            // when needed.  If you want to initialize the User descriptor to something
    877            // other than all zero, do it here.
    878            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
    879            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    880                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   00001D                ; Setup parameters for call to function osal_nv_item_init
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C11         MOV     R4,#0x11
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A81         MOV     R2,#-0x7f
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_item_init?relay
   \   000039   7402         MOV     A,#0x2
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003E   E9           MOV     A,R1
   \   00003F   7033         JNZ     ??ZDApp_InitUserDesc_0
    881            {
    882              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    883                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000041                ; Setup parameters for call to function osal_nv_read
   \   000041   78..         MOV     R0,#?V0 + 0
   \   000043   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000046   75..11       MOV     ?V0 + 0,#0x11
   \   000049   75..00       MOV     ?V0 + 1,#0x0
   \   00004C   78..         MOV     R0,#?V0 + 0
   \   00004E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000051   7C00         MOV     R4,#0x0
   \   000053   7D00         MOV     R5,#0x0
   \   000055   7A81         MOV     R2,#-0x7f
   \   000057   7B00         MOV     R3,#0x0
   \   000059   12....       LCALL   ??osal_nv_read?relay
   \   00005C   7404         MOV     A,#0x4
   \   00005E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000061   E9           MOV     A,R1
   \   000062   7010         JNZ     ??ZDApp_InitUserDesc_0
    884              {
    885                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000064   85..82       MOV     DPL,?XSP + 0
   \   000067   85..83       MOV     DPH,?XSP + 1
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6007         JZ      ??ZDApp_InitUserDesc_0
    886                {
    887                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   00006D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000070   E0           MOVX    A,@DPTR
   \   000071   D2E4         SETB    0xE0 /* A   */.4
   \   000073   F0           MOVX    @DPTR,A
    888                }
    889              }
    890            }
    891          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000074   7411         MOV     A,#0x11
   \   000076   02....       LJMP    ??Subroutine15_0 & 0xFFFF
    892          
    893          /*********************************************************************
    894           * @fn      ZDAppCheckForHoldKey()
    895           *
    896           * @brief   Check for key to set the device into Hold Auto Start
    897           *
    898           * @param   none
    899           *
    900           * @return  none
    901           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    902          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    903          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    904          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    905            // Get Keypad directly to see if a HOLD_START is needed.
    906            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    907            // while booting to avoid starting up the device.
    908            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    909            {
    910              // Change the device state to HOLD on start up
    911              devState = DEV_HOLD;
   \   00000C   E4           CLR     A
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   F0           MOVX    @DPTR,A
    912            }
    913          #endif // HAL_KEY
    914          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ??Subroutine14_0 & 0xFFFF
    915          
    916          /*********************************************************************
    917           * @fn      ZDApp_ProcessOSALMsg()
    918           *
    919           * @brief   Process the incoming task message.
    920           *
    921           * @param   msgPtr - message to process
    922           *
    923           * @return  none
    924           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    925          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    926          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    927            // Data Confirmation message fields
    928            byte sentEP;       // This should always be 0
    929            byte sentStatus;
    930            afDataConfirm_t *afDataConfirm;
    931          
    932            switch ( msgPtr->event )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   000011   00           DB        0
   \   000012   05           DB        5
   \   000013   01           DB        1
   \   000014   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   000016   02           DB        2
   \   000017   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   000019   03           DB        3
   \   00001A   ....         DW        ??ZDApp_ProcessOSALMsg_2
   \   00001C   1A           DB        26
   \   00001D   ....         DW        ??ZDApp_ProcessOSALMsg_3
   \   00001F   D3           DB        211
   \   000020   ....         DW        ??ZDApp_ProcessOSALMsg_4
   \   000022   ....         DW        ??CrossCallReturnLabel_29
    933            {
    934              // Incoming ZDO Message
    935              case AF_INCOMING_MSG_CMD:
    936                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000024                ; Setup parameters for call to function ZDP_IncomingData
   \   000024   12....       LCALL   ??ZDP_IncomingData?relay
   \   000027   02....       LJMP    ??CrossCallReturnLabel_29 & 0xFFFF
    937                break;
    938                
    939              case ZDO_CB_MSG:
    940                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   00002A                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00002A   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   \   00002D   02....       LJMP    ??CrossCallReturnLabel_29 & 0xFFFF
    941                break;
    942          
    943              case AF_DATA_CONFIRM_CMD:
    944                // This message is received as a confirmation of a data packet sent.
    945                // The status is of ZStatus_t type [defined in NLMEDE.h]
    946                // The message fields are defined in AF.h
    947                afDataConfirm = (afDataConfirm_t *)msgPtr;
    948                sentEP = afDataConfirm->endpoint;
    949                sentStatus = afDataConfirm->hdr.status;
    950          
    951                // Action taken when confirmation is received.
    952                /* Put code here */
    953          #if !defined ( RTR_NWK )
    954                if ( sentStatus == ZMacNoACK )
    955                {
    956                  //ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
    957                }
    958          #else
    959               (void)sentStatus;
    960          #endif
    961                break;
    962          
    963              case ZDO_NWK_DISC_CNF:
    964                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000030   90....       MOV     DPTR,#devState
   \   000033   E0           MOVX    A,@DPTR
   \   000034   6402         XRL     A,#0x2
   \   000036   6003         JZ      $+5
   \   000038   02....       LJMP    ??CrossCallReturnLabel_29 & 0xFFFF
    965                {
    966                }
    967          #if !defined ( ZDO_COORDINATOR ) || defined ( SOFT_START )
    968            #if defined ( MANAGED_SCAN )
    969                else if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
    970            #else
    971                else if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter++ > NUM_DISC_ATTEMPTS) )
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   A3           INC     DPTR
   \   000040   E0           MOVX    A,@DPTR
   \   000041   7078         JNZ     ??ZDApp_ProcessOSALMsg_5
   \   000043   90....       MOV     DPTR,#zdoDiscCounter
   \   000046   E0           MOVX    A,@DPTR
   \   000047   FA           MOV     R2,A
   \   000048   7401         MOV     A,#0x1
   \   00004A   2A           ADD     A,R2
   \   00004B   F0           MOVX    @DPTR,A
   \   00004C   EA           MOV     A,R2
   \   00004D   C3           CLR     C
   \   00004E   9403         SUBB    A,#0x3
   \   000050   4069         JC      ??ZDApp_ProcessOSALMsg_5
    972            #endif
    973                {
    974                  if ( devStartMode == MODE_JOIN )
   \   000052   90....       MOV     DPTR,#devStartMode
   \   000055   E0           MOVX    A,@DPTR
   \   000056   7043         JNZ     ??ZDApp_ProcessOSALMsg_6
    975                  {
    976                    devState = DEV_NWK_JOINING;
   \   000058   7403         MOV     A,#0x3
   \   00005A   90....       MOV     DPTR,#devState
   \   00005D   F0           MOVX    @DPTR,A
    977          
    978                    ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   \   00005E                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   00005E   EE           MOV     A,R6
   \   00005F   FA           MOV     R2,A
   \   000060   12....       LCALL   ??ZDApp_NodeProfileSync?relay
    979          
    980                    if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
    981                         BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
    982                         ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
    983                         ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   \   000063                ; Setup parameters for call to function NLME_JoinRequest
   \   000063   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000066   E0           MOVX    A,@DPTR
   \   000067   F5..         MOV     ?V0 + 0,A
   \   000069   78..         MOV     R0,#?V0 + 0
   \   00006B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00006E   8E82         MOV     DPL,R6
   \   000070   8F83         MOV     DPH,R7
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   A3           INC     DPTR
   \   000076   E0           MOVX    A,@DPTR
   \   000077   F9           MOV     R1,A
   \   000078   8E82         MOV     DPL,R6
   \   00007A   8F83         MOV     DPH,R7
   \   00007C   A3           INC     DPTR
   \   00007D   A3           INC     DPTR
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   FC           MOV     R4,A
   \   000080   8E82         MOV     DPL,R6
   \   000082   8F83         MOV     DPH,R7
   \   000084   A3           INC     DPTR
   \   000085   A3           INC     DPTR
   \   000086   A3           INC     DPTR
   \   000087   E0           MOVX    A,@DPTR
   \   000088   FD           MOV     R5,A
   \   000089   EE           MOV     A,R6
   \   00008A   2406         ADD     A,#0x6
   \   00008C   FA           MOV     R2,A
   \   00008D   EF           MOV     A,R7
   \   00008E   3400         ADDC    A,#0x0
   \   000090   FB           MOV     R3,A
   \   000091   12....       LCALL   ??NLME_JoinRequest?relay
   \   000094   7401         MOV     A,#0x1
   \   000096   12....       LCALL   ?DEALLOC_XSTACK8
   \   000099   800D         SJMP    ??ZDApp_ProcessOSALMsg_7
    984                    {
    985                      ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
    986                          + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
    987                    }
    988                  }
    989                  else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   00009B   6403         XRL     A,#0x3
   \   00009D   700F         JNZ     ??CrossCallReturnLabel_36
    990                  {
    991                    devState = DEV_NWK_REJOIN;
   \   00009F   7404         MOV     A,#0x4
   \   0000A1   90....       MOV     DPTR,#devState
   \   0000A4   F0           MOVX    @DPTR,A
    992                    if ( NLME_ReJoinRequest() != ZSuccess )
   \   0000A5                ; Setup parameters for call to function NLME_ReJoinRequest
   \   0000A5   12....       LCALL   ??NLME_ReJoinRequest?relay
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   0000A8   E9           MOV     A,R1
   \   0000A9   6003         JZ      ??CrossCallReturnLabel_36
    993                    {
    994                      ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
    995                          + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000AB                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000AB                ; Setup parameters for call to function osal_rand
   \   0000AB   12....       LCALL   ?Subroutine8 & 0xFFFF
    996                    }
    997                  }
    998          
    999                  if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_36:
   \   0000AE   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   0000B1   E0           MOVX    A,@DPTR
   \   0000B2   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000B4   5043         JNC     ??CrossCallReturnLabel_29
   1000                  {
   1001                    // The receiver is on, turn network layer polling off.
   1002                    NLME_SetPollRate( 0 );
   \   0000B6                ; Setup parameters for call to function NLME_SetPollRate
   \   0000B6   12....       LCALL   ?Subroutine9 & 0xFFFF
   1003                    NLME_SetQueuedPollRate( 0 );
   1004                    NLME_SetResponseRate( 0 );
   \                     ??CrossCallReturnLabel_12:
   \   0000B9   803E         SJMP    ??CrossCallReturnLabel_29
   1005                  }
   1006                }
   1007                else
   1008                {
   1009          #if defined ( SOFT_START ) && !defined ( VIRTKEY_SOFT_START )
   1010            #if defined ( MANAGED_SCAN )
   1011                  if ( (softStartAllowCoord)
   1012                      && (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status != ZDO_SUCCESS )
   1013                        && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   1014            #else
   1015                  if ( (softStartAllowCoord)
   1016                      && (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status != ZDO_SUCCESS )
   1017                        && (zdoDiscCounter++ > NUM_DISC_ATTEMPTS) )
   1018            #endif
   1019                  {
   1020                    ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   1021                    devStartMode = MODE_HARD;
   1022                  }
   1023                  else if ( continueJoining == FALSE )
   1024                  {
   1025                    devState = DEV_HOLD;
   1026                    osal_stop_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT );
   1027                    break;    // Don't init
   1028                  }
   1029          #endif
   1030            #if defined ( MANAGED_SCAN )
   1031                  ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1032            #else
   1033                  if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   0000BB   90....       MOV     DPTR,#continueJoining
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   6038         JZ      ??CrossCallReturnLabel_29
   1034                  {
   1035                    ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1036                        + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   0000C1                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000C1                ; Setup parameters for call to function osal_rand
   \   0000C1   12....       LCALL   ??osal_rand?relay
   \   0000C4   8A..         MOV     ?V0 + 0,R2
   \   0000C6   74FF         MOV     A,#-0x1
   \   0000C8   55..         ANL     A,?V0 + 0
   \   0000CA   F8           MOV     R0,A
   \   0000CB   7464         MOV     A,#0x64
   \   0000CD   28           ADD     A,R0
   \   0000CE   FA           MOV     R2,A
   \   0000CF   E4           CLR     A
   \   0000D0   3400         ADDC    A,#0x0
   \   0000D2   FB           MOV     R3,A
   \   0000D3   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   0000D6   8021         SJMP    ??CrossCallReturnLabel_29
   1037                  }
   1038            #endif
   1039                }
   1040          #endif  // !ZDO_COORDINATOR
   1041                break;
   1042          
   1043          #if !defined( ZDO_COORDINATOR ) || defined( SOFT_START )
   1044              case ZDO_NWK_JOIN_IND:
   1045                ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   0000D8                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   0000D8   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   \   0000DB   801C         SJMP    ??CrossCallReturnLabel_29
   1046                break;
   1047          
   1048              case ZDO_NWK_JOIN_REQ:
   1049                retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   0000DD   E4           CLR     A
   \   0000DE   90....       MOV     DPTR,#retryCnt
   \   0000E1   F0           MOVX    @DPTR,A
   1050                devStartMode = MODE_RESUME;
   \   0000E2   7401         MOV     A,#0x1
   \   0000E4   90....       MOV     DPTR,#devStartMode
   \   0000E7   F0           MOVX    @DPTR,A
   1051                _tmpRejoinState = true;
   \   0000E8   90....       MOV     DPTR,#_tmpRejoinState
   \   0000EB   F0           MOVX    @DPTR,A
   1052                zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \   0000EC   7402         MOV     A,#0x2
   \   0000EE   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   0000F1   12....       LCALL   ?Subroutine1 & 0xFFFF
   1053                ZDApp_NetworkInit( 0 );
   1054          
   1055                // indicate state change to apps
   1056                devState = DEV_INIT;
   \                     ??CrossCallReturnLabel_34:
   \   0000F4   7401         MOV     A,#0x1
   \   0000F6   12....       LCALL   ?Subroutine0 & 0xFFFF
   1057                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1058                break;
   1059          #endif  // !ZDO_COORDINATOR
   1060          
   1061          #if defined ( ZDSECMGR_SECURE )
   1062            #if defined ( ZDSECMGR_COMMERCIAL )
   1063                  case ZDO_ESTABLISH_KEY_CFM:
   1064                    ZDSecMgrEstablishKeyCfm
   1065                      ( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1066                    break;
   1067            #endif
   1068          
   1069            #if defined ( ZDSECMGR_COMMERCIAL )
   1070              #if !defined ( ZDO_COORDINATOR ) || defined ( SOFT_START )
   1071                  case ZDO_ESTABLISH_KEY_IND:
   1072                    ZDSecMgrEstablishKeyInd
   1073                      ( (ZDO_EstablishKeyInd_t*)msgPtr );
   1074                    break;
   1075              #endif
   1076            #endif
   1077          
   1078            #if !defined ( ZDO_COORDINATOR ) || defined( SOFT_START )
   1079                  case ZDO_TRANSPORT_KEY_IND:
   1080                    ZDSecMgrTransportKeyInd
   1081                      ( (ZDO_TransportKeyInd_t*)msgPtr );
   1082                    break;
   1083            #endif
   1084          
   1085            #if defined ( ZDO_COORDINATOR )
   1086                  case ZDO_UPDATE_DEVICE_IND:
   1087                    ZDSecMgrUpdateDeviceInd
   1088                      ( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1089                    break;
   1090            #endif
   1091          
   1092            #if defined ( RTR_NWK )
   1093              #if !defined ( ZDO_COORDINATOR ) || defined( SOFT_START )
   1094                  case ZDO_REMOVE_DEVICE_IND:
   1095                    ZDSecMgrRemoveDeviceInd
   1096                      ( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1097                    break;
   1098              #endif
   1099            #endif
   1100          
   1101            #if defined ( ZDSECMGR_COMMERCIAL )
   1102              #if defined ( ZDO_COORDINATOR )
   1103                  case ZDO_REQUEST_KEY_IND:
   1104                    ZDSecMgrRequestKeyInd
   1105                      ( (ZDO_RequestKeyInd_t*)msgPtr );
   1106                    break;
   1107              #endif
   1108            #endif
   1109          
   1110            #if !defined ( ZDO_COORDINATOR ) || defined( SOFT_START )
   1111                  case ZDO_SWITCH_KEY_IND:
   1112                    ZDSecMgrSwitchKeyInd
   1113                      ( (ZDO_SwitchKeyInd_t*)msgPtr );
   1114                    break;
   1115            #endif
   1116          
   1117          #endif // defined ( ZDSECMGR_SECURE )
   1118          
   1119              default:
   1120                break;
   1121            }
   1122          
   1123            (void)sentEP;
   1124          }
   \                     ??CrossCallReturnLabel_29:
   \   0000F9   80..         SJMP    ??Subroutine15_1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7B00         MOV     R3,#0x0
   \   000004   12....       LCALL   ??NLME_SetPollRate?relay
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E   7A00         MOV     R2,#0x0
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000015   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   12....       LCALL   ??osal_rand?relay
   \   000003   8A..         MOV     ?V0 + 0,R2
   \   000005   747F         MOV     A,#0x7f
   \   000007   55..         ANL     A,?V0 + 0
   \   000009   F8           MOV     R0,A
   \   00000A   7464         MOV     A,#0x64
   \   00000C   28           ADD     A,R0
   \   00000D   FA           MOV     R2,A
   \   00000E                REQUIRE ?Subroutine18
   \   00000E                ; // Fall through to label ?Subroutine18

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   90....       MOV     DPTR,#devState
   \   000003   F0           MOVX    @DPTR,A
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   7A10         MOV     R2,#0x10
   \   000006   80..         SJMP    ?Subroutine17

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000001                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000001   7A00         MOV     R2,#0x0
   \   000003   02....       LJMP    ?Subroutine18 & 0xFFFF
   1125          
   1126          /*********************************************************************
   1127           * @fn      ZDApp_ProcessMsgCBs()
   1128           *
   1129           * @brief   Process response messages
   1130           *
   1131           * @param   none
   1132           *
   1133           * @return  none
   1134           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1135          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1136          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1137            switch ( inMsg->clusterID )
   \   00000E   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000018   0200         DW        2
   \   00001A   2100         DW        33
   \   00001C   2200         DW        34
   \   00001E   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000020   0080         DW        32768
   \   000022   0180         DW        32769
   \   000024   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000026   0000         DW        0
   \   000028   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1138            {
   1139          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1140              case NWK_addr_rsp:
   1141              case IEEE_addr_rsp:
   1142                {
   1143                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1144                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   00002A                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   00002A   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00002D   8A..         MOV     ?V0 + 0,R2
   \   00002F   8B..         MOV     ?V0 + 1,R3
   \   000031   AE..         MOV     R6,?V0 + 0
   \   000033   AF..         MOV     R7,?V0 + 1
   1145                  if ( pAddrRsp )
   \   000035   EE           MOV     A,R6
   \   000036   7001         JNZ     ??ZDApp_ProcessMsgCBs_3
   \   000038   EF           MOV     A,R7
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   000039   603F         JZ      ??ZDApp_ProcessMsgCBs_2
   1146                  {
   1147                    if ( pAddrRsp->status == ZSuccess )
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   7011         JNZ     ??ZDApp_ProcessMsgCBs_4
   1148                    {
   1149                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000042                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000042   EE           MOV     A,R6
   \   000043   2403         ADD     A,#0x3
   \   000045   FC           MOV     R4,A
   \   000046   EF           MOV     A,R7
   \   000047   3400         ADDC    A,#0x0
   \   000049   FD           MOV     R5,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   FA           MOV     R2,A
   \   00004D   A3           INC     DPTR
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   FB           MOV     R3,A
   \   000050   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1150                    }
   1151                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   000053                ; Setup parameters for call to function osal_mem_free
   \   000053   EE           MOV     A,R6
   \   000054   FA           MOV     R2,A
   \   000055   EF           MOV     A,R7
   \   000056   FB           MOV     R3,A
   \   000057   12....       LCALL   ??osal_mem_free?relay
   \   00005A   801E         SJMP    ??ZDApp_ProcessMsgCBs_2
   1152                  }
   1153                }
   1154                break;
   1155          #endif
   1156                
   1157          #if defined ( REFLECTOR )
   1158              case Bind_req:
   1159              case Unbind_req:
   1160                {
   1161                  ZDO_BindUnbindReq_t bindReq;
   1162                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   00005C                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   00005C   85..82       MOV     DPL,?XSP + 0
   \   00005F   85..83       MOV     DPH,?XSP + 1
   \   000062   AC82         MOV     R4,DPL
   \   000064   AD83         MOV     R5,DPH
   \   000066   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1163                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000069                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000069   85..82       MOV     DPL,?XSP + 0
   \   00006C   85..83       MOV     DPH,?XSP + 1
   \   00006F   AC82         MOV     R4,DPL
   \   000071   AD83         MOV     R5,DPH
   \   000073   EE           MOV     A,R6
   \   000074   FA           MOV     R2,A
   \   000075   EF           MOV     A,R7
   \   000076   FB           MOV     R3,A
   \   000077   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1164                }
   1165                break;
   1166          #endif      
   1167                
   1168          #if defined ( ZDO_COORDINATOR )
   1169              case Bind_rsp:
   1170              case Unbind_rsp:
   1171                if ( matchED )
   1172                {
   1173                  ZDMatchSendState(
   1174                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1175                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1176                }
   1177                break;
   1178                
   1179              case End_Device_Bind_req:
   1180                {
   1181                  ZDEndDeviceBind_t bindReq;
   1182                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1183                  ZDO_MatchEndDeviceBind( &bindReq );
   1184                  
   1185                  // Freeing the cluster lists - if allocated.
   1186                  if ( bindReq.numInClusters )
   1187                    osal_mem_free( bindReq.inClusters );
   1188                  if ( bindReq.numOutClusters )
   1189                    osal_mem_free( bindReq.outClusters );
   1190                }
   1191                break;
   1192          #endif      
   1193            }
   1194          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00007A   7415         MOV     A,#0x15
   \   00007C   02....       LJMP    ??Subroutine15_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F5..         MOV     ?V0 + 0,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   EE           MOV     A,R6
   \   000001   240C         ADD     A,#0xc
   \   000003   F582         MOV     DPL,A
   \   000005   EF           MOV     A,R7
   \   000006   3400         ADDC    A,#0x0
   \   000008   F583         MOV     DPH,A
   \   00000A   22           RET
   1195          
   1196          /*********************************************************************
   1197           * @fn      ZDApp_RegisterCBs()
   1198           *
   1199           * @brief   Process response messages
   1200           *
   1201           * @param   none
   1202           *
   1203           * @return  none
   1204           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1205          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1206          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1207          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1208            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine4 & 0xFFFF
   1209          #endif
   1210          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1211            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_5:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine4 & 0xFFFF
   1212          #endif  
   1213          #if defined ( ZDO_COORDINATOR )
   1214            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1215            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1216            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1217          #endif
   1218          #if defined ( REFLECTOR )
   1219            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_6:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??Subroutine4_0 & 0xFFFF
   1220            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_7:
   \   000015                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000015   7A22         MOV     R2,#0x22
   \   000017   7B00         MOV     R3,#0x0
   \   000019   12....       LCALL   ??Subroutine4_0 & 0xFFFF
   1221          #endif  
   1222          }
   \                     ??CrossCallReturnLabel_8:
   \   00001C   02....       LJMP    ??Subroutine14_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7B80         MOV     R3,#-0x80
   \                     ??Subroutine4_0:
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   00000A   22           RET
   1223          
   1224          #if !defined( ZDO_COORDINATOR ) || defined( SOFT_START )
   1225          /*********************************************************************
   1226           * @fn      ZDApp_ProcessNetworkJoin()
   1227           *
   1228           * @brief
   1229           *
   1230           *   Save off the Network key information.
   1231           *
   1232           * @param   none
   1233           *
   1234           * @return  none
   1235           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1236          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1237          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1238            if ( (devState == DEV_NWK_JOINING) ||
   1239                ((devState == DEV_NWK_ORPHAN)  &&
   1240                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1241            {
   1242              // Result of a Join attempt by this device.
   1243              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   700E         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1244              {
   1245                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   7A10         MOV     R2,#0x10
   \   00002F   12....       LCALL   ?Subroutine17 & 0xFFFF
   1246          
   1247          #if defined ( POWER_SAVING )
   1248                osal_pwrmgr_device( PWRMGR_BATTERY );
   1249          #endif
   1250          
   1251          #if   ( SECURE != 0  )
   1252                if ( _NIB.SecurityLevel && (ZDApp_RestoreNwkKey() == false ) )
   1253                {
   1254                  // wait for auth from trust center!!
   1255                  devState = DEV_END_DEVICE_UNAUTH;
   1256          
   1257                  // Start the reset timer for MAX UNAUTH time
   1258                  ZDApp_ResetTimerStart( MAX_DEVICE_UNAUTH_TIMEOUT );
   1259                }
   1260                else
   1261          #endif  // SECURE
   1262                {
   1263          #if defined ( RTR_NWK )
   1264                  if ( devState == DEV_NWK_ORPHAN
   1265                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1266                  {
   1267                    // Change NIB state to router for restore
   1268                    _NIB.nwkState = NWK_ROUTER;
   1269                  }
   1270          #endif
   1271                  devState = DEV_END_DEVICE;
   \                     ??CrossCallReturnLabel_32:
   \   000032   7406         MOV     A,#0x6
   \   000034   90....       MOV     DPTR,#devState
   \   000037   F0           MOVX    @DPTR,A
   \   000038   02....       LJMP    ??CrossCallReturnLabel_37 & 0xFFFF
   1272          #if defined ( RTR_NWK )
   1273                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1274            #if !defined (AUTO_SOFT_START)
   1275                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1276                  {
   1277                    NLME_StartRouterRequest( 0, 0, false );
   1278                  }
   1279            #endif // AUTO_SOFT_START
   1280          #endif  // RTR
   1281          
   1282          #if defined ( ZDO_ENDDEVICE_ANNCE_GENERATE )
   1283                  ZDP_EndDeviceAnnce( ZDAppNwkAddr.addr.shortAddr, saveExtAddr,
   1284                                     ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   1285          #endif
   1286                }
   1287              }
   1288              else
   1289              {
   1290                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   00003B   90....       MOV     DPTR,#devStartMode
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   6401         XRL     A,#0x1
   \   000041   7036         JNZ     ??ZDApp_ProcessNetworkJoin_4
   \   000043   90....       MOV     DPTR,#retryCnt
   \   000046   E0           MOVX    A,@DPTR
   \   000047   04           INC     A
   \   000048   F0           MOVX    @DPTR,A
   \   000049   602E         JZ      ??ZDApp_ProcessNetworkJoin_4
   1291                {
   1292                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00004B   90....       MOV     DPTR,#(_NIB + 33)
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   64FF         XRL     A,#0xff
   \   000051   7004         JNZ     ??ZDApp_ProcessNetworkJoin_5
   \   000053   A3           INC     DPTR
   \   000054   E0           MOVX    A,@DPTR
   \   000055   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   000057   600E         JZ      ??ZDApp_ProcessNetworkJoin_6
   \   000059   90....       MOV     DPTR,#(_NIB + 33)
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   64FE         XRL     A,#0xfe
   \   00005F   7004         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   000061   A3           INC     DPTR
   \   000062   E0           MOVX    A,@DPTR
   \   000063   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   000065   7006         JNZ     ??ZDApp_ProcessNetworkJoin_8
   1293                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   000067   E4           CLR     A
   \   000068   90....       MOV     DPTR,#devStartMode
   \   00006B   800B         SJMP    ??ZDApp_ProcessNetworkJoin_9
   1294                  else
   1295                  {
   1296                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   00006D   7403         MOV     A,#0x3
   \   00006F   90....       MOV     DPTR,#devStartMode
   \   000072   F0           MOVX    @DPTR,A
   1297                    _tmpRejoinState = true;
   \   000073   7401         MOV     A,#0x1
   \   000075   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   000078   F0           MOVX    @DPTR,A
   1298                  }
   1299                }
   1300          
   1301                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1302                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000079                ; Setup parameters for call to function NLME_GetShortAddr
   \   000079   12....       LCALL   ??NLME_GetShortAddr?relay
   \   00007C   8A..         MOV     ?V0 + 0,R2
   \   00007E   8B..         MOV     ?V0 + 1,R3
   \   000080   74FE         MOV     A,#-0x2
   \   000082   65..         XRL     A,?V0 + 0
   \   000084   7004         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   000086   74FF         MOV     A,#-0x1
   \   000088   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   00008A   700E         JNZ     ??ZDApp_ProcessNetworkJoin_11
   \   00008C   90....       MOV     DPTR,#(_NIB + 20)
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   64FE         XRL     A,#0xfe
   \   000092   7004         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   000094   A3           INC     DPTR
   \   000095   E0           MOVX    A,@DPTR
   \   000096   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   000098   6026         JZ      ??ZDApp_ProcessNetworkJoin_13
   1303                {
   1304                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   00009A   85..82       MOV     DPL,?XSP + 0
   \   00009D   85..83       MOV     DPH,?XSP + 1
   \   0000A0   74FE         MOV     A,#-0x2
   \   0000A2   F0           MOVX    @DPTR,A
   \   0000A3   A3           INC     DPTR
   \   0000A4   74FF         MOV     A,#-0x1
   \   0000A6   F0           MOVX    @DPTR,A
   1305                  // Invalidate nwk addr so end device does not use in its data reqs.
   1306                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000A7   90....       MOV     DPTR,#(_NIB + 20)
   \   0000AA   74FE         MOV     A,#-0x2
   \   0000AC   F0           MOVX    @DPTR,A
   \   0000AD   A3           INC     DPTR
   \   0000AE   74FF         MOV     A,#-0x1
   \   0000B0   F0           MOVX    @DPTR,A
   1307                  ZMacSetReq( ZMacShortAddress, (byte *)&addr );
   \   0000B1                ; Setup parameters for call to function ZMacSetReq
   \   0000B1   85..82       MOV     DPL,?XSP + 0
   \   0000B4   85..83       MOV     DPH,?XSP + 1
   \   0000B7   AA82         MOV     R2,DPL
   \   0000B9   AB83         MOV     R3,DPH
   \   0000BB   7953         MOV     R1,#0x53
   \   0000BD   12....       LCALL   ZMacSetReq & 0xFFFF
   1308                }
   1309          
   1310                zdoDiscCounter = 1;
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000C0   7401         MOV     A,#0x1
   \   0000C2   90....       MOV     DPTR,#zdoDiscCounter
   \   0000C5   805A         SJMP    ??ZDApp_ProcessNetworkJoin_14
   \   0000C7                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000C7                ; Setup parameters for call to function osal_rand
   1311          
   1312          //      ZDApp_NetworkInit( (uint16)
   1313          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1314          //                          (NWK_START_DELAY * 5)) );
   1315                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1316                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1317              }
   1318            }
   1319            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000C7   E0           MOVX    A,@DPTR
   \   0000C8   6404         XRL     A,#0x4
   \   0000CA   7059         JNZ     ??CrossCallReturnLabel_37
   1320            {
   1321              // results of an orphaning attempt by this device
   1322              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000CC   90....       MOV     DPTR,#nwkStatus
   \   0000CF   E0           MOVX    A,@DPTR
   \   0000D0   7012         JNZ     ??ZDApp_ProcessNetworkJoin_15
   1323              {
   1324          #if ( SECURE != 0 )
   1325                ZDApp_RestoreNwkKey();
   1326          #endif
   1327                devState = DEV_END_DEVICE;
   \   0000D2   7406         MOV     A,#0x6
   \   0000D4   12....       LCALL   ?Subroutine0 & 0xFFFF
   1328                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1329                // setup Power Manager Device
   1330          #if defined ( POWER_SAVING )
   1331                osal_pwrmgr_device( PWRMGR_BATTERY );
   1332          #endif
   1333          
   1334                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_30:
   \   0000D7   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000DD   5046         JNC     ??CrossCallReturnLabel_37
   1335                {
   1336                  // The receiver is on, turn network layer polling off.
   1337                  NLME_SetPollRate( 0 );
   \   0000DF                ; Setup parameters for call to function NLME_SetPollRate
   \   0000DF   12....       LCALL   ?Subroutine9 & 0xFFFF
   1338                  NLME_SetQueuedPollRate( 0 );
   1339                  NLME_SetResponseRate( 0 );
   \                     ??CrossCallReturnLabel_13:
   \   0000E2   8041         SJMP    ??CrossCallReturnLabel_37
   1340                }
   1341          
   1342          #if defined ( ZDO_ENDDEVICE_ANNCE_GENERATE )
   1343                ZDP_EndDeviceAnnce( ZDAppNwkAddr.addr.shortAddr, saveExtAddr,
   1344                                   ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   1345          #endif
   1346          
   1347              }
   1348              else
   1349              {
   1350                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0000E4   90....       MOV     DPTR,#devStartMode
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   6401         XRL     A,#0x1
   \   0000EA   7036         JNZ     ??ZDApp_ProcessNetworkJoin_16
   \   0000EC   90....       MOV     DPTR,#retryCnt
   \   0000EF   E0           MOVX    A,@DPTR
   \   0000F0   04           INC     A
   \   0000F1   F0           MOVX    @DPTR,A
   \   0000F2   602E         JZ      ??ZDApp_ProcessNetworkJoin_16
   1351                {
   1352                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   0000F4   90....       MOV     DPTR,#(_NIB + 33)
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   64FF         XRL     A,#0xff
   \   0000FA   7004         JNZ     ??ZDApp_ProcessNetworkJoin_17
   \   0000FC   A3           INC     DPTR
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000100   600E         JZ      ??ZDApp_ProcessNetworkJoin_18
   \   000102   90....       MOV     DPTR,#(_NIB + 33)
   \   000105   E0           MOVX    A,@DPTR
   \   000106   64FE         XRL     A,#0xfe
   \   000108   7004         JNZ     ??ZDApp_ProcessNetworkJoin_19
   \   00010A   A3           INC     DPTR
   \   00010B   E0           MOVX    A,@DPTR
   \   00010C   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   00010E   7006         JNZ     ??ZDApp_ProcessNetworkJoin_20
   1353                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   000110   E4           CLR     A
   \   000111   90....       MOV     DPTR,#devStartMode
   \   000114   800B         SJMP    ??ZDApp_ProcessNetworkJoin_14
   1354                  else
   1355                  {
   1356                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   000116   7403         MOV     A,#0x3
   \   000118   90....       MOV     DPTR,#devStartMode
   \   00011B   F0           MOVX    @DPTR,A
   1357                    _tmpRejoinState = true;
   \   00011C   7401         MOV     A,#0x1
   \   00011E   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   000121   F0           MOVX    @DPTR,A
   1358                  }
   1359                }
   1360          
   1361                // setup a retry for later...
   1362                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1363                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   000122                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000122                ; Setup parameters for call to function osal_rand
   \   000122   12....       LCALL   ?Subroutine8 & 0xFFFF
   1364              }
   1365            }
   1366            else
   1367            {
   1368              // this is an error case!!
   1369            }
   1370          }
   \                     ??CrossCallReturnLabel_37:
   \   000125   02....       LJMP    ?Subroutine15 & 0xFFFF
   1371          #endif // !ZDO_COORDINATOR
   1372          
   1373          #if ( SECURE != 0 )
   1374          /*********************************************************************
   1375           * @fn      ZDApp_SaveNwkKey()
   1376           *
   1377           * @brief   Save off the Network key information.
   1378           *
   1379           * @param   none
   1380           *
   1381           * @return  none
   1382           */
   1383          void ZDApp_SaveNwkKey( void )
   1384          {
   1385            nwkActiveKeyItems keyItems;
   1386          
   1387            SSP_ReadNwkActiveKey( &keyItems );
   1388            keyItems.frameCounter++;
   1389          
   1390            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1391                          (void *)&keyItems );
   1392          
   1393            nwkFrameCounterChanges = 0;
   1394          }
   1395          
   1396          /*********************************************************************
   1397           * @fn      ZDApp_ResetNwkKey()
   1398           *
   1399           * @brief   Reset the Network key information in NV.
   1400           *
   1401           * @param   none
   1402           *
   1403           * @return  none
   1404           */
   1405          void ZDApp_ResetNwkKey( void )
   1406          {
   1407            nwkActiveKeyItems keyItems;
   1408          
   1409            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   1410            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1411                          (void *)&keyItems );
   1412          }
   1413          #endif
   1414          
   1415          #if ( SECURE != 0 )
   1416          /*********************************************************************
   1417           * @fn      ZDApp_RestoreNwkKey()
   1418           *
   1419           * @brief
   1420           *
   1421           *   Save off the Network key information.
   1422           *
   1423           * @param   none
   1424           *
   1425           * @return  true if restored from NV, false if not
   1426           */
   1427          byte ZDApp_RestoreNwkKey( void )
   1428          {
   1429            nwkActiveKeyItems keyItems;
   1430            byte ret = false;
   1431          
   1432            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1433                == ZSUCCESS )
   1434            {
   1435              if ( keyItems.frameCounter > 0 )
   1436              {
   1437                // Restore the key information
   1438                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1439                nwkFrameCounter = keyItems.frameCounter;
   1440                ret = true;
   1441              }
   1442          
   1443              // Force a save for the first frame counter increment
   1444              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   1445            }
   1446            return ( ret );
   1447          }
   1448          #endif
   1449          
   1450          /*********************************************************************
   1451           * @fn      ZDApp_ResetTimerStart
   1452           *
   1453           * @brief   Start the reset timer.
   1454           *
   1455           * @param   delay - delay time(ms) before reset
   1456           *
   1457           * @return  none
   1458           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1459          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1460          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1461            // Start the rest timer
   1462            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine7 & 0xFFFF
   1463          }
   \                     ??CrossCallReturnLabel_9:
   \   00000D   02....       LJMP    ??Subroutine14_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7B00         MOV     R3,#0x0
   \                     ??Subroutine7_0:
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_start_timerEx?relay
   \   00000A   22           RET
   1464          
   1465          /*********************************************************************
   1466           * @fn      ZDApp_ResetTimerCancel
   1467           *
   1468           * @brief   Cancel the reset timer.
   1469           *
   1470           * @param   none
   1471           *
   1472           * @return  none
   1473           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1474          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1475          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1476            // Cancel the reset timer
   1477            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1478          }
   \   000010   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   1479          
   1480          /*********************************************************************
   1481           * @fn      ZDApp_LeaveCtrlInit
   1482           *
   1483           * @brief   Initialize the leave control logic.
   1484           *
   1485           * @param   none
   1486           *
   1487           * @return  none
   1488           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1489          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1490          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1491            uint8 status;
   1492          
   1493          
   1494            // Initialize control state
   1495            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine2 & 0xFFFF
   1496          
   1497            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1498                                        sizeof(ZDApp_LeaveCtrl),
   1499                                        &ZDApp_LeaveCtrl );
   1500          
   1501            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_0:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1502            {
   1503              // Read saved control
   1504              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1505                            0,
   1506                            sizeof( uint8 ),
   1507                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1508            }
   1509          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine15_1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E4           CLR     A
   \   000001   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000008   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1510          
   1511          /*********************************************************************
   1512           * @fn      ZDApp_LeaveCtrlSet
   1513           *
   1514           * @brief   Set the leave control logic.
   1515           *
   1516           * @param   ra - reassociate flag
   1517           *
   1518           * @return  none
   1519           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1520          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1521          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1522            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000005   7401         MOV     A,#0x1
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   F0           MOVX    @DPTR,A
   1523          
   1524            if ( ra == TRUE )
   \   00000B   69           XRL     A,R1
   \   00000C   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1525            {
   1526              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   00000E   7403         MOV     A,#0x3
   \   000010   F0           MOVX    @DPTR,A
   1527            }
   1528          
   1529            // Write the leave control
   1530            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1531                           0,
   1532                           sizeof( uint8 ),
   1533                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000014   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000017   78..         MOV     R0,#?V0 + 0
   \   000019   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001C   75..01       MOV     ?V0 + 0,#0x1
   \   00001F   75..00       MOV     ?V0 + 1,#0x0
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A85         MOV     R2,#-0x7b
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_write?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   02....       LJMP    ??Subroutine15_0 & 0xFFFF
   1534          }
   1535          
   1536          /*********************************************************************
   1537           * @fn      ZDApp_LeaveCtrlBypass
   1538           *
   1539           * @brief   Check if NV restore should be skipped during a leave reset.
   1540           *
   1541           * @param   none
   1542           *
   1543           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1544           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1545          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1546          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1547            uint8 bypass;
   1548          
   1549            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1550            {
   1551              bypass = TRUE;
   1552            }
   1553            else
   1554            {
   1555              bypass = FALSE;
   1556            }
   1557          
   1558            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   92E0         MOV     0xE0 /* A   */.0,C
   \   00000D   F9           MOV     R1,A
   \   00000E   80..         SJMP    ??Subroutine14_0
   1559          }
   1560          
   1561          /*********************************************************************
   1562           * @fn      ZDApp_LeaveCtrlStartup
   1563           *
   1564           * @brief   Check for startup conditions during a leave reset.
   1565           *
   1566           * @param   state      - devState_t determined by leave control logic
   1567           * @param   startDelay - startup delay
   1568           *
   1569           * @return  none
   1570           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1571          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1572          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1573            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1574          
   1575            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5037         JNC     ??ZDApp_LeaveCtrlStartup_0
   1576            {
   1577              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1578              {
   1579                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1580              }
   1581              else
   1582              {
   1583                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   E4           CLR     A
   \   000026   8A82         MOV     DPL,R2
   \   000028   8B83         MOV     DPH,R3
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1584              }
   1585          
   1586              // Set leave control to initialized state
   1587              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine2 & 0xFFFF
   1588          
   1589              // Write initialized control
   1590              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1591                            0,
   1592                            sizeof( uint8 ),
   1593                            &ZDApp_LeaveCtrl);
   \                     ??CrossCallReturnLabel_1:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   7B00         MOV     R3,#0x0
   \   000044   12....       LCALL   ??osal_nv_write?relay
   \   000047   7404         MOV     A,#0x4
   \   000049   12....       LCALL   ?DEALLOC_XSTACK8
   1594            }
   1595          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   00004C   02....       LJMP    ??Subroutine15_1 & 0xFFFF
   1596          
   1597          /*********************************************************************
   1598           * @fn      ZDApp_LeaveReset
   1599           *
   1600           * @brief   Setup a device reset due to a leave indication/confirm.
   1601           *
   1602           * @param   ra - reassociate flag
   1603           *
   1604           * @return  none
   1605           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1606          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1607          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1608            ZDApp_LeaveCtrlSet( ra );
   \   000004                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000004   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1609          
   1610            ZDApp_ResetTimerStart( 5000 );
   \   000007                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000007   7A88         MOV     R2,#-0x78
   \   000009   7B13         MOV     R3,#0x13
   \   00000B   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1611          }
   \   00000E   80..         SJMP    ??Subroutine14_0
   1612          
   1613          /*********************************************************************
   1614           * @fn      ZDApp_LeaveUpdate
   1615           *
   1616           * @brief   Update local device data related to leaving device.
   1617           *
   1618           * @param   nwkAddr        - NWK address of leaving device
   1619           * @param   extAddr        - EXT address of leaving device
   1620           * @param   removeChildren - remove children of leaving device
   1621           *
   1622           * @return  none
   1623           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1624          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1625                                  uint8 removeChildren )
   1626          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EC           MOV     A,R4
   \   000005   FA           MOV     R2,A
   \   000006   ED           MOV     A,R5
   \   000007   FB           MOV     R3,A
   1627            /*
   1628            AddrMgrEntry_t entry;
   1629            */
   1630          
   1631          
   1632            // Remove if child
   1633            NLME_RemoveChild( extAddr, removeChildren );
   \   000008                ; Setup parameters for call to function NLME_RemoveChild
   \   000008   12....       LCALL   ??NLME_RemoveChild?relay
   1634          
   1635            /*
   1636            // Set NWK address to invalid
   1637            entry.user    = ADDRMGR_USER_DEFAULT;
   1638            entry.nwkAddr = INVALID_NODE_ADDR;
   1639            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1640            AddrMgrEntryUpdate( &entry );
   1641          
   1642            // Check
   1643            if ( removeChildren == TRUE )
   1644            {
   1645              // Set index to INVALID_NODE_ADDR to start search
   1646              entry.index = INVALID_NODE_ADDR;
   1647          
   1648              // Get first entry
   1649              AddrMgrEntryGetNext( &entry );
   1650          
   1651              // Remove all descendents
   1652              while ( entry.index != INVALID_NODE_ADDR )
   1653              {
   1654                // Check NWK address allocation algorithm
   1655                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1656                {
   1657                  // Set NWK address to invalid
   1658                  entry.nwkAddr = INVALID_NODE_ADDR;
   1659                  AddrMgrEntryUpdate( &entry );
   1660                }
   1661          
   1662                // Get next entry
   1663                AddrMgrEntryGetNext( &entry );
   1664              }
   1665            }
   1666            */
   1667          }
   \   00000B   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   1668          
   1669          /*********************************************************************
   1670           * CALLBACK FUNCTIONS
   1671           */
   1672          
   1673          /*********************************************************************
   1674           * @fn      ZDApp_SendEventMsg()
   1675           *
   1676           * @brief
   1677           *
   1678           *   Sends a Network Join message
   1679           *
   1680           * @param  cmd - command ID
   1681           * @param  len - length (in bytes) of the buf field
   1682           * @param  buf - buffer for the rest of the message.
   1683           *
   1684           * @return  none
   1685           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1686          void ZDApp_SendEventMsg( byte cmd, byte len, byte *buf )
   \                     ZDApp_SendEventMsg:
   1687          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1688            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000004                ; Setup parameters for call to function ZDApp_SendMsg
   \   000004   EA           MOV     A,R2
   \   000005   FB           MOV     R3,A
   \   000006   E9           MOV     A,R1
   \   000007   FA           MOV     R2,A
   \   000008   02....       LJMP    ?Subroutine14 & 0xFFFF
   1689          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1690          
   1691          /*********************************************************************
   1692           * @fn      ZDApp_SendMsg()
   1693           *
   1694           * @brief   Sends a OSAL message
   1695           *
   1696           * @param  taskID - Where to send the message
   1697           * @param  cmd - command ID
   1698           * @param  len - length (in bytes) of the buf field
   1699           * @param  buf - buffer for the rest of the message.
   1700           *
   1701           * @return  none
   1702           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1703          void ZDApp_SendMsg( byte taskID, byte cmd, byte len, byte *buf )
   \                     ZDApp_SendMsg:
   1704          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   8A..         MOV     ?V0 + 3,R2
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   \   00000B   8C..         MOV     ?V0 + 6,R4
   \   00000D   8D..         MOV     ?V0 + 7,R5
   1705            osal_event_hdr_t *msgPtr;
   1706          
   1707            // Send the address to the task
   1708            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F                ; Setup parameters for call to function osal_msg_allocate
   \   00000F   FA           MOV     R2,A
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??osal_msg_allocate?relay
   \   000015   8A..         MOV     ?V0 + 4,R2
   \   000017   8B..         MOV     ?V0 + 5,R3
   1709            if ( msgPtr )
   \   000019   EA           MOV     A,R2
   \   00001A   7001         JNZ     ??ZDApp_SendMsg_0
   \   00001C   EB           MOV     A,R3
   \                     ??ZDApp_SendMsg_0:
   \   00001D   6037         JZ      ??ZDApp_SendMsg_1
   1710            {
   1711              if ( (len > 0) && (buf != NULL) )
   \   00001F   EF           MOV     A,R7
   \   000020   6022         JZ      ??ZDApp_SendMsg_2
   \   000022   E5..         MOV     A,?V0 + 6
   \   000024   7002         JNZ     ??ZDApp_SendMsg_3
   \   000026   E5..         MOV     A,?V0 + 7
   \                     ??ZDApp_SendMsg_3:
   \   000028   601A         JZ      ??ZDApp_SendMsg_2
   1712                osal_memcpy( msgPtr, buf, len );
   \   00002A                ; Setup parameters for call to function osal_memcpy
   \   00002A   85....       MOV     ?V0 + 0,?V0 + 6
   \   00002D   85....       MOV     ?V0 + 1,?V0 + 7
   \   000030   75..00       MOV     ?V0 + 2,#0x0
   \   000033   78..         MOV     R0,#?V0 + 0
   \   000035   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000038   EF           MOV     A,R7
   \   000039   FC           MOV     R4,A
   \   00003A   7D00         MOV     R5,#0x0
   \   00003C   12....       LCALL   ??osal_memcpy?relay
   \   00003F   7403         MOV     A,#0x3
   \   000041   12....       LCALL   ?DEALLOC_XSTACK8
   1713          
   1714              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   000044   85..82       MOV     DPL,?V0 + 4
   \   000047   85..83       MOV     DPH,?V0 + 5
   \   00004A   E5..         MOV     A,?V0 + 3
   \   00004C   F0           MOVX    @DPTR,A
   1715              osal_msg_send( taskID, (byte *)msgPtr );
   \   00004D                ; Setup parameters for call to function osal_msg_send
   \   00004D   AA..         MOV     R2,?V0 + 4
   \   00004F   AB..         MOV     R3,?V0 + 5
   \   000051   EE           MOV     A,R6
   \   000052   F9           MOV     R1,A
   \   000053   12....       LCALL   ??osal_msg_send?relay
   1716            }
   1717          }
   \                     ??ZDApp_SendMsg_1:
   \   000056   7F08         MOV     R7,#0x8
   \   000058   02....       LJMP    ?BANKED_LEAVE_XDATA
   1718          
   1719          /*********************************************************************
   1720           * Call Back Functions from NWK  - API
   1721           */
   1722          
   1723          /*********************************************************************
   1724           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1725           *
   1726           * @brief       This function returns a choice of PAN to join.
   1727           *
   1728           * @param       ResultCount - Number of routers discovered
   1729           * @param               NetworkList - Pointer to list of network descriptors
   1730           *
   1731           * @return      ZStatus_t
   1732           */
   1733          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1734          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( byte ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1735                                                   networkDesc_t *NetworkList )
   1736          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   F8           MOV     R0,A
   \   00000E   EB           MOV     A,R3
   \   00000F   F9           MOV     R1,A
   1737            networkDesc_t *pNwkDesc;
   1738            ZDO_NetworkDiscoveryCfm_t msg;
   1739            byte  i;
   1740            uint8 stackProfile;
   1741            uint8 stackProfilePro;
   1742            uint8 selected;
   1743          
   1744          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1745            if ( zdappMgmtNwkDiscReqInProgress )
   1746            {
   1747              zdappMgmtNwkDiscReqInProgress = false;
   1748              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1749              return ( ZSuccess );
   1750            }
   1751          #endif
   1752          
   1753            // process discovery results
   1754            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 1,#0x0
   1755            selected = FALSE;
   1756          
   1757            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000013   7F00         MOV     R7,#0x0
   1758            {
   1759              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000015   E8           MOV     A,R0
   \   000016   FA           MOV     R2,A
   \   000017   E9           MOV     A,R1
   \   000018   FB           MOV     R3,A
   1760              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   000019   75..00       MOV     ?V0 + 0,#0x0
   \   00001C   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_1 & 0xFFFF
   1761              {
   1762                if ( zgConfigPANID != 0xFFFF )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00001F   90....       MOV     DPTR,#zgConfigPANID
   \   000022   E0           MOVX    A,@DPTR
   \   000023   64FF         XRL     A,#0xff
   \   000025   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000027   A3           INC     DPTR
   \   000028   E0           MOVX    A,@DPTR
   \   000029   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00002B   6017         JZ      ??ZDO_NetworkDiscoveryConfirmCB_4
   1763                {
   1764                  // PAN Id is preconfigured. check if it matches
   1765                  // only 14 bits of pan id is used
   1766                  if ( pNwkDesc->panId != ( zgConfigPANID & 0x3FFF ) )
   \   00002D   90....       MOV     DPTR,#zgConfigPANID
   \   000030   E0           MOVX    A,@DPTR
   \   000031   FC           MOV     R4,A
   \   000032   A3           INC     DPTR
   \   000033   E0           MOVX    A,@DPTR
   \   000034   543F         ANL     A,#0x3f
   \   000036   FD           MOV     R5,A
   \   000037   8B83         MOV     DPH,R3
   \   000039   8A82         MOV     DPL,R2
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   6C           XRL     A,R4
   \   00003D   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   \   00003F   A3           INC     DPTR
   \   000040   E0           MOVX    A,@DPTR
   \   000041   6D           XRL     A,R5
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   000042   704D         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   1767                    continue;
   1768                }
   1769          
   1770                // check that network is allowing joining
   1771                //------------------------------------------------------------
   1772                #if defined( RTR_NWK )
   1773                //------------------------------------------------------------
   1774                if ( stackProfilePro == FALSE )
   1775                {
   1776                  if ( !pNwkDesc->routerCapacity )
   1777                  {
   1778                    continue;
   1779                  }
   1780                }
   1781                else
   1782                {
   1783                  if ( !pNwkDesc->deviceCapacity )
   1784                  {
   1785                    continue;
   1786                  }
   1787                }
   1788                //------------------------------------------------------------
   1789                #else
   1790                //------------------------------------------------------------
   1791                if ( !pNwkDesc->deviceCapacity )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000044   8A82         MOV     DPL,R2
   \   000046   8B83         MOV     DPH,R3
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   A3           INC     DPTR
   \   00004B   A3           INC     DPTR
   \   00004C   A3           INC     DPTR
   \   00004D   A3           INC     DPTR
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6040         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   1792                {
   1793                  continue;
   1794                }
   1795                //------------------------------------------------------------
   1796                #endif
   1797                //------------------------------------------------------------
   1798                // check version of zigbee protocol
   1799                if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   \   000051   8A82         MOV     DPL,R2
   \   000053   8B83         MOV     DPH,R3
   \   000055   A3           INC     DPTR
   \   000056   A3           INC     DPTR
   \   000057   A3           INC     DPTR
   \   000058   A3           INC     DPTR
   \   000059   A3           INC     DPTR
   \   00005A   A3           INC     DPTR
   \   00005B   A3           INC     DPTR
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   FC           MOV     R4,A
   \   00005E   90....       MOV     DPTR,#(_NIB + 17)
   \   000061   E0           MOVX    A,@DPTR
   \   000062   6C           XRL     A,R4
   \   000063   702C         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   1800                  continue;
   1801          
   1802                // check version of stack profile
   1803                if ( pNwkDesc->stackProfile != zgStackProfile  )
   \   000065   8A82         MOV     DPL,R2
   \   000067   8B83         MOV     DPH,R3
   \   000069   A3           INC     DPTR
   \   00006A   A3           INC     DPTR
   \   00006B   A3           INC     DPTR
   \   00006C   A3           INC     DPTR
   \   00006D   A3           INC     DPTR
   \   00006E   A3           INC     DPTR
   \   00006F   A3           INC     DPTR
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   FC           MOV     R4,A
   \   000073   90....       MOV     DPTR,#zgStackProfile
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6C           XRL     A,R4
   \   000078   604C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_7
   1804                {
   1805                  if ( pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE )
   \   00007A   8A82         MOV     DPL,R2
   \   00007C   8B83         MOV     DPH,R3
   \   00007E   A3           INC     DPTR
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   A3           INC     DPTR
   \   000084   A3           INC     DPTR
   \   000085   A3           INC     DPTR
   \   000086   E0           MOVX    A,@DPTR
   \   000087   6402         XRL     A,#0x2
   \   000089   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   1806                    stackProfilePro = TRUE;
   \   00008B   75..01       MOV     ?V0 + 1,#0x1
   1807                  
   1808                  if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   00008E   EF           MOV     A,R7
   \   00008F   7035         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_7
   1809                  {
   1810                    continue;
   1811                  }
   1812                }
   1813          
   1814                // check if beacon order is the right value..
   1815                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1816                //    continue;
   1817          
   1818                // choose this pan for joining
   1819                break;
   1820              } 
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000091   05..         INC     ?V0 + 0
   \   000093   EA           MOV     A,R2
   \   000094   2415         ADD     A,#0x15
   \   000096   F582         MOV     DPL,A
   \   000098   EB           MOV     A,R3
   \   000099   12....       LCALL   ??Subroutine12_1 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   00009C   FA           MOV     R2,A
   \   00009D   A3           INC     DPTR
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   FB           MOV     R3,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   0000A0   E5..         MOV     A,?V0 + 0
   \   0000A2   C3           CLR     C
   \   0000A3   9E           SUBB    A,R6
   \   0000A4   5003         JNC     $+5
   \   0000A6   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   1821              
   1822              if (i < ResultCount)
   1823              {
   1824               selected = TRUE;
   1825                break;
   1826              }
   1827             
   1828              // break if selected or stack profile pro wasn't found
   1829              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \   0000A9   E5..         MOV     A,?V0 + 1
   \   0000AB   600A         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   1830              {
   1831                break;
   1832              }
   1833            }
   \   0000AD   0F           INC     R7
   \   0000AE   EF           MOV     A,R7
   \   0000AF   C3           CLR     C
   \   0000B0   9402         SUBB    A,#0x2
   \   0000B2   5003         JNC     $+5
   \   0000B4   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1834          
   1835            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   0000B7   EE           MOV     A,R6
   \   0000B8   65..         XRL     A,?V0 + 0
   \   0000BA   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_7
   1836            {
   1837              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   0000BC   7401         MOV     A,#0x1
   \   0000BE   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C1   7401         MOV     A,#0x1
   \   0000C3   F0           MOVX    @DPTR,A
   \   0000C4   8058         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_10
   1838            }
   1839            else
   1840            {
   1841              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000C6   7401         MOV     A,#0x1
   \   0000C8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000CB   E4           CLR     A
   \   0000CC   F0           MOVX    @DPTR,A
   1842              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   0000CD   8A82         MOV     DPL,R2
   \   0000CF   8B83         MOV     DPH,R3
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   C0E0         PUSH    A
   \   0000D4   7402         MOV     A,#0x2
   \   0000D6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D9   D0E0         POP     A
   \   0000DB   12....       LCALL   ?Subroutine3 & 0xFFFF
   1843              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \                     ??CrossCallReturnLabel_2:
   \   0000DE   E0           MOVX    A,@DPTR
   \   0000DF   C0E0         PUSH    A
   \   0000E1   7403         MOV     A,#0x3
   \   0000E3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E6   D0E0         POP     A
   \   0000E8   12....       LCALL   ?Subroutine3 & 0xFFFF
   1844              msg.logicalChannel = pNwkDesc->logicalChannel;
   \                     ??CrossCallReturnLabel_3:
   \   0000EB   A3           INC     DPTR
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   C0E0         PUSH    A
   \   0000EF   7404         MOV     A,#0x4
   \   0000F1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F4   D0E0         POP     A
   \   0000F6   12....       LCALL   ?Subroutine3 & 0xFFFF
   1845              msg.version = pNwkDesc->version;
   \                     ??CrossCallReturnLabel_4:
   \   0000F9   A3           INC     DPTR
   \   0000FA   A3           INC     DPTR
   \   0000FB   A3           INC     DPTR
   \   0000FC   A3           INC     DPTR
   \   0000FD   A3           INC     DPTR
   \   0000FE   A3           INC     DPTR
   \   0000FF   E0           MOVX    A,@DPTR
   \   000100   C0E0         PUSH    A
   \   000102   7405         MOV     A,#0x5
   \   000104   12....       LCALL   ?XSTACK_DISP0_8
   \   000107   D0E0         POP     A
   \   000109   F0           MOVX    @DPTR,A
   1846              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   00010A                ; Setup parameters for call to function osal_cpyExtAddr
   \   00010A   EA           MOV     A,R2
   \   00010B   240D         ADD     A,#0xd
   \   00010D   FC           MOV     R4,A
   \   00010E   EB           MOV     A,R3
   \   00010F   3400         ADDC    A,#0x0
   \   000111   FD           MOV     R5,A
   \   000112   7406         MOV     A,#0x6
   \   000114   12....       LCALL   ?XSTACK_DISP0_8
   \   000117   AA82         MOV     R2,DPL
   \   000119   AB83         MOV     R3,DPH
   \   00011B   12....       LCALL   ??osal_cpyExtAddr?relay
   1847            }
   1848          
   1849            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (byte *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   00011E                ; Setup parameters for call to function ZDApp_SendMsg
   \   00011E   85..82       MOV     DPL,?XSP + 0
   \   000121   85..83       MOV     DPH,?XSP + 1
   \   000124   AC82         MOV     R4,DPL
   \   000126   AD83         MOV     R5,DPH
   \   000128   7B0E         MOV     R3,#0xe
   \   00012A   7A01         MOV     R2,#0x1
   \   00012C   12....       LCALL   ?Subroutine5 & 0xFFFF
   1850          
   1851            return (ZSuccess);
   \                     ??CrossCallReturnLabel_27:
   \   00012F   7900         MOV     R1,#0x0
   \   000131   740E         MOV     A,#0xe
   \   000133   02....       LJMP    ??Subroutine15_0 & 0xFFFF
   1852          }  // ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8A82         MOV     DPL,R2
   \   000003   8B83         MOV     DPH,R3
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   EE           MOV     A,R6
   \   000001   240B         ADD     A,#0xb
   \                     ??Subroutine12_0:
   \   000003   F582         MOV     DPL,A
   \   000005   EF           MOV     A,R7
   \                     ??Subroutine12_1:
   \   000006   3400         ADDC    A,#0x0
   \   000008   F583         MOV     DPH,A
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   22           RET
   1853          
   1854          /*********************************************************************
   1855           * @fn          ZDO_NetworkFormationConfirmCB
   1856           *
   1857           * @brief       This function reports the results of the request to
   1858           *              initialize a coordinator in a network.
   1859           *
   1860           * @param       Status - Result of NLME_NetworkFormationRequest()
   1861           *
   1862           * @return      none
   1863           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1864          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   1865          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1866          #if defined(ZDO_COORDINATOR)
   1867            nwkStatus = (byte)Status;
   1868          
   1869            if ( Status == ZSUCCESS )
   1870            {
   1871              // LED on shows Coordinator started
   1872              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   1873          
   1874              // LED off forgets HOLD_AUTO_START
   1875              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   1876          
   1877          #if defined ( ZBIT )
   1878              SIM_SetColor(0xd0ffd0);
   1879          #endif
   1880          
   1881              if ( devState == DEV_HOLD )
   1882              {
   1883                // Began with HOLD_AUTO_START
   1884                devState = DEV_COORD_STARTING;
   1885              }
   1886            }
   1887          #if defined(BLINK_LEDS)
   1888            else
   1889              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   1890          #endif
   1891          
   1892            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   1893          #endif  //ZDO_COORDINATOR
   1894          }
   \   000000   02....       LJMP    ?BRET
   1895          
   1896          #if defined(RTR_NWK)
   1897          /*********************************************************************
   1898           * @fn          ZDO_StartRouterConfirmCB
   1899           *
   1900           * @brief       This function reports the results of the request to
   1901           *              start functioning as a router in a network.
   1902           *
   1903           * @param       Status - Result of NLME_StartRouterRequest()
   1904           *
   1905           * @return      none
   1906           */
   1907          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   1908          {
   1909            nwkStatus = (byte)Status;
   1910          
   1911            if ( Status == ZSUCCESS )
   1912            {
   1913              // LED on shows Router started
   1914              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   1915              // LED off forgets HOLD_AUTO_START
   1916              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   1917              if ( devState == DEV_HOLD )
   1918              {
   1919                // Began with HOLD_AUTO_START
   1920                devState = DEV_END_DEVICE;
   1921              }
   1922            }
   1923          #if defined(BLINK_LEDS)
   1924            else
   1925              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   1926          #endif
   1927          
   1928            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   1929          }
   1930          #endif  //RTR_NWK
   1931          
   1932          /*********************************************************************
   1933           * @fn          ZDO_JoinConfirmCB
   1934           *
   1935           * @brief       This function allows the next hight layer to be notified
   1936           *              of the results of its request to join itself or another
   1937           *              device to a network.
   1938           *
   1939           * @param       Status - Result of NLME_JoinRequest()
   1940           *
   1941           * @return      none
   1942           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1943          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   1944          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1945            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1946          
   1947            if ( Status == ZSUCCESS )
   \   000009   701C         JNZ     ??ZDO_JoinConfirmCB_0
   1948            {
   1949              // LED on shows device joined
   1950              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7904         MOV     R1,#0x4
   \   00000F   12....       LCALL   ??HalLedSet?relay
   1951              // LED off forgets HOLD_AUTO_START
   1952              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   7A00         MOV     R2,#0x0
   \   000014   7908         MOV     R1,#0x8
   \   000016   12....       LCALL   ??HalLedSet?relay
   1953              if ( (devState == DEV_HOLD) )
   \   000019   90....       MOV     DPTR,#devState
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   7003         JNZ     ??ZDO_JoinConfirmCB_1
   1954              {
   1955                // Began with HOLD_AUTO_START
   1956                devState = DEV_NWK_JOINING;
   \   00001F   7403         MOV     A,#0x3
   \   000021   F0           MOVX    @DPTR,A
   1957              }
   1958          #if !  ( SECURE != 0  )
   1959              // Notify to save info into NV
   1960              ZDApp_NVUpdate();
   \                     ??ZDO_JoinConfirmCB_1:
   \   000022                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000022   12....       LCALL   ??ZDApp_NVUpdate?relay
   \   000025   8007         SJMP    ??ZDO_JoinConfirmCB_2
   1961          #endif
   1962            }
   1963          #if defined(BLINK_LEDS)
   1964            else
   1965              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000027                ; Setup parameters for call to function HalLedSet
   \   000027   7A04         MOV     R2,#0x4
   \   000029   7904         MOV     R1,#0x4
   \   00002B   12....       LCALL   ??HalLedSet?relay
   1966          #endif
   1967          
   1968            // Notify ZDApp
   1969            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_2:
   \   00002E                ; Setup parameters for call to function ZDApp_SendMsg
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7B02         MOV     R3,#0x2
   \   000034   7A02         MOV     R2,#0x2
   \   000036   02....       LJMP    ?Subroutine14 & 0xFFFF
   1970          }
   1971          
   1972          /*********************************************************************
   1973           * @fn          ZDO_JoinIndicationCB
   1974           *
   1975           * @brief       This function allows the next higher layer of a
   1976           *              coordinator to be notified of a remote join request.
   1977           *
   1978           * @param       ShortAddress - 16-bit address
   1979           * @param       ExtendedAddress - IEEE (64-bit) address
   1980           * @param       CapabilityInformation - Association Capability Information
   1981           *
   1982           * @return      ZStatus_t
   1983           */
   1984          #if defined(RTR_NWK)
   1985          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, byte *ExtendedAddress,
   1986                                                   byte CapabilityInformation )
   1987          {
   1988          #if defined (AUTO_SOFT_START)
   1989              ZDX_PostCoordinatorIEEE(ShortAddress);
   1990          #endif
   1991          
   1992            // Notify to save info into NV
   1993            ZDApp_NVUpdate();
   1994          
   1995          #if   ( SECURE != 0  )
   1996            // send notification to TC of new device..
   1997            if ( _NIB.SecurityLevel )
   1998              osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   1999          #endif  // SECURE
   2000          
   2001            return ( ZSuccess );
   2002          }
   2003          #endif  //RTR_NWK
   2004          
   2005          /*********************************************************************
   2006           * @fn          ZDO_LeaveCnf
   2007           *
   2008           * @brief       This function allows the next higher layer to be
   2009           *              notified of the results of its request for this or
   2010           *              a child device to leave the network.
   2011           *
   2012           * @param       cnf - NLME_LeaveCnf_t
   2013           *
   2014           * @return      none
   2015           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2016          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2017          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2018            // Check for this device
   2019            if ( osal_ExtAddrEqual( cnf->extAddr,
   2020                                    NLME_GetExtAddr() ) == TRUE )
   \   000009                ; Setup parameters for call to function osal_ExtAddrEqual
   \   000009                ; Setup parameters for call to function NLME_GetExtAddr
   \   000009   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
   \   000010   EE           MOV     A,R6
   \   000011   2402         ADD     A,#0x2
   \   000013   FA           MOV     R2,A
   \   000014   EF           MOV     A,R7
   \   000015   3400         ADDC    A,#0x0
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??osal_ExtAddrEqual?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   6401         XRL     A,#0x1
   \   00001E   7006         JNZ     ??CrossCallReturnLabel_16
   2021            {
   2022              // Prepare to leave with reset
   2023              ZDApp_LeaveReset( cnf->rejoin );
   \   000020                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   12....       LCALL   ?Subroutine11 & 0xFFFF
   2024            }
   2025            //------------------------------------------------------------------
   2026            #if defined( RTR_NWK )
   2027            //------------------------------------------------------------------
   2028            else
   2029            {
   2030              // Remove device address(optionally descendents) from data
   2031              ZDApp_LeaveUpdate( cnf->dstAddr,
   2032                                 cnf->extAddr,
   2033                                 cnf->removeChildren );
   2034            }
   2035            //------------------------------------------------------------------
   2036            #endif
   2037            //------------------------------------------------------------------
   2038          }
   \                     ??CrossCallReturnLabel_16:
   \   000026   02....       LJMP    ?Subroutine16 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F9           MOV     R1,A
   \   000009   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00000C   22           RET
   2039          
   2040          /*********************************************************************
   2041           * @fn          ZDO_LeaveInd
   2042           *
   2043           * @brief       This function allows the next higher layer of a
   2044           *              device to be notified of a remote leave request or
   2045           *              indication.
   2046           *
   2047           * @param       ind - NLME_LeaveInd_t
   2048           *
   2049           * @return      none
   2050           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2051          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2052          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2053            uint8 leave;
   2054          
   2055          
   2056            // Parent is requesting the leave - NWK layer filters out illegal
   2057            // requests
   2058            if ( ind->request == TRUE )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6401         XRL     A,#0x1
   \   00001A   7008         JNZ     ??ZDO_LeaveInd_0
   2059            {
   2060              // Notify network of leave
   2061              //----------------------------------------------------------------
   2062              #if defined( RTR_NWK )
   2063              //----------------------------------------------------------------
   2064              NLME_LeaveRsp_t rsp;
   2065              rsp.rejoin         = ind->rejoin;
   2066              rsp.removeChildren = ind->removeChildren;
   2067              NLME_LeaveRsp( &rsp );
   2068              //----------------------------------------------------------------
   2069              #endif
   2070              //----------------------------------------------------------------
   2071          
   2072              // Prepare to leave with reset
   2073              ZDApp_LeaveReset( ind->rejoin );
   \                     ??ZDO_LeaveInd_1:
   \   00001C                ; Setup parameters for call to function ZDApp_LeaveReset
   \   00001C   EE           MOV     A,R6
   \   00001D   240C         ADD     A,#0xc
   \   00001F   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000022   8038         SJMP    ??ZDO_LeaveInd_2
   2074            }
   2075            else
   2076            {
   2077              leave = FALSE;
   2078          
   2079              // Check if this device needs to leave as a child or descendent
   2080              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000024                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000024   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000027   8A..         MOV     ?V0 + 0,R2
   \   000029   8B..         MOV     ?V0 + 1,R3
   \   00002B   A8..         MOV     R0,?V0 + 0
   \   00002D   A9..         MOV     R1,?V0 + 1
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   E0           MOVX    A,@DPTR
   \   000034   68           XRL     A,R0
   \   000035   7003         JNZ     ??ZDO_LeaveInd_3
   \   000037   A3           INC     DPTR
   \   000038   E0           MOVX    A,@DPTR
   \   000039   69           XRL     A,R1
   \                     ??ZDO_LeaveInd_3:
   \   00003A   7011         JNZ     ??ZDO_LeaveInd_4
   2081              {
   2082                if ( ( ind->removeChildren == TRUE               ) ||
   2083                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2084                       NODETYPE_DEVICE                           )    )
   \   00003C   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   00003F   6401         XRL     A,#0x1
   \   000041   60D9         JZ      ??ZDO_LeaveInd_1
   \   000043   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000046   E0           MOVX    A,@DPTR
   \   000047   5407         ANL     A,#0x7
   \   000049   6402         XRL     A,#0x2
   \   00004B   60CF         JZ      ??ZDO_LeaveInd_1
   2085                {
   2086                  leave = TRUE;
   2087                }
   2088              }
   2089              else if ( ind->removeChildren == TRUE )
   2090              {
   2091                // Check NWK address allocation algorithm
   2092                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2093              }
   2094          
   2095              if ( leave == TRUE )
   2096              {
   2097                // Prepare to leave with reset
   2098                ZDApp_LeaveReset( ind->rejoin );
   2099              }
   2100              else
   2101              {
   2102                // Remove device address(optionally descendents) from data
   2103                ZDApp_LeaveUpdate( ind->srcAddr,
   2104                                   ind->extAddr,
   2105                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_4:
   \   00004D                ; Setup parameters for call to function NLME_RemoveChild
   \   00004D   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000050   F9           MOV     R1,A
   \   000051   EE           MOV     A,R6
   \   000052   2402         ADD     A,#0x2
   \   000054   FA           MOV     R2,A
   \   000055   EF           MOV     A,R7
   \   000056   3400         ADDC    A,#0x0
   \   000058   FB           MOV     R3,A
   \   000059   12....       LCALL   ??NLME_RemoveChild?relay
   2106              }
   2107            }
   2108          }
   \                     ??ZDO_LeaveInd_2:
   \   00005C   02....       LJMP    ??Subroutine15_1 & 0xFFFF
   2109          
   2110          /*********************************************************************
   2111           * @fn          ZDO_SyncIndicationCB
   2112           *
   2113           * @brief       This function allows the next higher layer of a
   2114           *              coordinator to be notified of a loss of synchronization
   2115           *                          with the parent/child device.
   2116           *
   2117           * @param       type: 0 - child; 1 - parent
   2118           *
   2119           *
   2120           * @return      none
   2121           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2122          void ZDO_SyncIndicationCB( byte type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2123          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2124          
   2125          #if !defined ( RTR_NWK )
   2126              if ( type == 1 )
   \   000004   7401         MOV     A,#0x1
   \   000006   69           XRL     A,R1
   \   000007   700B         JNZ     ??CrossCallReturnLabel_28
   2127              {
   2128                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000009                ; Setup parameters for call to function ZDApp_SendMsg
   \   000009   7C00         MOV     R4,#0x0
   \   00000B   7D00         MOV     R5,#0x0
   \   00000D   7B02         MOV     R3,#0x2
   \   00000F   7A03         MOV     R2,#0x3
   \   000011   12....       LCALL   ?Subroutine5 & 0xFFFF
   2129              }
   2130          #endif
   2131            return;
   \                     ??CrossCallReturnLabel_28:
   \   000014   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   2132          }
   2133          
   2134          /*********************************************************************
   2135           * @fn          ZDO_PollConfirmCB
   2136           *
   2137           * @brief       This function allows the next higher layer to be
   2138           *              notified of a Poll Confirm.
   2139           *
   2140           * @param       none
   2141           *
   2142           * @return      none
   2143           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2144          void ZDO_PollConfirmCB( byte status )
   \                     ZDO_PollConfirmCB:
   2145          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2146            return;
   \   000000   02....       LJMP    ?BRET
   2147          }
   2148          
   2149          /******************************************************************************
   2150           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2151           *
   2152           * @brief       Stub routine implemented by NHLE. NHLE should call
   2153           *              <AddrMgrWriteNV> when appropriate.
   2154           *
   2155           * @param       none
   2156           *
   2157           * @return      none
   2158           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2159          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2160          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2161            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   EA           MOV     A,R2
   \   000012   7001         JNZ     ??AddrMgrWriteNVRequest_0
   \   000014   EB           MOV     A,R3
   \                     ??AddrMgrWriteNVRequest_0:
   \   000015   7003         JNZ     ??AddrMgrWriteNVRequest_1
   2162            {
   2163              // Trigger to save info into NV
   2164              ZDApp_NVUpdate();
   \   000017                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000017   12....       LCALL   ??ZDApp_NVUpdate?relay
   2165            }
   2166          }
   \                     ??AddrMgrWriteNVRequest_1:
   \   00001A   02....       LJMP    ??Subroutine15_1 & 0xFFFF
   2167          
   2168          /*********************************************************************
   2169           * Call Back Functions from Security  - API
   2170           */
   2171          
   2172          #if defined( ZDO_COORDINATOR )
   2173           /*********************************************************************
   2174           * @fn          ZDO_UpdateDeviceIndication
   2175           *
   2176           * @brief       This function notifies the "Trust Center" of a
   2177           *              network when a device joins or leaves the network.
   2178           *
   2179           * @param       extAddr - pointer to 64 bit address of new device
   2180           * @param       status  - 0 if a new device joined securely
   2181           *                      - 1 if a new device joined un-securely
   2182           *                      - 2 if a device left the network
   2183           *
   2184           * @return      true if newly joined device should be allowed to
   2185           *                                              remain on network
   2186           */
   2187          ZStatus_t ZDO_UpdateDeviceIndication( byte *extAddr, byte status )
   2188          {
   2189          
   2190          #if   ( SECURE != 0  )
   2191            // can implement a network access policy based on the
   2192            // IEEE address of newly joining devices...
   2193          #endif  // Trust Center
   2194          
   2195            return ZSuccess;
   2196          }
   2197          #endif // ZDO
   2198          
   2199          /*********************************************************************
   2200           * @fn          ZDApp_InMsgCB
   2201           *
   2202           * @brief       This function is called to pass up any message that is
   2203           *              not yet supported.  This allows for the developer to
   2204           *              support features themselves..
   2205           *
   2206           * @return      none
   2207           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2208          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2209          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2210            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   5480         ANL     A,#0x80
   \   000010   F9           MOV     R1,A
   \   000011   E4           CLR     A
   \   000012   7001         JNZ     ??ZDApp_InMsgCB_0
   \   000014   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_0:
   \   000015   704B         JNZ     ??ZDApp_InMsgCB_1
   2211            {
   2212              // Handle the response message
   2213            }
   2214            else
   2215            {
   2216              // Handle the request message by sending a generic "not supported".
   2217              // End Device Announce doesn't have a response.
   2218              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != End_Device_annce )
   \   000017   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   00001A   7046         JNZ     ??ZDApp_InMsgCB_1
   \   00001C   EE           MOV     A,R6
   \   00001D   240C         ADD     A,#0xc
   \   00001F   12....       LCALL   ??Subroutine12_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000022   6413         XRL     A,#0x13
   \   000024   7002         JNZ     ??ZDApp_InMsgCB_2
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \                     ??ZDApp_InMsgCB_2:
   \   000028   6038         JZ      ??ZDApp_InMsgCB_1
   2219              {
   2220                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2221                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   00002A                ; Setup parameters for call to function ZDP_GenericRsp
   \   00002A   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   00002D   4480         ORL     A,#0x80
   \   00002F   F5..         MOV     ?V0 + 1,A
   \   000031   78..         MOV     R0,#?V0 + 0
   \   000033   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000036   75..00       MOV     ?V0 + 0,#0x0
   \   000039   75..00       MOV     ?V0 + 1,#0x0
   \   00003C   78..         MOV     R0,#?V0 + 0
   \   00003E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000041   EE           MOV     A,R6
   \   000042   240E         ADD     A,#0xe
   \   000044   12....       LCALL   ??Subroutine12_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000047   FD           MOV     R5,A
   \   000048   7C84         MOV     R4,#-0x7c
   \   00004A   EE           MOV     A,R6
   \   00004B   2402         ADD     A,#0x2
   \   00004D   0A           INC     R2
   \   00004E   0A           INC     R2
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FB           MOV     R3,A
   \   000053   EE           MOV     A,R6
   \   000054   240F         ADD     A,#0xf
   \   000056   12....       LCALL   ??Subroutine12_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000059   F9           MOV     R1,A
   \   00005A   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00005D   7404         MOV     A,#0x4
   \   00005F   12....       LCALL   ?DEALLOC_XSTACK8
   2222              }
   2223            }
   2224          }
   \                     ??ZDApp_InMsgCB_1:
   \   000062   02....       LJMP    ??Subroutine15_1 & 0xFFFF
   2225          
   2226          /*********************************************************************
   2227           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2228           *
   2229           * @brief   Changes the Match Descriptor Response permission.
   2230           *
   2231           * @param   endpoint - endpoint to allow responses
   2232           * @param   action - true to allow responses, false to not
   2233           *
   2234           * @return  none
   2235           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2236          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2237          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2238            // Store the action
   2239            afSetMatch( endpoint, action );
   \   000004                ; Setup parameters for call to function afSetMatch
   \   000004   12....       LCALL   ??afSetMatch?relay
   2240          }
   \   000007   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   2241          
   2242          /*********************************************************************
   2243           * @fn      ZDApp_NetworkInit()
   2244           *
   2245           * @brief   Used to start the network joining process
   2246           *
   2247           * @param   delay - mSec delay to wait before starting
   2248           *
   2249           * @return  none
   2250           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2251          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2252          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2253            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   7001         JNZ     ??ZDApp_NetworkInit_0
   \   000007   EB           MOV     A,R3
   \                     ??ZDApp_NetworkInit_0:
   \   000008   600B         JZ      ??ZDApp_NetworkInit_1
   2254            {
   2255              // Wait awhile before starting the device
   2256              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000A                ; Setup parameters for call to function osal_start_timerEx
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
   \   00000E   7A01         MOV     R2,#0x1
   \   000010   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000013   8005         SJMP    ??CrossCallReturnLabel_33
   2257            }
   2258            else
   2259            {
   2260              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A01         MOV     R2,#0x1
   \   000017   12....       LCALL   ?Subroutine17 & 0xFFFF
   2261            }
   2262          }
   \                     ??CrossCallReturnLabel_33:
   \   00001A   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   2263          
   2264          /*********************************************************************
   2265           * @fn      ZDApp_StartUpFromApp()
   2266           *
   2267           * @brief   Start the device.  This function will only start a device
   2268           *          that is in the Holding state.
   2269           *
   2270           * @param   mode - ZDAPP_STARTUP_COORD - Start up as coordinator only
   2271           *                 ZDAPP_STARTUP_ROUTER - Start up as router only
   2272           *                 ZDAPP_STARTUP_AUTO - Startup in auto, look for coord,
   2273           *                                       if not found, become coord.
   2274           *
   2275           * @return  TRUE if started, FALSE if in the wrong mode
   2276           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2277          ZStatus_t ZDApp_StartUpFromApp( uint8 mode )
   \                     ZDApp_StartUpFromApp:
   2278          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2279            ZStatus_t ret = ZFailure;
   \   000004   7901         MOV     R1,#0x1
   2280          
   2281            if ( devState == DEV_HOLD )
   \   000006   90....       MOV     DPTR,#devState
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   7009         JNZ     ??ZDApp_StartUpFromApp_0
   2282            {
   2283              // Start the device's joining process
   2284              if ( ZDOInitDevice( 0 ) == ZDO_INITDEV_NEW_NETWORK_STATE )
   \   00000C                ; Setup parameters for call to function ZDOInitDevice
   \   00000C   7A00         MOV     R2,#0x0
   \   00000E   7B00         MOV     R3,#0x0
   \   000010   12....       LCALL   ??ZDOInitDevice?relay
   2285              {
   2286          #if defined( SOFT_START )
   2287                if ( mode == ZDAPP_STARTUP_COORD )
   2288                {
   2289                  devStartMode = MODE_HARD;     // Start as a coordinator
   2290                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   2291                }
   2292                else
   2293                {
   2294                  if ( mode == ZDAPP_STARTUP_ROUTER )
   2295                  {
   2296                    softStartAllowCoord = FALSE;  // Don't allow coord to start
   2297                    continueJoining = TRUE;
   2298                  }
   2299                  devStartMode = MODE_JOIN;     // Assume joining
   2300                }
   2301          #endif  // SOFT_START
   2302              }
   2303              ret = ZSuccess;
   \   000013   7900         MOV     R1,#0x0
   2304            }
   2305          
   2306            return ( ret );
   \                     ??ZDApp_StartUpFromApp_0:
   \   000015   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   2307          }
   2308          
   2309          /*********************************************************************
   2310           * @fn      ZDApp_StopStartUp()
   2311           *
   2312           * @brief   Stops the joining process of a router.  This will only
   2313           *          work if the router is in the scanning process and
   2314           *          the SOFT_START feature is enabled.
   2315           *
   2316           * @param   none
   2317           *
   2318           * @return  TRUE if SOFT_START is enabled, FALSE if not possible
   2319           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2320          uint8 ZDApp_StopStartUp( void )
   \                     ZDApp_StopStartUp:
   2321          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2322            uint8 ret = FALSE;
   2323          
   2324          #if defined( SOFT_START )
   2325            continueJoining = FALSE;
   2326            ret = TRUE;
   2327          #endif  // SOFT_START
   2328          
   2329            return ( ret );
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2330          }
   2331          
   2332          /*********************************************************************
   2333           * @fn      ZDApp_StartJoiningCycle()
   2334           *
   2335           * @brief   Starts the joining cycle of a device.  This will only
   2336           *          continue an already started (or stopped) joining cycle.
   2337           *
   2338           * @param   none
   2339           *
   2340           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2341           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2342          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2343          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2344            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   700C         JNZ     ??ZDApp_StartJoiningCycle_1
   2345            {
   2346              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   7401         MOV     A,#0x1
   \   000013   90....       MOV     DPTR,#continueJoining
   \   000016   12....       LCALL   ?Subroutine1 & 0xFFFF
   2347              ZDApp_NetworkInit( 0 );
   2348          
   2349              return ( TRUE );
   \                     ??CrossCallReturnLabel_35:
   \   000019   7901         MOV     R1,#0x1
   \   00001B   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2350            }
   2351            else
   2352              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   00001D   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   00001F   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   2353          }
   2354          
   2355          /*********************************************************************
   2356           * @fn      ZDApp_StopJoiningCycle()
   2357           *
   2358           * @brief   Stops the joining or rejoining process of a device.
   2359           *
   2360           * @param   none
   2361           *
   2362           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2363           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2364          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2365          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2366            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2367            {
   2368              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   E4           CLR     A
   \   000012   90....       MOV     DPTR,#continueJoining
   \   000015   F0           MOVX    @DPTR,A
   2369              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2370            }
   2371            else
   2372              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ??Subroutine14_0 & 0xFFFF
   2373          }
   2374          
   2375          #if !defined ( ZDO_COORDINATOR ) || defined ( SOFT_START )
   2376          /*********************************************************************
   2377           * @fn      ZDApp_NodeProfileSync()
   2378           *
   2379           * @brief   Sync node with stack profile.
   2380           *
   2381           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2382           *
   2383           * @return  none
   2384           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2385          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2386          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2387            networkDesc_t* desc;
   2388            uint16         panID;
   2389          
   2390            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5054         JNC     ??ZDApp_NodeProfileSync_0
   2391            {
   2392              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2393          
   2394              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2395          
   2396              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   7002         JNZ     ??ZDApp_NodeProfileSync_1
   \   00003D   E583         MOV     A,DPH
   \                     ??ZDApp_NodeProfileSync_1:
   \   00003F   6020         JZ      ??ZDApp_NodeProfileSync_0
   2397              {
   2398                if ( desc->stackProfile != zgStackProfile )
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   90....       MOV     DPTR,#zgStackProfile
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6A           XRL     A,R2
   \   000050   600F         JZ      ??ZDApp_NodeProfileSync_0
   2399                {
   2400                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000052   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000055   E0           MOVX    A,@DPTR
   \   000056   54F8         ANL     A,#0xf8
   \   000058   4402         ORL     A,#0x2
   \   00005A   F0           MOVX    @DPTR,A
   2401                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00005B   740C         MOV     A,#0xc
   \   00005D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000060   F0           MOVX    @DPTR,A
   2402                }
   2403              }
   2404            }
   2405          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000061   02....       LJMP    ??Subroutine15_1 & 0xFFFF
   2406          #endif
   2407          
   2408          /*********************************************************************
   2409           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2410           *
   2411           * @brief   Returns a PAN ID for the network layer to use during
   2412           *          a coordinator start and there is another network with 
   2413           *          the intended PANID.
   2414           *
   2415           * @param   panid - the intended PAN ID
   2416           *
   2417           * @return  PANID to try
   2418           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2419          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2420          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2421            return ( (panid + 1) & 0x3FFF );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   E4           CLR     A
   \   000004   3B           ADDC    A,R3
   \   000005   F9           MOV     R1,A
   \   000006   0A           INC     R2
   \   000007   743F         MOV     A,#0x3f
   \   000009   59           ANL     A,R1
   \   00000A   FB           MOV     R3,A
   \   00000B   02....       LJMP    ?BRET
   2422          }
   2423          
   2424          
   2425          /*********************************************************************
   2426           * @fn          ZDApp_NVUpdate
   2427           *
   2428           * @brief       Set the NV Update Timer.
   2429           *
   2430           * @param       none
   2431           *
   2432           * @return      none
   2433           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2434          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2435          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2436            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   7CBC         MOV     R4,#-0x44
   \   000006   7D02         MOV     R5,#0x2
   \   000008   7A00         MOV     R2,#0x0
   \   00000A   7B02         MOV     R3,#0x2
   \   00000C   12....       LCALL   ??Subroutine7_0 & 0xFFFF
   2437          }
   \                     ??CrossCallReturnLabel_11:
   \   00000F   02....       LJMP    ??Subroutine14_0 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartUpFromApp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartUpFromApp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopStartUp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopStartUp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate
   2438          
   2439          
   2440          /*********************************************************************
   2441          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0     10
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDAppCheckForHoldKey               2      0      1
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           0      0      0
     ZDApp_ChangeMatchDescRespPermission
                                        2      0      0
       -> afSetMatch                    4      0      0
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         2      0      1
       -> NLME_GetExtAddr               4      0      2
       -> ZDAppCheckForHoldKey          4      0      2
       -> ZDO_Init                      4      0      2
       -> afRegister                    4      0      2
       -> NLME_GetRequest               4      0      2
       -> NLME_SetBroadcastFilter       4      0      2
       -> ZDOInitDevice                 4      0      2
       -> HalLedBlink                   4      0      2
       -> ZDApp_RegisterCBs             4      0      2
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     14
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   2      0     10
       -> ZDApp_LeaveCtrlSet            4      0      0
       -> ZDApp_ResetTimerStart         4      0      0
     ZDApp_LeaveUpdate                  2      0      0
       -> NLME_RemoveChild              4      0      0
     ZDApp_NVUpdate                     2      0     10
       -> osal_start_timerEx            4      0      0
     ZDApp_NetworkInit                  2      0     12
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0      0
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     20
       -> nwk_getNetworkDesc            0      0     20
     ZDApp_ProcessMsgCBs                0      0     41
       -> ZDO_ParseAddrRsp              0      0     62
       -> ZDO_UpdateAddrManager         0      0     62
       -> osal_mem_free                 0      0     62
       -> ZDO_ParseBindUnbindReq        0      0     62
       -> ZDO_ProcessBindUnbindReq      0      0     62
     ZDApp_ProcessNetworkJoin           0      0     22
       -> osal_set_event                0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               0      0     21
       -> ZDP_IncomingData              0      0     20
       -> ZDApp_ProcessMsgCBs           0      0     20
       -> ZDApp_NodeProfileSync         0      0     20
       -> NLME_JoinRequest              0      0     22
       -> osal_rand                     0      0     20
       -> ZDApp_NetworkInit             0      0     20
       -> NLME_ReJoinRequest            0      0     20
       -> osal_rand                     0      0     20
       -> ZDApp_NetworkInit             0      0     20
       -> NLME_SetPollRate              0      0     20
       -> NLME_SetQueuedPollRate        0      0     20
       -> NLME_SetResponseRate          0      0     20
       -> osal_rand                     0      0     20
       -> ZDApp_NetworkInit             0      0     20
       -> ZDApp_ProcessNetworkJoin      0      0     20
       -> ZDApp_NetworkInit             0      0     20
       -> osal_set_event                0      0     20
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      1
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      0
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SecInit                      2      0      0
       -> ZDSecMgrInit                  4      0      0
     ZDApp_SendEventMsg                 2      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDApp_SendMsg                      1      0     43
       -> osal_msg_allocate             0      0     32
       -> osal_memcpy                   0      0     38
       -> osal_msg_send                 0      0     32
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StartUpFromApp               2      0      0
       -> ZDOInitDevice                 4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_StopStartUp                  0      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_UpdateNwkStatus           0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDO_StartDevice               0      0     20
     ZDOInitDevice                      0      0     13
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> osal_rand                     0      0     24
       -> ZDSecMgrInit                  0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDO_JoinConfirmCB                  2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_LeaveCnf                       0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> osal_ExtAddrEqual             0      0     18
       -> ZDApp_LeaveReset              0      0     18
     ZDO_LeaveInd                       0      0     10
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_GetCoordShortAddr        0      0     20
       -> NLME_RemoveChild              0      0     20
     ZDO_NetworkDiscoveryConfirmCB      2      0     24
       -> osal_cpyExtAddr               0      0     48
       -> ZDApp_SendMsg                 0      0     48
     ZDO_NetworkFormationConfirmCB      0      0      0
     ZDO_PollConfirmCB                  0      0      0
     ZDO_SyncIndicationCB               2      0      0
       -> ZDApp_SendMsg                 4      0      0


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     _A_IEN0                           1
     WDCTL                             1
     zdoDiscCounter                    1
     ZDAppNwkAddr                      9
     continueJoining                   1
     _tmpRejoinState                   1
     ZDAppTaskID                       1
     nwkStatus                         1
     ZDApp_AutoFindMode_epDesc         2
     ZDApp_LeaveCtrl                   1
     devState                          1
     devStartMode                      1
     retryCnt                          1
     ZDApp_epDesc                      6
     ZDApp_Init                      115
     ?Subroutine14                    10
     ZDApp_SecInit                    10
     ZDApp_event_loop                156
     ?Subroutine15                    10
     ZDOInitDevice                   104
     ZDApp_ReadNetworkRestoreState    18
     ?Subroutine16                     5
     ZDAppDetermineDeviceType          3
     ZDApp_NetworkStartEvt            81
     ?Subroutine17                    11
     ZDApp_SaveNetworkStateEvt         3
     ZDApp_RestoreNetworkState        67
     ZDApp_InitUserDesc              121
     ZDAppCheckForHoldKey             20
     ZDApp_ProcessOSALMsg            251
     ?Subroutine9                     22
     ?Subroutine8                     14
     ?Subroutine18                     6
     ?Subroutine0                      8
     ?Subroutine1                      6
     ZDApp_ProcessMsgCBs             127
     ?Subroutine10                     9
     ?Subroutine13                    11
     ZDApp_RegisterCBs                31
     ?Subroutine4                     11
     ZDApp_ProcessNetworkJoin        296
     ZDApp_ResetTimerStart            16
     ?Subroutine7                     11
     ZDApp_ResetTimerCancel           19
     ZDApp_LeaveCtrlInit              65
     ?Subroutine2                     14
     ZDApp_LeaveCtrlSet               55
     ZDApp_LeaveCtrlBypass            16
     ZDApp_LeaveCtrlStartup           79
     ZDApp_LeaveReset                 16
     ZDApp_LeaveUpdate                14
     ZDApp_SendEventMsg               11
     ?Subroutine5                      9
     ZDApp_SendMsg                    91
     ZDO_NetworkDiscoveryConfirmCB   310
     ?Subroutine3                      7
     ?Subroutine12                    12
     ZDO_NetworkFormationConfirmCB     3
     ZDO_JoinConfirmCB                57
     ZDO_LeaveCnf                     41
     ?Subroutine11                    13
     ZDO_LeaveInd                     95
     ZDO_SyncIndicationCB             23
     ZDO_PollConfirmCB                 3
     AddrMgrWriteNVRequest            29
     ZDApp_InMsgCB                   101
     ZDApp_ChangeMatchDescRespPermission
                                      10
     ZDApp_NetworkInit                29
     ZDApp_StartUpFromApp             24
     ZDApp_StopStartUp                 5
     ZDApp_StartJoiningCycle          34
     ZDApp_StopJoiningCycle           31
     ZDApp_NodeProfileSync           100
     ZDApp_CoordStartPANIDConflictCB
                                      14
     ZDApp_NVUpdate                   18
     ?<Initializer for zdoDiscCounter>
                                       1
     ?<Initializer for continueJoining>
                                       1
     ?<Initializer for devState>       1
     ?<Initializer for ZDApp_epDesc>
                                       6
     ??ZDApp_Init?relay                6
     ??ZDApp_SecInit?relay             6
     ??ZDApp_event_loop?relay          6
     ??ZDOInitDevice?relay             6
     ??ZDApp_ReadNetworkRestoreState?relay
                                       6
     ??ZDAppDetermineDeviceType?relay
                                       6
     ??ZDApp_NetworkStartEvt?relay     6
     ??ZDApp_SaveNetworkStateEvt?relay
                                       6
     ??ZDApp_RestoreNetworkState?relay
                                       6
     ??ZDApp_InitUserDesc?relay        6
     ??ZDAppCheckForHoldKey?relay      6
     ??ZDApp_ProcessOSALMsg?relay      6
     ??ZDApp_ProcessMsgCBs?relay       6
     ??ZDApp_RegisterCBs?relay         6
     ??ZDApp_ProcessNetworkJoin?relay
                                       6
     ??ZDApp_ResetTimerStart?relay     6
     ??ZDApp_ResetTimerCancel?relay    6
     ??ZDApp_LeaveCtrlInit?relay       6
     ??ZDApp_LeaveCtrlSet?relay        6
     ??ZDApp_LeaveCtrlBypass?relay     6
     ??ZDApp_LeaveCtrlStartup?relay    6
     ??ZDApp_LeaveReset?relay          6
     ??ZDApp_LeaveUpdate?relay         6
     ??ZDApp_SendEventMsg?relay        6
     ??ZDApp_SendMsg?relay             6
     ??ZDO_NetworkDiscoveryConfirmCB?relay
                                       6
     ??ZDO_NetworkFormationConfirmCB?relay
                                       6
     ??ZDO_JoinConfirmCB?relay         6
     ??ZDO_LeaveCnf?relay              6
     ??ZDO_LeaveInd?relay              6
     ??ZDO_SyncIndicationCB?relay      6
     ??ZDO_PollConfirmCB?relay         6
     ??AddrMgrWriteNVRequest?relay     6
     ??ZDApp_InMsgCB?relay             6
     ??ZDApp_ChangeMatchDescRespPermission?relay
                                       6
     ??ZDApp_NetworkInit?relay         6
     ??ZDApp_StartUpFromApp?relay      6
     ??ZDApp_StopStartUp?relay         6
     ??ZDApp_StartJoiningCycle?relay
                                       6
     ??ZDApp_StopJoiningCycle?relay    6
     ??ZDApp_NodeProfileSync?relay     6
     ??ZDApp_CoordStartPANIDConflictCB?relay
                                       6
     ??ZDApp_NVUpdate?relay            6

 
 2 901 bytes in segment BANKED_CODE
   258 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
     9 bytes in segment XDATA_I
     9 bytes in segment XDATA_ID
    17 bytes in segment XDATA_Z
 
 3 168 bytes of CODE  memory
     0 bytes of DATA  memory (+ 2 bytes shared)
    26 bytes of XDATA memory

Errors: none
Warnings: none
