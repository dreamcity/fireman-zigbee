###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    12/Mar/2013  15:45:29 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\ZMain\TI2430DB\ZMain.c                       #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wCoord.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS           #
#                          "-DCONST=const __code" -DGENERIC=__generic) -f     #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\..\. #
#                          .\..\Tools\CC2430DB\f8wConfig.cfg" (-DSECURE=0     #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\ZMa #
#                          in\TI2430DB\ZMain.c" -D CC2430EB -D REFLECTOR -D   #
#                          HAL_UART -D xZTOOL_P1 -D AXD_COR -D MT_TASK -D     #
#                          xMT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC "C:\Texas  #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\CoordinatorEB\ #
#                          List\" -lA "C:\Texas Instruments\ZStack-1.4.3-1.2. #
#                          1\Projects\zstack\Samples\cc2430-zstack-adxl345\CC #
#                          2430DB\CoordinatorEB\List\" --diag_suppress        #
#                          Pe001,Pa010 --diag_remark pe550 -o "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\CoordinatorEB\ #
#                          Obj\" -e --require_prototypes -z9                  #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\cc2430-zstack-adxl345\CC2430DB\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\cc2430-zstack-adxl345\CC2430DB\. #
#                          .\SOURCE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\cc2430-zstack-adxl345 #
#                          \CC2430DB\..\Drivers\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\ZMAIN #
#                          \TI2430DB\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\cc2430-zstack-adxl345\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\Coord #
#                          inatorEB\List\ZMain.lst                            #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\cc2430-zstack-adxl345\CC2430DB\Coord #
#                          inatorEB\Obj\ZMain.r51                             #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\ZMain\TI2430DB\ZMain.c
      1          /**************************************************************************************************
      2            Filename:       ZMain.c
      3            Revised:        $Date: 2007-10-27 17:16:54 -0700 (Sat, 27 Oct 2007) $
      4            Revision:       $Revision: 15793 $
      5            
      6            Description:    Startup and shutdown code for ZStack
      7            Notes:          This version targets the Chipcon CC2430DB/CC2430EB
      8          
      9          
     10            Copyright 2005-2007 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Memory.h"
     48          #include "OSAL_Nv.h"
     49          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x81
   \   unsigned char volatile __sfr SP
   \                     `SP`:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x8f
   \   unsigned char volatile __sfr P0INP
   \                     P0INP:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xbe
   \   unsigned char volatile __sfr SLEEP
   \                     SLEEP:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc6
   \   unsigned char volatile __sfr CLKCON
   \                     CLKCON:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xff
   \   unsigned char volatile __sfr P2DIR
   \                     P2DIR:
   \   000000                DS 1
     50          #include "ZMAC.h"
     51          #include "MTEL.h"
     52          
     53          #include "nwk_globals.h"
     54          #include "ZDApp.h"
     55          #include "ssp.h"
     56          #include "ZGlobals.h"
     57          
     58          #ifndef NONWK
     59            #include "AF.h"
     60          #endif
     61          
     62          /* Hal */
     63          #include "hal_lcd.h"
     64          #include "hal_key.h"
     65          #include "hal_led.h"
     66          #include "hal_adc.h"
     67          #include "hal_drivers.h"
     68          #include "hal_assert.h"
     69          
     70          /*********************************************************************
     71           * MACROS
     72           */
     73          
     74          /*********************************************************************
     75           * CONSTANTS
     76           */
     77          
     78          // LED Flash counter, waiting for default 64-bit address
     79          #define FLASH_COUNT 20000
     80          
     81          // Maximun number of Vdd samples checked before go on
     82          #define MAX_VDD_SAMPLES  3
     83          #define ZMAIN_VDD_LIMIT  HAL_ADC_VDD_LIMIT_4
     84          
     85          /*********************************************************************
     86           * TYPEDEFS
     87           */
     88          
     89          /*********************************************************************
     90           * GLOBAL VARIABLES
     91           */
     92          
     93          /*********************************************************************
     94           * EXTERNAL VARIABLES
     95           */
     96          
     97          /*********************************************************************
     98           * EXTERNAL FUNCTIONS
     99           */
    100          
    101          extern __near_func uint8 GetCodeByte(uint32);
    102          
    103          extern bool HalAdcCheckVdd (uint8 limit);
    104          
    105          /*********************************************************************
    106           * LOCAL VARIABLES
    107           */
    108          
    109          /*********************************************************************
    110           * ZMAIN API JUMP FUNCTIONS
    111           *
    112           * If the MINIMIZE_ROOT compile flag is defined, ZMAIN API functions
    113           * are implemented as "jump functions" located in the ROOT segment,
    114           * as expected by the NWK object libraries. This allows the actual
    115           * ZMAIN function bodies to locate outside ROOT memory, increasing
    116           * space for user defined constants, strings, etc in ROOT memory.
    117           *
    118           * If the MINIMIZE_ROOT compile flag in not defined, the ZMAIN API
    119           * functions are aliased to the similarly-named function bodies and
    120           * located in the ROOT segment with no "jump function" overhead.
    121           * This is the default behavior which produces smaller overall code
    122           * size and maximizes available code space in BANK1...BANK3.
    123           *
    124           */
    125          
    126          #ifdef MINIMIZE_ROOT
    127            // ZMAIN functions are not forced into ROOT segment
    128            #define ZSEG
    129          #else
    130            // ZMAIN functions are forced into ROOT segment
    131            #define ZSEG ROOT
    132          #endif
    133          
    134          /*********************************************************************
    135           * LOCAL FUNCTIONS
    136           */
    137          
    138          static ZSEG void zmain_dev_info( void );
    139          static ZSEG void zmain_ext_addr( void );
    140          static ZSEG void zmain_ram_init( void );
    141          static ZSEG void zmain_vdd_check( void );
    142          
    143          #ifdef LCD_SUPPORTED
    144          static ZSEG void zmain_lcd_init( void );
    145          #endif
    146          
    147          /*********************************************************************
    148           * @fn      main
    149           * @brief   First function called after startup.
    150           * @return  don't care
    151           *********************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    152          ZSEG int main( void )
   \                     main:
    153          {
   \   000000                ; Auto size: 0
    154            // Turn off interrupts
    155            osal_int_disable( INTS_ALL );
   \   000000                ; Setup parameters for call to function osal_int_disable
   \   000000   79FF         MOV     R1,#-0x1
   \   000002   12....       LCALL   ??osal_int_disable?relay
    156          
    157            // Initialize HAL
    158            HAL_BOARD_INIT();
   \   000005   53BEFB       ANL     0xbe,#0xfb
   \                     ??main_0:
   \   000008   E5BE         MOV     A,0xbe
   \   00000A   A2E6         MOV     C,0xE0 /* A   */.6
   \   00000C   50FA         JNC     ??main_0
   \   00000E   00           NOP
   \   00000F   78F8         MOV     R0,#-0x8
   \   000011   7901         MOV     R1,#0x1
   \                     ??main_1:
   \   000013   00           NOP
   \   000014   E8           MOV     A,R0
   \   000015   24FF         ADD     A,#-0x1
   \   000017   18           DEC     R0
   \   000018   E9           MOV     A,R1
   \   000019   34FF         ADDC    A,#-0x1
   \   00001B   F9           MOV     R1,A
   \   00001C   E8           MOV     A,R0
   \   00001D   7001         JNZ     ??main_2
   \   00001F   E9           MOV     A,R1
   \                     ??main_2:
   \   000020   70F1         JNZ     ??main_1
   \   000022   75C600       MOV     0xc6,#0x0
   \                     ??main_3:
   \   000025   E5C6         MOV     A,0xc6
   \   000027   70FC         JNZ     ??main_3
   \   000029   43BE04       ORL     0xbe,#0x4
   \   00002C   43FE01       ORL     0xfe,#0x1
   \   00002F   43FE04       ORL     0xfe,#0x4
   \   000032   43FE08       ORL     0xfe,#0x8
   \   000035   43FF01       ORL     0xff,#0x1
   \   000038   438F20       ORL     0x8f,#0x20
    159          
    160            // Make sure supply voltage is high enough to run
    161            zmain_vdd_check();
   \   00003B                ; Setup parameters for call to function zmain_vdd_check
   \   00003B   12....       LCALL   zmain_vdd_check
    162          
    163            // Initialize stack memory
    164            zmain_ram_init();
   \   00003E   78..         MOV     R0,#(SFB(XSP) & 0xff)
   \   000040   8682         MOV     DPL,@R0
   \   000042   08           INC     R0
   \   000043   8683         MOV     DPH,@R0
   \   000045   8003         SJMP    ??main_4
   \                     ??main_5:
   \   000047   74CD         MOV     A,#-0x33
   \   000049   F0           MOVX    @DPTR,A
   \                     ??main_4:
   \   00004A   12....       LCALL   ?Subroutine0
   \                     ??CrossCallReturnLabel_0:
   \   00004D   C3           CLR     C
   \   00004E   74..         MOV     A,#(SFB(XSTACK) & 0xff)
   \   000050   9582         SUBB    A,DPL
   \   000052   74..         MOV     A,#((SFB(XSTACK) >> 8) & 0xff)
   \   000054   9583         SUBB    A,DPH
   \   000056   40EF         JC      ??main_5
   \   000058   7582..       MOV     DPL,#((SFE(ISTACK) + 255) & 0xff)
   \   00005B   7583..       MOV     DPH,#(((SFE(ISTACK) - 1) >> 8) & 0xff)
   \   00005E   8004         SJMP    ??main_6
   \                     ??main_7:
   \   000060   A882         MOV     R0,DPL
   \   000062   76CD         MOV     @R0,#-0x33
   \                     ??main_6:
   \   000064   E581         MOV     A,0x81
   \   000066   F5..         MOV     ?V0 + 0,A
   \   000068   12....       LCALL   ?Subroutine0
   \                     ??CrossCallReturnLabel_1:
   \   00006B   75..00       MOV     ?V0 + 1,#0x0
   \   00006E   C3           CLR     C
   \   00006F   E5..         MOV     A,?V0 + 0
   \   000071   9582         SUBB    A,DPL
   \   000073   E4           CLR     A
   \   000074   9583         SUBB    A,DPH
   \   000076   40E8         JC      ??main_7
    165          
    166            // Initialize board I/O
    167            InitBoard( OB_COLD );
   \   000078                ; Setup parameters for call to function InitBoard
   \   000078   7900         MOV     R1,#0x0
   \   00007A   12....       LCALL   ??InitBoard?relay
    168          
    169            // Initialze HAL drivers
    170            HalDriverInit();
   \   00007D                ; Setup parameters for call to function HalDriverInit
   \   00007D   12....       LCALL   ??HalDriverInit?relay
    171          
    172            // Initialize NV System
    173            osal_nv_init( NULL );
   \   000080                ; Setup parameters for call to function osal_nv_init
   \   000080   7A00         MOV     R2,#0x0
   \   000082   7B00         MOV     R3,#0x0
   \   000084   12....       LCALL   ??osal_nv_init?relay
    174          
    175            // Determine the extended address
    176            zmain_ext_addr();
   \   000087                ; Setup parameters for call to function zmain_ext_addr
   \   000087   12....       LCALL   zmain_ext_addr
    177          
    178            // Initialize basic NV items
    179            zgInit();
   \   00008A                ; Setup parameters for call to function zgInit
   \   00008A   12....       LCALL   ??zgInit?relay
    180          
    181            // Initialize the MAC
    182            ZMacInit();
   \   00008D                ; Setup parameters for call to function ZMacInit
   \   00008D   12....       LCALL   ZMacInit
    183          
    184          #ifndef NONWK
    185            // Since the AF isn't a task, call it's initialization routine
    186            afInit();
   \   000090                ; Setup parameters for call to function afInit
   \   000090   12....       LCALL   ??afInit?relay
    187          #endif
    188          
    189            // Initialize the operating system
    190            osal_init_system();
   \   000093                ; Setup parameters for call to function osal_init_system
   \   000093   12....       LCALL   ??osal_init_system?relay
    191          
    192            // Allow interrupts
    193            osal_int_enable( INTS_ALL );
   \   000096                ; Setup parameters for call to function osal_int_enable
   \   000096   79FF         MOV     R1,#-0x1
   \   000098   12....       LCALL   ??osal_int_enable?relay
    194          
    195            // Final board initialization
    196            InitBoard( OB_READY );
   \   00009B                ; Setup parameters for call to function InitBoard
   \   00009B   7902         MOV     R1,#0x2
   \   00009D   12....       LCALL   ??InitBoard?relay
    197          
    198            // Display information about this device
    199            zmain_dev_info();
   \   0000A0                ; Setup parameters for call to function zmain_dev_info
   \   0000A0   12....       LCALL   zmain_dev_info
    200          
    201            /* Display the device info on the LCD */
    202          #ifdef LCD_SUPPORTED
    203            zmain_lcd_init();
   \   0000A3                ; Setup parameters for call to function HalLcdWriteString
   \   0000A3   7900         MOV     R1,#0x0
   \   0000A5   7A..         MOV     R2,#(`?<Constant "Figure8 Wireless">` & 0xff)
   \   0000A7   7B..         MOV     R3,#((`?<Constant "Figure8 Wireless">` >> 8) & 0xff)
   \   0000A9   12....       LCALL   ??HalLcdWriteString?relay
    204          #endif
    205          
    206            osal_start_system(); // No Return from here
   \   0000AC                ; Setup parameters for call to function osal_start_system
   \   0000AC   12....       LCALL   ??osal_start_system?relay
    207          } // main()
   \   0000AF   7A00         MOV     R2,#0x0
   \   0000B1   7B00         MOV     R3,#0x0
   \   0000B3   22           RET
   \   0000B4                REQUIRE P0INP
   \   0000B4                REQUIRE SLEEP
   \   0000B4                REQUIRE CLKCON
   \   0000B4                REQUIRE P1DIR
   \   0000B4                REQUIRE P2DIR
   \   0000B4                REQUIRE `SP`
    208          
    209          /*********************************************************************
    210           * @fn      zmain_vdd_check
    211           * @brief   Check if the Vdd is OK to run the processor.
    212           * @return  Return if Vdd is ok; otherwise, flash LED, then reset
    213           *********************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    214          static ZSEG void zmain_vdd_check( void )
   \                     zmain_vdd_check:
    215          {
   \   000000   74F8         MOV     A,#-0x8
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 8
   \   000005                ; Auto size: 0
    216            uint8 vdd_passed_count = 0;
   \   000005   7E00         MOV     R6,#0x0
    217            bool toggle = 0;
   \   000007   7F00         MOV     R7,#0x0
    218          
    219            // Repeat getting the sample until number of failures or successes hits MAX
    220            // then based on the count value, determine if the device is ready or not
    221            while ( vdd_passed_count < MAX_VDD_SAMPLES )
    222            {
    223              if ( HalAdcCheckVdd (ZMAIN_VDD_LIMIT) )
   \                     ??zmain_vdd_check_0:
   \   000009                ; Setup parameters for call to function HalAdcCheckVdd
   \   000009   7904         MOV     R1,#0x4
   \   00000B   12....       LCALL   ??HalAdcCheckVdd?relay
   \   00000E   E9           MOV     A,R1
   \   00000F   6019         JZ      ??zmain_vdd_check_1
    224              {
    225                vdd_passed_count++;    // Keep track # times Vdd passes in a row
   \   000011   0E           INC     R6
    226                MicroWait (10000);     // Wait 10ms to try again
   \   000012                ; Setup parameters for call to function Onboard_wait
   \   000012   7A10         MOV     R2,#0x10
   \   000014   7B27         MOV     R3,#0x27
   \   000016   12....       LCALL   ??Onboard_wait?relay
    227              }
    228              else
    229              {
    230                vdd_passed_count = 0;  // Reset passed counter
    231                MicroWait (50000);     // Wait 50ms
    232                MicroWait (50000);     // Wait another 50ms to try again
    233              }
    234          
    235              /* toggle LED1 and LED2 */
    236              if (vdd_passed_count == 0)
   \   000019   EE           MOV     A,R6
   \   00001A   601E         JZ      ??zmain_vdd_check_2
   \   00001C   C3           CLR     C
   \   00001D   9403         SUBB    A,#0x3
   \   00001F   40E8         JC      ??zmain_vdd_check_0
    237              {
    238                if ((toggle = !(toggle)))
    239                  HAL_TOGGLE_LED1();
    240                else
    241                  HAL_TOGGLE_LED2();
    242              }
    243            }
    244          
    245            /* turn off LED1 */
    246            HAL_TURN_OFF_LED1();
   \   000021   D290         SETB    0x90.0
    247            HAL_TURN_OFF_LED2();
   \   000023   D292         SETB    0x90.2
    248          }
   \   000025   7F01         MOV     R7,#0x1
   \   000027   02....       LJMP    ?FUNC_LEAVE_XDATA
   \                     ??zmain_vdd_check_1:
   \   00002A   7E00         MOV     R6,#0x0
   \   00002C                ; Setup parameters for call to function Onboard_wait
   \   00002C   7A50         MOV     R2,#0x50
   \   00002E   7BC3         MOV     R3,#-0x3d
   \   000030   12....       LCALL   ??Onboard_wait?relay
   \   000033                ; Setup parameters for call to function Onboard_wait
   \   000033   7A50         MOV     R2,#0x50
   \   000035   7BC3         MOV     R3,#-0x3d
   \   000037   12....       LCALL   ??Onboard_wait?relay
   \                     ??zmain_vdd_check_2:
   \   00003A   EF           MOV     A,R7
   \   00003B   7004         JNZ     ??zmain_vdd_check_3
   \   00003D   7A01         MOV     R2,#0x1
   \   00003F   8002         SJMP    ??zmain_vdd_check_4
   \                     ??zmain_vdd_check_3:
   \   000041   7A00         MOV     R2,#0x0
   \                     ??zmain_vdd_check_4:
   \   000043   EA           MOV     A,R2
   \   000044   FF           MOV     R7,A
   \   000045   600C         JZ      ??zmain_vdd_check_5
   \   000047   A290         MOV     C,0x90.0
   \   000049   5004         JNC     ??zmain_vdd_check_6
   \   00004B   C290         CLR     0x90.0
   \   00004D   80BA         SJMP    ??zmain_vdd_check_0
   \                     ??zmain_vdd_check_6:
   \   00004F   D290         SETB    0x90.0
   \   000051   80B6         SJMP    ??zmain_vdd_check_0
   \                     ??zmain_vdd_check_5:
   \   000053   A292         MOV     C,0x90.2
   \   000055   5004         JNC     ??zmain_vdd_check_7
   \   000057   C292         CLR     0x90.2
   \   000059   80AE         SJMP    ??zmain_vdd_check_0
   \                     ??zmain_vdd_check_7:
   \   00005B   D292         SETB    0x90.2
   \   00005D   80AA         SJMP    ??zmain_vdd_check_0
   \   00005F                REQUIRE _A_P1
    249          
    250          /*********************************************************************
    251           * @fn      zmain_ext_addr
    252           * @brief   Makes extended address if none exists.
    253           * @return  none
    254           *********************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    255          static ZSEG void zmain_ext_addr( void )
   \                     zmain_ext_addr:
    256          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    257            uint8 i;
    258            uint8 led;
    259            uint8 tmp;
    260            uint8 *xad;
    261            uint16 AtoD;
    262          
    263            // Initialize extended address in NV
    264            osal_nv_item_init( ZCD_NV_EXTADDR, Z_EXTADDR_LEN, NULL );
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005   75..00       MOV     ?V0 + 0,#0x0
   \   000008   75..00       MOV     ?V0 + 1,#0x0
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000010   7C08         MOV     R4,#0x8
   \   000012   7D00         MOV     R5,#0x0
   \   000014   7A01         MOV     R2,#0x1
   \   000016   7B00         MOV     R3,#0x0
   \   000018   12....       LCALL   ??osal_nv_item_init?relay
   \   00001B   7402         MOV     A,#0x2
   \   00001D   12....       LCALL   ?DEALLOC_XSTACK8
    265            osal_nv_read( ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, &aExtendedAddress );
   \   000020                ; Setup parameters for call to function osal_nv_read
   \   000020   75....       MOV     ?V0 + 0,#(aExtendedAddress & 0xff)
   \   000023   75....       MOV     ?V0 + 1,#((aExtendedAddress >> 8) & 0xff)
   \   000026   78..         MOV     R0,#?V0 + 0
   \   000028   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002B   75..08       MOV     ?V0 + 0,#0x8
   \   00002E   75..00       MOV     ?V0 + 1,#0x0
   \   000031   78..         MOV     R0,#?V0 + 0
   \   000033   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000036   7C00         MOV     R4,#0x0
   \   000038   7D00         MOV     R5,#0x0
   \   00003A   7A01         MOV     R2,#0x1
   \   00003C   7B00         MOV     R3,#0x0
   \   00003E   12....       LCALL   ??osal_nv_read?relay
   \   000041   7404         MOV     A,#0x4
   \   000043   12....       LCALL   ?DEALLOC_XSTACK8
    266          
    267            // Check for uninitialized value (erased EEPROM = 0xFF)
    268            xad = (uint8*)&aExtendedAddress;
   \   000046   78..         MOV     R0,#(aExtendedAddress & 0xff)
   \   000048   79..         MOV     R1,#((aExtendedAddress >> 8) & 0xff)
    269            for ( i = 0; i < Z_EXTADDR_LEN; i++ )
   \   00004A   7C00         MOV     R4,#0x0
    270              if ( *xad++ != 0xFF ) return;
   \                     ??zmain_ext_addr_0:
   \   00004C   E8           MOV     A,R0
   \   00004D   FA           MOV     R2,A
   \   00004E   E9           MOV     A,R1
   \   00004F   FB           MOV     R3,A
   \   000050   8A82         MOV     DPL,R2
   \   000052   8B83         MOV     DPH,R3
   \   000054   A3           INC     DPTR
   \   000055   A882         MOV     R0,DPL
   \   000057   A983         MOV     R1,DPH
   \   000059   8A82         MOV     DPL,R2
   \   00005B   8B83         MOV     DPH,R3
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   64FF         XRL     A,#0xff
   \   000060   6003         JZ      $+5
   \   000062   02....       LJMP    ??zmain_ext_addr_1
   \   000065   0C           INC     R4
   \   000066   EC           MOV     A,R4
   \   000067   C3           CLR     C
   \   000068   9408         SUBB    A,#0x8
   \   00006A   40E0         JC      ??zmain_ext_addr_0
    271          
    272          #ifdef ZDO_COORDINATOR
    273            tmp = 0x10;
   \   00006C   7B10         MOV     R3,#0x10
    274          #else
    275            tmp = 0x20;
    276          #endif
    277            // Initialize with a simple pattern
    278            xad = (uint8*)&aExtendedAddress;
   \   00006E   78..         MOV     R0,#(aExtendedAddress & 0xff)
   \   000070   79..         MOV     R1,#((aExtendedAddress >> 8) & 0xff)
    279            for ( i = 0; i < Z_EXTADDR_LEN; i++ )
   \   000072   7A08         MOV     R2,#0x8
    280              *xad++ = tmp++;
   \                     ??zmain_ext_addr_2:
   \   000074   EB           MOV     A,R3
   \   000075   8882         MOV     DPL,R0
   \   000077   8983         MOV     DPH,R1
   \   000079   F0           MOVX    @DPTR,A
   \   00007A   0B           INC     R3
   \   00007B   A3           INC     DPTR
   \   00007C   A882         MOV     R0,DPL
   \   00007E   A983         MOV     R1,DPH
   \   000080   1A           DEC     R2
   \   000081   EA           MOV     A,R2
   \   000082   70F0         JNZ     ??zmain_ext_addr_2
    281          
    282            // Flash LED1 until user hits SW5
    283            led = HAL_LED_MODE_OFF;
   \   000084   75..00       MOV     ?V0 + 0,#0x0
   \   000087   8018         SJMP    ??zmain_ext_addr_3
    284            while ( HAL_KEY_SW_5 != HalKeyRead() )
    285            {
    286              MicroWait( 62500 );
   \                     ??zmain_ext_addr_4:
   \   000089                ; Setup parameters for call to function Onboard_wait
   \   000089   7A24         MOV     R2,#0x24
   \   00008B   7BF4         MOV     R3,#-0xc
   \   00008D   12....       LCALL   ??Onboard_wait?relay
    287              HalLedSet( HAL_LED_1, led^=HAL_LED_MODE_ON );  // Toggle the LED
   \   000090   63..01       XRL     ?V0 + 0,#0x1
   \   000093                ; Setup parameters for call to function HalLedSet
   \   000093   AA..         MOV     R2,?V0 + 0
   \   000095   7901         MOV     R1,#0x1
   \   000097   12....       LCALL   ??HalLedSet?relay
    288              MicroWait( 62500 );
   \   00009A                ; Setup parameters for call to function Onboard_wait
   \   00009A   7A24         MOV     R2,#0x24
   \   00009C   7BF4         MOV     R3,#-0xc
   \   00009E   12....       LCALL   ??Onboard_wait?relay
    289            }
   \                     ??zmain_ext_addr_3:
   \   0000A1                ; Setup parameters for call to function HalKeyRead
   \   0000A1   12....       LCALL   ??HalKeyRead?relay
   \   0000A4   E9           MOV     A,R1
   \   0000A5   6404         XRL     A,#0x4
   \   0000A7   70E0         JNZ     ??zmain_ext_addr_4
    290            HalLedSet( HAL_LED_1, HAL_LED_MODE_OFF );
   \   0000A9                ; Setup parameters for call to function HalLedSet
   \   0000A9   7A00         MOV     R2,#0x0
   \   0000AB   7901         MOV     R1,#0x1
   \   0000AD   12....       LCALL   ??HalLedSet?relay
    291          
    292            // Plug AtoD data into lower bytes
    293            AtoD = HalAdcRead (HAL_ADC_CHANNEL_7, HAL_ADC_RESOLUTION_10);
   \   0000B0                ; Setup parameters for call to function HalAdcRead
   \   0000B0   7A02         MOV     R2,#0x2
   \   0000B2   7907         MOV     R1,#0x7
   \   0000B4   12....       LCALL   ??HalAdcRead?relay
    294            xad = (uint8*)&aExtendedAddress;
    295            *xad++ = LO_UINT16( AtoD );
   \   0000B7   EA           MOV     A,R2
   \   0000B8   90....       MOV     DPTR,#aExtendedAddress
   \   0000BB   F0           MOVX    @DPTR,A
    296            *xad = HI_UINT16( AtoD );
   \   0000BC   EB           MOV     A,R3
   \   0000BD   90....       MOV     DPTR,#(aExtendedAddress + 1)
   \   0000C0   F0           MOVX    @DPTR,A
    297          
    298          #if !defined( ZTOOL_PORT ) || defined( ZPORT ) || defined( NV_RESTORE )
    299            // If no support for Z-Tool serial I/O,
    300            // Write temporary 64-bit address to NV
    301            osal_nv_write( ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, &aExtendedAddress );
   \   0000C1                ; Setup parameters for call to function osal_nv_write
   \   0000C1   75....       MOV     ?V0 + 0,#(aExtendedAddress & 0xff)
   \   0000C4   75....       MOV     ?V0 + 1,#((aExtendedAddress >> 8) & 0xff)
   \   0000C7   78..         MOV     R0,#?V0 + 0
   \   0000C9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CC   75..08       MOV     ?V0 + 0,#0x8
   \   0000CF   75..00       MOV     ?V0 + 1,#0x0
   \   0000D2   78..         MOV     R0,#?V0 + 0
   \   0000D4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D7   7C00         MOV     R4,#0x0
   \   0000D9   7D00         MOV     R5,#0x0
   \   0000DB   7A01         MOV     R2,#0x1
   \   0000DD   7B00         MOV     R3,#0x0
   \   0000DF   12....       LCALL   ??osal_nv_write?relay
   \   0000E2   7404         MOV     A,#0x4
   \   0000E4   12....       LCALL   ?DEALLOC_XSTACK8
    302          #endif
    303          }
   \                     ??zmain_ext_addr_1:
   \   0000E7                REQUIRE ?Subroutine3
   \   0000E7                ; // Fall through to label ?Subroutine3

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?FUNC_LEAVE_XDATA
    304          
    305          /*********************************************************************
    306           * @fn      zmain_dev_info
    307           * @brief   Gets or makes extended address.
    308           * @return  none
    309           *********************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    310          static ZSEG void zmain_dev_info ( void )
   \                     zmain_dev_info:
    311          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?FUNC_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 18
   \   000005   74EE         MOV     A,#-0x12
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    312          #ifdef LCD_SUPPORTED
    313            uint8 i;
    314            uint8 ch;
    315            uint8 *xad;
    316            unsigned char lcd_buf[18];
    317          
    318            // Display the extended address
    319            xad = (uint8*)&aExtendedAddress + Z_EXTADDR_LEN - 1;
   \   00000A   78..         MOV     R0,#((aExtendedAddress + 7) & 0xff)
   \   00000C   79..         MOV     R1,#(((aExtendedAddress + 7) >> 8) & 0xff)
    320            for ( i = 0; i < Z_EXTADDR_LEN*2; xad-- ) {
   \   00000E   7C00         MOV     R4,#0x0
    321              ch = (*xad >> 4) & 0x0F;
   \                     ??zmain_dev_info_0:
   \   000010   8882         MOV     DPL,R0
   \   000012   8983         MOV     DPH,R1
   \   000014   E0           MOVX    A,@DPTR
   \   000015   C4           SWAP    A
   \   000016   12....       LCALL   ?Subroutine2
    322              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
   \                     ??CrossCallReturnLabel_4:
   \   000019   5004         JNC     ??zmain_dev_info_1
   \   00001B   7A30         MOV     R2,#0x30
   \   00001D   8002         SJMP    ??zmain_dev_info_2
   \                     ??zmain_dev_info_1:
   \   00001F   7A37         MOV     R2,#0x37
   \                     ??zmain_dev_info_2:
   \   000021   EA           MOV     A,R2
   \   000022   2D           ADD     A,R5
   \   000023   C0E0         PUSH    A
   \   000025   12....       LCALL   ?Subroutine1
   \                     ??CrossCallReturnLabel_2:
   \   000028   D0E0         POP     A
   \   00002A   F0           MOVX    @DPTR,A
    323              ch = *xad & 0x0F;
   \   00002B   8882         MOV     DPL,R0
   \   00002D   8983         MOV     DPH,R1
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   12....       LCALL   ?Subroutine2
    324              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
   \                     ??CrossCallReturnLabel_5:
   \   000033   5004         JNC     ??zmain_dev_info_3
   \   000035   7A30         MOV     R2,#0x30
   \   000037   8002         SJMP    ??zmain_dev_info_4
   \                     ??zmain_dev_info_3:
   \   000039   7A37         MOV     R2,#0x37
   \                     ??zmain_dev_info_4:
   \   00003B   EA           MOV     A,R2
   \   00003C   2D           ADD     A,R5
   \   00003D   C0E0         PUSH    A
   \   00003F   12....       LCALL   ?Subroutine1
   \                     ??CrossCallReturnLabel_3:
   \   000042   D0E0         POP     A
   \   000044   F0           MOVX    @DPTR,A
    325            }
   \   000045   E8           MOV     A,R0
   \   000046   24FF         ADD     A,#-0x1
   \   000048   18           DEC     R0
   \   000049   E9           MOV     A,R1
   \   00004A   34FF         ADDC    A,#-0x1
   \   00004C   F9           MOV     R1,A
   \   00004D   EC           MOV     A,R4
   \   00004E   C3           CLR     C
   \   00004F   9410         SUBB    A,#0x10
   \   000051   40BD         JC      ??zmain_dev_info_0
    326            lcd_buf[Z_EXTADDR_LEN*2] = '\0';
   \   000053   7410         MOV     A,#0x10
   \   000055   12....       LCALL   ?XSTACK_DISP0_8
   \   000058   E4           CLR     A
   \   000059   F0           MOVX    @DPTR,A
    327            HalLcdWriteString( "IEEE Address:", HAL_LCD_LINE_1 );
   \   00005A                ; Setup parameters for call to function HalLcdWriteString
   \   00005A   F9           MOV     R1,A
   \   00005B   7A..         MOV     R2,#(`?<Constant "IEEE Address:">` & 0xff)
   \   00005D   7B..         MOV     R3,#((`?<Constant "IEEE Address:">` >> 8) & 0xff)
   \   00005F   12....       LCALL   ??HalLcdWriteString?relay
    328            HalLcdWriteString( (char*)lcd_buf, HAL_LCD_LINE_2 );
   \   000062                ; Setup parameters for call to function HalLcdWriteString
   \   000062   7902         MOV     R1,#0x2
   \   000064   85..82       MOV     DPL,?XSP + 0
   \   000067   85..83       MOV     DPH,?XSP + 1
   \   00006A   AA82         MOV     R2,DPL
   \   00006C   AB83         MOV     R3,DPH
   \   00006E   12....       LCALL   ??HalLcdWriteString?relay
    329          #endif // LCD
    330          }
   \   000071   7412         MOV     A,#0x12
   \   000073   12....       LCALL   ?DEALLOC_XSTACK8
   \   000076   80..         SJMP    ?Subroutine3

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   540F         ANL     A,#0xf
   \   000002   FD           MOV     R5,A
   \   000003   8C..         MOV     ?V0 + 0,R4
   \   000005   0C           INC     R4
   \   000006   C3           CLR     C
   \   000007   940A         SUBB    A,#0xa
   \   000009   22           RET

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E582         MOV     A,DPL
   \   000008   25..         ADD     A,?V0 + 0
   \   00000A   F582         MOV     DPL,A
   \   00000C   E583         MOV     A,DPH
   \   00000E   3400         ADDC    A,#0x0
   \   000010   F583         MOV     DPH,A
   \   000012   22           RET

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   E582         MOV     A,DPL
   \   000002   24FF         ADD     A,#-0x1
   \   000004   F582         MOV     DPL,A
   \   000006   E583         MOV     A,DPH
   \   000008   34FF         ADDC    A,#-0x1
   \   00000A   F583         MOV     DPH,A
   \   00000C   22           RET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "IEEE Address:">>`:
   \   000000   49454545     DB "IEEE Address:"
   \            20416464
   \            72657373
   \            3A00    

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "Figure8 Wireless"`:
   \   000000   46696775     DB "Figure8 Wireless"
   \            72653820
   \            57697265
   \            6C657373
   \            00      

   \                                 In  segment XSP, align 1

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "IEEE Address:">`:
   \   000000                DS 14
   \   00000E                REQUIRE `?<Initializer for <Constant "IEEE Address:">>`
   \   00000E                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "Figure8 Wireless">`:
   \   000000                DS 17
   \   000011                REQUIRE `?<Initializer for <Constant "Figure8 Wireless"`
   \   000011                REQUIRE __INIT_XDATA_I
    331          
    332          /*********************************************************************
    333           * @fn      zmain_ram_init
    334           * @brief   Initialize ram for stack "high-water-mark" observations.
    335           * @return  none
    336           *********************************************************************/
    337          static ZSEG void zmain_ram_init( void )
    338          {
    339            uint8 *end;
    340            uint8 *ptr;
    341          
    342            // Initialize the call (parameter) stack
    343            end = (uint8*)CSTK_BEG;  // Lower end
    344            ptr = (uint8*)(*( __idata uint16*)(CSTK_PTR));  // Upper end
    345            while ( --ptr > end )
    346              *ptr = STACK_INIT_VALUE;
    347          
    348            // Initialize the return (address) stack
    349            ptr = (uint8*)RSTK_END - 1;  // Upper end
    350            while ( --ptr > (uint8*)SP )
    351              *(__idata uint8*)ptr = STACK_INIT_VALUE;
    352          }
    353          
    354          #ifdef LCD_SUPPORTED
    355          /*********************************************************************
    356           * @fn      zmain_lcd_init
    357           * @brief   Initialize LCD at start up.
    358           * @return  none
    359           *********************************************************************/
    360          static ZSEG void zmain_lcd_init ( void )
    361          {
    362          #ifdef LCD_SD
    363           // if ( LcdLine1 == NULL )
    364            {
    365              HalLcdWriteString( "Figure8 Wireless", HAL_LCD_LINE_1 );
    366          
    367          #if defined( MT_MAC_FUNC )
    368          #if defined( ZDO_COORDINATOR )
    369                HalLcdWriteString( "MAC-MT Coord", HAL_LCD_LINE_2 );
    370          #else
    371                HalLcdWriteString( "MAC-MT Device", HAL_LCD_LINE_2 );
    372          #endif // ZDO
    373          #elif defined( MT_NWK_FUNC )
    374          #if defined( ZDO_COORDINATOR )
    375                HalLcdWriteString( "NWK Coordinator", HAL_LCD_LINE_2 );
    376          #else
    377                HalLcdWriteString( "NWK Device", HAL_LCD_LINE_2 );
    378          #endif // ZDO
    379          #endif // MT_FUNC
    380            }
    381          #endif // LCD_SD
    382          }
    383          #endif
    384          
    385          /*********************************************************************
    386          *********************************************************************/

   Maximum stack usage in bytes:

     Function               ISTACK PSTACK XSTACK
     --------               ------ ------ ------
     main                       1      0      0
       -> osal_int_disable      0      0      0
       -> zmain_vdd_check       0      0      0
       -> InitBoard             0      0      0
       -> HalDriverInit         0      0      0
       -> osal_nv_init          0      0      0
       -> zmain_ext_addr        0      0      0
       -> zgInit                0      0      0
       -> ZMacInit              0      0      0
       -> afInit                0      0      0
       -> osal_init_system      0      0      0
       -> osal_int_enable       0      0      0
       -> InitBoard             0      0      0
       -> zmain_dev_info        0      0      0
       -> HalLcdWriteString     0      0      0
       -> osal_start_system     0      0      0
     zmain_dev_info             1      0     27
       -> HalLcdWriteString     0      0     54
       -> HalLcdWriteString     0      0     54
     zmain_ext_addr             1      0     13
       -> osal_nv_item_init     0      0     22
       -> osal_nv_read          0      0     26
       -> Onboard_wait          0      0     18
       -> HalLedSet             0      0     18
       -> Onboard_wait          0      0     18
       -> HalKeyRead            0      0     18
       -> HalLedSet             0      0     18
       -> HalAdcRead            0      0     18
       -> osal_nv_write         0      0     26
     zmain_vdd_check            0      0      8
       -> HalAdcCheckVdd        0      0     16
       -> Onboard_wait          0      0     16
       -> Onboard_wait          0      0     16
       -> Onboard_wait          0      0     16


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     SP                                1
     P0INP                             1
     _A_P1                             1
     SLEEP                             1
     CLKCON                            1
     P1DIR                             1
     P2DIR                             1
     main                            180
     zmain_vdd_check                  95
     zmain_ext_addr                  231
     ?Subroutine3                      5
     zmain_dev_info                  120
     ?Subroutine2                     10
     ?Subroutine1                     19
     ?Subroutine0                     13
     ?<Initializer for <Constant "IEEE Address:">>
                                      14
     ?<Initializer for <Constant "Figure8 Wireless"
                                      17
     ?<Constant "IEEE Address:">      14
     ?<Constant "Figure8 Wireless">   17

 
 673 bytes in segment NEAR_CODE
   7 bytes in segment SFR_AN
  31 bytes in segment XDATA_I
  31 bytes in segment XDATA_ID
 
 704 bytes of CODE  memory
   0 bytes of DATA  memory (+ 7 bytes shared)
  31 bytes of XDATA memory

Errors: none
Warnings: none
